<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>10 deg2 Test Region &#8212; obiwan 1.2.0 documentation</title>
    <link rel="stylesheet" href="../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="../_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="../_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-3.3.7/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-sphinx.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">

  </head><body>

  <div id="navbar" class="navbar navbar-default ">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="../index.html">
          Obiwan</a>
        <span class="navbar-text navbar-version pull-left"><b>1.2.0</b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
                <li><a href="../api.html">API</a></li>
                <li><a href="../tutorials.html">Tutorials</a></li>
                <li><a href="../deeplearning.html">Deep Learning</a></li>
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="../index.html">Pages <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"></ul>
</li>
              
                <li class="dropdown">
  <a role="button"
     id="dLabelLocalToc"
     data-toggle="dropdown"
     data-target="#"
     href="#">This Page <b class="caret"></b></a>
  <ul class="dropdown-menu localtoc"
      role="menu"
      aria-labelledby="dLabelLocalToc"><ul>
<li><a class="reference internal" href="#">10 deg2 Test Region</a></li>
<li><a class="reference internal" href="#Sources-are-clustered-in-the-Data-Base">Sources are clustered in the Data Base</a></li>
<li><a class="reference internal" href="#Recovered-sources-are-within-1-arcsec">Recovered sources are within 1 arcsec</a></li>
<li><a class="reference internal" href="#Brightness-distribution-of-Missed,-Recovered,-and-Real-sources">Brightness distribution of Missed, Recovered, and Real sources</a></li>
<li><a class="reference internal" href="#Missed-or-Recovered-only-depends-on-source-brightness">Missed or Recovered only depends on source brightness</a></li>
<li><a class="reference internal" href="#Truth---Measured-(binned-by-magnitude)">Truth - Measured (binned by magnitude)</a></li>
<li><a class="reference internal" href="#Recovered-sources-are-all-photometric-(flux-&gt;-0,-ivar-&gt;-0,-allmaks)">Recovered sources are all photometric (flux &gt; 0, ivar &gt; 0, allmaks)</a></li>
<li><a class="reference internal" href="#Recovered-sources-by-&quot;type&quot;">Recovered sources by “type”</a></li>
<li><a class="reference internal" href="#Depth-(fraction-recovered-versus-mag)">Depth (fraction recovered versus mag)</a></li>
<li><a class="reference internal" href="#Depth-2-(fraction-recovered-by-&quot;type&quot;)">Depth 2 (fraction recovered by “type”)</a></li>
<li><a class="reference internal" href="#Visualize-Real-vs.-Recovered-sources">Visualize Real vs. Recovered sources</a><ul>
<li><a class="reference internal" href="#Real">Real</a></li>
<li><a class="reference internal" href="#Recovered">Recovered</a></li>
<li><a class="reference internal" href="#Real-vs.-Recovered-grouped-by-g-mag">Real vs. Recovered grouped by g-mag</a></li>
</ul>
</li>
<li><a class="reference internal" href="#Properties-of-Recovered-sources">Properties of Recovered sources</a><ul>
<li><a class="reference internal" href="#Recovered-!=-func(-rhalf-)">Recovered != func( rhalf )</a></li>
<li><a class="reference internal" href="#Huge-scatter-in-True/Measured-rhalf">Huge scatter in True/Measured rhalf</a></li>
<li><a class="reference internal" href="#Pairplot-(hue=-Recoverec)">Pairplot (hue= Recoverec)</a></li>
<li><a class="reference internal" href="#By-not-adding-DEV-galaxies,-I-put-into-too-many-EXP">By not adding DEV galaxies, I put into too many EXP</a></li>
</ul>
</li>
<li><a class="reference internal" href="#Reocvered-vs.-Missed">Reocvered vs. Missed</a><ul>
<li><a class="reference internal" href="#TS-box">TS box</a></li>
<li><a class="reference internal" href="#Redshift">Redshift</a></li>
<li><a class="reference internal" href="#TS-box-colorcoded-by-Redshift">TS box colorcoded by Redshift</a></li>
</ul>
</li>
</ul>
</ul>
</li>
              
            
            
              
                
              
            
            
            
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="col-md-12 content">
      
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput,
div.nbinput div.prompt,
div.nbinput div.input_area,
div.nbinput div[class*=highlight],
div.nbinput div[class*=highlight] pre,
div.nboutput,
div.nbinput div.prompt,
div.nbinput div.output_area,
div.nboutput div[class*=highlight],
div.nboutput div[class*=highlight] pre {
    background: none;
    border: none;
    padding: 0 0;
    margin: 0;
    box-shadow: none;
}

/* avoid gaps between output lines */
div.nboutput div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput,
div.nboutput {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput,
    div.nboutput {
        flex-direction: column;
    }
}

/* input container */
div.nbinput {
    padding-top: 5px;
}

/* last container */
div.nblast {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput div.prompt pre {
    color: #303F9F;
}

/* output prompt */
div.nboutput div.prompt pre {
    color: #D84315;
}

/* all prompts */
div.nbinput div.prompt,
div.nboutput div.prompt {
    min-width: 9ex;
    padding-top: 0.4em;
    padding-right: 0.4em;
    text-align: right;
    flex: 0;
}
@media (max-width: 540px) {
    div.nbinput div.prompt,
    div.nboutput div.prompt {
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput div.prompt.empty {
        padding: 0;
    }
}

/* disable scrollbars on prompts */
div.nbinput div.prompt pre,
div.nboutput div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput div.input_area,
div.nboutput div.output_area {
    padding: 0.4em;
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput div.input_area,
    div.nboutput div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput div.input_area {
    border: 1px solid #cfcfcf;
    border-radius: 2px;
    background: #f7f7f7;
}

/* override MathJax center alignment in output cells */
div.nboutput div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.pngmath center alignment in output cells */
div.nboutput div.math p {
    text-align: left;
}

/* standard error */
div.nboutput div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }
</style>
<div class="section" id="10-deg2-Test-Region">
<h1>10 deg2 Test Region<a class="headerlink" href="#10-deg2-Test-Region" title="Permalink to this headline">¶</a></h1>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="kn">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">itertools</span>
<span class="kn">from</span> <span class="nn">PIL</span> <span class="kn">import</span> <span class="n">Image</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="kn">as</span> <span class="nn">sns</span>
<span class="kn">import</span> <span class="nn">fitsio</span>
<span class="kn">import</span> <span class="nn">skimage.io</span>

<span class="c1"># to make this notebook&#39;s output stable across runs</span>
<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">7</span><span class="p">)</span>

<span class="c1"># To plot pretty figures</span>
<span class="o">%</span><span class="k">matplotlib</span> inline
<span class="kn">import</span> <span class="nn">matplotlib</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;axes.labelsize&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">14</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;xtick.labelsize&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">12</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;ytick.labelsize&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">12</span>

<span class="o">%</span><span class="k">load_ext</span> autoreload
<span class="o">%</span><span class="k">autoreload</span> 2

</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">REPO_DIR</span><span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;HOME&#39;</span><span class="p">],</span>
                       <span class="s1">&#39;myrepo/obiwan&#39;</span><span class="p">)</span>
<span class="n">DATA_DIR</span><span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;HOME&#39;</span><span class="p">],</span>
                       <span class="s1">&#39;mydata&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">astrometry.util.fits</span> <span class="kn">import</span> <span class="n">fits_table</span><span class="p">,</span> <span class="n">merge_tables</span>
<span class="kn">from</span> <span class="nn">obiwan.common</span> <span class="kn">import</span> <span class="n">fits2pandas</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">simcat</span><span class="o">=</span><span class="n">fits_table</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">DATA_DIR</span><span class="p">,</span>
                 <span class="s1">&#39;1741p242&#39;</span><span class="p">,</span><span class="s1">&#39;rs0/obiwan&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;simcat-elg-1741p242.fits&#39;</span><span class="p">))</span>
<span class="n">skipid</span><span class="o">=</span><span class="n">fits_table</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">DATA_DIR</span><span class="p">,</span>
                 <span class="s1">&#39;1741p242&#39;</span><span class="p">,</span><span class="s1">&#39;rs0/obiwan&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;skippedids-elg-1741p242.fits&#39;</span><span class="p">))</span>

<span class="n">obitractor</span><span class="o">=</span> <span class="n">fits_table</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">DATA_DIR</span><span class="p">,</span>
                 <span class="s1">&#39;1741p242&#39;</span><span class="p">,</span><span class="s1">&#39;rs0/tractor&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;tractor-1741p242.fits&#39;</span><span class="p">))</span>

<span class="n">dr5tractor</span><span class="o">=</span> <span class="n">fits_table</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">DATA_DIR</span><span class="p">,</span>
                 <span class="s1">&#39;1741p242&#39;</span><span class="p">,</span><span class="s1">&#39;dr5&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;tractor-1741p242.fits&#39;</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="nb">len</span><span class="p">(</span><span class="n">simcat</span><span class="p">),</span><span class="nb">len</span><span class="p">(</span><span class="n">skipid</span><span class="p">),</span> <span class="n">simcat</span><span class="o">.</span><span class="n">get_columns</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>Out[5]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>(282,
 18,
 [&#39;id&#39;,
  &#39;seed&#39;,
  &#39;ra&#39;,
  &#39;dec&#39;,
  &#39;x&#39;,
  &#39;y&#39;,
  &#39;gflux&#39;,
  &#39;rflux&#39;,
  &#39;zflux&#39;,
  &#39;sersicn&#39;,
  &#39;rhalf&#39;,
  &#39;ba&#39;,
  &#39;phi&#39;])
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">dr5tractor</span><span class="o">.</span><span class="n">shapeexp_e1</span><span class="p">,</span><span class="n">dr5tractor</span><span class="o">.</span><span class="n">shapeexp_e2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>Out[8]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>&lt;matplotlib.collections.PathCollection at 0x7f690b687a90&gt;
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/nb_10deg2_region_6_1.png" src="../_images/nb_10deg2_region_6_1.png" />
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">def</span> <span class="nf">readImage</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span><span class="n">jpeg</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Reads FITS and jpeg images so that x,y indices refer to the same pixels</span>
<span class="sd">    regardless of image format. x,y and fits correspond so the jpeg is rotated and flipped</span>
<span class="sd">    to align with fits</span>

<span class="sd">    Args:</span>
<span class="sd">        fn: image filename</span>
<span class="sd">        jpeg: bool, is is a jpeg?</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">jpeg</span><span class="p">:</span>
        <span class="n">img</span><span class="o">=</span> <span class="n">skimage</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
            <span class="n">img</span><span class="p">[:,:,</span><span class="n">i</span><span class="p">]</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">rot90</span><span class="p">(</span><span class="n">img</span><span class="p">[:,:,</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">img</span><span class="o">=</span> <span class="n">fitsio</span><span class="o">.</span><span class="n">FITS</span><span class="p">(</span><span class="n">fn</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">img</span>

<span class="k">def</span> <span class="nf">sliceImage</span><span class="p">(</span><span class="n">img</span><span class="p">,</span>
               <span class="n">xslice</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span><span class="bp">None</span><span class="p">),</span><span class="n">yslice</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span><span class="bp">None</span><span class="p">)):</span>
    <span class="sd">&quot;&quot;&quot;Not sure why, but simcat.x[xslice],simcat.y[yslice]</span>
<span class="sd">    corresponds to img[yslice,xslice], eg inverted for the image&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">img</span><span class="p">[</span><span class="n">yslice</span><span class="p">,</span><span class="n">xslice</span><span class="p">,</span><span class="o">...</span><span class="p">]</span>

<span class="k">class</span> <span class="nc">plotImage</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Helper functions for displaying image and overlaying circles around sources</span>

<span class="sd">    Args:</span>
<span class="sd">        img: need to give as initial input b/c some helper funcs that dont directly</span>
<span class="sd">            use img, need its shape at least, see circles()</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">imshow</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">img</span><span class="p">,</span><span class="n">ax</span><span class="p">,</span><span class="n">qs</span><span class="o">=</span><span class="p">[</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">99.5</span><span class="p">]):</span>
        <span class="k">if</span> <span class="n">img</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
            <span class="c1">#minmax=np.percentile(np.sum(img,axis=2),q=qs)</span>
            <span class="n">minmax</span><span class="o">=</span><span class="p">[</span><span class="bp">None</span><span class="p">,</span><span class="bp">None</span><span class="p">]</span>
            <span class="n">cmap</span><span class="o">=</span><span class="bp">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">minmax</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">img</span><span class="p">,</span><span class="n">q</span><span class="o">=</span><span class="n">qs</span><span class="p">)</span>
            <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">interpolation</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span>
                  <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span><span class="n">vmin</span><span class="o">=</span><span class="n">minmax</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">vmax</span><span class="o">=</span><span class="n">minmax</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">direction</span><span class="o">=</span><span class="s1">&#39;out&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">circles</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">xs</span><span class="p">,</span><span class="n">ys</span><span class="p">,</span><span class="n">ax</span><span class="p">,</span>
                <span class="n">img_shape</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                <span class="n">xslice</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">yslice</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                <span class="n">r_pixels</span><span class="o">=</span><span class="mf">5.</span><span class="o">/</span><span class="mf">0.262</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        xs,ys: x,y positions of sources in pixels, e.g. tractor.bx or simcat.x</span>
<span class="sd">        img_shape: needed when xslice or yslice is None</span>
<span class="sd">        xlice,yslice: slice() objects into the image array</span>
<span class="sd">        r_pixels: radius circles in pixels</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">xslice</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">yslice</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">):</span>
            <span class="k">assert</span><span class="p">(</span><span class="ow">not</span> <span class="n">img_shape</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">xslice</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">xslice</span><span class="o">=</span> <span class="nb">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">img_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">yslice</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">yslice</span><span class="o">=</span> <span class="nb">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">img_shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">keep</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">justInSlice</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span><span class="n">ys</span><span class="p">,</span><span class="n">xslice</span><span class="p">,</span><span class="n">yslice</span><span class="p">)</span>
        <span class="n">xpos</span><span class="p">,</span><span class="n">ypos</span><span class="o">=</span> <span class="n">xs</span><span class="p">[</span><span class="n">keep</span><span class="p">]</span><span class="o">-</span><span class="n">xslice</span><span class="o">.</span><span class="n">start</span><span class="p">,</span><span class="n">ys</span><span class="p">[</span><span class="n">keep</span><span class="p">]</span><span class="o">-</span><span class="n">yslice</span><span class="o">.</span><span class="n">start</span>

        <span class="kn">from</span> <span class="nn">matplotlib.patches</span> <span class="kn">import</span> <span class="n">Circle</span><span class="p">,</span><span class="n">Wedge</span>
        <span class="kn">from</span> <span class="nn">matplotlib.collections</span> <span class="kn">import</span> <span class="n">PatchCollection</span>
        <span class="n">dr</span><span class="o">=</span> <span class="n">r_pixels</span><span class="o">/</span> <span class="mi">20</span>
        <span class="n">patches</span><span class="o">=</span><span class="p">[</span><span class="n">Wedge</span><span class="p">((</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span> <span class="n">r_pixels</span> <span class="o">+</span> <span class="n">dr</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">360</span><span class="p">,</span><span class="n">dr</span><span class="p">)</span>
                 <span class="k">for</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">xpos</span><span class="p">,</span> <span class="n">ypos</span><span class="p">)</span> <span class="p">]</span>
        <span class="n">coll</span> <span class="o">=</span> <span class="n">PatchCollection</span><span class="p">(</span><span class="n">patches</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">)</span> <span class="c1">#,alpha=1)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">add_collection</span><span class="p">(</span><span class="n">coll</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">justInSlice</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">xslice</span><span class="p">,</span><span class="n">yslice</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns bool array of x,y positions in the slice()&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">((</span><span class="n">x</span> <span class="o">&gt;=</span> <span class="n">xslice</span><span class="o">.</span><span class="n">start</span><span class="p">)</span> <span class="o">&amp;</span>
               <span class="p">(</span><span class="n">x</span> <span class="o">&lt;=</span> <span class="n">xslice</span><span class="o">.</span><span class="n">stop</span><span class="p">)</span> <span class="o">&amp;</span>
               <span class="p">(</span><span class="n">y</span> <span class="o">&gt;=</span> <span class="n">yslice</span><span class="o">.</span><span class="n">start</span><span class="p">)</span> <span class="o">&amp;</span>
               <span class="p">(</span><span class="n">y</span> <span class="o">&lt;=</span> <span class="n">yslice</span><span class="o">.</span><span class="n">stop</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">img_dr5_g</span><span class="o">=</span> <span class="n">readImage</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">DATA_DIR</span><span class="p">,</span>
                     <span class="s1">&#39;1741p242&#39;</span><span class="p">,</span><span class="s1">&#39;dr5&#39;</span><span class="p">,</span>
                     <span class="s1">&#39;legacysurvey-1741p242-image-g.fits.fz&#39;</span><span class="p">))</span>
<span class="n">img_dr5_r</span><span class="o">=</span> <span class="n">readImage</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">DATA_DIR</span><span class="p">,</span>
                     <span class="s1">&#39;1741p242&#39;</span><span class="p">,</span><span class="s1">&#39;dr5&#39;</span><span class="p">,</span>
                     <span class="s1">&#39;legacysurvey-1741p242-image-r.fits.fz&#39;</span><span class="p">))</span>
<span class="n">img_dr5_z</span><span class="o">=</span> <span class="n">readImage</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">DATA_DIR</span><span class="p">,</span>
                     <span class="s1">&#39;1741p242&#39;</span><span class="p">,</span><span class="s1">&#39;dr5&#39;</span><span class="p">,</span>
                     <span class="s1">&#39;legacysurvey-1741p242-image-z.fits.fz&#39;</span><span class="p">))</span>

<span class="n">img_obi_g</span><span class="o">=</span> <span class="n">readImage</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">DATA_DIR</span><span class="p">,</span>
                     <span class="s1">&#39;1741p242&#39;</span><span class="p">,</span><span class="s1">&#39;rs0/coadd&#39;</span><span class="p">,</span>
                     <span class="s1">&#39;legacysurvey-1741p242-image-g.fits.fz&#39;</span><span class="p">))</span>
<span class="n">img_obi_r</span><span class="o">=</span> <span class="n">readImage</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">DATA_DIR</span><span class="p">,</span>
                     <span class="s1">&#39;1741p242&#39;</span><span class="p">,</span><span class="s1">&#39;rs0/coadd&#39;</span><span class="p">,</span>
                     <span class="s1">&#39;legacysurvey-1741p242-image-r.fits.fz&#39;</span><span class="p">))</span>
<span class="n">img_obi_z</span><span class="o">=</span> <span class="n">readImage</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">DATA_DIR</span><span class="p">,</span>
                     <span class="s1">&#39;1741p242&#39;</span><span class="p">,</span><span class="s1">&#39;rs0/coadd&#39;</span><span class="p">,</span>
                     <span class="s1">&#39;legacysurvey-1741p242-image-z.fits.fz&#39;</span><span class="p">))</span>

<span class="n">img_jpg</span><span class="o">=</span> <span class="n">readImage</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">DATA_DIR</span><span class="p">,</span>
                      <span class="s1">&#39;1741p242&#39;</span><span class="p">,</span><span class="s1">&#39;rs0/coadd&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;legacysurvey-1741p242-image.jpg&#39;</span><span class="p">),</span>
                     <span class="n">jpeg</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
<span class="n">plotImage</span><span class="p">()</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">img_obi_r</span><span class="p">,</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">plotImage</span><span class="p">()</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">img_obi_z</span><span class="p">,</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">plotImage</span><span class="p">()</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">img_jpg</span><span class="p">,</span><span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
    <span class="n">plotImage</span><span class="p">()</span><span class="o">.</span><span class="n">circles</span><span class="p">(</span><span class="n">simcat</span><span class="o">.</span><span class="n">x</span><span class="p">,</span><span class="n">simcat</span><span class="o">.</span><span class="n">y</span><span class="p">,</span><span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                        <span class="n">img_shape</span><span class="o">=</span><span class="n">img_obi_z</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/nb_10deg2_region_8_0.png" src="../_images/nb_10deg2_region_8_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>
<span class="n">plotImage</span><span class="p">()</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">img_obi_z</span> <span class="o">-</span> <span class="n">img_dr5_z</span><span class="p">,</span><span class="n">ax</span><span class="p">)</span>
<span class="n">plotImage</span><span class="p">()</span><span class="o">.</span><span class="n">circles</span><span class="p">(</span><span class="n">simcat</span><span class="o">.</span><span class="n">x</span><span class="p">,</span><span class="n">simcat</span><span class="o">.</span><span class="n">y</span><span class="p">,</span><span class="n">ax</span><span class="p">,</span>
                    <span class="n">img_shape</span><span class="o">=</span><span class="n">img_obi_z</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/nb_10deg2_region_9_0.png" src="../_images/nb_10deg2_region_9_0.png" />
</div>
</div>
</div>
<div class="section" id="Sources-are-clustered-in-the-Data-Base">
<h1>Sources are clustered in the Data Base<a class="headerlink" href="#Sources-are-clustered-in-the-Data-Base" title="Permalink to this headline">¶</a></h1>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">print</span><span class="p">(</span><span class="s2">&quot;Yellow: first 300 from DB, Magenta: all&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Yellow: first 300 from DB, Magenta: all
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>
<span class="n">plotImage</span><span class="p">()</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">img_jpg</span><span class="p">,</span><span class="n">ax</span><span class="p">)</span>
<span class="n">plotImage</span><span class="p">()</span><span class="o">.</span><span class="n">circles</span><span class="p">(</span><span class="n">dr5tractor</span><span class="o">.</span><span class="n">bx</span><span class="p">,</span><span class="n">dr5tractor</span><span class="o">.</span><span class="n">by</span><span class="p">,</span><span class="n">ax</span><span class="p">,</span>
                    <span class="n">img_shape</span><span class="o">=</span><span class="n">img_jpg</span><span class="p">[:,:,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span>
                    <span class="n">color</span><span class="o">=</span><span class="s1">&#39;m&#39;</span><span class="p">)</span>
<span class="n">plotImage</span><span class="p">()</span><span class="o">.</span><span class="n">circles</span><span class="p">(</span><span class="n">obitractor</span><span class="o">.</span><span class="n">bx</span><span class="p">,</span><span class="n">obitractor</span><span class="o">.</span><span class="n">by</span><span class="p">,</span><span class="n">ax</span><span class="p">,</span>
                    <span class="n">img_shape</span><span class="o">=</span><span class="n">img_jpg</span><span class="p">[:,:,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span>
                    <span class="n">color</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/nb_10deg2_region_12_0.png" src="../_images/nb_10deg2_region_12_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">xslc</span><span class="p">,</span><span class="n">yslc</span><span class="o">=</span> <span class="nb">slice</span><span class="p">(</span><span class="mi">2500</span><span class="p">,</span><span class="mi">3000</span><span class="p">),</span> <span class="nb">slice</span><span class="p">(</span><span class="mi">2500</span><span class="p">,</span><span class="mi">3000</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
<span class="n">plotImage</span><span class="p">()</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">sliceImage</span><span class="p">(</span><span class="n">img_obi_r</span> <span class="o">-</span> <span class="n">img_dr5_r</span><span class="p">,</span><span class="n">xslc</span><span class="p">,</span><span class="n">yslc</span><span class="p">),</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">plotImage</span><span class="p">()</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">sliceImage</span><span class="p">(</span><span class="n">img_obi_z</span> <span class="o">-</span> <span class="n">img_dr5_z</span><span class="p">,</span><span class="n">xslc</span><span class="p">,</span><span class="n">yslc</span><span class="p">),</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
    <span class="n">plotImage</span><span class="p">()</span><span class="o">.</span><span class="n">circles</span><span class="p">(</span><span class="n">simcat</span><span class="o">.</span><span class="n">x</span><span class="p">,</span><span class="n">simcat</span><span class="o">.</span><span class="n">y</span><span class="p">,</span><span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                        <span class="n">xslice</span><span class="o">=</span><span class="n">xslc</span><span class="p">,</span><span class="n">yslice</span><span class="o">=</span><span class="n">yslc</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/nb_10deg2_region_13_0.png" src="../_images/nb_10deg2_region_13_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">xslc</span><span class="p">,</span><span class="n">yslc</span><span class="o">=</span> <span class="nb">slice</span><span class="p">(</span><span class="mi">2000</span><span class="p">,</span><span class="mi">2500</span><span class="p">),</span> <span class="nb">slice</span><span class="p">(</span><span class="mi">2700</span><span class="p">,</span><span class="mi">3200</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>
<span class="n">plotImage</span><span class="p">()</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">sliceImage</span><span class="p">(</span><span class="n">img_obi_g</span> <span class="o">-</span> <span class="n">img_dr5_g</span><span class="p">,</span><span class="n">xslc</span><span class="p">,</span><span class="n">yslc</span><span class="p">),</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
<span class="n">plotImage</span><span class="p">()</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">sliceImage</span><span class="p">(</span><span class="n">img_obi_r</span> <span class="o">-</span> <span class="n">img_dr5_r</span><span class="p">,</span><span class="n">xslc</span><span class="p">,</span><span class="n">yslc</span><span class="p">),</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
<span class="n">plotImage</span><span class="p">()</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">sliceImage</span><span class="p">(</span><span class="n">img_obi_z</span> <span class="o">-</span> <span class="n">img_dr5_z</span><span class="p">,</span><span class="n">xslc</span><span class="p">,</span><span class="n">yslc</span><span class="p">),</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">])</span>
<span class="n">plotImage</span><span class="p">()</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">sliceImage</span><span class="p">(</span><span class="n">img_obi_g</span><span class="p">,</span><span class="n">xslc</span><span class="p">,</span><span class="n">yslc</span><span class="p">),</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
<span class="n">plotImage</span><span class="p">()</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">sliceImage</span><span class="p">(</span><span class="n">img_obi_r</span><span class="p">,</span><span class="n">xslc</span><span class="p">,</span><span class="n">yslc</span><span class="p">),</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
<span class="n">plotImage</span><span class="p">()</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">sliceImage</span><span class="p">(</span><span class="n">img_obi_z</span><span class="p">,</span><span class="n">xslc</span><span class="p">,</span><span class="n">yslc</span><span class="p">),</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">])</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
    <span class="n">plotImage</span><span class="p">()</span><span class="o">.</span><span class="n">circles</span><span class="p">(</span><span class="n">simcat</span><span class="o">.</span><span class="n">x</span><span class="p">,</span><span class="n">simcat</span><span class="o">.</span><span class="n">y</span><span class="p">,</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="n">i</span><span class="p">],</span>
                        <span class="n">xslice</span><span class="o">=</span><span class="n">xslc</span><span class="p">,</span><span class="n">yslice</span><span class="o">=</span><span class="n">yslc</span><span class="p">)</span>
    <span class="n">plotImage</span><span class="p">()</span><span class="o">.</span><span class="n">circles</span><span class="p">(</span><span class="n">simcat</span><span class="o">.</span><span class="n">x</span><span class="p">,</span><span class="n">simcat</span><span class="o">.</span><span class="n">y</span><span class="p">,</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="p">],</span>
                        <span class="n">xslice</span><span class="o">=</span><span class="n">xslc</span><span class="p">,</span><span class="n">yslice</span><span class="o">=</span><span class="n">yslc</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/nb_10deg2_region_14_0.png" src="../_images/nb_10deg2_region_14_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">seaborn</span> <span class="kn">as</span> <span class="nn">sns</span>
<span class="n">sns</span><span class="o">.</span><span class="n">distplot</span><span class="p">(</span><span class="n">sliceImage</span><span class="p">(</span><span class="n">img_obi_z</span><span class="o">-</span><span class="n">img_dr5_z</span><span class="p">,</span><span class="n">xslc</span><span class="p">,</span><span class="n">yslc</span><span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">())</span> <span class="c1">#,s=np.linspace(-0.01,0.01,num=100))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="o">-</span><span class="mf">0.01</span><span class="p">,</span><span class="mf">0.01</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>Out[12]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>(-0.01, 0.01)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/nb_10deg2_region_16_1.png" src="../_images/nb_10deg2_region_16_1.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">xslc</span><span class="p">,</span><span class="n">yslc</span><span class="o">=</span> <span class="nb">slice</span><span class="p">(</span><span class="mi">2000</span><span class="p">,</span><span class="mi">2500</span><span class="p">),</span> <span class="nb">slice</span><span class="p">(</span><span class="mi">2700</span><span class="p">,</span><span class="mi">3200</span><span class="p">)</span>

<span class="n">fix</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
<span class="n">plotImage</span><span class="p">()</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">sliceImage</span><span class="p">(</span><span class="n">img_obi_z</span><span class="p">,</span><span class="n">xslc</span><span class="p">,</span><span class="n">yslc</span><span class="p">),</span><span class="n">ax</span><span class="p">)</span>
<span class="c1"># NOTE: x pixel - y slice start IS correct</span>
<span class="n">plotImage</span><span class="p">()</span><span class="o">.</span><span class="n">circles</span><span class="p">(</span><span class="n">simcat</span><span class="o">.</span><span class="n">x</span><span class="p">,</span><span class="n">simcat</span><span class="o">.</span><span class="n">y</span><span class="p">,</span><span class="n">ax</span><span class="p">,</span>
                    <span class="n">xslice</span><span class="o">=</span><span class="n">xslc</span><span class="p">,</span><span class="n">yslice</span><span class="o">=</span><span class="n">yslc</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">,</span><span class="n">r_pixels</span><span class="o">=</span><span class="mi">5</span><span class="o">/</span><span class="mf">0.262</span><span class="p">)</span>
<span class="n">plotImage</span><span class="p">()</span><span class="o">.</span><span class="n">circles</span><span class="p">(</span><span class="n">obitractor</span><span class="o">.</span><span class="n">bx</span><span class="p">,</span><span class="n">obitractor</span><span class="o">.</span><span class="n">by</span><span class="p">,</span><span class="n">ax</span><span class="p">,</span>
                    <span class="n">xslice</span><span class="o">=</span><span class="n">xslc</span><span class="p">,</span><span class="n">yslice</span><span class="o">=</span><span class="n">yslc</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;m&#39;</span><span class="p">,</span><span class="n">r_pixels</span><span class="o">=</span><span class="mi">6</span><span class="o">/</span><span class="mf">0.262</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/nb_10deg2_region_17_0.png" src="../_images/nb_10deg2_region_17_0.png" />
</div>
</div>
</div>
<div class="section" id="Recovered-sources-are-within-1-arcsec">
<h1>Recovered sources are within 1 arcsec<a class="headerlink" href="#Recovered-sources-are-within-1-arcsec" title="Permalink to this headline">¶</a></h1>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">def</span> <span class="nf">not_index</span><span class="p">(</span><span class="n">indices</span><span class="p">,</span><span class="n">n</span><span class="p">):</span>
    <span class="n">keep</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="nb">bool</span><span class="p">)</span><span class="kn">from</span> <span class="nn">astrometry.libkd.spherematch</span> <span class="kn">import</span> <span class="n">match_radec</span>
<span class="n">isim</span><span class="p">,</span><span class="n">itrac</span><span class="p">,</span><span class="n">d</span><span class="o">=</span> <span class="n">match_radec</span><span class="p">(</span><span class="n">simcat</span><span class="o">.</span><span class="n">ra</span><span class="p">,</span> <span class="n">simcat</span><span class="o">.</span><span class="n">dec</span><span class="p">,</span> <span class="n">obitractor</span><span class="o">.</span><span class="n">ra</span><span class="p">,</span> <span class="n">obitractor</span><span class="o">.</span><span class="n">dec</span><span class="p">,</span>
                          <span class="mf">1.</span><span class="o">/</span><span class="mf">3600.0</span><span class="p">,</span><span class="n">nearest</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">keep</span><span class="p">[</span><span class="n">indices</span><span class="p">]</span><span class="o">=</span><span class="bp">False</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">n</span><span class="p">)[</span><span class="n">keep</span><span class="p">]</span>

<span class="kn">from</span> <span class="nn">astrometry.libkd.spherematch</span> <span class="kn">import</span> <span class="n">match_radec</span>
<span class="n">isim</span><span class="p">,</span><span class="n">itrac</span><span class="p">,</span><span class="n">d</span><span class="o">=</span> <span class="n">match_radec</span><span class="p">(</span><span class="n">simcat</span><span class="o">.</span><span class="n">ra</span><span class="p">,</span> <span class="n">simcat</span><span class="o">.</span><span class="n">dec</span><span class="p">,</span> <span class="n">obitractor</span><span class="o">.</span><span class="n">ra</span><span class="p">,</span> <span class="n">obitractor</span><span class="o">.</span><span class="n">dec</span><span class="p">,</span>
                          <span class="mf">1.</span><span class="o">/</span><span class="mf">3600.0</span><span class="p">,</span><span class="n">nearest</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">not_isim</span><span class="o">=</span> <span class="n">not_index</span><span class="p">(</span><span class="n">isim</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">simcat</span><span class="p">))</span>
<span class="n">not_itrac</span><span class="o">=</span> <span class="n">not_index</span><span class="p">(</span><span class="n">itrac</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">obitractor</span><span class="p">))</span>
<span class="n">sns</span><span class="o">.</span><span class="n">distplot</span><span class="p">(</span><span class="n">d</span><span class="o">*</span><span class="mi">3600</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>Out[14]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>&lt;matplotlib.axes._subplots.AxesSubplot at 0x7f02b9077350&gt;
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/nb_10deg2_region_19_1.png" src="../_images/nb_10deg2_region_19_1.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">xslc</span><span class="p">,</span><span class="n">yslc</span><span class="o">=</span> <span class="nb">slice</span><span class="p">(</span><span class="mi">2500</span><span class="p">,</span><span class="mi">3000</span><span class="p">),</span> <span class="nb">slice</span><span class="p">(</span><span class="mi">2500</span><span class="p">,</span><span class="mi">3000</span><span class="p">)</span>

<span class="n">fix</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
<span class="n">plotImage</span><span class="p">()</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">sliceImage</span><span class="p">(</span><span class="n">img_jpg</span><span class="p">,</span><span class="n">xslc</span><span class="p">,</span><span class="n">yslc</span><span class="p">),</span><span class="n">ax</span><span class="p">)</span>
<span class="c1"># Recovered</span>
<span class="n">plotImage</span><span class="p">()</span><span class="o">.</span><span class="n">circles</span><span class="p">(</span><span class="n">obitractor</span><span class="o">.</span><span class="n">bx</span><span class="p">[</span><span class="n">itrac</span><span class="p">],</span><span class="n">obitractor</span><span class="o">.</span><span class="n">by</span><span class="p">[</span><span class="n">itrac</span><span class="p">],</span><span class="n">ax</span><span class="p">,</span>
        <span class="n">xslice</span><span class="o">=</span><span class="n">xslc</span><span class="p">,</span><span class="n">yslice</span><span class="o">=</span><span class="n">yslc</span><span class="p">,</span>
        <span class="n">color</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">,</span><span class="n">r_pixels</span><span class="o">=</span><span class="mi">5</span><span class="o">/</span><span class="mf">0.262</span><span class="p">)</span>
<span class="c1"># Missed</span>
<span class="n">plotImage</span><span class="p">()</span><span class="o">.</span><span class="n">circles</span><span class="p">(</span><span class="n">simcat</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">not_isim</span><span class="p">],</span><span class="n">simcat</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">not_isim</span><span class="p">],</span><span class="n">ax</span><span class="p">,</span>
        <span class="n">xslice</span><span class="o">=</span><span class="n">xslc</span><span class="p">,</span><span class="n">yslice</span><span class="o">=</span><span class="n">yslc</span><span class="p">,</span>
        <span class="n">color</span><span class="o">=</span><span class="s1">&#39;m&#39;</span><span class="p">,</span><span class="n">r_pixels</span><span class="o">=</span><span class="mi">5</span><span class="o">/</span><span class="mf">0.262</span><span class="p">)</span>
<span class="c1"># Real</span>
<span class="n">plotImage</span><span class="p">()</span><span class="o">.</span><span class="n">circles</span><span class="p">(</span><span class="n">obitractor</span><span class="o">.</span><span class="n">bx</span><span class="p">[</span><span class="n">not_itrac</span><span class="p">],</span><span class="n">obitractor</span><span class="o">.</span><span class="n">by</span><span class="p">[</span><span class="n">not_itrac</span><span class="p">],</span><span class="n">ax</span><span class="p">,</span>
        <span class="n">xslice</span><span class="o">=</span><span class="n">xslc</span><span class="p">,</span><span class="n">yslice</span><span class="o">=</span><span class="n">yslc</span><span class="p">,</span>
        <span class="n">color</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span><span class="n">r_pixels</span><span class="o">=</span><span class="mi">5</span><span class="o">/</span><span class="mf">0.262</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/nb_10deg2_region_20_0.png" src="../_images/nb_10deg2_region_20_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">xslc</span><span class="p">,</span><span class="n">yslc</span><span class="o">=</span> <span class="nb">slice</span><span class="p">(</span><span class="mi">2500</span><span class="p">,</span><span class="mi">3200</span><span class="p">),</span><span class="nb">slice</span><span class="p">(</span><span class="mi">2300</span><span class="p">,</span><span class="mi">3500</span><span class="p">)</span>

<span class="n">fix</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">12</span><span class="p">))</span>
<span class="n">plotImage</span><span class="p">()</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">sliceImage</span><span class="p">(</span><span class="n">img_jpg</span><span class="p">,</span><span class="n">xslc</span><span class="p">,</span><span class="n">yslc</span><span class="p">),</span><span class="n">ax</span><span class="p">)</span>
<span class="c1"># Recovered</span>
<span class="n">plotImage</span><span class="p">()</span><span class="o">.</span><span class="n">circles</span><span class="p">(</span><span class="n">obitractor</span><span class="o">.</span><span class="n">bx</span><span class="p">[</span><span class="n">itrac</span><span class="p">],</span><span class="n">obitractor</span><span class="o">.</span><span class="n">by</span><span class="p">[</span><span class="n">itrac</span><span class="p">],</span><span class="n">ax</span><span class="p">,</span>
        <span class="n">xslice</span><span class="o">=</span><span class="n">xslc</span><span class="p">,</span><span class="n">yslice</span><span class="o">=</span><span class="n">yslc</span><span class="p">,</span>
        <span class="n">color</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">,</span><span class="n">r_pixels</span><span class="o">=</span><span class="mi">5</span><span class="o">/</span><span class="mf">0.262</span><span class="p">)</span>
<span class="c1"># Missed</span>
<span class="n">plotImage</span><span class="p">()</span><span class="o">.</span><span class="n">circles</span><span class="p">(</span><span class="n">simcat</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">not_isim</span><span class="p">],</span><span class="n">simcat</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">not_isim</span><span class="p">],</span><span class="n">ax</span><span class="p">,</span>
        <span class="n">xslice</span><span class="o">=</span><span class="n">xslc</span><span class="p">,</span><span class="n">yslice</span><span class="o">=</span><span class="n">yslc</span><span class="p">,</span>
        <span class="n">color</span><span class="o">=</span><span class="s1">&#39;m&#39;</span><span class="p">,</span><span class="n">r_pixels</span><span class="o">=</span><span class="mi">5</span><span class="o">/</span><span class="mf">0.262</span><span class="p">)</span>
<span class="c1"># Real</span>
<span class="n">plotImage</span><span class="p">()</span><span class="o">.</span><span class="n">circles</span><span class="p">(</span><span class="n">obitractor</span><span class="o">.</span><span class="n">bx</span><span class="p">[</span><span class="n">not_itrac</span><span class="p">],</span><span class="n">obitractor</span><span class="o">.</span><span class="n">by</span><span class="p">[</span><span class="n">not_itrac</span><span class="p">],</span><span class="n">ax</span><span class="p">,</span>
        <span class="n">xslice</span><span class="o">=</span><span class="n">xslc</span><span class="p">,</span><span class="n">yslice</span><span class="o">=</span><span class="n">yslc</span><span class="p">,</span>
        <span class="n">color</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span><span class="n">r_pixels</span><span class="o">=</span><span class="mi">5</span><span class="o">/</span><span class="mf">0.262</span><span class="p">)</span>

</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/nb_10deg2_region_21_0.png" src="../_images/nb_10deg2_region_21_0.png" />
</div>
</div>
</div>
<div class="section" id="Brightness-distribution-of-Missed,-Recovered,-and-Real-sources">
<h1>Brightness distribution of Missed, Recovered, and Real sources<a class="headerlink" href="#Brightness-distribution-of-Missed,-Recovered,-and-Real-sources" title="Permalink to this headline">¶</a></h1>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">class</span> <span class="nc">Flux2mag</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;convert simcat or tractor fluxes, NaN where flux &lt;= 0</span>

<span class="sd">    Note: both fluxes have units of nanomaggies, however simcat fluxes</span>
<span class="sd">    are corrected while tractor fluxes do not correct for</span>
<span class="sd">    extinction</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">print</span><span class="p">(</span><span class="s1">&#39;WARNING:Neither simcat or tractor fluxes are extinction corrected&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">simcat</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">flux</span><span class="p">):</span>
        <span class="n">mag</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">flux</span><span class="p">))</span><span class="o">-</span><span class="mi">1</span>
        <span class="n">keep</span><span class="o">=</span> <span class="n">flux</span> <span class="o">&gt;</span> <span class="mi">0</span>
        <span class="n">mag</span><span class="p">[</span><span class="n">keep</span><span class="p">]</span><span class="o">=</span> <span class="o">-</span><span class="mf">2.5</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="mf">1e-9</span> <span class="o">*</span> <span class="n">flux</span><span class="p">[</span><span class="n">keep</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">masked_array</span><span class="p">(</span><span class="n">mag</span><span class="p">,</span>
                                  <span class="n">mask</span><span class="o">=</span> <span class="n">flux</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">tractor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">flux</span><span class="p">,</span><span class="n">mw_ext</span><span class="p">):</span>
        <span class="n">raw_mag</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">simcat</span><span class="p">(</span><span class="n">flux</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">raw_mag</span> <span class="c1">#- mw_ext[keep]</span>

<span class="n">F</span><span class="o">=</span> <span class="n">Flux2mag</span><span class="p">()</span>
<span class="n">sns</span><span class="o">.</span><span class="n">distplot</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">simcat</span><span class="p">(</span><span class="n">simcat</span><span class="o">.</span><span class="n">zflux</span><span class="p">[</span><span class="n">isim</span><span class="p">]),</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;Recoverd&#39;</span><span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">distplot</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">simcat</span><span class="p">(</span><span class="n">simcat</span><span class="o">.</span><span class="n">zflux</span><span class="p">[</span><span class="n">not_isim</span><span class="p">]),</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;m&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;Missed&#39;</span><span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">distplot</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">tractor</span><span class="p">(</span><span class="n">obitractor</span><span class="o">.</span><span class="n">flux_z</span><span class="p">[</span><span class="n">not_itrac</span><span class="p">],</span>
                       <span class="n">obitractor</span><span class="o">.</span><span class="n">mw_transmission_z</span><span class="p">[</span><span class="n">not_itrac</span><span class="p">]),</span>
             <span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;Real&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;z mag AB&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span><span class="mi">25</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
WARNING:Neither simcat or tractor fluxes are extinction corrected
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>Out[17]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>&lt;matplotlib.legend.Legend at 0x7f02b9099910&gt;
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/nb_10deg2_region_23_2.png" src="../_images/nb_10deg2_region_23_2.png" />
</div>
</div>
</div>
<div class="section" id="Missed-or-Recovered-only-depends-on-source-brightness">
<h1>Missed or Recovered only depends on source brightness<a class="headerlink" href="#Missed-or-Recovered-only-depends-on-source-brightness" title="Permalink to this headline">¶</a></h1>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [18]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">def</span> <span class="nf">myhist</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="n">lab</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="n">normed</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">reset_orig</span><span class="p">()</span>
    <span class="n">_</span><span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">histtype</span><span class="o">=</span><span class="s1">&#39;step&#39;</span><span class="p">,</span><span class="n">normed</span><span class="o">=</span><span class="n">normed</span><span class="p">,</span>
                <span class="n">color</span><span class="o">=</span><span class="n">c</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="n">lab</span><span class="p">)</span>

<span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">simcat</span><span class="o">.</span><span class="n">get_columns</span><span class="p">():</span>
    <span class="k">for</span> <span class="n">indices</span><span class="p">,</span><span class="n">lab</span><span class="p">,</span><span class="n">c</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">([</span><span class="n">isim</span><span class="p">,</span><span class="n">not_isim</span><span class="p">],[</span><span class="s1">&#39;Recovered&#39;</span><span class="p">,</span><span class="s1">&#39;Missed&#39;</span><span class="p">],[</span><span class="s1">&#39;y&#39;</span><span class="p">,</span><span class="s1">&#39;m&#39;</span><span class="p">]):</span>
        <span class="n">myhist</span><span class="p">(</span><span class="n">simcat</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">var</span><span class="p">)[</span><span class="n">indices</span><span class="p">],</span><span class="n">c</span><span class="o">=</span><span class="n">c</span><span class="p">,</span><span class="n">lab</span><span class="o">=</span><span class="n">lab</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="n">var</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/nb_10deg2_region_25_0.png" src="../_images/nb_10deg2_region_25_0.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/nb_10deg2_region_25_1.png" src="../_images/nb_10deg2_region_25_1.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/nb_10deg2_region_25_2.png" src="../_images/nb_10deg2_region_25_2.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/nb_10deg2_region_25_3.png" src="../_images/nb_10deg2_region_25_3.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/nb_10deg2_region_25_4.png" src="../_images/nb_10deg2_region_25_4.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/nb_10deg2_region_25_5.png" src="../_images/nb_10deg2_region_25_5.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/nb_10deg2_region_25_6.png" src="../_images/nb_10deg2_region_25_6.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/nb_10deg2_region_25_7.png" src="../_images/nb_10deg2_region_25_7.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/nb_10deg2_region_25_8.png" src="../_images/nb_10deg2_region_25_8.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/nb_10deg2_region_25_9.png" src="../_images/nb_10deg2_region_25_9.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/nb_10deg2_region_25_10.png" src="../_images/nb_10deg2_region_25_10.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/nb_10deg2_region_25_11.png" src="../_images/nb_10deg2_region_25_11.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/nb_10deg2_region_25_12.png" src="../_images/nb_10deg2_region_25_12.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [19]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">def</span> <span class="nf">get_q25</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">q</span><span class="o">=</span><span class="mi">25</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">get_q50</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">q</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">get_q75</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">q</span><span class="o">=</span><span class="mi">75</span><span class="p">)</span>


<span class="n">new</span><span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
    <span class="s1">&#39;trac_mag&#39;</span><span class="p">:</span><span class="n">F</span><span class="o">.</span><span class="n">tractor</span><span class="p">(</span><span class="n">obitractor</span><span class="o">.</span><span class="n">flux_z</span><span class="p">[</span><span class="n">itrac</span><span class="p">],</span>
                         <span class="n">obitractor</span><span class="o">.</span><span class="n">mw_transmission_z</span><span class="p">[</span><span class="n">itrac</span><span class="p">]),</span>
    <span class="s1">&#39;sim_mag&#39;</span><span class="p">:</span><span class="n">F</span><span class="o">.</span><span class="n">simcat</span><span class="p">(</span><span class="n">simcat</span><span class="o">.</span><span class="n">zflux</span><span class="p">[</span><span class="n">isim</span><span class="p">])</span>
    <span class="p">})</span>
<span class="n">new</span><span class="p">[</span><span class="s1">&#39;diff&#39;</span><span class="p">]</span><span class="o">=</span> <span class="n">new</span><span class="p">[</span><span class="s1">&#39;sim_mag&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">new</span><span class="p">[</span><span class="s1">&#39;trac_mag&#39;</span><span class="p">]</span>
<span class="c1">#W=0.2</span>
<span class="c1">#LO,HI=new[&#39;sim_mag&#39;].min()-W,new[&#39;sim_mag&#39;].max()</span>
<span class="c1">#new[&#39;bins&#39;]= pd.cut(new[&#39;sim_mag&#39;],bins=np.arange(LO,HI+W*2,W))</span>
<span class="n">new</span><span class="p">[</span><span class="s1">&#39;bins&#39;</span><span class="p">]</span><span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">cut</span><span class="p">(</span><span class="n">new</span><span class="p">[</span><span class="s1">&#39;sim_mag&#39;</span><span class="p">],</span><span class="n">bins</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<span class="n">a</span><span class="o">=</span> <span class="n">new</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;bins&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">([</span><span class="n">get_q25</span><span class="p">,</span><span class="n">get_q50</span><span class="p">,</span><span class="n">get_q75</span><span class="p">])</span>
<span class="n">a</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
<span class="c1">#new[&#39;bins&#39;].cat.categories.mid</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>Out[19]:
</pre></div>
</div>
<div class="output_area docutils container">
<div>
<style>
    .dataframe thead tr:only-child th {
        text-align: right;
    }

    .dataframe thead th {
        text-align: left;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr>
      <th></th>
      <th colspan="3" halign="left">sim_mag</th>
      <th colspan="3" halign="left">trac_mag</th>
      <th colspan="3" halign="left">diff</th>
    </tr>
    <tr>
      <th></th>
      <th>get_q25</th>
      <th>get_q50</th>
      <th>get_q75</th>
      <th>get_q25</th>
      <th>get_q50</th>
      <th>get_q75</th>
      <th>get_q25</th>
      <th>get_q50</th>
      <th>get_q75</th>
    </tr>
    <tr>
      <th>bins</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>(19.704, 19.913]</th>
      <td>19.758501</td>
      <td>19.809545</td>
      <td>19.860590</td>
      <td>19.713614</td>
      <td>19.779356</td>
      <td>19.845098</td>
      <td>0.015492</td>
      <td>0.030189</td>
      <td>0.044887</td>
    </tr>
    <tr>
      <th>(19.913, 20.118]</th>
      <td>19.953417</td>
      <td>19.982250</td>
      <td>20.028189</td>
      <td>19.948938</td>
      <td>19.950054</td>
      <td>20.037999</td>
      <td>-0.037527</td>
      <td>-0.023239</td>
      <td>0.004479</td>
    </tr>
    <tr>
      <th>(20.118, 20.323]</th>
      <td>20.146553</td>
      <td>20.161123</td>
      <td>20.207467</td>
      <td>20.278008</td>
      <td>20.286423</td>
      <td>20.315403</td>
      <td>-0.160436</td>
      <td>-0.137611</td>
      <td>-0.085111</td>
    </tr>
    <tr>
      <th>(20.323, 20.528]</th>
      <td>20.394506</td>
      <td>20.421235</td>
      <td>20.424951</td>
      <td>20.376431</td>
      <td>20.451448</td>
      <td>20.493268</td>
      <td>-0.068317</td>
      <td>-0.030213</td>
      <td>0.018075</td>
    </tr>
    <tr>
      <th>(20.528, 20.733]</th>
      <td>20.630314</td>
      <td>20.653788</td>
      <td>20.670790</td>
      <td>20.600925</td>
      <td>20.657610</td>
      <td>20.695587</td>
      <td>-0.016108</td>
      <td>0.001160</td>
      <td>0.021018</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
</div>
<div class="section" id="Truth---Measured-(binned-by-magnitude)">
<h1>Truth - Measured (binned by magnitude)<a class="headerlink" href="#Truth---Measured-(binned-by-magnitude)" title="Permalink to this headline">¶</a></h1>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [20]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">g</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">jointplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">&quot;sim_mag&quot;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">&quot;diff&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">new</span><span class="p">,</span>
                  <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;hex&#39;</span><span class="p">)</span>
<span class="n">binc</span><span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">categories</span><span class="o">.</span><span class="n">mid</span>
<span class="n">g</span><span class="o">.</span><span class="n">ax_joint</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">binc</span><span class="p">,</span><span class="n">a</span><span class="p">[</span><span class="s1">&#39;diff&#39;</span><span class="p">][</span><span class="s1">&#39;get_q25&#39;</span><span class="p">],</span><span class="s1">&#39;g-&#39;</span><span class="p">)</span>
<span class="n">g</span><span class="o">.</span><span class="n">ax_joint</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">binc</span><span class="p">,</span><span class="n">a</span><span class="p">[</span><span class="s1">&#39;diff&#39;</span><span class="p">][</span><span class="s1">&#39;get_q50&#39;</span><span class="p">],</span><span class="s1">&#39;g-&#39;</span><span class="p">)</span>
<span class="n">g</span><span class="o">.</span><span class="n">ax_joint</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">binc</span><span class="p">,</span><span class="n">a</span><span class="p">[</span><span class="s1">&#39;diff&#39;</span><span class="p">][</span><span class="s1">&#39;get_q75&#39;</span><span class="p">],</span><span class="s1">&#39;g-&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>Out[20]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>[&lt;matplotlib.lines.Line2D at 0x7f02b8ee5e10&gt;]
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/nb_10deg2_region_28_1.png" src="../_images/nb_10deg2_region_28_1.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [21]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">print</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">char</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="n">obitractor</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;type&#39;</span><span class="p">))))</span>
<span class="nb">len</span><span class="p">(</span><span class="n">obitractor</span><span class="p">[</span><span class="n">obitractor</span><span class="o">.</span><span class="n">allmask_z</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">]),</span><span class="nb">len</span><span class="p">(</span><span class="n">obitractor</span><span class="p">[</span><span class="n">obitractor</span><span class="o">.</span><span class="n">anymask_z</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
set([&#39;COMP&#39;, &#39;REX&#39;, &#39;PSF&#39;, &#39;EXP&#39;, &#39;DEV&#39;])
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>Out[21]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>(1, 16)
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [22]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">objtypes</span><span class="o">=</span> <span class="p">[</span><span class="s1">&#39;psf&#39;</span><span class="p">,</span><span class="s1">&#39;rex&#39;</span><span class="p">,</span><span class="s1">&#39;exp&#39;</span><span class="p">,</span><span class="s1">&#39;dev&#39;</span><span class="p">,</span><span class="s1">&#39;comp&#39;</span><span class="p">]</span>

<span class="k">def</span> <span class="nf">get_tractor_cuts</span><span class="p">(</span><span class="n">tractor</span><span class="p">):</span>
    <span class="n">cuts</span><span class="o">=</span> <span class="p">{}</span> <span class="c1">#{&#39;photometric&#39;:np.ones(len(tractor),bool)}</span>
    <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;g&#39;</span><span class="p">,</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="s1">&#39;z&#39;</span><span class="p">]:</span>
        <span class="n">cuts</span><span class="p">[</span><span class="s1">&#39;phot_&#39;</span><span class="o">+</span><span class="n">b</span><span class="p">]</span><span class="o">=</span> <span class="p">((</span><span class="n">tractor</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;flux_&#39;</span><span class="o">+</span><span class="n">b</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span>
                          <span class="p">(</span><span class="n">tractor</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;flux_ivar_&#39;</span><span class="o">+</span><span class="n">b</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span>
                          <span class="p">(</span><span class="n">tractor</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;allmask_&#39;</span><span class="o">+</span><span class="n">b</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">objtypes</span><span class="p">:</span>
        <span class="n">cuts</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">char</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="n">tractor</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;type&#39;</span><span class="p">))</span> <span class="o">==</span> <span class="n">col</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">cuts</span>

<span class="n">cuts_obitractor</span><span class="o">=</span> <span class="n">get_tractor_cuts</span><span class="p">(</span><span class="n">obitractor</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [23]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">def</span> <span class="nf">indices2bool</span><span class="p">(</span><span class="n">indices</span><span class="p">,</span><span class="n">n</span><span class="p">):</span>
    <span class="n">keep</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="nb">bool</span><span class="p">)</span>
    <span class="n">keep</span><span class="p">[</span><span class="n">indices</span><span class="p">]</span><span class="o">=</span><span class="bp">True</span>
    <span class="k">return</span> <span class="n">keep</span>

<span class="c1">#Recovered</span>
<span class="n">btrac</span><span class="o">=</span> <span class="n">indices2bool</span><span class="p">(</span><span class="n">itrac</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">obitractor</span><span class="p">))</span>
<span class="k">for</span> <span class="n">bcut</span><span class="p">,</span><span class="n">lab</span><span class="p">,</span><span class="n">c</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">([</span><span class="n">cuts_obitractor</span><span class="p">[</span><span class="s1">&#39;phot_z&#39;</span><span class="p">],</span>
                       <span class="n">cuts_obitractor</span><span class="p">[</span><span class="s1">&#39;phot_z&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="bp">False</span><span class="p">],</span>
                       <span class="p">[</span><span class="s1">&#39;Photometric&#39;</span><span class="p">,</span><span class="s1">&#39;Not&#39;</span><span class="p">],[</span><span class="s1">&#39;y&#39;</span><span class="p">,</span><span class="s1">&#39;m&#39;</span><span class="p">]):</span>
    <span class="k">print</span><span class="p">(</span><span class="n">lab</span><span class="p">,</span><span class="s1">&#39; </span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">obitractor</span><span class="p">[(</span><span class="n">btrac</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">bcut</span><span class="p">)]))</span>
    <span class="n">myhist</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">tractor</span><span class="p">(</span><span class="n">obitractor</span><span class="o">.</span><span class="n">flux_z</span><span class="p">[(</span><span class="n">btrac</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">bcut</span><span class="p">)],</span>
                     <span class="n">obitractor</span><span class="o">.</span><span class="n">mw_transmission_z</span><span class="p">[(</span><span class="n">btrac</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">bcut</span><span class="p">)]),</span>
                     <span class="n">c</span><span class="o">=</span><span class="n">c</span><span class="p">,</span><span class="n">lab</span><span class="o">=</span><span class="n">lab</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;Recovered&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;z mag AB&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1">#Real</span>
<span class="n">btrac</span><span class="o">=</span> <span class="n">indices2bool</span><span class="p">(</span><span class="n">not_itrac</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">obitractor</span><span class="p">))</span>
<span class="k">for</span> <span class="n">bcut</span><span class="p">,</span><span class="n">lab</span><span class="p">,</span><span class="n">c</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">([</span><span class="n">cuts_obitractor</span><span class="p">[</span><span class="s1">&#39;phot_z&#39;</span><span class="p">],</span>
                       <span class="n">cuts_obitractor</span><span class="p">[</span><span class="s1">&#39;phot_z&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="bp">False</span><span class="p">],</span>
                       <span class="p">[</span><span class="s1">&#39;Photometric&#39;</span><span class="p">,</span><span class="s1">&#39;Not&#39;</span><span class="p">],[</span><span class="s1">&#39;y&#39;</span><span class="p">,</span><span class="s1">&#39;m&#39;</span><span class="p">]):</span>
    <span class="k">print</span><span class="p">(</span><span class="n">lab</span><span class="p">,</span><span class="s1">&#39; </span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">obitractor</span><span class="p">[(</span><span class="n">btrac</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">bcut</span><span class="p">)]))</span>
    <span class="n">myhist</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">tractor</span><span class="p">(</span><span class="n">obitractor</span><span class="o">.</span><span class="n">flux_z</span><span class="p">[(</span><span class="n">btrac</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">bcut</span><span class="p">)],</span>
                     <span class="n">obitractor</span><span class="o">.</span><span class="n">mw_transmission_z</span><span class="p">[(</span><span class="n">btrac</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">bcut</span><span class="p">)]),</span>
                     <span class="n">c</span><span class="o">=</span><span class="n">c</span><span class="p">,</span><span class="n">lab</span><span class="o">=</span><span class="n">lab</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;Real&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;z mag AB&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="c1">#plt.xlim(16,25)</span>


</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(&#39;Photometric&#39;, &#39; 214&#39;)
(&#39;Not&#39;, &#39; 0&#39;)
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="stderr output_area docutils container">
<div class="highlight"><pre>
/home/kaylan/env_galsim/local/lib/python2.7/site-packages/matplotlib/axes/_axes.py:6201: RuntimeWarning: invalid value encountered in true_divide
  m = (m.astype(float) / db) / m.sum()
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/nb_10deg2_region_33_2.png" src="../_images/nb_10deg2_region_33_2.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(&#39;Photometric&#39;, &#39; 104&#39;)
(&#39;Not&#39;, &#39; 3&#39;)
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/nb_10deg2_region_33_4.png" src="../_images/nb_10deg2_region_33_4.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [24]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">recovered</span><span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
    <span class="s1">&#39;sim_mag&#39;</span><span class="p">:</span><span class="n">F</span><span class="o">.</span><span class="n">simcat</span><span class="p">(</span><span class="n">simcat</span><span class="o">.</span><span class="n">zflux</span><span class="p">[</span><span class="n">isim</span><span class="p">]),</span>
    <span class="s1">&#39;isPhotZ&#39;</span><span class="p">:</span><span class="n">cuts_obitractor</span><span class="p">[</span><span class="s1">&#39;phot_z&#39;</span><span class="p">][</span><span class="n">isim</span><span class="p">]</span>
<span class="p">})</span>
<span class="n">recovered</span><span class="p">[</span><span class="s1">&#39;bins&#39;</span><span class="p">]</span><span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">cut</span><span class="p">(</span><span class="n">recovered</span><span class="p">[</span><span class="s1">&#39;sim_mag&#39;</span><span class="p">],</span><span class="n">bins</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<span class="n">recovered</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>Out[24]:
</pre></div>
</div>
<div class="output_area docutils container">
<div>
<style>
    .dataframe thead tr:only-child th {
        text-align: right;
    }

    .dataframe thead th {
        text-align: left;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>isPhotZ</th>
      <th>sim_mag</th>
      <th>bins</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>True</td>
      <td>21.451953</td>
      <td>(21.349, 21.554]</td>
    </tr>
    <tr>
      <th>1</th>
      <td>True</td>
      <td>22.592270</td>
      <td>(22.58, 22.785]</td>
    </tr>
    <tr>
      <th>2</th>
      <td>True</td>
      <td>21.624738</td>
      <td>(21.554, 21.759]</td>
    </tr>
    <tr>
      <th>3</th>
      <td>True</td>
      <td>21.212229</td>
      <td>(21.144, 21.349]</td>
    </tr>
    <tr>
      <th>4</th>
      <td>True</td>
      <td>21.583440</td>
      <td>(21.554, 21.759]</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
</div>
<div class="section" id="Recovered-sources-are-all-photometric-(flux-&gt;-0,-ivar-&gt;-0,-allmaks)">
<h1>Recovered sources are all photometric (flux &gt; 0, ivar &gt; 0, allmaks)<a class="headerlink" href="#Recovered-sources-are-all-photometric-(flux->-0,-ivar->-0,-allmaks)" title="Permalink to this headline">¶</a></h1>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [25]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">result</span><span class="o">=</span> <span class="n">recovered</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;bins&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">/</span> <span class="n">recovered</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;bins&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
<span class="k">print</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">tail</span><span class="p">(</span><span class="mi">5</span><span class="p">))</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">categories</span><span class="o">.</span><span class="n">mid</span><span class="p">,</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;isPhotZ&#39;</span><span class="p">])</span>
<span class="c1">#plt.axvline(result.index[result[&#39;isPhotz&#39;] &lt;= 0.5][0],c=&#39;r&#39;,ls=&#39;-&#39;)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;z mag AB&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Fraction of Recovered that are Phot_z&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
                   isPhotZ    sim_mag
bins
(21.759, 21.964]  1.000000  21.861761
(21.964, 22.17]   1.000000  22.074437
(22.17, 22.375]   1.000000  22.263788
(22.375, 22.58]   1.000000  22.497383
(22.58, 22.785]   0.833333  22.678082
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>Out[25]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>&lt;matplotlib.text.Text at 0x7f02bb8cfd10&gt;
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/nb_10deg2_region_36_2.png" src="../_images/nb_10deg2_region_36_2.png" />
</div>
</div>
</div>
<div class="section" id="Recovered-sources-by-&quot;type&quot;">
<h1>Recovered sources by “type”<a class="headerlink" href="#Recovered-sources-by-"type"" title="Permalink to this headline">¶</a></h1>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [26]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1">#Recovered</span>
<span class="n">btrac</span><span class="o">=</span> <span class="n">indices2bool</span><span class="p">(</span><span class="n">itrac</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">obitractor</span><span class="p">))</span>
<span class="k">for</span> <span class="n">objtype</span><span class="p">,</span><span class="n">c</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">objtypes</span><span class="p">,[</span><span class="s1">&#39;y&#39;</span><span class="p">,</span><span class="s1">&#39;m&#39;</span><span class="p">,</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="s1">&#39;g&#39;</span><span class="p">,</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="s1">&#39;gray&#39;</span><span class="p">]):</span>
    <span class="n">isObj</span><span class="o">=</span> <span class="p">(</span><span class="n">cuts_obitractor</span><span class="p">[</span><span class="n">objtype</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">btrac</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="n">objtype</span><span class="p">,</span><span class="s1">&#39; </span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">obitractor</span><span class="p">[</span><span class="n">isObj</span><span class="p">]))</span>
    <span class="n">myhist</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">tractor</span><span class="p">(</span><span class="n">obitractor</span><span class="o">.</span><span class="n">flux_z</span><span class="p">[</span><span class="n">isObj</span><span class="p">],</span>
                     <span class="n">obitractor</span><span class="o">.</span><span class="n">mw_transmission_z</span><span class="p">[</span><span class="n">isObj</span><span class="p">]),</span>
                     <span class="n">c</span><span class="o">=</span><span class="n">c</span><span class="p">,</span><span class="n">lab</span><span class="o">=</span><span class="n">objtype</span><span class="p">,</span><span class="n">normed</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;Recovered&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;z mag AB&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mf">19.5</span><span class="p">,</span><span class="mi">24</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1">#Real</span>
<span class="n">btrac</span><span class="o">=</span> <span class="n">indices2bool</span><span class="p">(</span><span class="n">not_itrac</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">obitractor</span><span class="p">))</span>
<span class="k">for</span> <span class="n">objtype</span><span class="p">,</span><span class="n">c</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">objtypes</span><span class="p">,[</span><span class="s1">&#39;y&#39;</span><span class="p">,</span><span class="s1">&#39;m&#39;</span><span class="p">,</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="s1">&#39;g&#39;</span><span class="p">,</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="s1">&#39;gray&#39;</span><span class="p">]):</span>
    <span class="n">isObj</span><span class="o">=</span> <span class="p">(</span><span class="n">cuts_obitractor</span><span class="p">[</span><span class="n">objtype</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">btrac</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="n">objtype</span><span class="p">,</span><span class="s1">&#39; </span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">obitractor</span><span class="p">[</span><span class="n">isObj</span><span class="p">]))</span>
    <span class="n">myhist</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">tractor</span><span class="p">(</span><span class="n">obitractor</span><span class="o">.</span><span class="n">flux_z</span><span class="p">[</span><span class="n">isObj</span><span class="p">],</span>
                     <span class="n">obitractor</span><span class="o">.</span><span class="n">mw_transmission_z</span><span class="p">[</span><span class="n">isObj</span><span class="p">]),</span>
                     <span class="n">c</span><span class="o">=</span><span class="n">c</span><span class="p">,</span><span class="n">lab</span><span class="o">=</span><span class="n">objtype</span><span class="p">,</span><span class="n">normed</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;Real&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;z mag AB&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(&#39;psf&#39;, &#39; 11&#39;)
(&#39;rex&#39;, &#39; 169&#39;)
(&#39;exp&#39;, &#39; 32&#39;)
(&#39;dev&#39;, &#39; 2&#39;)
(&#39;comp&#39;, &#39; 0&#39;)
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/nb_10deg2_region_38_1.png" src="../_images/nb_10deg2_region_38_1.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(&#39;psf&#39;, &#39; 25&#39;)
(&#39;rex&#39;, &#39; 44&#39;)
(&#39;exp&#39;, &#39; 26&#39;)
(&#39;dev&#39;, &#39; 10&#39;)
(&#39;comp&#39;, &#39; 2&#39;)
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/nb_10deg2_region_38_3.png" src="../_images/nb_10deg2_region_38_3.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [27]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">fraction</span><span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
    <span class="s1">&#39;sim_mag&#39;</span><span class="p">:</span><span class="n">F</span><span class="o">.</span><span class="n">simcat</span><span class="p">(</span><span class="n">simcat</span><span class="o">.</span><span class="n">zflux</span><span class="p">),</span>
    <span class="s1">&#39;isRecovered&#39;</span><span class="p">:</span><span class="n">indices2bool</span><span class="p">(</span><span class="n">isim</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">simcat</span><span class="p">))</span>
<span class="p">})</span>
<span class="n">fraction</span><span class="p">[</span><span class="s1">&#39;bins&#39;</span><span class="p">]</span><span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">cut</span><span class="p">(</span><span class="n">fraction</span><span class="p">[</span><span class="s1">&#39;sim_mag&#39;</span><span class="p">],</span><span class="n">bins</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<span class="c1"># W=0.2</span>
<span class="c1"># LO,HI=fraction[&#39;sim_mag&#39;].min()-W,fraction[&#39;sim_mag&#39;].max()</span>
<span class="c1"># fraction[&#39;binc&#39;]= np.zeros(len(fraction))</span>
<span class="c1"># for low,hi in zip(np.arange(LO,HI+W,W),np.arange(LO+W,HI+W*2,W)):</span>
<span class="c1">#     fraction.loc[((fraction[&#39;sim_mag&#39;] &gt; low) &amp;</span>
<span class="c1">#                    (fraction[&#39;sim_mag&#39;] &lt;= hi)), &#39;binc&#39;]= (low+hi)/2</span>
<span class="n">fraction</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>Out[27]:
</pre></div>
</div>
<div class="output_area docutils container">
<div>
<style>
    .dataframe thead tr:only-child th {
        text-align: right;
    }

    .dataframe thead th {
        text-align: left;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>isRecovered</th>
      <th>sim_mag</th>
      <th>bins</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>True</td>
      <td>21.451953</td>
      <td>(21.354, 21.59]</td>
    </tr>
    <tr>
      <th>1</th>
      <td>True</td>
      <td>22.592270</td>
      <td>(22.531, 22.766]</td>
    </tr>
    <tr>
      <th>2</th>
      <td>True</td>
      <td>21.624738</td>
      <td>(21.59, 21.825]</td>
    </tr>
    <tr>
      <th>3</th>
      <td>False</td>
      <td>22.330312</td>
      <td>(22.296, 22.531]</td>
    </tr>
    <tr>
      <th>4</th>
      <td>False</td>
      <td>20.427215</td>
      <td>(20.413, 20.649]</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [28]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">result</span><span class="o">=</span> <span class="n">fraction</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;bins&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">/</span> <span class="n">fraction</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;bins&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
<span class="n">result</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>Out[28]:
</pre></div>
</div>
<div class="output_area docutils container">
<div>
<style>
    .dataframe thead tr:only-child th {
        text-align: right;
    }

    .dataframe thead th {
        text-align: left;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>isRecovered</th>
      <th>sim_mag</th>
    </tr>
    <tr>
      <th>bins</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>(19.704, 19.943]</th>
      <td>1.000000</td>
      <td>19.847891</td>
    </tr>
    <tr>
      <th>(19.943, 20.178]</th>
      <td>1.000000</td>
      <td>20.087371</td>
    </tr>
    <tr>
      <th>(20.178, 20.413]</th>
      <td>1.000000</td>
      <td>20.310795</td>
    </tr>
    <tr>
      <th>(20.413, 20.649]</th>
      <td>0.833333</td>
      <td>20.526575</td>
    </tr>
    <tr>
      <th>(20.649, 20.884]</th>
      <td>0.875000</td>
      <td>20.778800</td>
    </tr>
    <tr>
      <th>(20.884, 21.119]</th>
      <td>0.823529</td>
      <td>21.037349</td>
    </tr>
    <tr>
      <th>(21.119, 21.354]</th>
      <td>0.965517</td>
      <td>21.218799</td>
    </tr>
    <tr>
      <th>(21.354, 21.59]</th>
      <td>0.967742</td>
      <td>21.465643</td>
    </tr>
    <tr>
      <th>(21.59, 21.825]</th>
      <td>0.775510</td>
      <td>21.709568</td>
    </tr>
    <tr>
      <th>(21.825, 22.06]</th>
      <td>0.739130</td>
      <td>21.930837</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [29]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">result</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;isRecovered&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mf">0.5</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>Out[29]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>Interval(22.530999999999999, 22.765999999999998, closed=&#39;right&#39;)
</pre></div>
</div>
</div>
</div>
<div class="section" id="Depth-(fraction-recovered-versus-mag)">
<h1>Depth (fraction recovered versus mag)<a class="headerlink" href="#Depth-(fraction-recovered-versus-mag)" title="Permalink to this headline">¶</a></h1>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [30]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">categories</span><span class="o">.</span><span class="n">mid</span><span class="p">,</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;isRecovered&#39;</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">categories</span><span class="o">.</span><span class="n">mid</span><span class="p">[</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;isRecovered&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mf">0.5</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="n">c</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="n">ls</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;z mag AB&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Fraction Recovered&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>Out[30]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>&lt;matplotlib.text.Text at 0x7f02b8a60490&gt;
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/nb_10deg2_region_43_1.png" src="../_images/nb_10deg2_region_43_1.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [31]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">frac_recovered</span><span class="o">=</span> <span class="n">fraction</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">isim</span><span class="p">]</span>
<span class="k">for</span> <span class="n">objtype</span> <span class="ow">in</span> <span class="n">objtypes</span><span class="p">:</span>
    <span class="n">frac_recovered</span><span class="p">[</span><span class="s1">&#39;is&#39;</span><span class="o">+</span><span class="n">objtype</span><span class="p">]</span><span class="o">=</span> <span class="n">cuts_obitractor</span><span class="p">[</span><span class="n">objtype</span><span class="p">][</span><span class="n">itrac</span><span class="p">]</span>
<span class="n">frac_recovered</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>

</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="stderr output_area docutils container">
<div class="highlight"><pre>
/home/kaylan/env_galsim/lib/python2.7/site-packages/ipykernel_launcher.py:3: SettingWithCopyWarning:
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: http://pandas.pydata.org/pandas-docs/stable/indexing.html#indexing-view-versus-copy
  This is separate from the ipykernel package so we can avoid doing imports until
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>Out[31]:
</pre></div>
</div>
<div class="output_area docutils container">
<div>
<style>
    .dataframe thead tr:only-child th {
        text-align: right;
    }

    .dataframe thead th {
        text-align: left;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>isRecovered</th>
      <th>sim_mag</th>
      <th>bins</th>
      <th>ispsf</th>
      <th>isrex</th>
      <th>isexp</th>
      <th>isdev</th>
      <th>iscomp</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>True</td>
      <td>21.451953</td>
      <td>(21.354, 21.59]</td>
      <td>False</td>
      <td>True</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
    </tr>
    <tr>
      <th>1</th>
      <td>True</td>
      <td>22.592270</td>
      <td>(22.531, 22.766]</td>
      <td>False</td>
      <td>True</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
    </tr>
    <tr>
      <th>2</th>
      <td>True</td>
      <td>21.624738</td>
      <td>(21.59, 21.825]</td>
      <td>False</td>
      <td>True</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
    </tr>
    <tr>
      <th>5</th>
      <td>True</td>
      <td>21.212229</td>
      <td>(21.119, 21.354]</td>
      <td>False</td>
      <td>True</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
    </tr>
    <tr>
      <th>6</th>
      <td>True</td>
      <td>21.583440</td>
      <td>(21.354, 21.59]</td>
      <td>False</td>
      <td>True</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [32]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">result</span><span class="o">=</span> <span class="n">frac_recovered</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;bins&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">/</span> <span class="n">frac_recovered</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;bins&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
<span class="n">result</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>Out[32]:
</pre></div>
</div>
<div class="output_area docutils container">
<div>
<style>
    .dataframe thead tr:only-child th {
        text-align: right;
    }

    .dataframe thead th {
        text-align: left;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>isRecovered</th>
      <th>sim_mag</th>
      <th>ispsf</th>
      <th>isrex</th>
      <th>isexp</th>
      <th>isdev</th>
      <th>iscomp</th>
    </tr>
    <tr>
      <th>bins</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>(19.704, 19.943]</th>
      <td>1.0</td>
      <td>19.847891</td>
      <td>0.0</td>
      <td>0.666667</td>
      <td>0.333333</td>
      <td>0.000000</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>(19.943, 20.178]</th>
      <td>1.0</td>
      <td>20.087371</td>
      <td>0.0</td>
      <td>0.000000</td>
      <td>1.000000</td>
      <td>0.000000</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>(20.178, 20.413]</th>
      <td>1.0</td>
      <td>20.310795</td>
      <td>0.0</td>
      <td>0.500000</td>
      <td>0.500000</td>
      <td>0.000000</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>(20.413, 20.649]</th>
      <td>1.0</td>
      <td>20.546447</td>
      <td>0.0</td>
      <td>0.400000</td>
      <td>0.600000</td>
      <td>0.000000</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>(20.649, 20.884]</th>
      <td>1.0</td>
      <td>20.773034</td>
      <td>0.0</td>
      <td>0.642857</td>
      <td>0.285714</td>
      <td>0.071429</td>
      <td>0.0</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
</div>
<div class="section" id="Depth-2-(fraction-recovered-by-&quot;type&quot;)">
<h1>Depth 2 (fraction recovered by “type”)<a class="headerlink" href="#Depth-2-(fraction-recovered-by-"type")" title="Permalink to this headline">¶</a></h1>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [33]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">for</span> <span class="n">objtype</span><span class="p">,</span><span class="n">c</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">objtypes</span><span class="p">,[</span><span class="s1">&#39;y&#39;</span><span class="p">,</span><span class="s1">&#39;m&#39;</span><span class="p">,</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="s1">&#39;g&#39;</span><span class="p">,</span><span class="s1">&#39;cyan&#39;</span><span class="p">]):</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">categories</span><span class="o">.</span><span class="n">mid</span><span class="p">,</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;is&#39;</span><span class="o">+</span><span class="n">objtype</span><span class="p">],</span><span class="n">label</span><span class="o">=</span><span class="n">objtype</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="c1">#plt.axvline(result.index[result[&#39;isRecovered&#39;] &lt;= 0.5][0],c=&#39;r&#39;,ls=&#39;-&#39;)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;z mag AB&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Fraction of Recovered sources&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>Out[33]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>&lt;matplotlib.text.Text at 0x7f02bbb04f90&gt;
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/nb_10deg2_region_47_1.png" src="../_images/nb_10deg2_region_47_1.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [34]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">xslc</span><span class="p">,</span><span class="n">yslc</span><span class="o">=</span> <span class="nb">slice</span><span class="p">(</span><span class="mi">2500</span><span class="p">,</span><span class="mi">3200</span><span class="p">),</span><span class="nb">slice</span><span class="p">(</span><span class="mi">2300</span><span class="p">,</span><span class="mi">3500</span><span class="p">)</span>
<span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">12</span><span class="p">))</span>

<span class="n">plotImage</span><span class="p">()</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">sliceImage</span><span class="p">(</span><span class="n">img_jpg</span><span class="p">,</span><span class="n">xslc</span><span class="p">,</span><span class="n">yslc</span><span class="p">),</span><span class="n">ax</span><span class="p">)</span>
<span class="c1"># Recovered</span>
<span class="n">plotImage</span><span class="p">()</span><span class="o">.</span><span class="n">circles</span><span class="p">(</span><span class="n">obitractor</span><span class="o">.</span><span class="n">bx</span><span class="p">[</span><span class="n">itrac</span><span class="p">],</span><span class="n">obitractor</span><span class="o">.</span><span class="n">by</span><span class="p">[</span><span class="n">itrac</span><span class="p">],</span><span class="n">ax</span><span class="p">,</span>
                    <span class="n">xslice</span><span class="o">=</span><span class="n">xslc</span><span class="p">,</span><span class="n">yslice</span><span class="o">=</span><span class="n">yslc</span><span class="p">,</span>
                    <span class="n">color</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">,</span><span class="n">r_pixels</span><span class="o">=</span><span class="mi">5</span><span class="o">/</span><span class="mf">0.262</span><span class="p">)</span>
<span class="c1"># Missed</span>
<span class="n">plotImage</span><span class="p">()</span><span class="o">.</span><span class="n">circles</span><span class="p">(</span><span class="n">simcat</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">not_isim</span><span class="p">],</span><span class="n">simcat</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">not_isim</span><span class="p">],</span><span class="n">ax</span><span class="p">,</span>
                    <span class="n">xslice</span><span class="o">=</span><span class="n">xslc</span><span class="p">,</span><span class="n">yslice</span><span class="o">=</span><span class="n">yslc</span><span class="p">,</span>
                    <span class="n">color</span><span class="o">=</span><span class="s1">&#39;m&#39;</span><span class="p">,</span><span class="n">r_pixels</span><span class="o">=</span><span class="mi">5</span><span class="o">/</span><span class="mf">0.262</span><span class="p">)</span>
<span class="c1"># Real</span>
<span class="n">plotImage</span><span class="p">()</span><span class="o">.</span><span class="n">circles</span><span class="p">(</span><span class="n">obitractor</span><span class="o">.</span><span class="n">bx</span><span class="p">[</span><span class="n">not_itrac</span><span class="p">],</span><span class="n">obitractor</span><span class="o">.</span><span class="n">by</span><span class="p">[</span><span class="n">not_itrac</span><span class="p">],</span><span class="n">ax</span><span class="p">,</span>
                    <span class="n">xslice</span><span class="o">=</span><span class="n">xslc</span><span class="p">,</span><span class="n">yslice</span><span class="o">=</span><span class="n">yslc</span><span class="p">,</span>
                    <span class="n">color</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span><span class="n">r_pixels</span><span class="o">=</span><span class="mi">5</span><span class="o">/</span><span class="mf">0.262</span><span class="p">)</span>

</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/nb_10deg2_region_48_0.png" src="../_images/nb_10deg2_region_48_0.png" />
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [35]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">class</span> <span class="nc">Panel</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Plots panel of N cutouts for N sources from an image and any slice into it</span>

<span class="sd">    TODO: normalize each cutout before adding it to the panel</span>

<span class="sd">    Args:</span>
<span class="sd">        img: full image</span>
<span class="sd">        x_all,y_all: positions of all sources in the full image</span>
<span class="sd">        jpeg: bool, rotate fits image and jpeg image differently when display</span>
<span class="sd">        xslc,yslc: slice() objects if want to take subset of full image and sources</span>
<span class="sd">        hw: half-width [pixels]</span>
<span class="sd">        nrows: number of rows and also number of cols</span>

<span class="sd">    Returns:</span>
<span class="sd">        panel:</span>
<span class="sd">        panel</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">img</span><span class="p">,</span><span class="n">x_all</span><span class="p">,</span><span class="n">y_all</span><span class="p">,</span>
                 <span class="n">xslc</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">yslc</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                 <span class="n">nrows</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">hw</span><span class="o">=</span><span class="mi">30</span><span class="p">):</span>
        <span class="k">assert</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">x_all</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">y_all</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">))</span>
        <span class="n">dims</span> <span class="o">=</span> <span class="p">(</span><span class="n">nrows</span><span class="o">*</span><span class="n">hw</span><span class="o">*</span><span class="mi">2</span><span class="p">,</span><span class="n">nrows</span><span class="o">*</span><span class="n">hw</span><span class="o">*</span><span class="mi">2</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">img</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
            <span class="n">dims</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">dims</span><span class="p">)</span><span class="o">+</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">panel</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">dims</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">img</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">xpan</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">dims</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">hw</span><span class="o">*</span><span class="mi">2</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ypan</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">dims</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">hw</span><span class="o">*</span><span class="mi">2</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">xslc</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">xslc</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">img</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">yslc</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">yslc</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">img</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">dims</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
            <span class="n">pil_img</span><span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">fromarray</span><span class="p">(</span><span class="n">sliceImage</span><span class="p">(</span><span class="n">img_jpg</span><span class="p">,</span><span class="n">xslc</span><span class="p">,</span><span class="n">yslc</span><span class="p">),</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;RGB&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">pil_img</span><span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">fromarray</span><span class="p">(</span><span class="n">sliceImage</span><span class="p">(</span><span class="n">img</span><span class="p">,</span><span class="n">xslc</span><span class="p">,</span><span class="n">yslc</span><span class="p">))</span>
        <span class="n">keep</span><span class="o">=</span> <span class="n">plotImage</span><span class="p">()</span><span class="o">.</span><span class="n">justInSlice</span><span class="p">(</span><span class="n">x_all</span><span class="p">,</span><span class="n">y_all</span><span class="p">,</span><span class="n">xslc</span><span class="p">,</span><span class="n">yslc</span><span class="p">)</span>
        <span class="n">x_inslice</span><span class="p">,</span><span class="n">y_inslice</span><span class="o">=</span> <span class="n">x_all</span><span class="p">[</span><span class="n">keep</span><span class="p">],</span><span class="n">y_all</span><span class="p">[</span><span class="n">keep</span><span class="p">]</span>
        <span class="k">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x_inslice</span><span class="p">),</span><span class="n">nrows</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">npanels</span><span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">nrows</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">x_inslice</span><span class="p">))</span>
        <span class="n">i</span><span class="o">=</span><span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="o">=</span><span class="p">[],[]</span>
        <span class="k">for</span> <span class="n">xp</span><span class="p">,</span><span class="n">yp</span> <span class="ow">in</span> <span class="n">itertools</span><span class="o">.</span><span class="n">product</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xpan</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">ypan</span><span class="p">):</span>
                <span class="n">xs</span><span class="p">,</span><span class="n">ys</span><span class="o">=</span><span class="n">x_inslice</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="n">xslc</span><span class="o">.</span><span class="n">start</span><span class="p">,</span><span class="n">y_inslice</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="n">yslc</span><span class="o">.</span><span class="n">start</span>
                <span class="n">cutout</span><span class="o">=</span> <span class="n">pil_img</span><span class="o">.</span><span class="n">crop</span><span class="p">((</span><span class="n">xs</span><span class="o">-</span><span class="n">hw</span><span class="p">,</span><span class="n">ys</span><span class="o">-</span><span class="n">hw</span><span class="p">,</span><span class="n">xs</span><span class="o">+</span><span class="n">hw</span><span class="p">,</span><span class="n">ys</span><span class="o">+</span><span class="n">hw</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">panel</span><span class="p">[</span><span class="n">xp</span><span class="p">:</span><span class="n">xp</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">hw</span><span class="p">,</span> <span class="n">yp</span><span class="p">:</span><span class="n">yp</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">hw</span><span class="p">]</span><span class="o">=</span> <span class="n">cutout</span>
                <span class="c1"># retain exact position</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">xp</span><span class="o">+</span> <span class="n">hw</span> <span class="o">+</span> <span class="n">xs</span><span class="o">-</span><span class="nb">int</span><span class="p">(</span><span class="n">xs</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">yp</span><span class="o">+</span> <span class="n">hw</span> <span class="o">+</span> <span class="n">ys</span><span class="o">-</span><span class="nb">int</span><span class="p">(</span><span class="n">ys</span><span class="p">))</span>
                <span class="n">i</span><span class="o">+=</span><span class="mi">1</span>
                <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;=</span> <span class="n">npanels</span><span class="p">:</span>
                    <span class="k">break</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">ax</span><span class="p">,</span><span class="n">title</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="n">plotImage</span><span class="p">()</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">panel</span><span class="p">,</span><span class="n">ax</span><span class="p">)</span>
        <span class="n">plotImage</span><span class="p">()</span><span class="o">.</span><span class="n">circles</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">,</span><span class="n">ax</span><span class="p">,</span>
                            <span class="n">img_shape</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">panel</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span>
                            <span class="n">color</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">,</span><span class="n">r_pixels</span><span class="o">=</span><span class="mi">5</span><span class="o">/</span><span class="mf">0.262</span><span class="p">)</span>
        <span class="c1"># borders</span>
        <span class="k">for</span> <span class="n">xp</span><span class="p">,</span><span class="n">yp</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xpan</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span><span class="bp">self</span><span class="o">.</span><span class="n">ypan</span><span class="p">[</span><span class="mi">1</span><span class="p">:]):</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">xp</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">yp</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">title</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="Visualize-Real-vs.-Recovered-sources">
<h1>Visualize Real vs. Recovered sources<a class="headerlink" href="#Visualize-Real-vs.-Recovered-sources" title="Permalink to this headline">¶</a></h1>
<div class="section" id="Real">
<h2>Real<a class="headerlink" href="#Real" title="Permalink to this headline">¶</a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [39]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">xslc</span><span class="p">,</span><span class="n">yslc</span><span class="o">=</span> <span class="bp">None</span><span class="p">,</span><span class="bp">None</span> <span class="c1">#slice(2500,3200),slice(2300,3500)</span>
<span class="n">p</span><span class="o">=</span> <span class="n">Panel</span><span class="p">(</span><span class="n">img_jpg</span><span class="p">,</span><span class="n">obitractor</span><span class="o">.</span><span class="n">bx</span><span class="p">[</span><span class="n">not_itrac</span><span class="p">],</span><span class="n">obitractor</span><span class="o">.</span><span class="n">by</span><span class="p">[</span><span class="n">not_itrac</span><span class="p">],</span>
         <span class="n">xslc</span><span class="o">=</span><span class="n">xslc</span><span class="p">,</span><span class="n">yslc</span><span class="o">=</span><span class="n">yslc</span><span class="p">,</span>
         <span class="n">hw</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span><span class="n">nrows</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">p</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;Real&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(107, 100)
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/nb_10deg2_region_52_1.png" src="../_images/nb_10deg2_region_52_1.png" />
</div>
</div>
</div>
<div class="section" id="Recovered">
<h2>Recovered<a class="headerlink" href="#Recovered" title="Permalink to this headline">¶</a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [40]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">xslc</span><span class="p">,</span><span class="n">yslc</span><span class="o">=</span> <span class="bp">None</span><span class="p">,</span><span class="bp">None</span> <span class="c1">#slice(2500,3200),slice(2300,3500)</span>
<span class="n">p</span><span class="o">=</span> <span class="n">Panel</span><span class="p">(</span><span class="n">img_jpg</span><span class="p">,</span><span class="n">obitractor</span><span class="o">.</span><span class="n">bx</span><span class="p">[</span><span class="n">itrac</span><span class="p">],</span><span class="n">obitractor</span><span class="o">.</span><span class="n">by</span><span class="p">[</span><span class="n">itrac</span><span class="p">],</span>
         <span class="n">xslc</span><span class="o">=</span><span class="n">xslc</span><span class="p">,</span><span class="n">yslc</span><span class="o">=</span><span class="n">yslc</span><span class="p">,</span>
         <span class="n">hw</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span><span class="n">nrows</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">p</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;Recovered&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(214, 100)
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/nb_10deg2_region_54_1.png" src="../_images/nb_10deg2_region_54_1.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [41]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">obitractor</span><span class="o">.</span><span class="n">get_columns</span><span class="p">():</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">obitractor</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">col</span><span class="p">)</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s1">&#39;removing col=&#39;</span><span class="p">,</span><span class="n">col</span><span class="p">)</span>
        <span class="n">obitractor</span><span class="o">.</span><span class="n">delete_column</span><span class="p">(</span><span class="n">col</span><span class="p">)</span>
<span class="n">obitractor</span><span class="o">.</span><span class="n">get_columns</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(&#39;removing col=&#39;, &#39;dchisq&#39;)
(&#39;removing col=&#39;, &#39;apflux_u&#39;)
(&#39;removing col=&#39;, &#39;apflux_g&#39;)
(&#39;removing col=&#39;, &#39;apflux_r&#39;)
(&#39;removing col=&#39;, &#39;apflux_i&#39;)
(&#39;removing col=&#39;, &#39;apflux_z&#39;)
(&#39;removing col=&#39;, &#39;apflux_y&#39;)
(&#39;removing col=&#39;, &#39;apflux_resid_u&#39;)
(&#39;removing col=&#39;, &#39;apflux_resid_g&#39;)
(&#39;removing col=&#39;, &#39;apflux_resid_r&#39;)
(&#39;removing col=&#39;, &#39;apflux_resid_i&#39;)
(&#39;removing col=&#39;, &#39;apflux_resid_z&#39;)
(&#39;removing col=&#39;, &#39;apflux_resid_y&#39;)
(&#39;removing col=&#39;, &#39;apflux_ivar_u&#39;)
(&#39;removing col=&#39;, &#39;apflux_ivar_g&#39;)
(&#39;removing col=&#39;, &#39;apflux_ivar_r&#39;)
(&#39;removing col=&#39;, &#39;apflux_ivar_i&#39;)
(&#39;removing col=&#39;, &#39;apflux_ivar_z&#39;)
(&#39;removing col=&#39;, &#39;apflux_ivar_y&#39;)
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>Out[41]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>[&#39;release&#39;,
 &#39;brickid&#39;,
 &#39;brickname&#39;,
 &#39;objid&#39;,
 &#39;brick_primary&#39;,
 &#39;type&#39;,
 &#39;ra&#39;,
 &#39;dec&#39;,
 &#39;ra_ivar&#39;,
 &#39;dec_ivar&#39;,
 &#39;bx&#39;,
 &#39;by&#39;,
 &#39;ebv&#39;,
 &#39;mjd_min&#39;,
 &#39;mjd_max&#39;,
 &#39;flux_u&#39;,
 &#39;flux_g&#39;,
 &#39;flux_r&#39;,
 &#39;flux_i&#39;,
 &#39;flux_z&#39;,
 &#39;flux_y&#39;,
 &#39;flux_ivar_u&#39;,
 &#39;flux_ivar_g&#39;,
 &#39;flux_ivar_r&#39;,
 &#39;flux_ivar_i&#39;,
 &#39;flux_ivar_z&#39;,
 &#39;flux_ivar_y&#39;,
 &#39;mw_transmission_u&#39;,
 &#39;mw_transmission_g&#39;,
 &#39;mw_transmission_r&#39;,
 &#39;mw_transmission_i&#39;,
 &#39;mw_transmission_z&#39;,
 &#39;mw_transmission_y&#39;,
 &#39;nobs_u&#39;,
 &#39;nobs_g&#39;,
 &#39;nobs_r&#39;,
 &#39;nobs_i&#39;,
 &#39;nobs_z&#39;,
 &#39;nobs_y&#39;,
 &#39;rchisq_u&#39;,
 &#39;rchisq_g&#39;,
 &#39;rchisq_r&#39;,
 &#39;rchisq_i&#39;,
 &#39;rchisq_z&#39;,
 &#39;rchisq_y&#39;,
 &#39;fracflux_u&#39;,
 &#39;fracflux_g&#39;,
 &#39;fracflux_r&#39;,
 &#39;fracflux_i&#39;,
 &#39;fracflux_z&#39;,
 &#39;fracflux_y&#39;,
 &#39;fracmasked_u&#39;,
 &#39;fracmasked_g&#39;,
 &#39;fracmasked_r&#39;,
 &#39;fracmasked_i&#39;,
 &#39;fracmasked_z&#39;,
 &#39;fracmasked_y&#39;,
 &#39;fracin_u&#39;,
 &#39;fracin_g&#39;,
 &#39;fracin_r&#39;,
 &#39;fracin_i&#39;,
 &#39;fracin_z&#39;,
 &#39;fracin_y&#39;,
 &#39;anymask_u&#39;,
 &#39;anymask_g&#39;,
 &#39;anymask_r&#39;,
 &#39;anymask_i&#39;,
 &#39;anymask_z&#39;,
 &#39;anymask_y&#39;,
 &#39;allmask_u&#39;,
 &#39;allmask_g&#39;,
 &#39;allmask_r&#39;,
 &#39;allmask_i&#39;,
 &#39;allmask_z&#39;,
 &#39;allmask_y&#39;,
 &#39;psfsize_u&#39;,
 &#39;psfsize_g&#39;,
 &#39;psfsize_r&#39;,
 &#39;psfsize_i&#39;,
 &#39;psfsize_z&#39;,
 &#39;psfsize_y&#39;,
 &#39;psfdepth_u&#39;,
 &#39;psfdepth_g&#39;,
 &#39;psfdepth_r&#39;,
 &#39;psfdepth_i&#39;,
 &#39;psfdepth_z&#39;,
 &#39;psfdepth_y&#39;,
 &#39;galdepth_u&#39;,
 &#39;galdepth_g&#39;,
 &#39;galdepth_r&#39;,
 &#39;galdepth_i&#39;,
 &#39;galdepth_z&#39;,
 &#39;galdepth_y&#39;,
 &#39;fracdev&#39;,
 &#39;fracdev_ivar&#39;,
 &#39;shapeexp_r&#39;,
 &#39;shapeexp_r_ivar&#39;,
 &#39;shapeexp_e1&#39;,
 &#39;shapeexp_e1_ivar&#39;,
 &#39;shapeexp_e2&#39;,
 &#39;shapeexp_e2_ivar&#39;,
 &#39;shapedev_r&#39;,
 &#39;shapedev_r_ivar&#39;,
 &#39;shapedev_e1&#39;,
 &#39;shapedev_e1_ivar&#39;,
 &#39;shapedev_e2&#39;,
 &#39;shapedev_e2_ivar&#39;]
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [42]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">simcat_df</span><span class="o">=</span> <span class="n">fits2pandas</span><span class="p">(</span><span class="n">simcat</span><span class="p">)</span>
<span class="n">simcat_df</span><span class="p">[</span><span class="s1">&#39;gmag&#39;</span><span class="p">]</span><span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">simcat</span><span class="p">(</span><span class="n">simcat_df</span><span class="p">[</span><span class="s1">&#39;gflux&#39;</span><span class="p">])</span>
<span class="n">sns</span><span class="o">.</span><span class="n">distplot</span><span class="p">(</span><span class="n">simcat_df</span><span class="p">[</span><span class="s1">&#39;gmag&#39;</span><span class="p">])</span>

<span class="n">obitractor_df</span><span class="o">=</span> <span class="n">fits2pandas</span><span class="p">(</span><span class="n">obitractor</span><span class="p">)</span>
<span class="n">obitractor_df</span><span class="p">[</span><span class="s1">&#39;gmag&#39;</span><span class="p">]</span><span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">tractor</span><span class="p">(</span><span class="n">obitractor_df</span><span class="p">[</span><span class="s1">&#39;flux_g&#39;</span><span class="p">],</span>
                                 <span class="n">obitractor_df</span><span class="p">[</span><span class="s1">&#39;mw_transmission_z&#39;</span><span class="p">])</span>
<span class="n">sns</span><span class="o">.</span><span class="n">distplot</span><span class="p">(</span><span class="n">obitractor_df</span><span class="p">[</span><span class="s1">&#39;gmag&#39;</span><span class="p">])</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">19</span><span class="p">,</span><span class="mi">30</span><span class="p">)</span>
<span class="c1">#gmag= F.tractor(obitractor.flux_z[isObj],</span>
<span class="c1">#                obitractor.mw_transmission_z[isObj])</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>Out[42]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>(19, 30)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/nb_10deg2_region_57_1.png" src="../_images/nb_10deg2_region_57_1.png" />
</div>
</div>
</div>
<div class="section" id="Real-vs.-Recovered-grouped-by-g-mag">
<h2>Real vs. Recovered grouped by g-mag<a class="headerlink" href="#Real-vs.-Recovered-grouped-by-g-mag" title="Permalink to this headline">¶</a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">gmag_bins</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">22</span><span class="p">,</span><span class="mi">26</span><span class="p">,</span><span class="n">num</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="n">simcat_df</span><span class="p">[</span><span class="s1">&#39;gmag_bins&#39;</span><span class="p">]</span><span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">cut</span><span class="p">(</span><span class="n">simcat_df</span><span class="p">[</span><span class="s1">&#39;gmag&#39;</span><span class="p">],</span><span class="n">bins</span><span class="o">=</span><span class="n">gmag_bins</span><span class="p">)</span>
<span class="n">obitractor_df</span><span class="p">[</span><span class="s1">&#39;gmag_bins&#39;</span><span class="p">]</span><span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">cut</span><span class="p">(</span><span class="n">obitractor_df</span><span class="p">[</span><span class="s1">&#39;gmag&#39;</span><span class="p">],</span><span class="n">bins</span><span class="o">=</span><span class="n">gmag_bins</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [44]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">simcat_df</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;gmag&#39;</span><span class="p">)[</span><span class="s1">&#39;gmag&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>Out[44]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>224    21.993821
32     22.268190
182    22.290115
222    22.303895
90     22.318836
Name: gmag, dtype: float64
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">print</span><span class="p">(</span><span class="s1">&#39;Each 30 image mosaic has faintest (top left) and brightest (bottom right)&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Each 30 image mosaic has faintest (top left) and brightest (bottom right)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [45]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">simcat_df_rec</span><span class="o">=</span> <span class="n">simcat_df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">isim</span><span class="p">]</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;gmag&#39;</span><span class="p">)</span>
<span class="n">obitractor_df_real</span><span class="o">=</span> <span class="n">obitractor_df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">not_itrac</span><span class="p">]</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;gmag&#39;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">categ</span> <span class="ow">in</span> <span class="n">simcat_df</span><span class="p">[</span><span class="s1">&#39;gmag_bins&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">cat</span><span class="o">.</span><span class="n">categories</span><span class="p">:</span>
    <span class="n">keep</span><span class="o">=</span> <span class="n">simcat_df_rec</span><span class="p">[</span><span class="s1">&#39;gmag_bins&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">categ</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">simcat_df_rec</span><span class="p">[</span><span class="n">keep</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">simPanel</span><span class="o">=</span> <span class="n">Panel</span><span class="p">(</span><span class="n">img_jpg</span><span class="p">,</span>
                        <span class="n">simcat_df_rec</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">keep</span><span class="p">,</span><span class="s1">&#39;x&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
                        <span class="n">simcat_df_rec</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">keep</span><span class="p">,</span><span class="s1">&#39;y&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
                        <span class="n">hw</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span><span class="n">nrows</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
    <span class="n">keep</span><span class="o">=</span> <span class="n">obitractor_df_real</span><span class="p">[</span><span class="s1">&#39;gmag_bins&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">categ</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">obitractor_df_real</span><span class="p">[</span><span class="n">keep</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">obiPanel</span><span class="o">=</span> <span class="n">Panel</span><span class="p">(</span><span class="n">img_jpg</span><span class="p">,</span>
                        <span class="n">obitractor_df_real</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">keep</span><span class="p">,</span><span class="s1">&#39;bx&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
                        <span class="n">obitractor_df_real</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">keep</span><span class="p">,</span><span class="s1">&#39;by&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
                        <span class="n">hw</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span><span class="n">nrows</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>

    <span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
    <span class="n">text</span><span class="o">=</span> <span class="s1">&#39;</span><span class="si">%.1f</span><span class="s1"> &lt; g &lt; </span><span class="si">%.1f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">categ</span><span class="o">.</span><span class="n">left</span><span class="p">,</span><span class="n">categ</span><span class="o">.</span><span class="n">right</span><span class="p">)</span>
    <span class="n">simPanel</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;Recovered &#39;</span><span class="o">+</span><span class="n">text</span><span class="p">)</span>
    <span class="n">obiPanel</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;Real &#39;</span><span class="o">+</span><span class="n">text</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(43, 25)
(18, 25)
(102, 25)
(25, 25)
(42, 25)
(14, 25)
(20, 25)
(8, 25)
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/nb_10deg2_region_62_1.png" src="../_images/nb_10deg2_region_62_1.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/nb_10deg2_region_62_2.png" src="../_images/nb_10deg2_region_62_2.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/nb_10deg2_region_62_3.png" src="../_images/nb_10deg2_region_62_3.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/nb_10deg2_region_62_4.png" src="../_images/nb_10deg2_region_62_4.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [46]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">def</span> <span class="nf">myshuffle</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="n">indices</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
    <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="n">indices</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">indices</span>

<span class="n">myshuffle</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>Out[46]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>array([8, 5, 0, 2, 1, 9, 7, 3, 6, 4])
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="Properties-of-Recovered-sources">
<h1>Properties of Recovered sources<a class="headerlink" href="#Properties-of-Recovered-sources" title="Permalink to this headline">¶</a></h1>
<div class="section" id="Recovered-!=-func(-rhalf-)">
<h2>Recovered != func( rhalf )<a class="headerlink" href="#Recovered-!=-func(-rhalf-)" title="Permalink to this headline">¶</a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [47]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Recovered vs. Missed</span>
<span class="n">mag</span><span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">simcat</span><span class="p">(</span><span class="n">simcat</span><span class="o">.</span><span class="n">zflux</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">mag</span><span class="p">[</span><span class="n">isim</span><span class="p">],</span><span class="n">simcat</span><span class="o">.</span><span class="n">rhalf</span><span class="p">[</span><span class="n">isim</span><span class="p">],</span><span class="n">c</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;Recovered&#39;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">mag</span><span class="p">[</span><span class="n">not_isim</span><span class="p">],</span><span class="n">simcat</span><span class="o">.</span><span class="n">rhalf</span><span class="p">[</span><span class="n">not_isim</span><span class="p">],</span><span class="n">c</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;Missed&#39;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;z mag&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;rhalf&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>Out[47]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>&lt;matplotlib.legend.Legend at 0x7f02bd7ba790&gt;
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/nb_10deg2_region_66_1.png" src="../_images/nb_10deg2_region_66_1.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [48]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">print</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">obitractor_df</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]))</span>
<span class="n">obitractor</span><span class="o">.</span><span class="n">get_columns</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
set([&#39;PSF &#39;, &#39;EXP &#39;, &#39;DEV &#39;, &#39;COMP&#39;, &#39;REX &#39;])
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>Out[48]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>[&#39;release&#39;,
 &#39;brickid&#39;,
 &#39;brickname&#39;,
 &#39;objid&#39;,
 &#39;brick_primary&#39;,
 &#39;type&#39;,
 &#39;ra&#39;,
 &#39;dec&#39;,
 &#39;ra_ivar&#39;,
 &#39;dec_ivar&#39;,
 &#39;bx&#39;,
 &#39;by&#39;,
 &#39;ebv&#39;,
 &#39;mjd_min&#39;,
 &#39;mjd_max&#39;,
 &#39;flux_u&#39;,
 &#39;flux_g&#39;,
 &#39;flux_r&#39;,
 &#39;flux_i&#39;,
 &#39;flux_z&#39;,
 &#39;flux_y&#39;,
 &#39;flux_ivar_u&#39;,
 &#39;flux_ivar_g&#39;,
 &#39;flux_ivar_r&#39;,
 &#39;flux_ivar_i&#39;,
 &#39;flux_ivar_z&#39;,
 &#39;flux_ivar_y&#39;,
 &#39;mw_transmission_u&#39;,
 &#39;mw_transmission_g&#39;,
 &#39;mw_transmission_r&#39;,
 &#39;mw_transmission_i&#39;,
 &#39;mw_transmission_z&#39;,
 &#39;mw_transmission_y&#39;,
 &#39;nobs_u&#39;,
 &#39;nobs_g&#39;,
 &#39;nobs_r&#39;,
 &#39;nobs_i&#39;,
 &#39;nobs_z&#39;,
 &#39;nobs_y&#39;,
 &#39;rchisq_u&#39;,
 &#39;rchisq_g&#39;,
 &#39;rchisq_r&#39;,
 &#39;rchisq_i&#39;,
 &#39;rchisq_z&#39;,
 &#39;rchisq_y&#39;,
 &#39;fracflux_u&#39;,
 &#39;fracflux_g&#39;,
 &#39;fracflux_r&#39;,
 &#39;fracflux_i&#39;,
 &#39;fracflux_z&#39;,
 &#39;fracflux_y&#39;,
 &#39;fracmasked_u&#39;,
 &#39;fracmasked_g&#39;,
 &#39;fracmasked_r&#39;,
 &#39;fracmasked_i&#39;,
 &#39;fracmasked_z&#39;,
 &#39;fracmasked_y&#39;,
 &#39;fracin_u&#39;,
 &#39;fracin_g&#39;,
 &#39;fracin_r&#39;,
 &#39;fracin_i&#39;,
 &#39;fracin_z&#39;,
 &#39;fracin_y&#39;,
 &#39;anymask_u&#39;,
 &#39;anymask_g&#39;,
 &#39;anymask_r&#39;,
 &#39;anymask_i&#39;,
 &#39;anymask_z&#39;,
 &#39;anymask_y&#39;,
 &#39;allmask_u&#39;,
 &#39;allmask_g&#39;,
 &#39;allmask_r&#39;,
 &#39;allmask_i&#39;,
 &#39;allmask_z&#39;,
 &#39;allmask_y&#39;,
 &#39;psfsize_u&#39;,
 &#39;psfsize_g&#39;,
 &#39;psfsize_r&#39;,
 &#39;psfsize_i&#39;,
 &#39;psfsize_z&#39;,
 &#39;psfsize_y&#39;,
 &#39;psfdepth_u&#39;,
 &#39;psfdepth_g&#39;,
 &#39;psfdepth_r&#39;,
 &#39;psfdepth_i&#39;,
 &#39;psfdepth_z&#39;,
 &#39;psfdepth_y&#39;,
 &#39;galdepth_u&#39;,
 &#39;galdepth_g&#39;,
 &#39;galdepth_r&#39;,
 &#39;galdepth_i&#39;,
 &#39;galdepth_z&#39;,
 &#39;galdepth_y&#39;,
 &#39;fracdev&#39;,
 &#39;fracdev_ivar&#39;,
 &#39;shapeexp_r&#39;,
 &#39;shapeexp_r_ivar&#39;,
 &#39;shapeexp_e1&#39;,
 &#39;shapeexp_e1_ivar&#39;,
 &#39;shapeexp_e2&#39;,
 &#39;shapeexp_e2_ivar&#39;,
 &#39;shapedev_r&#39;,
 &#39;shapedev_r_ivar&#39;,
 &#39;shapedev_e1&#39;,
 &#39;shapedev_e1_ivar&#39;,
 &#39;shapedev_e2&#39;,
 &#39;shapedev_e2_ivar&#39;]
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [51]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">isGal</span><span class="o">=</span> <span class="n">obitractor_df</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;PSF &#39;</span>
<span class="n">obitractor_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">isGal</span><span class="p">,[</span><span class="s1">&#39;type&#39;</span><span class="p">,</span><span class="s1">&#39;psfsize_g&#39;</span><span class="p">,</span><span class="s1">&#39;psfsize_r&#39;</span><span class="p">,</span><span class="s1">&#39;psfsize_z&#39;</span><span class="p">,</span><span class="s1">&#39;shapeexp_r&#39;</span><span class="p">,</span><span class="s1">&#39;shapedev_r&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>

</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>Out[51]:
</pre></div>
</div>
<div class="output_area docutils container">
<div>
<style>
    .dataframe thead tr:only-child th {
        text-align: right;
    }

    .dataframe thead th {
        text-align: left;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>type</th>
      <th>psfsize_g</th>
      <th>psfsize_r</th>
      <th>psfsize_z</th>
      <th>shapeexp_r</th>
      <th>shapedev_r</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>8</th>
      <td>PSF</td>
      <td>1.217095</td>
      <td>1.041571</td>
      <td>1.166601</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>15</th>
      <td>PSF</td>
      <td>1.217095</td>
      <td>1.041571</td>
      <td>1.063296</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>18</th>
      <td>PSF</td>
      <td>1.217095</td>
      <td>1.041571</td>
      <td>1.091158</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>24</th>
      <td>PSF</td>
      <td>1.217095</td>
      <td>1.041571</td>
      <td>1.105378</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>28</th>
      <td>PSF</td>
      <td>1.217095</td>
      <td>1.041571</td>
      <td>1.168029</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [52]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Recovered vs. Real</span>
<span class="n">isGal</span><span class="o">=</span> <span class="n">obitractor_df</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;PSF &#39;</span>
<span class="n">obitractor_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">isGal</span><span class="p">,[</span><span class="s1">&#39;type&#39;</span><span class="p">,</span><span class="s1">&#39;psfsize_g&#39;</span><span class="p">,</span><span class="s1">&#39;psfsize_r&#39;</span><span class="p">,</span><span class="s1">&#39;psfsize_z&#39;</span><span class="p">,</span><span class="s1">&#39;shapeexp_r&#39;</span><span class="p">,</span><span class="s1">&#39;shapedev_r&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>

</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>Out[52]:
</pre></div>
</div>
<div class="output_area docutils container">
<div>
<style>
    .dataframe thead tr:only-child th {
        text-align: right;
    }

    .dataframe thead th {
        text-align: left;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>type</th>
      <th>psfsize_g</th>
      <th>psfsize_r</th>
      <th>psfsize_z</th>
      <th>shapeexp_r</th>
      <th>shapedev_r</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>REX</td>
      <td>1.238828</td>
      <td>1.038830</td>
      <td>1.152590</td>
      <td>0.926860</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>REX</td>
      <td>1.217095</td>
      <td>1.041571</td>
      <td>1.244965</td>
      <td>0.261353</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>REX</td>
      <td>1.217095</td>
      <td>1.041571</td>
      <td>1.155406</td>
      <td>0.701151</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>REX</td>
      <td>1.217095</td>
      <td>1.041571</td>
      <td>1.154364</td>
      <td>0.529196</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>REX</td>
      <td>1.217095</td>
      <td>1.041571</td>
      <td>1.156058</td>
      <td>0.642927</td>
      <td>0.0</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [53]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">obitractor_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,[</span><span class="s1">&#39;shapeexp_r&#39;</span><span class="p">,</span><span class="s1">&#39;shapedev_r&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">shape</span> <span class="c1">#max(axis=1).shape</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>Out[53]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>(321, 2)
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [54]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="nb">len</span><span class="p">(</span><span class="n">simcat</span><span class="p">[</span><span class="n">isim</span><span class="p">]),</span><span class="nb">len</span><span class="p">(</span><span class="n">obitractor</span><span class="p">[</span><span class="n">itrac</span><span class="p">]),</span><span class="nb">len</span><span class="p">(</span><span class="n">simcat_df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">isim</span><span class="p">]),</span><span class="nb">len</span><span class="p">(</span><span class="n">obitractor_df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">isim</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>Out[54]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>(214, 214, 214, 214)
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [64]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">([</span><span class="n">obitractor</span><span class="o">.</span><span class="n">shapeexp_r</span><span class="p">,</span><span class="n">obitractor</span><span class="o">.</span><span class="n">shapeexp_r</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>Out[64]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>(321,)
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [66]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">def</span> <span class="nf">get_source_sizes</span><span class="p">(</span><span class="n">tractor</span><span class="p">):</span>
    <span class="n">rhalf</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">tractor</span><span class="p">))</span><span class="o">-</span><span class="mi">1</span>
    <span class="n">isGal</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">char</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="n">tractor</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;type&#39;</span><span class="p">))</span> <span class="o">!=</span> <span class="s1">&#39;PSF&#39;</span>
    <span class="n">vals</span><span class="o">=</span> <span class="p">[</span><span class="n">tractor</span><span class="p">[</span><span class="n">isGal</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">col</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
           <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;shapeexp_r&#39;</span><span class="p">,</span><span class="s1">&#39;shapedev_r&#39;</span><span class="p">]]</span>
    <span class="n">rhalf</span><span class="p">[</span><span class="n">isGal</span><span class="p">]</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">([</span><span class="n">obitractor</span><span class="p">[</span><span class="n">isGal</span><span class="p">]</span><span class="o">.</span><span class="n">shapeexp_r</span><span class="p">,</span>
                          <span class="n">obitractor</span><span class="p">[</span><span class="n">isGal</span><span class="p">]</span><span class="o">.</span><span class="n">shapedev_r</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">rhalf</span><span class="p">[</span><span class="o">~</span><span class="n">isGal</span><span class="p">]</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">([</span><span class="n">obitractor</span><span class="p">[</span><span class="o">~</span><span class="n">isGal</span><span class="p">]</span><span class="o">.</span><span class="n">psfsize_g</span><span class="p">,</span>
                           <span class="n">obitractor</span><span class="p">[</span><span class="o">~</span><span class="n">isGal</span><span class="p">]</span><span class="o">.</span><span class="n">psfsize_r</span><span class="p">,</span>
                           <span class="n">obitractor</span><span class="p">[</span><span class="o">~</span><span class="n">isGal</span><span class="p">]</span><span class="o">.</span><span class="n">psfsize_z</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">rhalf</span>

<span class="n">obitractor</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;rhalf&#39;</span><span class="p">,</span><span class="n">get_source_sizes</span><span class="p">(</span><span class="n">obitractor</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [70]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">sns</span><span class="o">.</span><span class="n">distplot</span><span class="p">(</span><span class="n">simcat</span><span class="p">[</span><span class="n">isim</span><span class="p">]</span><span class="o">.</span><span class="n">rhalf</span><span class="p">,</span><span class="n">hist</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
             <span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;Recovered (input)&#39;</span><span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">distplot</span><span class="p">(</span><span class="n">obitractor</span><span class="p">[</span><span class="n">itrac</span><span class="p">]</span><span class="o">.</span><span class="n">rhalf</span><span class="p">,</span><span class="n">hist</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
             <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;Recovered (meas)&#39;</span><span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">distplot</span><span class="p">(</span><span class="n">simcat</span><span class="p">[</span><span class="n">not_isim</span><span class="p">]</span><span class="o">.</span><span class="n">rhalf</span><span class="p">,</span><span class="n">hist</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
             <span class="n">color</span><span class="o">=</span><span class="s1">&#39;g&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;Missed&#39;</span><span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">distplot</span><span class="p">(</span><span class="n">obitractor</span><span class="p">[</span><span class="n">not_itrac</span><span class="p">]</span><span class="o">.</span><span class="n">rhalf</span><span class="p">,</span><span class="n">hist</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
             <span class="n">color</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;Real&#39;</span><span class="p">)</span>
<span class="c1">#print(simcat_df.iloc[isim][&#39;rhalf&#39;].min())</span>
<span class="c1">#print(obitractor_df.iloc[itrac][&#39;rhalf&#39;].min())</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>Out[70]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>&lt;matplotlib.legend.Legend at 0x7f02b81815d0&gt;
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/nb_10deg2_region_74_1.png" src="../_images/nb_10deg2_region_74_1.png" />
</div>
</div>
</div>
<div class="section" id="Huge-scatter-in-True/Measured-rhalf">
<h2>Huge scatter in True/Measured rhalf<a class="headerlink" href="#Huge-scatter-in-True/Measured-rhalf" title="Permalink to this headline">¶</a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [134]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">sim_rec</span><span class="o">=</span> <span class="n">simcat</span><span class="p">[</span><span class="n">isim</span><span class="p">]</span>
<span class="n">obi_rec</span><span class="o">=</span> <span class="n">obitractor</span><span class="p">[</span><span class="n">isim</span><span class="p">]</span>
<span class="k">for</span> <span class="n">typ</span><span class="p">,</span><span class="n">c</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">obi_rec</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;type&#39;</span><span class="p">)),</span>
                 <span class="p">[</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="s1">&#39;g&#39;</span><span class="p">,</span><span class="s1">&#39;m&#39;</span><span class="p">,</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="s1">&#39;y&#39;</span><span class="p">]):</span>
    <span class="n">keep</span><span class="o">=</span> <span class="n">obi_rec</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;type&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="n">typ</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">sim_rec</span><span class="p">[</span><span class="n">keep</span><span class="p">]</span><span class="o">.</span><span class="n">rhalf</span><span class="p">,</span>
                <span class="n">obi_rec</span><span class="p">[</span><span class="n">keep</span><span class="p">]</span><span class="o">.</span><span class="n">rhalf</span><span class="p">,</span>
                <span class="n">c</span><span class="o">=</span><span class="n">c</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="n">typ</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">lim</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mf">2.2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="n">lim</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="n">lim</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">lim</span><span class="p">,</span><span class="n">lim</span><span class="p">,</span><span class="s1">&#39;k--&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;rhalf&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;measured rhalf&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>Out[134]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>&lt;matplotlib.legend.Legend at 0x7f02b71b7bd0&gt;
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/nb_10deg2_region_76_1.png" src="../_images/nb_10deg2_region_76_1.png" />
</div>
</div>
</div>
<div class="section" id="Pairplot-(hue=-Recoverec)">
<h2>Pairplot (hue= Recoverec)<a class="headerlink" href="#Pairplot-(hue=-Recoverec)" title="Permalink to this headline">¶</a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [135]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">simcat_df</span><span class="o">=</span> <span class="n">fits2pandas</span><span class="p">(</span><span class="n">simcat</span><span class="p">)</span>
<span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;g&#39;</span><span class="p">,</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="s1">&#39;z&#39;</span><span class="p">]:</span>
    <span class="n">simcat_df</span><span class="p">[</span><span class="s1">&#39;mag_&#39;</span><span class="o">+</span><span class="n">b</span><span class="p">]</span><span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">simcat</span><span class="p">(</span><span class="n">simcat</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">b</span><span class="o">+</span><span class="s1">&#39;flux&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">data</span>

<span class="n">attrs</span><span class="o">=</span> <span class="p">[</span><span class="s1">&#39;mag_g&#39;</span><span class="p">,</span><span class="s1">&#39;mag_r&#39;</span><span class="p">,</span><span class="s1">&#39;mag_z&#39;</span><span class="p">,</span><span class="s1">&#39;rhalf&#39;</span><span class="p">,</span><span class="s1">&#39;recovered&#39;</span><span class="p">]</span>
<span class="n">simcat_df</span><span class="p">[</span><span class="s1">&#39;recovered&#39;</span><span class="p">]</span><span class="o">=</span> <span class="n">indices2bool</span><span class="p">(</span><span class="n">isim</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">simcat_df</span><span class="p">))</span>
<span class="n">g</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">pairplot</span><span class="p">(</span><span class="n">simcat_df</span><span class="p">[</span><span class="n">attrs</span><span class="p">],</span> <span class="n">hue</span><span class="o">=</span><span class="s2">&quot;recovered&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/nb_10deg2_region_78_0.png" src="../_images/nb_10deg2_region_78_0.png" />
</div>
</div>
</div>
<div class="section" id="By-not-adding-DEV-galaxies,-I-put-into-too-many-EXP">
<h2>By not adding DEV galaxies, I put into too many EXP<a class="headerlink" href="#By-not-adding-DEV-galaxies,-I-put-into-too-many-EXP" title="Permalink to this headline">¶</a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [137]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">n_rec</span><span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">obitractor_df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">itrac</span><span class="p">])</span>
<span class="n">n_real</span><span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">obitractor_df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">not_itrac</span><span class="p">])</span>

<span class="n">rex_to_exp</span><span class="o">=</span><span class="bp">True</span>
<span class="k">if</span> <span class="n">rex_to_exp</span><span class="p">:</span>
    <span class="n">obitractor_df</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">][</span><span class="n">obitractor_df</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;REX &#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;EXP &#39;</span>
<span class="n">df</span><span class="o">=</span><span class="n">obitractor_df</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">itrac</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span><span class="o">.</span><span class="n">to_frame</span><span class="p">()</span> <span class="o">/</span> <span class="n">n_rec</span>
<span class="n">df</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span><span class="s1">&#39;recovered&#39;</span><span class="p">},</span><span class="n">inplace</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">df</span><span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="n">obitractor_df</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">not_itrac</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span><span class="o">.</span><span class="n">to_frame</span><span class="p">(),</span>
             <span class="n">left_index</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span><span class="n">right_index</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">df</span><span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span><span class="s1">&#39;real&#39;</span><span class="p">})</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;real&#39;</span><span class="p">]</span><span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;real&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">n_real</span>
<span class="n">display</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
<span class="n">df</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">barh</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="stderr output_area docutils container">
<div class="highlight"><pre>
/home/kaylan/env_galsim/lib/python2.7/site-packages/ipykernel_launcher.py:6: SettingWithCopyWarning:
A value is trying to be set on a copy of a slice from a DataFrame

See the caveats in the documentation: http://pandas.pydata.org/pandas-docs/stable/indexing.html#indexing-view-versus-copy

</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div>
<style>
    .dataframe thead tr:only-child th {
        text-align: right;
    }

    .dataframe thead th {
        text-align: left;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>recovered</th>
      <th>real</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>EXP</th>
      <td>0.939252</td>
      <td>0.654206</td>
    </tr>
    <tr>
      <th>PSF</th>
      <td>0.051402</td>
      <td>0.233645</td>
    </tr>
    <tr>
      <th>DEV</th>
      <td>0.009346</td>
      <td>0.093458</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>Out[137]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>&lt;matplotlib.axes._subplots.AxesSubplot at 0x7f02b5ec6750&gt;
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/nb_10deg2_region_80_3.png" src="../_images/nb_10deg2_region_80_3.png" />
</div>
</div>
</div>
</div>
<div class="section" id="Reocvered-vs.-Missed">
<h1>Reocvered vs. Missed<a class="headerlink" href="#Reocvered-vs.-Missed" title="Permalink to this headline">¶</a></h1>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [99]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">obiwan.priors</span> <span class="kn">import</span> <span class="n">TSBox</span>
</pre></div>
</div>
</div>
<div class="section" id="TS-box">
<h2>TS box<a class="headerlink" href="#TS-box" title="Permalink to this headline">¶</a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [100]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># g-r vs. r-z</span>
<span class="n">ts</span><span class="o">=</span> <span class="n">TSBox</span><span class="p">(</span><span class="n">src</span><span class="o">=</span><span class="s1">&#39;ELG&#39;</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">ts</span><span class="o">.</span><span class="n">add_ts_box</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">xlim</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">2.2</span><span class="p">],</span><span class="n">ylim</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mf">0.3</span><span class="p">,</span><span class="mf">2.2</span><span class="p">])</span>
<span class="n">rz</span><span class="o">=</span> <span class="n">simcat_df</span><span class="p">[</span><span class="s1">&#39;mag_r&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">simcat_df</span><span class="p">[</span><span class="s1">&#39;mag_z&#39;</span><span class="p">]</span>
<span class="n">gr</span><span class="o">=</span> <span class="n">simcat_df</span><span class="p">[</span><span class="s1">&#39;mag_g&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">simcat_df</span><span class="p">[</span><span class="s1">&#39;mag_r&#39;</span><span class="p">]</span>
<span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">rz</span><span class="p">[</span><span class="n">isim</span><span class="p">],</span><span class="n">gr</span><span class="p">[</span><span class="n">isim</span><span class="p">],</span><span class="n">c</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;Recovered&#39;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">rz</span><span class="p">[</span><span class="n">not_isim</span><span class="p">],</span><span class="n">gr</span><span class="p">[</span><span class="n">not_isim</span><span class="p">],</span><span class="n">c</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;MIssed&#39;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;r -z&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;g - r&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">2.2</span><span class="p">])</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="o">-</span><span class="mf">0.3</span><span class="p">,</span><span class="mf">2.2</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>Out[100]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>(-0.3, 2.2)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/nb_10deg2_region_84_1.png" src="../_images/nb_10deg2_region_84_1.png" />
</div>
</div>
</div>
<div class="section" id="Redshift">
<h2>Redshift<a class="headerlink" href="#Redshift" title="Permalink to this headline">¶</a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [101]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">sns</span><span class="o">.</span><span class="n">distplot</span><span class="p">(</span><span class="n">simcat_z</span><span class="p">[</span><span class="s1">&#39;redshift&#39;</span><span class="p">][</span><span class="n">isim</span><span class="p">],</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;Recovered&#39;</span><span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">distplot</span><span class="p">(</span><span class="n">simcat_z</span><span class="p">[</span><span class="s1">&#39;redshift&#39;</span><span class="p">][</span><span class="n">not_isim</span><span class="p">],</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;Missed&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>Out[101]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>&lt;matplotlib.legend.Legend at 0x7f67cf36d850&gt;
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/nb_10deg2_region_86_1.png" src="../_images/nb_10deg2_region_86_1.png" />
</div>
</div>
</div>
<div class="section" id="TS-box-colorcoded-by-Redshift">
<h2>TS box colorcoded by Redshift<a class="headerlink" href="#TS-box-colorcoded-by-Redshift" title="Permalink to this headline">¶</a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [102]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">simcat_z</span><span class="p">[</span><span class="s1">&#39;rz&#39;</span><span class="p">]</span><span class="o">=</span> <span class="n">simcat_z</span><span class="p">[</span><span class="s1">&#39;mag_r&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">simcat_z</span><span class="p">[</span><span class="s1">&#39;mag_z&#39;</span><span class="p">]</span>
<span class="n">simcat_z</span><span class="p">[</span><span class="s1">&#39;gr&#39;</span><span class="p">]</span><span class="o">=</span> <span class="n">simcat_z</span><span class="p">[</span><span class="s1">&#39;mag_g&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">simcat_z</span><span class="p">[</span><span class="s1">&#39;mag_r&#39;</span><span class="p">]</span>
<span class="c1">#zmin,zmax=</span>
<span class="n">simcat_z</span><span class="p">[</span><span class="s2">&quot;bin&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">cut</span><span class="p">(</span><span class="n">simcat_z</span><span class="p">[</span><span class="s1">&#39;redshift&#39;</span><span class="p">],</span><span class="n">bins</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

<span class="n">attrs</span><span class="o">=</span> <span class="p">[</span><span class="s1">&#39;rz&#39;</span><span class="p">,</span><span class="s1">&#39;gr&#39;</span><span class="p">,</span><span class="s1">&#39;bin&#39;</span><span class="p">]</span>
<span class="n">g</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">pairplot</span><span class="p">(</span><span class="n">simcat_z</span><span class="p">[</span><span class="n">attrs</span><span class="p">],</span> <span class="n">hue</span><span class="o">=</span><span class="s2">&quot;bin&quot;</span><span class="p">,</span>
                 <span class="n">hue_order</span><span class="o">=</span><span class="n">simcat_z</span><span class="o">.</span><span class="n">bin</span><span class="o">.</span><span class="n">cat</span><span class="o">.</span><span class="n">categories</span><span class="p">,</span>
                 <span class="n">palette</span><span class="o">=</span><span class="s2">&quot;YlGnBu&quot;</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>

<span class="n">ts</span><span class="o">=</span> <span class="n">TSBox</span><span class="p">(</span><span class="n">src</span><span class="o">=</span><span class="s1">&#39;ELG&#39;</span><span class="p">)</span>
<span class="n">ts</span><span class="o">.</span><span class="n">add_ts_box</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="n">xlim</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">2.2</span><span class="p">],</span><span class="n">ylim</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mf">0.3</span><span class="p">,</span><span class="mf">2.2</span><span class="p">])</span>
<span class="n">g</span><span class="o">.</span><span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">2.2</span><span class="p">)</span>
<span class="n">g</span><span class="o">.</span><span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">-</span><span class="mf">0.3</span><span class="p">,</span><span class="mf">2.2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>Out[102]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>(-0.3, 2.2)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/nb_10deg2_region_88_1.png" src="../_images/nb_10deg2_region_88_1.png" />
</div>
</div>
</div>
</div>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
    </p>
    <p>
        &copy; Copyright 2014-2018, Kaylan Burleigh, John Moustakas.<br/>
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.7.6.<br/>
    </p>
  </div>
</footer>
  </body>
</html>