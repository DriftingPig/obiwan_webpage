<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Model the color, size, and shape of real galaxies (ELG, star forming) sampled by DESI and eBOSS Target Selection &#8212; obiwan 1.2.0 documentation</title>
    <link rel="stylesheet" href="../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="../_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="../_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-3.3.7/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-sphinx.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">

  </head><body>

  <div id="navbar" class="navbar navbar-default ">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="../index.html">
          Obiwan</a>
        <span class="navbar-text navbar-version pull-left"><b>1.2.0</b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
                <li><a href="../api.html">API</a></li>
                <li><a href="../tutorials.html">Tutorials</a></li>
                <li><a href="../deeplearning.html">Deep Learning</a></li>
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="../index.html">Pages <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"></ul>
</li>
              
                <li class="dropdown">
  <a role="button"
     id="dLabelLocalToc"
     data-toggle="dropdown"
     data-target="#"
     href="#">This Page <b class="caret"></b></a>
  <ul class="dropdown-menu localtoc"
      role="menu"
      aria-labelledby="dLabelLocalToc"><ul>
<li><a class="reference internal" href="#">Model the color, size, and shape of real galaxies (ELG, star forming) sampled by DESI and eBOSS Target Selection</a></li>
<li><a class="reference internal" href="#eBOSS">eBOSS</a><ul>
<li><a class="reference internal" href="#Exploratory-Data-analysis">Exploratory Data analysis</a><ul>
<li><a class="reference internal" href="#DEV-are-larger-than-EXP">DEV are larger than EXP</a></li>
<li><a class="reference internal" href="#DEV-are-brighter-than-EXP">DEV are brighter than EXP</a></li>
<li><a class="reference internal" href="#NGC-is-incomplete">NGC is incomplete</a></li>
</ul>
</li>
<li><a class="reference internal" href="#Model-(only-use-SGC-data)">Model (only use SGC data)</a><ul>
<li><a class="reference internal" href="#Colors,-sizes,-shapes">Colors, sizes, shapes</a></li>
<li><a class="reference internal" href="#Cannot-model-power-law-(g-mag-histogram)-with-Gaussians">Cannot model power law (g-mag histogram) with Gaussians</a></li>
<li><a class="reference internal" href="#TS-box-with-padding-(0.5-mag)">TS box with padding (0.5 mag)</a></li>
</ul>
</li>
<li><a class="reference internal" href="#Add-DR3-Deep2-to-Model">Add DR3-Deep2 to Model</a><ul>
<li><a class="reference internal" href="#DR3-Deep2-for-outside-the-TS-box">DR3-Deep2 for outside the TS box</a></li>
<li><a class="reference internal" href="#DR3-Deep2-reproduces-SGC-data-when-cut-to-TS-box!">DR3-Deep2 reproduces SGC data when cut to TS box!</a></li>
<li><a class="reference internal" href="#Redshift-correlations-also-reproduced!">Redshift correlations also reproduced!</a></li>
<li><a class="reference internal" href="#DEV-from-DR3-Deep2-span-redshifts-[0,2]-and-0.2-mag-deeper-than-SGC-g-mag,-so-will-can-model-this-even-though-just-79-data-points">DEV from DR3-Deep2 span redshifts [0,2] and 0.2 mag deeper than SGC g-mag, so will can model this even though just 79 data points</a></li>
<li><a class="reference internal" href="#Same-padding-(0.2-mag)-for-EXP">Same padding (0.2 mag) for EXP</a></li>
</ul>
</li>
<li><a class="reference internal" href="#4-Samples-=-Model-(EXP/DEV-and-SGC/DR3-Deep2)">4 Samples = Model (EXP/DEV and SGC/DR3-Deep2)</a><ul>
<li><a class="reference internal" href="#Model-for-EXP">Model for EXP</a></li>
<li><a class="reference internal" href="#Model-for-DEV">Model for DEV</a></li>
</ul>
</li>
<li><a class="reference internal" href="#n(z)-for-eBOSS-ELGs">n(z) for eBOSS ELGs</a><ul>
<li><a class="reference internal" href="#n(z)-weighted-by-spectroscopic-completness-(1/TSR)">n(z) weighted by spectroscopic completness (1/TSR)</a></li>
<li><a class="reference internal" href="#Gaussian-Mixture-for-n(z)">Gaussian Mixture for n(z)</a></li>
<li><a class="reference internal" href="#10-components-reproduce-true-n(z)">10 components reproduce true n(z)</a></li>
<li><a class="reference internal" href="#Save-GM-model">Save GM model</a></li>
</ul>
</li>
<li><a class="reference internal" href="#Draw-n(z)-&amp;-Query-KDTree-for-nearest-redshift-in-sample">Draw n(z) &amp; Query KDTree for nearest redshift in sample</a><ul>
<li><a class="reference internal" href="#Nearest-redshifts-are-nearly-all-within-~-0.02">Nearest redshifts are nearly all within ~ 0.02</a></li>
<li><a class="reference internal" href="#Correct-fraction-of-DEV-~-10%">Correct fraction of DEV ~ 10%</a></li>
<li><a class="reference internal" href="#EXP/DEV-have-correct-color,-shape,-size-AND-eBOSS-n(z)">EXP/DEV have correct color, shape, size AND eBOSS n(z)</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#DESI">DESI</a><ul>
<li><a class="reference internal" href="#Use-DR5-data">Use DR5 data</a></li>
<li><a class="reference internal" href="#in-TS-box">in TS box</a><ul>
<li><a class="reference internal" href="#Properties-!=-func(TS-box)">Properties != func(TS box)</a></li>
<li><a class="reference internal" href="#DEV-are-larger-and-brighter-than-EXP">DEV are larger and brighter than EXP</a></li>
</ul>
</li>
<li><a class="reference internal" href="#Model-as-Gaussian-Mixture">Model as Gaussian Mixture</a><ul>
<li><a class="reference internal" href="#Fit-model">Fit model</a></li>
<li><a class="reference internal" href="#Minimum-components-for-good-model-is-8-(don't-want-to-overfit)">Minimum components for good model is 8 (donâ€™t want to overfit)</a></li>
<li><a class="reference internal" href="#Model-in-TS-region">Model in TS region</a></li>
<li><a class="reference internal" href="#Redshift-correlations">Redshift correlations</a></li>
</ul>
</li>
<li><a class="reference internal" href="#Sample-=-Model">Sample = Model</a><ul>
<li><a class="reference internal" href="#Starting-sample-of-10k">Starting sample of 10k</a></li>
<li><a class="reference internal" href="#Resample-until-10k-within-redshift-and-size-limits">Resample until 10k within redshift and size limits</a></li>
<li><a class="reference internal" href="#The-GM-mixture-produced-a-sample-that-was-then-filtered-to-our-redshift-and-mag-limits">The GM mixture produced a sample that was then filtered to our redshift and mag limits</a></li>
<li><a class="reference internal" href="#Save-the-model-produced-sample">Save the model produced sample</a></li>
</ul>
</li>
<li><a class="reference internal" href="#Model-DEV">Model DEV</a><ul>
<li><a class="reference internal" href="#Fit-Mixture">Fit Mixture</a></li>
<li><a class="reference internal" href="#Cannot-build-a-good-model,-simply-not-nough-DEV-data-points">Cannot build a good model, simply not nough DEV data points</a></li>
</ul>
</li>
<li><a class="reference internal" href="#Model-the-DESI-n(z)">Model the DESI n(z)</a><ul>
<li><a class="reference internal" href="#100,000-random-draws-from-sanches-&amp;-kirkby,-w/out-replacement">100,000 random draws from sanches &amp; kirkby, w/out replacement</a></li>
<li><a class="reference internal" href="#Fit-Gaussian-Mixture">Fit Gaussian Mixture</a></li>
<li><a class="reference internal" href="#12-compoents-to-intentionally-overfit-(we-want-the-exact-n(z))">12 compoents to intentionally overfit (we want the exact n(z))</a></li>
<li><a class="reference internal" href="#Save-the-model">Save the model</a></li>
</ul>
</li>
<li><a class="reference internal" href="#Build-our-final-sample-(from-the-DR3-Deep2-and-n(z)-model)">Build our final sample (from the DR3-Deep2 and n(z) model)</a><ul>
<li><a class="reference internal" href="#Final-sample-has-DR3-Deep2-color,-shape,-size-AND-DESI-n(z)">Final sample has DR3-Deep2 color, shape, size AND DESI n(z)</a></li>
<li><a class="reference internal" href="#42%-is-in-the-TS-box">42% is in the TS box</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#Cosmos-Randoms">Cosmos Randoms</a></li>
</ul>
</ul>
</li>
              
            
            
              
                
              
            
            
            
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="col-md-12 content">
      
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput,
div.nbinput div.prompt,
div.nbinput div.input_area,
div.nbinput div[class*=highlight],
div.nbinput div[class*=highlight] pre,
div.nboutput,
div.nbinput div.prompt,
div.nbinput div.output_area,
div.nboutput div[class*=highlight],
div.nboutput div[class*=highlight] pre {
    background: none;
    border: none;
    padding: 0 0;
    margin: 0;
    box-shadow: none;
}

/* avoid gaps between output lines */
div.nboutput div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput,
div.nboutput {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput,
    div.nboutput {
        flex-direction: column;
    }
}

/* input container */
div.nbinput {
    padding-top: 5px;
}

/* last container */
div.nblast {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput div.prompt pre {
    color: #303F9F;
}

/* output prompt */
div.nboutput div.prompt pre {
    color: #D84315;
}

/* all prompts */
div.nbinput div.prompt,
div.nboutput div.prompt {
    min-width: 9ex;
    padding-top: 0.4em;
    padding-right: 0.4em;
    text-align: right;
    flex: 0;
}
@media (max-width: 540px) {
    div.nbinput div.prompt,
    div.nboutput div.prompt {
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput div.prompt.empty {
        padding: 0;
    }
}

/* disable scrollbars on prompts */
div.nbinput div.prompt pre,
div.nboutput div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput div.input_area,
div.nboutput div.output_area {
    padding: 0.4em;
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput div.input_area,
    div.nboutput div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput div.input_area {
    border: 1px solid #cfcfcf;
    border-radius: 2px;
    background: #f7f7f7;
}

/* override MathJax center alignment in output cells */
div.nboutput div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.pngmath center alignment in output cells */
div.nboutput div.math p {
    text-align: left;
}

/* standard error */
div.nboutput div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }
</style>
<div class="section" id="Model-the-color,-size,-and-shape-of-real-galaxies-(ELG,-star-forming)-sampled-by-DESI-and-eBOSS-Target-Selection">
<h1>Model the color, size, and shape of real galaxies (ELG, star forming) sampled by DESI and eBOSS Target Selection<a class="headerlink" href="#Model-the-color,-size,-and-shape-of-real-galaxies-(ELG,-star-forming)-sampled-by-DESI-and-eBOSS-Target-Selection" title="Permalink to this headline">Â¶</a></h1>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="kn">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="kn">as</span> <span class="nn">sns</span>
<span class="kn">import</span> <span class="nn">fitsio</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;/Users/kaylan1/PhdStudent/Research/desi/astrometry.net/astrometry&#39;</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">astrometry.util.fits</span> <span class="kn">import</span> <span class="n">fits_table</span><span class="p">,</span> <span class="n">merge_tables</span>
<span class="kn">from</span> <span class="nn">glob</span> <span class="kn">import</span> <span class="n">glob</span>

<span class="kn">from</span> <span class="nn">sklearn</span> <span class="kn">import</span> <span class="n">mixture</span>

<span class="c1"># to make this notebook&#39;s output stable across runs</span>
<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">7</span><span class="p">)</span>

<span class="c1"># To plot pretty figures</span>
<span class="o">%</span><span class="k">matplotlib</span> inline
<span class="kn">import</span> <span class="nn">matplotlib</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;axes.labelsize&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">14</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;xtick.labelsize&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">12</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;ytick.labelsize&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">12</span>

<span class="o">%</span><span class="k">load_ext</span> autoreload
<span class="o">%</span><span class="k">autoreload</span> 2

</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">obiwan.common</span> <span class="kn">import</span> <span class="n">fits2pandas</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">def</span> <span class="nf">stack_tables</span><span class="p">(</span><span class="n">fns</span><span class="p">):</span>
    <span class="n">cat</span><span class="o">=</span><span class="p">[]</span>
    <span class="k">assert</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">fns</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">fn</span> <span class="ow">in</span> <span class="n">fns</span><span class="p">:</span>
        <span class="k">assert</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">fn</span><span class="p">))</span>
        <span class="k">print</span><span class="p">(</span><span class="s1">&#39;Stacking </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">fn</span><span class="p">)</span>
        <span class="n">cat</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">fits_table</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span> <span class="p">)</span>
    <span class="k">return</span> <span class="n">merge_tables</span><span class="p">(</span><span class="n">cat</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="s1">&#39;fillzero&#39;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">flux2mag</span><span class="p">(</span><span class="n">nmgy</span><span class="p">):</span>
    <span class="k">return</span> <span class="o">-</span><span class="mf">2.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">nmgy</span><span class="p">)</span> <span class="o">-</span> <span class="mi">9</span><span class="p">)</span>

</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [405]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">def</span> <span class="nf">my_mixture</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="n">n_comp</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">cov_type</span><span class="o">=</span><span class="s1">&#39;full&#39;</span><span class="p">):</span>
    <span class="c1"># Compute density via Gaussian Mixtures</span>
    <span class="c1"># we&#39;ll try several numbers of clusters</span>
    <span class="k">if</span> <span class="n">n_comp</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">n_comp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">16</span><span class="p">)</span>
    <span class="n">gmms</span> <span class="o">=</span> <span class="p">[</span><span class="n">mixture</span><span class="o">.</span><span class="n">GaussianMixture</span><span class="p">(</span><span class="n">n_components</span><span class="o">=</span><span class="n">n</span><span class="p">,</span>
                                    <span class="n">covariance_type</span><span class="o">=</span> <span class="n">cov_type</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">n_comp</span><span class="p">]</span>
    <span class="n">BICs</span> <span class="o">=</span> <span class="p">[</span><span class="n">gmm</span><span class="o">.</span><span class="n">bic</span><span class="p">(</span><span class="n">X</span><span class="p">)</span><span class="o">/</span><span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">gmm</span> <span class="ow">in</span> <span class="n">gmms</span><span class="p">]</span>
    <span class="n">i_min</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">BICs</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%d</span><span class="s2"> components&quot;</span> <span class="o">%</span> <span class="n">n_comp</span><span class="p">[</span><span class="n">i_min</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">gmms</span><span class="p">,</span><span class="n">i_min</span><span class="p">,</span> <span class="n">n_comp</span><span class="p">,</span> <span class="n">BICs</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [452]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">class</span> <span class="nc">GaussianMixtureModel</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    John&#39;s class to read, write, and sample from a mixture model.</span>

<span class="sd">    Args:</span>
<span class="sd">        weights,means,covars: array-like, from mixture fit</span>
<span class="sd">        covar_type: usually &#39;full&#39;</span>
<span class="sd">        py: one of [&#39;27&#39;,&#39;36&#39;]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">weights</span><span class="p">,</span> <span class="n">means</span><span class="p">,</span> <span class="n">covars</span><span class="p">,</span>
                 <span class="n">py</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">covar_type</span><span class="o">=</span><span class="s1">&#39;full&#39;</span><span class="p">,</span><span class="n">is1D</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="k">assert</span><span class="p">(</span><span class="n">py</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;27&#39;</span><span class="p">,</span><span class="s1">&#39;36&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">py</span><span class="o">=</span> <span class="n">py</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">is1D</span><span class="o">=</span> <span class="n">is1D</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">weights_</span> <span class="o">=</span> <span class="n">weights</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">means_</span> <span class="o">=</span> <span class="n">means</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">covariances_</span> <span class="o">=</span> <span class="n">covars</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is1D</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">weights_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">weights_</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">means_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">means_</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">covariances_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">covariances_</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
        <span class="c1">#    self.n_components, self.n_dimensions = self.means_.shape[0],1</span>
        <span class="c1">#else:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_components</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_dimensions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">means_</span><span class="o">.</span><span class="n">shape</span>
        <span class="c1">#print(self.weights_.shape,self.covariances_.shape,len(self.covariances_.shape))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">covariance_type</span><span class="o">=</span> <span class="n">covar_type</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span><span class="n">data</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">([</span><span class="s1">&#39;means&#39;</span><span class="p">,</span><span class="s1">&#39;weights&#39;</span><span class="p">,</span><span class="s1">&#39;covars&#39;</span><span class="p">],</span>
                     <span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">means_</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">weights_</span><span class="p">,</span>
                      <span class="n">model</span><span class="o">.</span><span class="n">covariances_</span><span class="p">]):</span>
            <span class="n">fn</span><span class="o">=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">_</span><span class="si">%s</span><span class="s1">.txt&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">filename</span><span class="p">,</span><span class="n">name</span><span class="p">)</span>
            <span class="n">np</span><span class="o">.</span><span class="n">savetxt</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span><span class="n">data</span><span class="p">,</span><span class="n">delimiter</span><span class="o">=</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
            <span class="k">print</span><span class="p">(</span><span class="s1">&#39;Wrote </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">fn</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">load</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span><span class="n">py</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">is1D</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="n">d</span><span class="o">=</span><span class="p">{</span><span class="n">name</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">_</span><span class="si">%s</span><span class="s1">.txt&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">filename</span><span class="p">,</span><span class="n">name</span><span class="p">),</span><span class="n">delimiter</span><span class="o">=</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
           <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;means&#39;</span><span class="p">,</span><span class="s1">&#39;weights&#39;</span><span class="p">,</span><span class="s1">&#39;covars&#39;</span><span class="p">]}</span>
        <span class="k">return</span> <span class="n">GaussianMixtureModel</span><span class="p">(</span>
                    <span class="n">d</span><span class="p">[</span><span class="s1">&#39;weights&#39;</span><span class="p">],</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;means&#39;</span><span class="p">],</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;covars&#39;</span><span class="p">],</span>
                    <span class="n">covar_type</span><span class="o">=</span><span class="s1">&#39;full&#39;</span><span class="p">,</span><span class="n">py</span><span class="o">=</span><span class="n">py</span><span class="p">,</span><span class="n">is1D</span><span class="o">=</span><span class="n">is1D</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">sample</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n_samples</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">assert</span><span class="p">(</span><span class="n">n_samples</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_samples</span><span class="o">=</span> <span class="n">n_samples</span>
        <span class="k">if</span> <span class="n">random_state</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">random_state</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">RandomState</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="o">=</span> <span class="n">random_state</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">py</span> <span class="o">==</span> <span class="s1">&#39;2.7&#39;</span><span class="p">:</span>
            <span class="n">X</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sample_py2</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">X</span><span class="p">,</span><span class="n">Y</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sample_py3</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">X</span>

    <span class="k">def</span> <span class="nf">sample_py2</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">weight_cdf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">weights_</span><span class="p">)</span>
        <span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">n_samples</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_components</span><span class="p">))</span>
        <span class="n">rand</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_samples</span><span class="p">)</span>
        <span class="c1"># decide which component to use for each sample</span>
        <span class="n">comps</span> <span class="o">=</span> <span class="n">weight_cdf</span><span class="o">.</span><span class="n">searchsorted</span><span class="p">(</span><span class="n">rand</span><span class="p">)</span>
        <span class="c1"># for each component, generate all needed samples</span>
        <span class="k">for</span> <span class="n">comp</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_components</span><span class="p">):</span>
            <span class="c1"># occurrences of current component in X</span>
            <span class="n">comp_in_X</span> <span class="o">=</span> <span class="p">(</span><span class="n">comp</span> <span class="o">==</span> <span class="n">comps</span><span class="p">)</span>
            <span class="c1"># number of those occurrences</span>
            <span class="n">num_comp_in_X</span> <span class="o">=</span> <span class="n">comp_in_X</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">num_comp_in_X</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">X</span><span class="p">[</span><span class="n">comp_in_X</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">multivariate_normal</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">means_</span><span class="p">[</span><span class="n">comp</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">covariances_</span><span class="p">[</span><span class="n">comp</span><span class="p">],</span> <span class="n">num_comp_in_X</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">X</span>

    <span class="k">def</span> <span class="nf">sample_py3</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Copied from sklearn&#39;s mixture.GaussianMixture().sample()&quot;&quot;&quot;</span>
        <span class="k">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">weights_</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">n_samples_comp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">multinomial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_samples</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">weights_</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">weights_</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">weights_</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">weights_</span><span class="p">))</span>
            <span class="n">n_samples_comp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">multinomial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_samples</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">weights_</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">covariance_type</span> <span class="o">==</span> <span class="s1">&#39;full&#39;</span><span class="p">:</span>
            <span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">multivariate_normal</span><span class="p">(</span><span class="n">mean</span><span class="p">,</span> <span class="n">covariance</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">sample</span><span class="p">))</span>
                <span class="k">for</span> <span class="p">(</span><span class="n">mean</span><span class="p">,</span> <span class="n">covariance</span><span class="p">,</span> <span class="n">sample</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">means_</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">covariances_</span><span class="p">,</span> <span class="n">n_samples_comp</span><span class="p">)])</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">covariance_type</span> <span class="o">==</span> <span class="s2">&quot;tied&quot;</span><span class="p">:</span>
            <span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">multivariate_normal</span><span class="p">(</span><span class="n">mean</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">covariances_</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">sample</span><span class="p">))</span>
                <span class="k">for</span> <span class="p">(</span><span class="n">mean</span><span class="p">,</span> <span class="n">sample</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">means_</span><span class="p">,</span> <span class="n">n_samples_comp</span><span class="p">)])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span>
                <span class="n">mean</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">sample</span><span class="p">,</span> <span class="n">n_features</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">covariance</span><span class="p">)</span>
                <span class="k">for</span> <span class="p">(</span><span class="n">mean</span><span class="p">,</span> <span class="n">covariance</span><span class="p">,</span> <span class="n">sample</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">means_</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">covariances_</span><span class="p">,</span> <span class="n">n_samples_comp</span><span class="p">)])</span>

        <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">j</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">sample</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
                           <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">sample</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">n_samples_comp</span><span class="p">)])</span>

        <span class="k">return</span> <span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>

</pre></div>
</div>
</div>
</div>
<div class="section" id="eBOSS">
<h1>eBOSS<a class="headerlink" href="#eBOSS" title="Permalink to this headline">Â¶</a></h1>
<div class="section" id="Exploratory-Data-analysis">
<h2>Exploratory Data analysis<a class="headerlink" href="#Exploratory-Data-analysis" title="Permalink to this headline">Â¶</a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [781]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">fns_ngc</span><span class="o">=</span> <span class="p">[</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;HOME&#39;</span><span class="p">],</span><span class="s1">&#39;Downloads&#39;</span><span class="p">,</span>
            <span class="s1">&#39;ebossDR3&#39;</span><span class="p">,</span><span class="s1">&#39;redshift_tractorcats&#39;</span><span class="p">,</span><span class="s1">&#39;eBOSS.ELG.obiwan.eboss</span><span class="si">%s</span><span class="s1">.fits&#39;</span> <span class="o">%</span> <span class="n">name</span><span class="p">)</span>
          <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;23.v5_10_7&#39;</span><span class="p">]]</span>
<span class="n">fns_sgc</span><span class="o">=</span> <span class="p">[</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;HOME&#39;</span><span class="p">],</span><span class="s1">&#39;Downloads&#39;</span><span class="p">,</span>
            <span class="s1">&#39;ebossDR3&#39;</span><span class="p">,</span><span class="s1">&#39;redshift_tractorcats&#39;</span><span class="p">,</span><span class="s1">&#39;eBOSS.ELG.obiwan.eboss</span><span class="si">%s</span><span class="s1">.fits&#39;</span> <span class="o">%</span> <span class="n">name</span><span class="p">)</span>
         <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;2122.v5_10_7&#39;</span><span class="p">]]</span>

<span class="n">ngc</span><span class="o">=</span><span class="n">merge_tables</span><span class="p">([</span><span class="n">fits_table</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span>
                 <span class="k">for</span> <span class="n">fn</span> <span class="ow">in</span> <span class="n">fns_ngc</span><span class="p">],</span><span class="n">columns</span><span class="o">=</span><span class="s1">&#39;fillzero&#39;</span><span class="p">)</span>
<span class="n">ngc</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;field&#39;</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="s1">&#39;ngc&#39;</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">ngc</span><span class="p">),</span><span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">))</span>
<span class="n">sgc</span><span class="o">=</span><span class="n">merge_tables</span><span class="p">([</span><span class="n">fits_table</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span>
                 <span class="k">for</span> <span class="n">fn</span> <span class="ow">in</span> <span class="n">fns_sgc</span><span class="p">],</span><span class="n">columns</span><span class="o">=</span><span class="s1">&#39;fillzero&#39;</span><span class="p">)</span>
<span class="n">sgc</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;field&#39;</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="s1">&#39;sgc&#39;</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">sgc</span><span class="p">),</span><span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">))</span>

<span class="k">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ngc</span><span class="p">),</span><span class="nb">len</span><span class="p">(</span><span class="n">ngc</span><span class="o">.</span><span class="n">get_columns</span><span class="p">()))</span>
<span class="k">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">sgc</span><span class="p">),</span><span class="nb">len</span><span class="p">(</span><span class="n">sgc</span><span class="o">.</span><span class="n">get_columns</span><span class="p">()))</span>
<span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">sgc</span><span class="o">.</span><span class="n">get_columns</span><span class="p">():</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="s1">&#39;decam&#39;</span> <span class="ow">in</span> <span class="n">col</span><span class="p">:</span>
        <span class="k">continue</span>
    <span class="k">print</span><span class="p">(</span><span class="n">col</span><span class="p">,</span><span class="n">ngc</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">col</span><span class="p">)</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span><span class="n">sgc</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">col</span><span class="p">)</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Converted brickname from |S8 to &lt;U8
Converted type from |S4 to &lt;U4
Converted chunk from |S7 to &lt;U7
Converted datadir from |S150 to &lt;U150
Converted brickname from |S8 to &lt;U8
Converted type from |S4 to &lt;U4
Converted chunk from |S7 to &lt;U7
Converted datadir from |S150 to &lt;U150
48397 51
108060 57
decam_flux (48397, 6) (108060, 6)
decam_flux_ivar (48397, 6) (108060, 6)
decam_apflux (48397, 48) (108060, 6, 8)
decam_apflux_resid (48397, 48) (108060, 6, 8)
decam_apflux_ivar (48397, 48) (108060, 6, 8)
decam_mw_transmission (48397, 6) (108060, 6)
decam_nobs (48397, 6) (108060, 6)
decam_rchi2 (48397, 6) (108060, 6)
decam_fracflux (48397, 6) (108060, 6)
decam_fracmasked (48397, 6) (108060, 6)
decam_fracin (48397, 6) (108060, 6)
decam_anymask (48397, 6) (108060, 6)
decam_allmask (48397, 6) (108060, 6)
decam_psfsize (48397, 6) (108060, 6)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [782]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">(</span><span class="n">sgc</span><span class="o">.</span><span class="n">get_columns</span><span class="p">())</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">ngc</span><span class="o">.</span><span class="n">get_columns</span><span class="p">())):</span>
    <span class="k">if</span> <span class="s1">&#39;apflux&#39;</span> <span class="ow">in</span> <span class="n">col</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s1">&#39;Removing col: &#39;</span><span class="p">,</span><span class="n">col</span><span class="p">)</span>
        <span class="n">sgc</span><span class="o">.</span><span class="n">delete_column</span><span class="p">(</span><span class="n">col</span><span class="p">)</span>
        <span class="n">ngc</span><span class="o">.</span><span class="n">delete_column</span><span class="p">(</span><span class="n">col</span><span class="p">)</span>
<span class="n">a</span><span class="o">=</span> <span class="n">merge_tables</span><span class="p">([</span><span class="n">ngc</span><span class="p">,</span><span class="n">sgc</span><span class="p">],</span><span class="n">columns</span><span class="o">=</span><span class="s1">&#39;fillzero&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Removing col:  decam_apflux
Removing col:  decam_apflux_resid
Removing col:  decam_apflux_ivar
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [783]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">isStar</span><span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">z_flag</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span>
<span class="n">hasRedshift</span><span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">z_flag</span> <span class="o">==</span> <span class="mi">1</span>
<span class="n">isPrim</span><span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">brick_primary</span> <span class="o">==</span> <span class="bp">True</span>
<span class="k">print</span><span class="p">(</span><span class="s1">&#39;isStar &amp; brick primary: </span><span class="si">%d</span><span class="s1">/</span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> \
     <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="p">[(</span><span class="n">isStar</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">isPrim</span><span class="p">)]),</span><span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="p">)))</span>
<span class="k">print</span><span class="p">(</span><span class="s1">&#39;hasRedshift &amp; brick primary: </span><span class="si">%d</span><span class="s1">/</span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> \
     <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="p">[(</span><span class="n">hasRedshift</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">isPrim</span><span class="p">)]),</span><span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="p">)))</span>
<span class="n">a</span><span class="o">.</span><span class="n">cut</span><span class="p">((</span><span class="n">hasRedshift</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">isPrim</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
isStar &amp; brick primary: 924/156457
hasRedshift &amp; brick primary: 124818/156457
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [776]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;sector_tsr&#39;</span><span class="p">,</span><span class="s1">&#39;chunk&#39;</span><span class="p">,</span>
            <span class="s1">&#39;plate&#39;</span><span class="p">,</span><span class="s1">&#39;fiberid&#39;</span><span class="p">]:</span>
    <span class="k">print</span><span class="p">(</span><span class="n">key</span><span class="p">,</span><span class="n">a</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span><span class="nb">type</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">)[</span><span class="mi">0</span><span class="p">]))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
sector_tsr 0.54 &lt;class &#39;numpy.float32&#39;&gt;
chunk eboss23 &lt;class &#39;numpy.str_&#39;&gt;
plate 9564 &lt;class &#39;numpy.int32&#39;&gt;
fiberid 504 &lt;class &#39;numpy.int32&#39;&gt;
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [794]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">d</span><span class="o">=</span><span class="p">{}</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">b</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">],</span><span class="s1">&#39;grz&#39;</span><span class="p">):</span>
    <span class="n">d</span><span class="p">[</span><span class="n">b</span><span class="o">+</span><span class="s1">&#39;flux&#39;</span><span class="p">]</span><span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;decam_flux&#39;</span><span class="p">)[:,</span><span class="n">i</span><span class="p">]</span>
    <span class="n">d</span><span class="p">[</span><span class="n">b</span><span class="o">+</span><span class="s1">&#39;fluxivar&#39;</span><span class="p">]</span><span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;decam_flux_ivar&#39;</span><span class="p">)[:,</span><span class="n">i</span><span class="p">]</span>
    <span class="n">d</span><span class="p">[</span><span class="n">b</span><span class="o">+</span><span class="s1">&#39;psfsize&#39;</span><span class="p">]</span><span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;decam_psfsize&#39;</span><span class="p">)[:,</span><span class="n">i</span><span class="p">]</span>
    <span class="n">d</span><span class="p">[</span><span class="n">b</span><span class="o">+</span><span class="s1">&#39;_mw_transmission&#39;</span><span class="p">]</span><span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;decam_mw_transmission&#39;</span><span class="p">)[:,</span><span class="n">i</span><span class="p">]</span>
<span class="n">d</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span><span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">type</span>
<span class="n">d</span><span class="p">[</span><span class="s1">&#39;shapeexp_r&#39;</span><span class="p">]</span><span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">shapeexp_r</span>
<span class="n">d</span><span class="p">[</span><span class="s1">&#39;shapedev_r&#39;</span><span class="p">]</span><span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">shapedev_r</span>

<span class="n">d</span><span class="p">[</span><span class="s1">&#39;redshift&#39;</span><span class="p">]</span><span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">z</span>
<span class="n">d</span><span class="p">[</span><span class="s1">&#39;sector_tsr&#39;</span><span class="p">]</span><span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">sector_tsr</span>
<span class="n">d</span><span class="p">[</span><span class="s1">&#39;field&#39;</span><span class="p">]</span><span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">field</span>

<span class="n">eboss</span><span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
<span class="n">eboss</span><span class="o">=</span> <span class="n">eboss</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">byteswap</span><span class="p">()</span><span class="o">.</span><span class="n">newbyteorder</span><span class="p">())</span>


<span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">b</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">],</span><span class="s1">&#39;grz&#39;</span><span class="p">):</span>
    <span class="n">eboss</span><span class="p">[</span><span class="n">b</span><span class="p">]</span><span class="o">=</span> <span class="n">flux2mag</span><span class="p">(</span><span class="n">eboss</span><span class="p">[</span><span class="n">b</span><span class="o">+</span><span class="s1">&#39;flux&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">/</span><span class="n">eboss</span><span class="p">[</span><span class="n">b</span><span class="o">+</span><span class="s1">&#39;_mw_transmission&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
<span class="n">eboss</span><span class="p">[</span><span class="s1">&#39;g-r&#39;</span><span class="p">]</span><span class="o">=</span> <span class="n">eboss</span><span class="p">[</span><span class="s1">&#39;g&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">eboss</span><span class="p">[</span><span class="s1">&#39;r&#39;</span><span class="p">]</span>
<span class="n">eboss</span><span class="p">[</span><span class="s1">&#39;r-z&#39;</span><span class="p">]</span><span class="o">=</span> <span class="n">eboss</span><span class="p">[</span><span class="s1">&#39;r&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">eboss</span><span class="p">[</span><span class="s1">&#39;z&#39;</span><span class="p">]</span>

<span class="c1"># SDSS unique identifier is (PLATE,MJD,FIBERID)</span>
<span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;plate&#39;</span><span class="p">,</span><span class="s1">&#39;mjd&#39;</span><span class="p">,</span><span class="s1">&#39;fiberid&#39;</span><span class="p">]:</span>
    <span class="k">assert</span><span class="p">(</span><span class="ow">not</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">eboss</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
    <span class="n">eboss</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>


<span class="n">eboss</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>Out[794]:
</pre></div>
</div>
<div class="output_area docutils container">
<div>
<style>
    .dataframe thead tr:only-child th {
        text-align: right;
    }

    .dataframe thead th {
        text-align: left;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>g_mw_transmission</th>
      <th>gflux</th>
      <th>gfluxivar</th>
      <th>gpsfsize</th>
      <th>r_mw_transmission</th>
      <th>redshift</th>
      <th>rflux</th>
      <th>rfluxivar</th>
      <th>rpsfsize</th>
      <th>sector_tsr</th>
      <th>...</th>
      <th>zfluxivar</th>
      <th>zpsfsize</th>
      <th>g</th>
      <th>r</th>
      <th>z</th>
      <th>g-r</th>
      <th>r-z</th>
      <th>plate</th>
      <th>mjd</th>
      <th>fiberid</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>124818.000000</td>
      <td>124818.000000</td>
      <td>124818.000000</td>
      <td>124818.000000</td>
      <td>124818.000000</td>
      <td>124818.000000</td>
      <td>124818.000000</td>
      <td>124818.000000</td>
      <td>124818.000000</td>
      <td>124818.000000</td>
      <td>...</td>
      <td>124818.000000</td>
      <td>124818.000000</td>
      <td>124818.000000</td>
      <td>124818.000000</td>
      <td>124818.000000</td>
      <td>124818.000000</td>
      <td>124818.000000</td>
      <td>124818.000000</td>
      <td>124818.000000</td>
      <td>124818.000000</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>0.887981</td>
      <td>0.894358</td>
      <td>663.596191</td>
      <td>1.585073</td>
      <td>0.922737</td>
      <td>0.845346</td>
      <td>1.695404</td>
      <td>404.526794</td>
      <td>1.262581</td>
      <td>0.925419</td>
      <td>...</td>
      <td>41.047676</td>
      <td>1.154662</td>
      <td>22.523006</td>
      <td>21.882172</td>
      <td>20.909605</td>
      <td>0.640837</td>
      <td>0.972565</td>
      <td>9394.769817</td>
      <td>57891.387572</td>
      <td>498.775401</td>
    </tr>
    <tr>
      <th>std</th>
      <td>0.051016</td>
      <td>0.233051</td>
      <td>586.811768</td>
      <td>0.182776</td>
      <td>0.036416</td>
      <td>0.220672</td>
      <td>0.508343</td>
      <td>534.675598</td>
      <td>0.186244</td>
      <td>0.116810</td>
      <td>...</td>
      <td>35.968708</td>
      <td>0.145182</td>
      <td>0.253308</td>
      <td>0.299463</td>
      <td>0.361003</td>
      <td>0.138784</td>
      <td>0.179721</td>
      <td>139.772085</td>
      <td>152.686943</td>
      <td>287.418148</td>
    </tr>
    <tr>
      <th>min</th>
      <td>0.541891</td>
      <td>0.423581</td>
      <td>0.000285</td>
      <td>0.000000</td>
      <td>0.661849</td>
      <td>0.000010</td>
      <td>0.813217</td>
      <td>0.016720</td>
      <td>0.000000</td>
      <td>0.094000</td>
      <td>...</td>
      <td>0.000004</td>
      <td>0.000000</td>
      <td>21.825092</td>
      <td>20.921309</td>
      <td>19.572298</td>
      <td>0.345093</td>
      <td>0.661255</td>
      <td>9197.000000</td>
      <td>57656.000000</td>
      <td>1.000000</td>
    </tr>
    <tr>
      <th>25%</th>
      <td>0.870798</td>
      <td>0.719299</td>
      <td>258.765213</td>
      <td>1.463014</td>
      <td>0.911019</td>
      <td>0.764202</td>
      <td>1.324715</td>
      <td>116.953539</td>
      <td>1.139694</td>
      <td>0.887000</td>
      <td>...</td>
      <td>15.754657</td>
      <td>1.049614</td>
      <td>22.363008</td>
      <td>21.690143</td>
      <td>20.667189</td>
      <td>0.523310</td>
      <td>0.828516</td>
      <td>9309.000000</td>
      <td>57728.000000</td>
      <td>247.000000</td>
    </tr>
    <tr>
      <th>50%</th>
      <td>0.904013</td>
      <td>0.825104</td>
      <td>546.302612</td>
      <td>1.590574</td>
      <td>0.934283</td>
      <td>0.831748</td>
      <td>1.570839</td>
      <td>260.817749</td>
      <td>1.223145</td>
      <td>0.985000</td>
      <td>...</td>
      <td>31.407959</td>
      <td>1.124252</td>
      <td>22.580585</td>
      <td>21.921579</td>
      <td>20.939089</td>
      <td>0.639626</td>
      <td>0.944961</td>
      <td>9374.000000</td>
      <td>57864.000000</td>
      <td>500.000000</td>
    </tr>
    <tr>
      <th>75%</th>
      <td>0.921569</td>
      <td>1.008793</td>
      <td>895.015701</td>
      <td>1.703754</td>
      <td>0.946467</td>
      <td>0.920407</td>
      <td>1.945317</td>
      <td>469.033813</td>
      <td>1.336910</td>
      <td>0.994000</td>
      <td>...</td>
      <td>54.780305</td>
      <td>1.229884</td>
      <td>22.729773</td>
      <td>22.106296</td>
      <td>21.178267</td>
      <td>0.758045</td>
      <td>1.090259</td>
      <td>9556.000000</td>
      <td>58055.000000</td>
      <td>748.000000</td>
    </tr>
    <tr>
      <th>max</th>
      <td>0.961263</td>
      <td>1.770160</td>
      <td>11717.317383</td>
      <td>4.630108</td>
      <td>0.973738</td>
      <td>6.737325</td>
      <td>4.008598</td>
      <td>7636.661621</td>
      <td>4.266237</td>
      <td>1.000000</td>
      <td>...</td>
      <td>569.374512</td>
      <td>2.403814</td>
      <td>22.899969</td>
      <td>22.529026</td>
      <td>21.801359</td>
      <td>0.927851</td>
      <td>1.704117</td>
      <td>9630.000000</td>
      <td>58086.000000</td>
      <td>1000.000000</td>
    </tr>
  </tbody>
</table>
<p>8 rows Ã— 24 columns</p>
</div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [795]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">print</span><span class="p">(</span><span class="n">eboss</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">())</span>
<span class="c1"># Remove COMP</span>
<span class="n">isCOMP</span><span class="o">=</span> <span class="n">eboss</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">values</span> <span class="o">==</span> <span class="s1">&#39;COMP&#39;</span>
<span class="n">eboss</span><span class="o">=</span> <span class="n">eboss</span><span class="p">[</span><span class="o">~</span><span class="n">isCOMP</span><span class="p">]</span>
<span class="k">print</span><span class="p">(</span><span class="n">eboss</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">())</span>
<span class="k">print</span><span class="p">(</span><span class="n">eboss</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span><span class="o">/</span><span class="n">eboss</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
EXP     73791
SIMP    34960
DEV     10442
PSF      3641
COMP     1984
Name: type, dtype: int64
EXP     73791
SIMP    34960
DEV     10442
PSF      3641
Name: type, dtype: int64
EXP     0.600738
SIMP    0.284612
DEV     0.085009
PSF     0.029642
Name: type, dtype: float64
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [796]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">grz_gt0</span><span class="o">=</span> <span class="p">((</span><span class="n">eboss</span><span class="p">[</span><span class="s1">&#39;gflux&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span>
          <span class="p">(</span><span class="n">eboss</span><span class="p">[</span><span class="s1">&#39;rflux&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span>
          <span class="p">(</span><span class="n">eboss</span><span class="p">[</span><span class="s1">&#39;zflux&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span>
          <span class="p">(</span><span class="n">eboss</span><span class="p">[</span><span class="s1">&#39;gfluxivar&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span>
          <span class="p">(</span><span class="n">eboss</span><span class="p">[</span><span class="s1">&#39;rfluxivar&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span>
          <span class="p">(</span><span class="n">eboss</span><span class="p">[</span><span class="s1">&#39;zfluxivar&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">))</span>
<span class="k">assert</span><span class="p">(</span><span class="n">eboss</span><span class="p">[</span><span class="n">grz_gt0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">eboss</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

<span class="k">print</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">eboss</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]))</span>
<span class="n">fwhm_or_rhalf</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">eboss</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">-</span><span class="mi">1</span> <span class="c1"># arcsec</span>
<span class="n">strip_type</span><span class="o">=</span> <span class="n">eboss</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">values</span>
<span class="n">isPSF</span><span class="o">=</span> <span class="n">strip_type</span> <span class="o">==</span> <span class="s1">&#39;PSF&#39;</span>
<span class="n">isEXP</span><span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">strip_type</span><span class="p">)</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="s1">&#39;EXP&#39;</span><span class="p">,</span><span class="s1">&#39;REX&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">values</span>
<span class="n">isSIMP</span><span class="o">=</span> <span class="n">strip_type</span> <span class="o">==</span> <span class="s1">&#39;SIMP&#39;</span>
<span class="n">isDEV</span><span class="o">=</span> <span class="n">strip_type</span> <span class="o">==</span> <span class="s1">&#39;DEV&#39;</span>
<span class="c1"># rhalf ~ fwhm/2</span>
<span class="n">fwhm_or_rhalf</span><span class="p">[</span><span class="n">isPSF</span><span class="p">]</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">eboss</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">isPSF</span><span class="p">,</span><span class="s1">&#39;gpsfsize&#39;</span><span class="p">],</span>
                                        <span class="n">eboss</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">isPSF</span><span class="p">,</span><span class="s1">&#39;rpsfsize&#39;</span><span class="p">],</span>
                                        <span class="n">eboss</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">isPSF</span><span class="p">,</span><span class="s1">&#39;zpsfsize&#39;</span><span class="p">]]),</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>
<span class="n">fwhm_or_rhalf</span><span class="p">[</span><span class="n">isSIMP</span><span class="p">]</span><span class="o">=</span> <span class="mf">0.5</span>
<span class="n">fwhm_or_rhalf</span><span class="p">[</span><span class="n">isEXP</span><span class="p">]</span><span class="o">=</span> <span class="n">eboss</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">isEXP</span><span class="p">,</span><span class="s1">&#39;shapeexp_r&#39;</span><span class="p">]</span>
<span class="n">fwhm_or_rhalf</span><span class="p">[</span><span class="n">isDEV</span><span class="p">]</span><span class="o">=</span> <span class="n">eboss</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">isDEV</span><span class="p">,</span><span class="s1">&#39;shapedev_r&#39;</span><span class="p">]</span>
<span class="n">eboss</span><span class="p">[</span><span class="s1">&#39;fwhm_or_rhalf&#39;</span><span class="p">]</span><span class="o">=</span> <span class="n">fwhm_or_rhalf</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;DEV &#39;, &#39;SIMP&#39;, &#39;EXP &#39;, &#39;PSF &#39;}
</pre></div></div>
</div>
<div class="section" id="DEV-are-larger-than-EXP">
<h3>DEV are larger than EXP<a class="headerlink" href="#DEV-are-larger-than-EXP" title="Permalink to this headline">Â¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [797]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
<span class="n">sns</span><span class="o">.</span><span class="n">distplot</span><span class="p">(</span><span class="n">eboss</span><span class="p">[</span><span class="s1">&#39;fwhm_or_rhalf&#39;</span><span class="p">],</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">isSmall</span><span class="o">=</span> <span class="p">(</span><span class="n">eboss</span><span class="p">[</span><span class="s1">&#39;fwhm_or_rhalf&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="n">values</span>
<span class="n">sns</span><span class="o">.</span><span class="n">distplot</span><span class="p">(</span><span class="n">eboss</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">isSmall</span><span class="p">,</span><span class="s1">&#39;fwhm_or_rhalf&#39;</span><span class="p">],</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">10</span><span class="p">)</span>

<span class="n">sns</span><span class="o">.</span><span class="n">distplot</span><span class="p">(</span><span class="n">eboss</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">isSmall</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">isDEV</span><span class="p">),</span><span class="s1">&#39;fwhm_or_rhalf&#39;</span><span class="p">],</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
             <span class="n">label</span><span class="o">=</span><span class="s1">&#39;DEV&#39;</span><span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">distplot</span><span class="p">(</span><span class="n">eboss</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">isSmall</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="o">~</span><span class="n">isDEV</span><span class="p">),</span><span class="s1">&#39;fwhm_or_rhalf&#39;</span><span class="p">],</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
             <span class="n">label</span><span class="o">=</span><span class="s1">&#39;not DEV&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">10</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>


</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>Out[797]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>&lt;matplotlib.legend.Legend at 0x138337b38&gt;
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/nb_eBOSS_DESI_Priors_16_1.png" src="../_images/nb_eBOSS_DESI_Priors_16_1.png" />
</div>
</div>
</div>
<div class="section" id="DEV-are-brighter-than-EXP">
<h3>DEV are brighter than EXP<a class="headerlink" href="#DEV-are-brighter-than-EXP" title="Permalink to this headline">Â¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [798]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">attrs</span><span class="o">=</span> <span class="p">[</span><span class="s1">&#39;g&#39;</span><span class="p">,</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="s1">&#39;z&#39;</span><span class="p">,</span><span class="s1">&#39;redshift&#39;</span><span class="p">,</span><span class="s1">&#39;fwhm_or_rhalf&#39;</span><span class="p">]</span>
<span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">9</span><span class="p">))</span>
<span class="n">i</span><span class="o">=-</span><span class="mi">1</span>
<span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
        <span class="n">i</span><span class="o">+=</span><span class="mi">1</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">attrs</span><span class="p">):</span>
            <span class="k">continue</span>
        <span class="n">bins</span><span class="o">=</span><span class="bp">None</span>
        <span class="k">if</span> <span class="n">attrs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;redshift&#39;</span><span class="p">:</span>
            <span class="n">bins</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">20</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">attrs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;fwhm_or_rhalf&#39;</span><span class="p">:</span>
            <span class="n">bins</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">40</span><span class="p">)</span>
        <span class="n">_</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="n">row</span><span class="p">,</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">eboss</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="o">~</span><span class="n">isDEV</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">isSmall</span><span class="p">),</span><span class="n">attrs</span><span class="p">[</span><span class="n">i</span><span class="p">]],</span><span class="n">histtype</span><span class="o">=</span><span class="s1">&#39;step&#39;</span><span class="p">,</span><span class="n">normed</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                           <span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="n">bins</span><span class="o">=</span><span class="n">bins</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;not DEV&#39;</span><span class="p">)</span>
        <span class="n">_</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="n">row</span><span class="p">,</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">eboss</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">isDEV</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">isSmall</span><span class="p">),</span><span class="n">attrs</span><span class="p">[</span><span class="n">i</span><span class="p">]],</span><span class="n">histtype</span><span class="o">=</span><span class="s1">&#39;step&#39;</span><span class="p">,</span><span class="n">normed</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                           <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="n">bins</span><span class="o">=</span><span class="n">bins</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;isDEV&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">row</span><span class="p">,</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">attrs</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">ax</span><span class="p">[</span><span class="n">row</span><span class="p">,</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper left&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>

<span class="c1">#gband</span>
<span class="n">oii_emitters</span><span class="o">=</span> <span class="p">[</span><span class="mf">21.825</span><span class="p">,</span> <span class="mf">22.825</span><span class="p">]</span>
<span class="c1">#ax[0,0].set_xlim(oii_emitters)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">oii_emitters</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">c</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">oii_emitters</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">c</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="s1">&#39;fraction NOT dev: &#39;</span><span class="p">,</span><span class="n">eboss</span><span class="p">[</span><span class="o">~</span><span class="n">isDEV</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="n">eboss</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="k">print</span><span class="p">(</span><span class="s1">&#39;fraction dev: &#39;</span><span class="p">,</span><span class="n">eboss</span><span class="p">[</span><span class="n">isDEV</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="n">eboss</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
fraction NOT dev:  0.9149909634140384
fraction dev:  0.08500903658596154
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/nb_eBOSS_DESI_Priors_18_1.png" src="../_images/nb_eBOSS_DESI_Priors_18_1.png" />
</div>
</div>
</div>
<div class="section" id="NGC-is-incomplete">
<h3>NGC is incomplete<a class="headerlink" href="#NGC-is-incomplete" title="Permalink to this headline">Â¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [799]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">isNGC</span><span class="o">=</span> <span class="n">eboss</span><span class="p">[</span><span class="s1">&#39;field&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;ngc&#39;</span>

<span class="n">attrs</span><span class="o">=</span> <span class="p">[</span><span class="s1">&#39;g&#39;</span><span class="p">,</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="s1">&#39;z&#39;</span><span class="p">,</span><span class="s1">&#39;redshift&#39;</span><span class="p">,</span><span class="s1">&#39;fwhm_or_rhalf&#39;</span><span class="p">]</span>
<span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">9</span><span class="p">))</span>
<span class="n">i</span><span class="o">=-</span><span class="mi">1</span>
<span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
        <span class="n">i</span><span class="o">+=</span><span class="mi">1</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">attrs</span><span class="p">):</span>
            <span class="k">continue</span>
        <span class="n">bins</span><span class="o">=</span><span class="bp">None</span>
        <span class="k">if</span> <span class="n">attrs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;redshift&#39;</span><span class="p">:</span>
            <span class="n">bins</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">20</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">attrs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;fwhm_or_rhalf&#39;</span><span class="p">:</span>
            <span class="n">bins</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">40</span><span class="p">)</span>
        <span class="n">_</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="n">row</span><span class="p">,</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">eboss</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">isNGC</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">isDEV</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">isSmall</span><span class="p">),</span><span class="n">attrs</span><span class="p">[</span><span class="n">i</span><span class="p">]],</span><span class="n">histtype</span><span class="o">=</span><span class="s1">&#39;step&#39;</span><span class="p">,</span><span class="n">normed</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                           <span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="n">bins</span><span class="o">=</span><span class="n">bins</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;NGC&#39;</span><span class="p">)</span>
        <span class="n">_</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="n">row</span><span class="p">,</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">eboss</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="o">~</span><span class="n">isNGC</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">isDEV</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">isSmall</span><span class="p">),</span><span class="n">attrs</span><span class="p">[</span><span class="n">i</span><span class="p">]],</span><span class="n">histtype</span><span class="o">=</span><span class="s1">&#39;step&#39;</span><span class="p">,</span><span class="n">normed</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                           <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="n">bins</span><span class="o">=</span><span class="n">bins</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;SGC&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">row</span><span class="p">,</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">attrs</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">ax</span><span class="p">[</span><span class="n">row</span><span class="p">,</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper left&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>

<span class="c1">#gband</span>
<span class="n">oii_emitters</span><span class="o">=</span> <span class="p">[</span><span class="mf">21.825</span><span class="p">,</span> <span class="mf">22.825</span><span class="p">]</span>
<span class="c1">#ax[0,0].set_xlim(oii_emitters)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">oii_emitters</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">c</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">oii_emitters</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">c</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>

</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>Out[799]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>&lt;matplotlib.lines.Line2D at 0x1427e8160&gt;
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/nb_eBOSS_DESI_Priors_20_1.png" src="../_images/nb_eBOSS_DESI_Priors_20_1.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [800]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">bins</span><span class="o">=</span><span class="bp">None</span>
<span class="n">_</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">eboss</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">isNGC</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">isDEV</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">isSmall</span><span class="p">),</span><span class="s1">&#39;g&#39;</span><span class="p">],</span><span class="n">histtype</span><span class="o">=</span><span class="s1">&#39;step&#39;</span><span class="p">,</span><span class="n">normed</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                  <span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="n">bins</span><span class="o">=</span><span class="n">bins</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;DEV in N&#39;</span><span class="p">)</span>
<span class="n">_</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">eboss</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="o">~</span><span class="n">isNGC</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">isDEV</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">isSmall</span><span class="p">),</span><span class="s1">&#39;g&#39;</span><span class="p">],</span><span class="n">histtype</span><span class="o">=</span><span class="s1">&#39;step&#39;</span><span class="p">,</span><span class="n">normed</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                  <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="n">bins</span><span class="o">=</span><span class="n">bins</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;DEV in S&#39;</span><span class="p">)</span>
<span class="n">_</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">eboss</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">isNGC</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="o">~</span><span class="n">isDEV</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">isSmall</span><span class="p">),</span><span class="s1">&#39;g&#39;</span><span class="p">],</span><span class="n">histtype</span><span class="o">=</span><span class="s1">&#39;step&#39;</span><span class="p">,</span><span class="n">normed</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                  <span class="n">color</span><span class="o">=</span><span class="s1">&#39;m&#39;</span><span class="p">,</span><span class="n">bins</span><span class="o">=</span><span class="n">bins</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;EXP in N&#39;</span><span class="p">)</span>
<span class="n">_</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">eboss</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="o">~</span><span class="n">isNGC</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="o">~</span><span class="n">isDEV</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">isSmall</span><span class="p">),</span><span class="s1">&#39;g&#39;</span><span class="p">],</span><span class="n">histtype</span><span class="o">=</span><span class="s1">&#39;step&#39;</span><span class="p">,</span><span class="n">normed</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                  <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="n">bins</span><span class="o">=</span><span class="n">bins</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;EXP in S&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span> <span class="c1">#loc=&#39;upper left&#39;)</span>

<span class="c1">#gband</span>
<span class="n">oii_emitters</span><span class="o">=</span> <span class="p">[</span><span class="mf">21.825</span><span class="p">,</span> <span class="mf">22.825</span><span class="p">]</span>
<span class="c1">#ax[0,0].set_xlim(oii_emitters)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">oii_emitters</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">c</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">oii_emitters</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">c</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>Out[800]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>&lt;matplotlib.lines.Line2D at 0x17108efd0&gt;
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/nb_eBOSS_DESI_Priors_21_1.png" src="../_images/nb_eBOSS_DESI_Priors_21_1.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [801]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">attrs</span><span class="o">=</span> <span class="p">[</span><span class="s1">&#39;g&#39;</span><span class="p">,</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="s1">&#39;z&#39;</span><span class="p">,</span><span class="s1">&#39;redshift&#39;</span><span class="p">,</span><span class="s1">&#39;fwhm_or_rhalf&#39;</span><span class="p">]</span>
<span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">9</span><span class="p">))</span>
<span class="n">i</span><span class="o">=-</span><span class="mi">1</span>
<span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
        <span class="n">i</span><span class="o">+=</span><span class="mi">1</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">attrs</span><span class="p">):</span>
            <span class="k">continue</span>
        <span class="n">bins</span><span class="o">=</span><span class="bp">None</span>
        <span class="k">if</span> <span class="n">attrs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;redshift&#39;</span><span class="p">:</span>
            <span class="n">bins</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">20</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">attrs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;fwhm_or_rhalf&#39;</span><span class="p">:</span>
            <span class="n">bins</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">40</span><span class="p">)</span>
        <span class="n">_</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="n">row</span><span class="p">,</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">eboss</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="o">~</span><span class="n">isNGC</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">isDEV</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">isSmall</span><span class="p">),</span><span class="n">attrs</span><span class="p">[</span><span class="n">i</span><span class="p">]],</span><span class="n">histtype</span><span class="o">=</span><span class="s1">&#39;step&#39;</span><span class="p">,</span><span class="n">normed</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                           <span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="n">bins</span><span class="o">=</span><span class="n">bins</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;DEV in S&#39;</span><span class="p">)</span>
        <span class="n">_</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="n">row</span><span class="p">,</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">eboss</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">isNGC</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="o">~</span><span class="n">isDEV</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">isSmall</span><span class="p">),</span><span class="n">attrs</span><span class="p">[</span><span class="n">i</span><span class="p">]],</span><span class="n">histtype</span><span class="o">=</span><span class="s1">&#39;step&#39;</span><span class="p">,</span><span class="n">normed</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                           <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="n">bins</span><span class="o">=</span><span class="n">bins</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;EXP in N&#39;</span><span class="p">)</span>
        <span class="n">_</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="n">row</span><span class="p">,</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">eboss</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="o">~</span><span class="n">isNGC</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="o">~</span><span class="n">isDEV</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">isSmall</span><span class="p">),</span><span class="n">attrs</span><span class="p">[</span><span class="n">i</span><span class="p">]],</span><span class="n">histtype</span><span class="o">=</span><span class="s1">&#39;step&#39;</span><span class="p">,</span><span class="n">normed</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                           <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="n">bins</span><span class="o">=</span><span class="n">bins</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;ExP in S&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">row</span><span class="p">,</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">attrs</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">ax</span><span class="p">[</span><span class="n">row</span><span class="p">,</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper left&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>

<span class="c1">#gband</span>
<span class="n">oii_emitters</span><span class="o">=</span> <span class="p">[</span><span class="mf">21.825</span><span class="p">,</span> <span class="mf">22.825</span><span class="p">]</span>
<span class="c1">#ax[0,0].set_xlim(oii_emitters)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">oii_emitters</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">c</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">oii_emitters</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">c</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="s1">&#39;Frac in NGC&#39;</span><span class="p">,</span><span class="n">eboss</span><span class="p">[(</span><span class="n">isNGC</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">isSmall</span><span class="p">)]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="n">eboss</span><span class="p">[(</span><span class="n">isSmall</span><span class="p">)]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="k">print</span><span class="p">(</span><span class="s1">&#39;Frac in SGC&#39;</span><span class="p">,</span><span class="n">eboss</span><span class="p">[(</span><span class="o">~</span><span class="n">isNGC</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">isSmall</span><span class="p">)]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="n">eboss</span><span class="p">[(</span><span class="n">isSmall</span><span class="p">)]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Frac in NGC 0.3051520987009596
Frac in SGC 0.6948479012990404
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/nb_eBOSS_DESI_Priors_22_1.png" src="../_images/nb_eBOSS_DESI_Priors_22_1.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [802]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">def</span> <span class="nf">ivar_ext_corr</span><span class="p">(</span><span class="n">flux_ivar</span><span class="p">,</span> <span class="n">mw_trans</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">flux_ivar</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">mw_trans</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">fluxErrorsToMagErrors</span><span class="p">(</span><span class="n">flux</span><span class="p">,</span> <span class="n">flux_invvar</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;From Dustin Lang&#39;s tractor.brightness module</span>
<span class="sd">    NanoMaggies().fluxErrorsToMagErrors</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">flux</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">flux</span><span class="p">)</span>
    <span class="n">flux_invvar</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">flux_invvar</span><span class="p">)</span>
    <span class="n">dflux</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">flux</span><span class="p">))</span>
    <span class="n">okiv</span> <span class="o">=</span> <span class="p">(</span><span class="n">flux_invvar</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">dflux</span><span class="p">[</span><span class="n">okiv</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">flux_invvar</span><span class="p">[</span><span class="n">okiv</span><span class="p">]))</span>
    <span class="n">okflux</span> <span class="o">=</span> <span class="p">(</span><span class="n">flux</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">mag</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">flux</span><span class="p">))</span>
    <span class="n">mag</span><span class="p">[</span><span class="n">okflux</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">flux2mag</span><span class="p">(</span><span class="n">flux</span><span class="p">[</span><span class="n">okflux</span><span class="p">]))</span>
    <span class="n">dmag</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">flux</span><span class="p">))</span>
    <span class="n">ok</span> <span class="o">=</span> <span class="p">(</span><span class="n">okiv</span> <span class="o">*</span> <span class="n">okflux</span><span class="p">)</span>
    <span class="n">dmag</span><span class="p">[</span><span class="n">ok</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">((</span><span class="o">-</span><span class="mf">2.5</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mf">10.</span><span class="p">))</span> <span class="o">*</span> <span class="n">dflux</span><span class="p">[</span><span class="n">ok</span><span class="p">]</span> <span class="o">/</span> <span class="n">flux</span><span class="p">[</span><span class="n">ok</span><span class="p">]))</span>
    <span class="n">mag</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">logical_not</span><span class="p">(</span><span class="n">okflux</span><span class="p">)]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
    <span class="n">dmag</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">logical_not</span><span class="p">(</span><span class="n">ok</span><span class="p">)]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
    <span class="k">return</span> <span class="n">mag</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">),</span> <span class="n">dmag</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>


<span class="n">exp_df</span><span class="o">=</span> <span class="n">eboss</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="o">~</span><span class="n">isNGC</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="o">~</span><span class="n">isDEV</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">isSmall</span><span class="p">)]</span>
<span class="n">a</span><span class="o">=</span><span class="p">{}</span>
<span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="s1">&#39;grz&#39;</span><span class="p">:</span>
    <span class="c1">#print(exp_df[b+&#39;_mw_transmission&#39;].values)</span>
    <span class="n">flux_EC</span><span class="o">=</span> <span class="n">exp_df</span><span class="p">[</span><span class="n">b</span><span class="o">+</span><span class="s1">&#39;flux&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">exp_df</span><span class="p">[</span><span class="n">b</span><span class="o">+</span><span class="s1">&#39;_mw_transmission&#39;</span><span class="p">]</span>
    <span class="n">ivar_EC</span><span class="o">=</span> <span class="n">ivar_ext_corr</span><span class="p">(</span><span class="n">exp_df</span><span class="p">[</span><span class="n">b</span><span class="o">+</span><span class="s1">&#39;fluxivar&#39;</span><span class="p">],</span>
                           <span class="n">exp_df</span><span class="p">[</span><span class="n">b</span><span class="o">+</span><span class="s1">&#39;_mw_transmission&#39;</span><span class="p">])</span>
    <span class="n">a</span><span class="p">[</span><span class="n">b</span><span class="p">],</span><span class="n">a</span><span class="p">[</span><span class="n">b</span><span class="o">+</span><span class="s1">&#39;_err&#39;</span><span class="p">]</span><span class="o">=</span> <span class="n">fluxErrorsToMagErrors</span><span class="p">(</span><span class="n">flux_EC</span><span class="p">,</span><span class="n">ivar_EC</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;max diff&#39;</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="n">b</span><span class="p">]</span> <span class="o">-</span> <span class="n">exp_df</span><span class="p">[</span><span class="n">b</span><span class="p">]))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
max diff 0.0
max diff 0.0
max diff 0.0
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">exp_df</span><span class="p">[</span><span class="s1">&#39;zfluxivar&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.1</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [508]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">exp_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,[</span><span class="s1">&#39;gflux&#39;</span><span class="p">,</span><span class="s1">&#39;gfluxivar&#39;</span><span class="p">,</span><span class="s1">&#39;rflux&#39;</span><span class="p">,</span><span class="s1">&#39;rfluxivar&#39;</span><span class="p">,</span><span class="s1">&#39;zflux&#39;</span><span class="p">,</span><span class="s1">&#39;zfluxivar&#39;</span><span class="p">,]]</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>Out[508]:
</pre></div>
</div>
<div class="output_area docutils container">
<div>
<style>
    .dataframe thead tr:only-child th {
        text-align: right;
    }

    .dataframe thead th {
        text-align: left;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>gflux</th>
      <th>gfluxivar</th>
      <th>rflux</th>
      <th>rfluxivar</th>
      <th>zflux</th>
      <th>zfluxivar</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>77707.000000</td>
      <td>77707.000000</td>
      <td>77707.000000</td>
      <td>77707.000000</td>
      <td>77707.000000</td>
      <td>77707.000000</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>0.888922</td>
      <td>881.916504</td>
      <td>1.707809</td>
      <td>548.811218</td>
      <td>4.328659</td>
      <td>52.991436</td>
    </tr>
    <tr>
      <th>std</th>
      <td>0.224979</td>
      <td>612.729980</td>
      <td>0.497227</td>
      <td>593.549988</td>
      <td>1.494015</td>
      <td>37.039284</td>
    </tr>
    <tr>
      <th>min</th>
      <td>0.423581</td>
      <td>15.386562</td>
      <td>0.813217</td>
      <td>4.425666</td>
      <td>1.855282</td>
      <td>0.000009</td>
    </tr>
    <tr>
      <th>25%</th>
      <td>0.722753</td>
      <td>531.541199</td>
      <td>1.348789</td>
      <td>249.192551</td>
      <td>3.235148</td>
      <td>28.715761</td>
    </tr>
    <tr>
      <th>50%</th>
      <td>0.823451</td>
      <td>766.096497</td>
      <td>1.585970</td>
      <td>381.044220</td>
      <td>3.992064</td>
      <td>44.390278</td>
    </tr>
    <tr>
      <th>75%</th>
      <td>0.997608</td>
      <td>1069.143066</td>
      <td>1.948330</td>
      <td>586.753754</td>
      <td>5.091161</td>
      <td>66.973400</td>
    </tr>
    <tr>
      <th>max</th>
      <td>1.758362</td>
      <td>11717.317383</td>
      <td>4.004512</td>
      <td>7636.661621</td>
      <td>14.356393</td>
      <td>569.374512</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [504]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">a</span><span class="p">)</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>Out[504]:
</pre></div>
</div>
<div class="output_area docutils container">
<div>
<style>
    .dataframe thead tr:only-child th {
        text-align: right;
    }

    .dataframe thead th {
        text-align: left;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>g</th>
      <th>g_err</th>
      <th>r</th>
      <th>r_err</th>
      <th>z</th>
      <th>z_err</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>77707.000000</td>
      <td>77707.000000</td>
      <td>77707.000000</td>
      <td>77707.000000</td>
      <td>77707.000000</td>
      <td>77707.000000</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>22.517084</td>
      <td>0.048797</td>
      <td>21.864561</td>
      <td>0.036079</td>
      <td>20.913521</td>
      <td>0.044286</td>
    </tr>
    <tr>
      <th>std</th>
      <td>0.241931</td>
      <td>0.017435</td>
      <td>0.288296</td>
      <td>0.015156</td>
      <td>0.347103</td>
      <td>0.199887</td>
    </tr>
    <tr>
      <th>min</th>
      <td>21.825092</td>
      <td>0.008628</td>
      <td>20.921309</td>
      <td>0.004216</td>
      <td>19.572298</td>
      <td>0.005758</td>
    </tr>
    <tr>
      <th>25%</th>
      <td>22.367023</td>
      <td>0.037267</td>
      <td>21.682262</td>
      <td>0.026140</td>
      <td>20.679452</td>
      <td>0.031045</td>
    </tr>
    <tr>
      <th>50%</th>
      <td>22.574741</td>
      <td>0.046364</td>
      <td>21.904720</td>
      <td>0.034198</td>
      <td>20.943573</td>
      <td>0.040345</td>
    </tr>
    <tr>
      <th>75%</th>
      <td>22.715694</td>
      <td>0.056969</td>
      <td>22.078629</td>
      <td>0.043640</td>
      <td>21.171512</td>
      <td>0.052133</td>
    </tr>
    <tr>
      <th>max</th>
      <td>22.824989</td>
      <td>0.320735</td>
      <td>22.450010</td>
      <td>0.385943</td>
      <td>21.730873</td>
      <td>55.529587</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [507]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="s1">&#39;g&#39;</span><span class="p">][</span><span class="n">a</span><span class="p">[</span><span class="s1">&#39;z_err&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">50</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>Out[507]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>1
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [672]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">b</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span><span class="s1">&#39;grz&#39;</span><span class="p">):</span>
    <span class="n">bins</span><span class="o">=</span><span class="bp">None</span>
    <span class="k">if</span> <span class="n">b</span> <span class="o">==</span> <span class="s1">&#39;z&#39;</span><span class="p">:</span>
        <span class="n">bins</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mf">0.2</span><span class="p">)</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">distplot</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="n">b</span><span class="o">+</span><span class="s1">&#39;_err&#39;</span><span class="p">],</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">bins</span><span class="o">=</span><span class="n">bins</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
    <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mf">0.4</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">bins</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">bins</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
<span class="c1">#plt.xlim(-0.5,0.5)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>Out[672]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>(0.0, 1.8)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/nb_eBOSS_DESI_Priors_29_1.png" src="../_images/nb_eBOSS_DESI_Priors_29_1.png" />
</div>
</div>
</div>
</div>
<div class="section" id="Model-(only-use-SGC-data)">
<h2>Model (only use SGC data)<a class="headerlink" href="#Model-(only-use-SGC-data)" title="Permalink to this headline">Â¶</a></h2>
<div class="section" id="Colors,-sizes,-shapes">
<h3>Colors, sizes, shapes<a class="headerlink" href="#Colors,-sizes,-shapes" title="Permalink to this headline">Â¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [803]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">attrs</span><span class="o">=</span> <span class="p">[</span><span class="s1">&#39;g&#39;</span><span class="p">,</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="s1">&#39;z&#39;</span><span class="p">,</span><span class="s1">&#39;redshift&#39;</span><span class="p">,</span><span class="s1">&#39;fwhm_or_rhalf&#39;</span><span class="p">]</span>
<span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">9</span><span class="p">))</span>
<span class="n">i</span><span class="o">=-</span><span class="mi">1</span>
<span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
        <span class="n">i</span><span class="o">+=</span><span class="mi">1</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">attrs</span><span class="p">):</span>
            <span class="k">continue</span>
        <span class="n">bins</span><span class="o">=</span><span class="bp">None</span>
        <span class="k">if</span> <span class="n">attrs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;redshift&#39;</span><span class="p">:</span>
            <span class="n">bins</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">20</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">attrs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;fwhm_or_rhalf&#39;</span><span class="p">:</span>
            <span class="n">bins</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">40</span><span class="p">)</span>
        <span class="n">_</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="n">row</span><span class="p">,</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">eboss</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="o">~</span><span class="n">isNGC</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">isDEV</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">isSmall</span><span class="p">),</span><span class="n">attrs</span><span class="p">[</span><span class="n">i</span><span class="p">]],</span><span class="n">histtype</span><span class="o">=</span><span class="s1">&#39;step&#39;</span><span class="p">,</span><span class="n">normed</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                           <span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="n">bins</span><span class="o">=</span><span class="n">bins</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;DEV in S&#39;</span><span class="p">)</span>
        <span class="n">_</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="n">row</span><span class="p">,</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">eboss</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="o">~</span><span class="n">isNGC</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="o">~</span><span class="n">isDEV</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">isSmall</span><span class="p">),</span><span class="n">attrs</span><span class="p">[</span><span class="n">i</span><span class="p">]],</span><span class="n">histtype</span><span class="o">=</span><span class="s1">&#39;step&#39;</span><span class="p">,</span><span class="n">normed</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                           <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="n">bins</span><span class="o">=</span><span class="n">bins</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;EXP in S&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">row</span><span class="p">,</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">attrs</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">ax</span><span class="p">[</span><span class="n">row</span><span class="p">,</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper left&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>

<span class="c1">#gband</span>
<span class="n">oii_emitters</span><span class="o">=</span> <span class="p">[</span><span class="mf">21.825</span><span class="p">,</span> <span class="mf">22.825</span><span class="p">]</span>
<span class="c1">#ax[0,0].set_xlim(oii_emitters)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">oii_emitters</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">c</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">oii_emitters</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">c</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>

<span class="n">num_in_s</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">isDEV</span><span class="o">=</span><span class="n">eboss</span><span class="p">[(</span><span class="o">~</span><span class="n">isNGC</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">isDEV</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">isSmall</span><span class="p">)]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
              <span class="n">notDEV</span><span class="o">=</span><span class="n">eboss</span><span class="p">[(</span><span class="o">~</span><span class="n">isNGC</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="o">~</span><span class="n">isDEV</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">isSmall</span><span class="p">)]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
              <span class="n">total</span><span class="o">=</span><span class="n">eboss</span><span class="p">[(</span><span class="n">isSmall</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="o">~</span><span class="n">isNGC</span><span class="p">)]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="k">print</span><span class="p">(</span><span class="s1">&#39;DEV in S: Number=</span><span class="si">%d</span><span class="s1">, Frac=</span><span class="si">%.3f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">num_in_s</span><span class="p">[</span><span class="s1">&#39;isDEV&#39;</span><span class="p">],</span><span class="n">num_in_s</span><span class="p">[</span><span class="s1">&#39;isDEV&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">num_in_s</span><span class="p">[</span><span class="s1">&#39;total&#39;</span><span class="p">]))</span>
<span class="k">print</span><span class="p">(</span><span class="s1">&#39;EXP in S: Number=</span><span class="si">%d</span><span class="s1">, Frac=</span><span class="si">%.3f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">num_in_s</span><span class="p">[</span><span class="s1">&#39;notDEV&#39;</span><span class="p">],</span><span class="n">num_in_s</span><span class="p">[</span><span class="s1">&#39;notDEV&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">num_in_s</span><span class="p">[</span><span class="s1">&#39;total&#39;</span><span class="p">]))</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
DEV in S: Number=7448, Frac=0.087
EXP in S: Number=77707, Frac=0.913
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/nb_eBOSS_DESI_Priors_32_1.png" src="../_images/nb_eBOSS_DESI_Priors_32_1.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [674]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">fit_cols</span><span class="o">=</span> <span class="p">[</span><span class="s1">&#39;fwhm_or_rhalf&#39;</span><span class="p">,</span> <span class="s1">&#39;g-r&#39;</span><span class="p">,</span> <span class="s1">&#39;r-z&#39;</span><span class="p">,</span><span class="s1">&#39;z&#39;</span><span class="p">,</span><span class="s1">&#39;redshift&#39;</span><span class="p">]</span>
<span class="n">eboss_notdev</span><span class="o">=</span> <span class="n">eboss</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="o">~</span><span class="n">isNGC</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="o">~</span><span class="n">isDEV</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">isSmall</span><span class="p">),</span> <span class="n">fit_cols</span><span class="p">]</span>
<span class="n">eboss_dev</span><span class="o">=</span> <span class="n">eboss</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="o">~</span><span class="n">isNGC</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">isDEV</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">isSmall</span><span class="p">),</span> <span class="n">fit_cols</span><span class="p">]</span>
<span class="n">X</span><span class="o">=</span> <span class="n">eboss_notdev</span><span class="o">.</span><span class="n">values</span>

<span class="n">gmms</span><span class="p">,</span><span class="n">i_min</span><span class="p">,</span> <span class="n">n_comp</span><span class="p">,</span> <span class="n">BICs</span><span class="o">=</span> <span class="n">my_mixture</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">n_comp</span><span class="p">,</span><span class="n">BICs</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
15 components
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>Out[674]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>[&lt;matplotlib.lines.Line2D at 0x22c3c4748&gt;]
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/nb_eBOSS_DESI_Priors_34_2.png" src="../_images/nb_eBOSS_DESI_Priors_34_2.png" />
</div>
</div>
</div>
<div class="section" id="Cannot-model-power-law-(g-mag-histogram)-with-Gaussians">
<h3>Cannot model power law (g-mag histogram) with Gaussians<a class="headerlink" href="#Cannot-model-power-law-(g-mag-histogram)-with-Gaussians" title="Permalink to this headline">Â¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [474]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">13</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>

<span class="n">zbins</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span><span class="mf">1.8</span><span class="p">,</span><span class="mf">0.1</span><span class="p">)</span>
<span class="n">fwhm_bins</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mf">0.2</span><span class="p">)</span>
<span class="k">for</span> <span class="n">row</span><span class="p">,</span><span class="n">n</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">([</span><span class="mi">6</span><span class="p">,</span><span class="mi">9</span><span class="p">,</span><span class="mi">12</span><span class="p">]):</span>
    <span class="n">i</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">n_comp</span> <span class="o">==</span> <span class="n">n</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">Xpred</span><span class="p">,</span><span class="n">Ypred</span><span class="o">=</span> <span class="n">gmms</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">10000</span><span class="p">)</span>
    <span class="n">_</span><span class="p">,</span><span class="n">bins</span><span class="p">,</span><span class="n">_</span><span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="n">row</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">eboss_notdev</span><span class="p">[</span><span class="s1">&#39;redshift&#39;</span><span class="p">],</span><span class="n">bins</span><span class="o">=</span><span class="n">zbins</span><span class="p">,</span><span class="n">histtype</span><span class="o">=</span><span class="s1">&#39;step&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="n">normed</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">_</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="n">row</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">Xpred</span><span class="p">[:,</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="n">bins</span><span class="o">=</span><span class="n">zbins</span><span class="p">,</span><span class="n">histtype</span><span class="o">=</span><span class="s1">&#39;step&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="n">normed</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

    <span class="n">_</span><span class="p">,</span><span class="n">bins</span><span class="p">,</span><span class="n">_</span><span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="n">row</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">eboss_notdev</span><span class="p">[</span><span class="s1">&#39;fwhm_or_rhalf&#39;</span><span class="p">],</span><span class="n">bins</span><span class="o">=</span><span class="n">fwhm_bins</span><span class="p">,</span><span class="n">histtype</span><span class="o">=</span><span class="s1">&#39;step&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="n">normed</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                             <span class="n">label</span><span class="o">=</span><span class="s1">&#39;data&#39;</span><span class="p">)</span>
    <span class="n">_</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="n">row</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">Xpred</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span><span class="n">bins</span><span class="o">=</span><span class="n">fwhm_bins</span><span class="p">,</span><span class="n">histtype</span><span class="o">=</span><span class="s1">&#39;step&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="n">normed</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                     <span class="n">label</span><span class="o">=</span><span class="s1">&#39;pred&#39;</span><span class="p">)</span>
    <span class="c1">#ax[2].set_xlabel(&#39;fwhm_or_rhalf&#39;)</span>

<span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;redshift&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;fwhm_or_rhalf&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

<span class="c1">### g,r,z</span>
<span class="c1">#fit_cols= [&#39;fwhm_or_rhalf&#39;, &#39;g-r&#39;, &#39;r-z&#39;,&#39;z&#39;,&#39;redshift&#39;]</span>
<span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">13</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>

<span class="k">for</span> <span class="n">row</span><span class="p">,</span><span class="n">n</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">([</span><span class="mi">6</span><span class="p">,</span><span class="mi">9</span><span class="p">,</span><span class="mi">12</span><span class="p">]):</span>
    <span class="n">i</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">n_comp</span> <span class="o">==</span> <span class="n">n</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">Xpred</span><span class="p">,</span><span class="n">Ypred</span><span class="o">=</span> <span class="n">gmms</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">10000</span><span class="p">)</span>
    <span class="c1"># each band: z,r,g</span>
    <span class="n">_</span><span class="p">,</span><span class="n">bins</span><span class="p">,</span><span class="n">_</span><span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="n">row</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">eboss_notdev</span><span class="p">[</span><span class="s1">&#39;z&#39;</span><span class="p">],</span><span class="n">bins</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span><span class="n">histtype</span><span class="o">=</span><span class="s1">&#39;step&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="n">normed</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">_</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="n">row</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">Xpred</span><span class="p">[:,</span><span class="o">-</span><span class="mi">2</span><span class="p">],</span><span class="n">bins</span><span class="o">=</span><span class="n">bins</span><span class="p">,</span><span class="n">histtype</span><span class="o">=</span><span class="s1">&#39;step&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="n">normed</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="n">row</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;z&#39;</span><span class="p">)</span>

    <span class="n">_</span><span class="p">,</span><span class="n">bins</span><span class="p">,</span><span class="n">_</span><span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="n">row</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">eboss_notdev</span><span class="p">[</span><span class="s1">&#39;r-z&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">eboss_notdev</span><span class="p">[</span><span class="s1">&#39;z&#39;</span><span class="p">],</span><span class="n">bins</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span><span class="n">histtype</span><span class="o">=</span><span class="s1">&#39;step&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="n">normed</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">_</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="n">row</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">Xpred</span><span class="p">[:,</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span> <span class="o">+</span> <span class="n">Xpred</span><span class="p">[:,</span><span class="o">-</span><span class="mi">2</span><span class="p">],</span><span class="n">bins</span><span class="o">=</span><span class="n">bins</span><span class="p">,</span><span class="n">histtype</span><span class="o">=</span><span class="s1">&#39;step&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="n">normed</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="n">row</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>

    <span class="n">_</span><span class="p">,</span><span class="n">bins</span><span class="p">,</span><span class="n">_</span><span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="n">row</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">eboss_notdev</span><span class="p">[</span><span class="s1">&#39;g-r&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">eboss_notdev</span><span class="p">[</span><span class="s1">&#39;r-z&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">eboss_notdev</span><span class="p">[</span><span class="s1">&#39;z&#39;</span><span class="p">],</span><span class="n">bins</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span><span class="n">histtype</span><span class="o">=</span><span class="s1">&#39;step&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="n">normed</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">_</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="n">row</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">Xpred</span><span class="p">[:,</span><span class="o">-</span><span class="mi">4</span><span class="p">]</span> <span class="o">+</span> <span class="n">Xpred</span><span class="p">[:,</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span> <span class="o">+</span> <span class="n">Xpred</span><span class="p">[:,</span><span class="o">-</span><span class="mi">2</span><span class="p">],</span><span class="n">bins</span><span class="o">=</span><span class="n">bins</span><span class="p">,</span><span class="n">histtype</span><span class="o">=</span><span class="s1">&#39;step&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="n">normed</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="n">row</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;g&#39;</span><span class="p">)</span>

<span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">b</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span><span class="s1">&#39;zrg&#39;</span><span class="p">):</span>
    <span class="n">ax</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>

</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/nb_eBOSS_DESI_Priors_36_0.png" src="../_images/nb_eBOSS_DESI_Priors_36_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/nb_eBOSS_DESI_Priors_36_1.png" src="../_images/nb_eBOSS_DESI_Priors_36_1.png" />
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [592]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>

<span></span><span class="k">def</span> <span class="nf">ebossInSGC</span><span class="p">(</span><span class="n">rz</span><span class="p">,</span><span class="n">gr</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">((</span><span class="o">-</span><span class="mf">0.068</span><span class="o">*</span><span class="n">rz</span> <span class="o">+</span> <span class="mf">0.457</span> <span class="o">&lt;</span> <span class="n">gr</span><span class="p">)</span> <span class="o">&amp;</span>
            <span class="p">(</span><span class="n">gr</span> <span class="o">&lt;</span> <span class="mf">0.112</span><span class="o">*</span><span class="n">rz</span> <span class="o">+</span> <span class="mf">0.773</span><span class="p">)</span> <span class="o">&amp;</span>
            <span class="p">(</span><span class="mf">0.218</span><span class="o">*</span><span class="n">gr</span> <span class="o">+</span> <span class="mf">0.571</span> <span class="o">&lt;</span> <span class="n">rz</span><span class="p">)</span> <span class="o">&amp;</span>
            <span class="p">(</span><span class="n">rz</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mf">0.555</span><span class="o">*</span><span class="n">gr</span> <span class="o">+</span> <span class="mf">1.901</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">ebossInNGC</span><span class="p">(</span><span class="n">rz</span><span class="p">,</span><span class="n">gr</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">((</span><span class="o">-</span><span class="mf">0.068</span><span class="o">*</span><span class="n">rz</span> <span class="o">+</span> <span class="mf">0.457</span> <span class="o">&lt;</span> <span class="n">gr</span><span class="p">)</span> <span class="o">&amp;</span>
            <span class="p">(</span><span class="n">gr</span> <span class="o">&lt;</span> <span class="mf">0.112</span><span class="o">*</span><span class="n">rz</span> <span class="o">+</span> <span class="mf">0.773</span><span class="p">)</span> <span class="o">&amp;</span>
            <span class="p">(</span><span class="mf">0.637</span><span class="o">*</span><span class="n">gr</span> <span class="o">+</span> <span class="mf">0.399</span> <span class="o">&lt;</span> <span class="n">rz</span><span class="p">)</span> <span class="o">&amp;</span>
            <span class="p">(</span><span class="n">rz</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mf">0.555</span><span class="o">*</span><span class="n">gr</span> <span class="o">+</span> <span class="mf">1.901</span><span class="p">))</span>

<span class="k">class</span> <span class="nc">EbossBox</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">get_xy_pad</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">slope</span><span class="p">,</span><span class="n">pad</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns dx,dy&quot;&quot;&quot;</span>
        <span class="n">theta</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">slope</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">pad</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">),</span> <span class="n">pad</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_yint_pad</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">slope</span><span class="p">,</span><span class="n">pad</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns dx,dy&quot;&quot;&quot;</span>
        <span class="n">theta</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan</span><span class="p">(</span><span class="n">slope</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">pad</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">three_lines</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">rz</span><span class="p">,</span><span class="n">pad</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="n">slopes</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mf">0.068</span><span class="p">,</span><span class="mf">0.112</span><span class="p">,</span> <span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="o">-</span><span class="mf">0.555</span><span class="p">)])</span>
        <span class="n">yints</span><span class="o">=</span>  <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.457</span><span class="p">,</span><span class="mf">0.773</span><span class="p">,</span><span class="o">-</span><span class="mf">1.901</span><span class="o">/</span><span class="p">(</span><span class="o">-</span><span class="mf">0.555</span><span class="p">)])</span>
        <span class="n">lines</span><span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">cnt</span><span class="p">,</span><span class="n">slope</span><span class="p">,</span><span class="n">yint</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">slopes</span><span class="p">)),</span><span class="n">slopes</span><span class="p">,</span><span class="n">yints</span><span class="p">):</span>
            <span class="n">dy</span><span class="o">=</span> <span class="mi">0</span>
            <span class="c1">#dx,dy= self.get_xy_pad(slope,pad)</span>
            <span class="n">dy</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_yint_pad</span><span class="p">(</span><span class="n">slope</span><span class="p">,</span><span class="n">pad</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">cnt</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">dy</span> <span class="o">*=</span> <span class="o">-</span><span class="mi">1</span>
            <span class="c1">#lines.append(slope*(rz-dx) + yint + dy)</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">slope</span><span class="o">*</span><span class="n">rz</span> <span class="o">+</span> <span class="n">yint</span> <span class="o">+</span> <span class="n">dy</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">sgc_line</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">rz</span><span class="p">,</span><span class="n">pad</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="n">slope</span><span class="p">,</span><span class="n">yint</span><span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="mf">0.218</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.571</span><span class="o">/</span><span class="mf">0.218</span>
        <span class="n">dy</span><span class="o">=</span><span class="mf">0.</span>
        <span class="c1">#dx,dy= self.get_xy_pad(slope,pad)</span>
        <span class="n">dy</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_yint_pad</span><span class="p">(</span><span class="n">slope</span><span class="p">,</span><span class="n">pad</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">slope</span><span class="o">*</span><span class="n">rz</span> <span class="o">+</span> <span class="n">yint</span> <span class="o">+</span> <span class="n">dy</span>

    <span class="k">def</span> <span class="nf">ngc_line</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">rz</span><span class="p">,</span><span class="n">pad</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="n">slope</span><span class="p">,</span><span class="n">yint</span><span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="mf">0.637</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.399</span><span class="o">/</span><span class="mf">0.637</span>
        <span class="c1">#dx,dy= self.get_xy_pad(slope,pad)</span>
        <span class="n">dy</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_yint_pad</span><span class="p">(</span><span class="n">slope</span><span class="p">,</span><span class="n">pad</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">slope</span><span class="o">*</span><span class="n">rz</span> <span class="o">+</span> <span class="n">yint</span> <span class="o">+</span> <span class="n">dy</span>

    <span class="k">def</span> <span class="nf">SGC</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">rz</span><span class="p">,</span> <span class="n">pad</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Args:</span>
<span class="sd">            rz: r-z</span>
<span class="sd">            pad: magnitudes of padding to expand TS box</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">d</span><span class="p">[</span><span class="s1">&#39;y1&#39;</span><span class="p">],</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;y2&#39;</span><span class="p">],</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;y3&#39;</span><span class="p">]</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">three_lines</span><span class="p">(</span><span class="n">rz</span><span class="p">,</span><span class="n">pad</span><span class="p">)</span>
        <span class="n">d</span><span class="p">[</span><span class="s1">&#39;y4&#39;</span><span class="p">]</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sgc_line</span><span class="p">(</span><span class="n">rz</span><span class="p">,</span><span class="n">pad</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">d</span>

    <span class="k">def</span> <span class="nf">NGC</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">rz</span><span class="p">,</span> <span class="n">pad</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Args:</span>
<span class="sd">            rz: r-z</span>
<span class="sd">            pad: magnitudes of padding to expand TS box</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">d</span><span class="p">[</span><span class="s1">&#39;y1&#39;</span><span class="p">],</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;y2&#39;</span><span class="p">],</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;y3&#39;</span><span class="p">]</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">three_lines</span><span class="p">(</span><span class="n">rz</span><span class="p">,</span><span class="n">pad</span><span class="p">)</span>
        <span class="n">d</span><span class="p">[</span><span class="s1">&#39;y4&#39;</span><span class="p">]</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ngc_line</span><span class="p">(</span><span class="n">rz</span><span class="p">,</span><span class="n">pad</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">d</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="TS-box-with-padding-(0.5-mag)">
<h3>TS box with padding (0.5 mag)<a class="headerlink" href="#TS-box-with-padding-(0.5-mag)" title="Permalink to this headline">Â¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [582]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="o">~</span><span class="n">isNGC</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="o">~</span><span class="n">isDEV</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">isSmall</span><span class="p">),</span><span class="s1">&#39;r-z&#39;</span><span class="p">],</span>
              <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="o">~</span><span class="n">isNGC</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="o">~</span><span class="n">isDEV</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">isSmall</span><span class="p">),</span><span class="s1">&#39;g-r&#39;</span><span class="p">],</span>
              <span class="n">c</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="n">s</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;S&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">isNGC</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="o">~</span><span class="n">isDEV</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">isSmall</span><span class="p">),</span><span class="s1">&#39;r-z&#39;</span><span class="p">],</span>
              <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">isNGC</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="o">~</span><span class="n">isDEV</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">isSmall</span><span class="p">),</span><span class="s1">&#39;g-r&#39;</span><span class="p">],</span>
              <span class="n">c</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="n">s</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;N&#39;</span><span class="p">)</span>

<span class="n">rz</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">num</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">ngc_d</span><span class="o">=</span> <span class="n">EbossBox</span><span class="p">()</span><span class="o">.</span><span class="n">NGC</span><span class="p">(</span><span class="n">rz</span><span class="p">,</span><span class="n">pad</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">rz</span><span class="p">,</span><span class="n">ngc_d</span><span class="p">[</span><span class="s1">&#39;y1&#39;</span><span class="p">],</span><span class="s1">&#39;k--&#39;</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">rz</span><span class="p">,</span><span class="n">ngc_d</span><span class="p">[</span><span class="s1">&#39;y2&#39;</span><span class="p">],</span><span class="s1">&#39;k--&#39;</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">rz</span><span class="p">,</span><span class="n">ngc_d</span><span class="p">[</span><span class="s1">&#39;y3&#39;</span><span class="p">],</span><span class="s1">&#39;k--&#39;</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">rz</span><span class="p">,</span><span class="n">ngc_d</span><span class="p">[</span><span class="s1">&#39;y4&#39;</span><span class="p">],</span><span class="s1">&#39;m--&#39;</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

<span class="n">sgc_d</span><span class="o">=</span> <span class="n">EbossBox</span><span class="p">()</span><span class="o">.</span><span class="n">SGC</span><span class="p">(</span><span class="n">rz</span><span class="p">,</span><span class="n">pad</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">rz</span><span class="p">,</span><span class="n">sgc_d</span><span class="p">[</span><span class="s1">&#39;y4&#39;</span><span class="p">],</span><span class="s1">&#39;b--&#39;</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>


<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mf">0.2</span><span class="p">,</span><span class="mf">1.3</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;r-z&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;g-r&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>Out[582]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>&lt;matplotlib.text.Text at 0x17516d710&gt;
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/nb_eBOSS_DESI_Priors_39_1.png" src="../_images/nb_eBOSS_DESI_Priors_39_1.png" />
</div>
</div>
</div>
</div>
<div class="section" id="Add-DR3-Deep2-to-Model">
<h2>Add DR3-Deep2 to Model<a class="headerlink" href="#Add-DR3-Deep2-to-Model" title="Permalink to this headline">Â¶</a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [879]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">DATA_DIR</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;HOME&#39;</span><span class="p">],</span><span class="s1">&#39;Downloads&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;truth&#39;</span><span class="p">)</span>
<span class="n">dr3_fns</span><span class="o">=</span> <span class="n">glob</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">DATA_DIR</span><span class="p">,</span>
                <span class="s1">&#39;dr3.1/trimmed/decals-dr3.1-deep2-field*-trim.fits&#39;</span><span class="p">))</span>
<span class="n">dp2_fns</span><span class="o">=</span> <span class="n">glob</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">DATA_DIR</span><span class="p">,</span>
                <span class="s1">&#39;dr3.1/trimmed/deep2-field*-trim.fits&#39;</span><span class="p">))</span>
<span class="k">print</span><span class="p">(</span><span class="n">dr3_fns</span><span class="p">,</span><span class="n">dp2_fns</span><span class="p">)</span>
<span class="c1">###</span>
<span class="k">def</span> <span class="nf">stack_tables</span><span class="p">(</span><span class="n">fns</span><span class="p">):</span>
    <span class="n">cat</span><span class="o">=</span><span class="p">[]</span>
    <span class="k">assert</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">fns</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">fn</span> <span class="ow">in</span> <span class="n">fns</span><span class="p">:</span>
        <span class="k">assert</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">fn</span><span class="p">))</span>
        <span class="k">print</span><span class="p">(</span><span class="s1">&#39;Stacking </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">fn</span><span class="p">)</span>
        <span class="n">cat</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">fits_table</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span> <span class="p">)</span>
    <span class="k">return</span> <span class="n">merge_tables</span><span class="p">(</span><span class="n">cat</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="s1">&#39;fillzero&#39;</span><span class="p">)</span>

<span class="n">dr3</span><span class="o">=</span> <span class="n">stack_tables</span><span class="p">(</span><span class="n">dr3_fns</span><span class="p">)</span>
<span class="n">dp2</span><span class="o">=</span> <span class="n">stack_tables</span><span class="p">(</span><span class="n">dp2_fns</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dr3</span><span class="p">),</span><span class="nb">len</span><span class="p">(</span><span class="n">dp2</span><span class="p">))</span>
<span class="c1">#######</span>
<span class="n">grz_gt0</span><span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">dr3</span><span class="o">.</span><span class="n">decam_flux</span><span class="p">[:,[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">]]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span>
          <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">dr3</span><span class="o">.</span><span class="n">decam_flux_ivar</span><span class="p">[:,[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">]]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
<span class="n">notCOMP</span><span class="o">=</span> <span class="n">dr3</span><span class="o">.</span><span class="n">type</span> <span class="o">!=</span> <span class="s1">&#39;COMP&#39;</span>
<span class="c1">###</span>
<span class="n">fwhm_or_rhalf</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dr3</span><span class="p">))</span><span class="o">-</span><span class="mi">1</span> <span class="c1"># arcsec</span>
<span class="n">isPSF</span><span class="o">=</span> <span class="n">dr3</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s1">&#39;PSF&#39;</span>
<span class="n">isEXP</span><span class="o">=</span> <span class="n">dr3</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s1">&#39;EXP&#39;</span>
<span class="n">isSIMP</span><span class="o">=</span> <span class="n">dr3</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s1">&#39;SIMP&#39;</span>
<span class="n">isDEV</span><span class="o">=</span> <span class="n">dr3</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s1">&#39;DEV&#39;</span>
<span class="n">fwhm_or_rhalf</span><span class="p">[</span><span class="n">isPSF</span><span class="p">]</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">dr3</span><span class="p">[</span><span class="n">isPSF</span><span class="p">]</span><span class="o">.</span><span class="n">decam_psfsize</span><span class="p">[:,[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">]],</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">fwhm_or_rhalf</span><span class="p">[</span><span class="n">isSIMP</span><span class="p">]</span><span class="o">=</span> <span class="mf">0.5</span>
<span class="n">fwhm_or_rhalf</span><span class="p">[</span><span class="n">isEXP</span><span class="p">]</span><span class="o">=</span> <span class="n">dr3</span><span class="p">[</span><span class="n">isEXP</span><span class="p">]</span><span class="o">.</span><span class="n">shapeexp_r</span>
<span class="n">fwhm_or_rhalf</span><span class="p">[</span><span class="n">isDEV</span><span class="p">]</span><span class="o">=</span> <span class="n">dr3</span><span class="p">[</span><span class="n">isDEV</span><span class="p">]</span><span class="o">.</span><span class="n">shapedev_r</span>
<span class="n">dr3</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;fwhm_or_rhalf&#39;</span><span class="p">,</span><span class="n">fwhm_or_rhalf</span><span class="p">)</span>
<span class="c1">###</span>
<span class="n">reshift_lims</span><span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mf">2.</span><span class="p">]</span> <span class="c1"># eBOSS</span>
<span class="c1">###</span>
<span class="n">keep</span><span class="o">=</span> <span class="p">((</span><span class="n">grz_gt0</span><span class="p">)</span> <span class="o">&amp;</span>
       <span class="p">(</span><span class="n">notCOMP</span><span class="p">)</span> <span class="o">&amp;</span>
       <span class="p">(</span><span class="n">fwhm_or_rhalf</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="p">)</span> <span class="o">&amp;</span>
       <span class="p">(</span><span class="n">dp2</span><span class="o">.</span><span class="n">zhelio</span> <span class="o">&gt;</span> <span class="n">reshift_lims</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&amp;</span>
       <span class="p">(</span><span class="n">dp2</span><span class="o">.</span><span class="n">zhelio</span> <span class="o">&lt;</span> <span class="n">reshift_lims</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
<span class="n">dr3</span><span class="o">.</span><span class="n">cut</span><span class="p">(</span><span class="n">keep</span><span class="p">)</span>
<span class="n">dp2</span><span class="o">.</span><span class="n">cut</span><span class="p">(</span><span class="n">keep</span><span class="p">)</span>
<span class="c1">###</span>
<span class="n">d</span><span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">b</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">],</span><span class="s1">&#39;grz&#39;</span><span class="p">):</span>
    <span class="n">d</span><span class="p">[</span><span class="n">b</span><span class="p">]</span><span class="o">=</span> <span class="n">flux2mag</span><span class="p">(</span><span class="n">dr3</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;decam_flux&#39;</span><span class="p">)[:,</span><span class="n">i</span><span class="p">]</span><span class="o">/</span><span class="n">dr3</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;decam_mw_transmission&#39;</span><span class="p">)[:,</span><span class="n">i</span><span class="p">])</span>
    <span class="c1">#d[b+&#39;_ivar&#39;]= flux2mag(dr3.get(&#39;decam_flux_ivar&#39;)[:,i]/dr3.get(&#39;decam_mw_transmission&#39;)[:,i])</span>
<span class="n">d</span><span class="p">[</span><span class="s1">&#39;redshift&#39;</span><span class="p">]</span><span class="o">=</span> <span class="n">dp2</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;zhelio&#39;</span><span class="p">)</span>
<span class="n">d</span><span class="p">[</span><span class="s1">&#39;fwhm_or_rhalf&#39;</span><span class="p">]</span><span class="o">=</span> <span class="n">dr3</span><span class="o">.</span><span class="n">fwhm_or_rhalf</span>
<span class="n">d</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span><span class="o">=</span> <span class="n">dr3</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;type&#39;</span><span class="p">)</span>
<span class="n">dr3_deep2</span><span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
<span class="c1">###</span>
<span class="k">print</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span><span class="o">/</span><span class="n">df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">isDEV</span><span class="o">=</span> <span class="n">dr3_deep2</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;DEV&#39;</span>
<span class="n">dr3_deep2</span><span class="p">[</span><span class="s1">&#39;r-z&#39;</span><span class="p">]</span><span class="o">=</span> <span class="n">dr3_deep2</span><span class="p">[</span><span class="s1">&#39;r&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">dr3_deep2</span><span class="p">[</span><span class="s1">&#39;z&#39;</span><span class="p">]</span>
<span class="n">dr3_deep2</span><span class="p">[</span><span class="s1">&#39;g-r&#39;</span><span class="p">]</span><span class="o">=</span> <span class="n">dr3_deep2</span><span class="p">[</span><span class="s1">&#39;g&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">dr3_deep2</span><span class="p">[</span><span class="s1">&#39;r&#39;</span><span class="p">]</span>
<span class="n">dr3_deep2</span><span class="p">[</span><span class="s1">&#39;brickid&#39;</span><span class="p">]</span><span class="o">=</span> <span class="n">dr3</span><span class="o">.</span><span class="n">brickid</span>
<span class="n">dr3_deep2</span><span class="p">[</span><span class="s1">&#39;objid&#39;</span><span class="p">]</span><span class="o">=</span> <span class="n">dr3</span><span class="o">.</span><span class="n">objid</span>

</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[&#39;/Users/kaylan1/Downloads/truth/dr3.1/trimmed/decals-dr3.1-deep2-field2-trim.fits&#39;, &#39;/Users/kaylan1/Downloads/truth/dr3.1/trimmed/decals-dr3.1-deep2-field3-trim.fits&#39;, &#39;/Users/kaylan1/Downloads/truth/dr3.1/trimmed/decals-dr3.1-deep2-field4-trim.fits&#39;] [&#39;/Users/kaylan1/Downloads/truth/dr3.1/trimmed/deep2-field2-trim.fits&#39;, &#39;/Users/kaylan1/Downloads/truth/dr3.1/trimmed/deep2-field3-trim.fits&#39;, &#39;/Users/kaylan1/Downloads/truth/dr3.1/trimmed/deep2-field4-trim.fits&#39;]
Stacking /Users/kaylan1/Downloads/truth/dr3.1/trimmed/decals-dr3.1-deep2-field2-trim.fits
Converted brickname from |S8 to &lt;U8
Converted type from |S4 to &lt;U4
Stacking /Users/kaylan1/Downloads/truth/dr3.1/trimmed/decals-dr3.1-deep2-field3-trim.fits
Converted brickname from |S8 to &lt;U8
Converted type from |S4 to &lt;U4
Stacking /Users/kaylan1/Downloads/truth/dr3.1/trimmed/decals-dr3.1-deep2-field4-trim.fits
Converted brickname from |S8 to &lt;U8
Converted type from |S4 to &lt;U4
Stacking /Users/kaylan1/Downloads/truth/dr3.1/trimmed/deep2-field2-trim.fits
Converted source from |S12 to &lt;U12
Converted vis_morph from |S1 to &lt;U1
Stacking /Users/kaylan1/Downloads/truth/dr3.1/trimmed/deep2-field3-trim.fits
Converted source from |S12 to &lt;U12
Converted vis_morph from |S1 to &lt;U1
Stacking /Users/kaylan1/Downloads/truth/dr3.1/trimmed/deep2-field4-trim.fits
Converted source from |S12 to &lt;U12
Converted vis_morph from |S1 to &lt;U1
28284 28284
EXP     0.600738
SIMP    0.284612
DEV     0.085009
PSF     0.029642
Name: type, dtype: float64
</pre></div></div>
</div>
<div class="section" id="DR3-Deep2-for-outside-the-TS-box">
<h3>DR3-Deep2 for outside the TS box<a class="headerlink" href="#DR3-Deep2-for-outside-the-TS-box" title="Permalink to this headline">Â¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [880]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">def</span> <span class="nf">eboss_scatterplot</span><span class="p">(</span><span class="n">rz</span><span class="p">,</span><span class="n">gr</span><span class="p">,</span><span class="n">redshift</span><span class="p">,</span>
                      <span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="p">,</span><span class="n">pad</span><span class="o">=</span><span class="mf">0.</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Given cleaned gr,gr, and redshifts, cuts to padded SGC region</span>
<span class="sd">    and plots scatter plot colored by redshift&quot;&quot;&quot;</span>
    <span class="c1">#inSGC= ebossInSGC(df[&#39;r-z&#39;],df[&#39;g-r&#39;])</span>
    <span class="n">sgc_d</span><span class="o">=</span> <span class="n">EbossBox</span><span class="p">()</span><span class="o">.</span><span class="n">SGC</span><span class="p">(</span><span class="n">rz</span><span class="p">,</span><span class="n">pad</span><span class="o">=</span><span class="n">mag_pad</span><span class="p">)</span>
    <span class="n">inSGC</span><span class="o">=</span> <span class="p">((</span><span class="n">gr</span> <span class="o">&gt;</span> <span class="n">sgc_d</span><span class="p">[</span><span class="s1">&#39;y1&#39;</span><span class="p">])</span> <span class="o">&amp;</span>
            <span class="p">(</span><span class="n">gr</span> <span class="o">&lt;</span> <span class="n">sgc_d</span><span class="p">[</span><span class="s1">&#39;y2&#39;</span><span class="p">])</span> <span class="o">&amp;</span>
            <span class="p">(</span><span class="n">gr</span> <span class="o">&lt;</span> <span class="n">sgc_d</span><span class="p">[</span><span class="s1">&#39;y3&#39;</span><span class="p">])</span> <span class="o">&amp;</span>
            <span class="p">(</span><span class="n">gr</span> <span class="o">&lt;</span> <span class="n">sgc_d</span><span class="p">[</span><span class="s1">&#39;y4&#39;</span><span class="p">]))</span>

    <span class="kn">import</span> <span class="nn">matplotlib.colors</span> <span class="kn">as</span> <span class="nn">colors</span>
    <span class="n">vmin</span><span class="o">=</span> <span class="n">redshift</span><span class="p">[</span><span class="n">inSGC</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
    <span class="n">vmax</span><span class="o">=</span> <span class="n">redshift</span><span class="p">[</span><span class="n">inSGC</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
    <span class="n">bounds</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">vmin</span><span class="p">,</span><span class="n">vmax</span><span class="o">+</span><span class="mf">0.2</span><span class="p">,</span><span class="mf">0.2</span><span class="p">)</span>
    <span class="n">norm</span> <span class="o">=</span> <span class="n">colors</span><span class="o">.</span><span class="n">BoundaryNorm</span><span class="p">(</span><span class="n">boundaries</span><span class="o">=</span><span class="n">bounds</span><span class="p">,</span> <span class="n">ncolors</span><span class="o">=</span><span class="mi">256</span><span class="p">)</span>
    <span class="n">scat</span><span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">rz</span><span class="p">[</span><span class="n">inSGC</span><span class="p">],</span> <span class="n">gr</span><span class="p">[</span><span class="n">inSGC</span><span class="p">],</span>
                     <span class="n">c</span><span class="o">=</span><span class="n">redshift</span><span class="p">[</span><span class="n">inSGC</span><span class="p">],</span><span class="n">s</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                     <span class="n">vmin</span><span class="o">=</span><span class="n">vmin</span><span class="p">,</span><span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">,</span><span class="n">norm</span><span class="o">=</span><span class="n">norm</span><span class="p">)</span>
    <span class="n">rz_pts</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.4</span><span class="p">,</span><span class="mf">2.1</span><span class="p">,</span><span class="n">num</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
    <span class="n">sgc_d</span><span class="o">=</span> <span class="n">EbossBox</span><span class="p">()</span><span class="o">.</span><span class="n">SGC</span><span class="p">(</span><span class="n">rz_pts</span><span class="p">,</span><span class="n">pad</span><span class="o">=</span><span class="n">mag_pad</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;y1&#39;</span><span class="p">,</span><span class="s1">&#39;y2&#39;</span><span class="p">,</span><span class="s1">&#39;y3&#39;</span><span class="p">,</span><span class="s1">&#39;y4&#39;</span><span class="p">]:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">rz_pts</span><span class="p">,</span><span class="n">sgc_d</span><span class="p">[</span><span class="n">key</span><span class="p">],</span><span class="s1">&#39;k--&#39;</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="c1"># eBOSS Box</span>
    <span class="n">sgc_d</span><span class="o">=</span> <span class="n">EbossBox</span><span class="p">()</span><span class="o">.</span><span class="n">SGC</span><span class="p">(</span><span class="n">rz_pts</span><span class="p">,</span><span class="n">pad</span><span class="o">=</span><span class="mf">0.</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;y1&#39;</span><span class="p">,</span><span class="s1">&#39;y2&#39;</span><span class="p">,</span><span class="s1">&#39;y3&#39;</span><span class="p">,</span><span class="s1">&#39;y4&#39;</span><span class="p">]:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">rz_pts</span><span class="p">,</span><span class="n">sgc_d</span><span class="p">[</span><span class="n">key</span><span class="p">],</span><span class="s1">&#39;m--&#39;</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;r-z&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;g-r&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">rz_pts</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">rz_pts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mf">1.2</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">rz</span><span class="p">))</span>

    <span class="kn">from</span> <span class="nn">mpl_toolkits.axes_grid1</span> <span class="kn">import</span> <span class="n">make_axes_locatable</span>
    <span class="n">divider</span> <span class="o">=</span> <span class="n">make_axes_locatable</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>
    <span class="n">cax</span> <span class="o">=</span> <span class="n">divider</span><span class="o">.</span><span class="n">append_axes</span><span class="p">(</span><span class="s1">&#39;right&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="s1">&#39;5%&#39;</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mf">0.05</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">scat</span><span class="p">,</span> <span class="n">cax</span><span class="o">=</span><span class="n">cax</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="s1">&#39;vertical&#39;</span><span class="p">)</span>

<span class="c1"># eBOSS data</span>
<span class="n">redshift_lims</span><span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="c1"># eBOSS</span>
<span class="n">eboss_cut</span><span class="o">=</span> <span class="p">((</span><span class="o">~</span><span class="n">isNGC</span><span class="p">)</span> <span class="o">&amp;</span>
            <span class="p">(</span><span class="n">isSmall</span><span class="p">)</span> <span class="o">&amp;</span>
            <span class="p">(</span><span class="n">eboss</span><span class="p">[</span><span class="s1">&#39;redshift&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">redshift_lims</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&amp;</span>
            <span class="p">(</span><span class="n">eboss</span><span class="p">[</span><span class="s1">&#39;redshift&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">redshift_lims</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
<span class="c1"># type</span>
<span class="n">isDEV</span><span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">dr3</span><span class="o">=</span> <span class="n">dr3_deep2</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;DEV&#39;</span><span class="p">,</span>
            <span class="n">eboss</span><span class="o">=</span> <span class="n">eboss_zcut</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;DEV&#39;</span><span class="p">)</span>


<span class="n">pad</span><span class="o">=</span><span class="mf">0.2</span>
<span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span><span class="mi">14</span><span class="p">))</span>
<span class="n">eboss_scatterplot</span><span class="p">(</span><span class="n">dr3_deep2</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="o">~</span><span class="n">isDEV</span><span class="p">[</span><span class="s1">&#39;dr3&#39;</span><span class="p">],</span><span class="s1">&#39;r-z&#39;</span><span class="p">],</span><span class="n">dr3_deep2</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="o">~</span><span class="n">isDEV</span><span class="p">[</span><span class="s1">&#39;dr3&#39;</span><span class="p">],</span><span class="s1">&#39;g-r&#39;</span><span class="p">],</span>
                  <span class="n">dr3_deep2</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="o">~</span><span class="n">isDEV</span><span class="p">[</span><span class="s1">&#39;dr3&#39;</span><span class="p">],</span><span class="s1">&#39;redshift&#39;</span><span class="p">],</span>
                  <span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span><span class="n">pad</span><span class="o">=</span><span class="n">pad</span><span class="p">)</span>
<span class="n">eboss_scatterplot</span><span class="p">(</span><span class="n">eboss</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">eboss_cut</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="o">~</span><span class="n">isDEV</span><span class="p">[</span><span class="s1">&#39;eboss&#39;</span><span class="p">]),</span><span class="s1">&#39;r-z&#39;</span><span class="p">],</span>
                  <span class="n">eboss</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">eboss_cut</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="o">~</span><span class="n">isDEV</span><span class="p">[</span><span class="s1">&#39;eboss&#39;</span><span class="p">]),</span><span class="s1">&#39;g-r&#39;</span><span class="p">],</span>
                  <span class="n">eboss</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">eboss_cut</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="o">~</span><span class="n">isDEV</span><span class="p">[</span><span class="s1">&#39;eboss&#39;</span><span class="p">]),</span><span class="s1">&#39;redshift&#39;</span><span class="p">],</span>
                  <span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span><span class="n">pad</span><span class="o">=</span><span class="n">pad</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;EXP, DR3-DEEP2&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;EXP, eBOSS&#39;</span><span class="p">)</span>

<span class="c1"># DEV</span>
<span class="n">eboss_scatterplot</span><span class="p">(</span><span class="n">dr3_deep2</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">isDEV</span><span class="p">[</span><span class="s1">&#39;dr3&#39;</span><span class="p">],</span><span class="s1">&#39;r-z&#39;</span><span class="p">],</span><span class="n">dr3_deep2</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">isDEV</span><span class="p">[</span><span class="s1">&#39;dr3&#39;</span><span class="p">],</span><span class="s1">&#39;g-r&#39;</span><span class="p">],</span>
                  <span class="n">dr3_deep2</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">isDEV</span><span class="p">[</span><span class="s1">&#39;dr3&#39;</span><span class="p">],</span><span class="s1">&#39;redshift&#39;</span><span class="p">],</span>
                  <span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span><span class="n">pad</span><span class="o">=</span><span class="n">pad</span><span class="p">)</span>
<span class="n">eboss_scatterplot</span><span class="p">(</span><span class="n">eboss</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">eboss_cut</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">isDEV</span><span class="p">[</span><span class="s1">&#39;eboss&#39;</span><span class="p">]),</span><span class="s1">&#39;r-z&#39;</span><span class="p">],</span>
                  <span class="n">eboss</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">eboss_cut</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">isDEV</span><span class="p">[</span><span class="s1">&#39;eboss&#39;</span><span class="p">]),</span><span class="s1">&#39;g-r&#39;</span><span class="p">],</span>
                  <span class="n">eboss</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">eboss_cut</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">isDEV</span><span class="p">[</span><span class="s1">&#39;eboss&#39;</span><span class="p">]),</span><span class="s1">&#39;redshift&#39;</span><span class="p">],</span>
                  <span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span><span class="n">pad</span><span class="o">=</span><span class="n">pad</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;DEV, DR3-DEEP2&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;DEV, eBOSS&#39;</span><span class="p">)</span>


</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
25473
77525
927
7439
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>Out[880]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>&lt;matplotlib.text.Text at 0x1948a8630&gt;
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/nb_eBOSS_DESI_Priors_43_2.png" src="../_images/nb_eBOSS_DESI_Priors_43_2.png" />
</div>
</div>
</div>
<div class="section" id="DR3-Deep2-reproduces-SGC-data-when-cut-to-TS-box!">
<h3>DR3-Deep2 reproduces SGC data when cut to TS box!<a class="headerlink" href="#DR3-Deep2-reproduces-SGC-data-when-cut-to-TS-box!" title="Permalink to this headline">Â¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [882]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">pad</span><span class="o">=</span><span class="mf">0.</span>
<span class="n">sgc_d</span><span class="o">=</span> <span class="n">EbossBox</span><span class="p">()</span><span class="o">.</span><span class="n">SGC</span><span class="p">(</span><span class="n">dr3_deep2</span><span class="p">[</span><span class="s1">&#39;r-z&#39;</span><span class="p">],</span><span class="n">pad</span><span class="o">=</span><span class="n">pad</span><span class="p">)</span>
<span class="n">inSGC</span><span class="o">=</span> <span class="p">((</span><span class="n">dr3_deep2</span><span class="p">[</span><span class="s1">&#39;g-r&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">sgc_d</span><span class="p">[</span><span class="s1">&#39;y1&#39;</span><span class="p">])</span> <span class="o">&amp;</span>
        <span class="p">(</span><span class="n">dr3_deep2</span><span class="p">[</span><span class="s1">&#39;g-r&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">sgc_d</span><span class="p">[</span><span class="s1">&#39;y2&#39;</span><span class="p">])</span> <span class="o">&amp;</span>
        <span class="p">(</span><span class="n">dr3_deep2</span><span class="p">[</span><span class="s1">&#39;g-r&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">sgc_d</span><span class="p">[</span><span class="s1">&#39;y3&#39;</span><span class="p">])</span> <span class="o">&amp;</span>
        <span class="p">(</span><span class="n">dr3_deep2</span><span class="p">[</span><span class="s1">&#39;g-r&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">sgc_d</span><span class="p">[</span><span class="s1">&#39;y4&#39;</span><span class="p">]))</span>

<span class="n">reshift_lims</span><span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mf">2.</span><span class="p">]</span> <span class="c1"># eBOSS</span>
<span class="n">eboss_cut</span><span class="o">=</span> <span class="p">((</span><span class="o">~</span><span class="n">isNGC</span><span class="p">)</span> <span class="o">&amp;</span>
            <span class="p">(</span><span class="o">~</span><span class="n">isDEV</span><span class="p">[</span><span class="s1">&#39;eboss&#39;</span><span class="p">])</span> <span class="o">&amp;</span>
            <span class="p">(</span><span class="n">isSmall</span><span class="p">)</span> <span class="o">&amp;</span>
            <span class="p">(</span><span class="n">eboss</span><span class="p">[</span><span class="s1">&#39;redshift&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">reshift_lims</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&amp;</span>
            <span class="p">(</span><span class="n">eboss</span><span class="p">[</span><span class="s1">&#39;redshift&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">reshift_lims</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>

<span class="n">g_min</span><span class="p">,</span><span class="n">g_max</span><span class="o">=</span> <span class="n">eboss</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">eboss_cut</span><span class="p">,</span><span class="s1">&#39;g&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">eboss</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">eboss_cut</span><span class="p">,</span><span class="s1">&#39;g&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
<span class="n">dr3_cut</span><span class="o">=</span> <span class="p">((</span><span class="n">inSGC</span><span class="p">)</span> <span class="o">&amp;</span>
          <span class="p">(</span><span class="n">dr3_deep2</span><span class="p">[</span><span class="s1">&#39;g&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">g_min</span><span class="p">)</span> <span class="o">&amp;</span>
          <span class="p">(</span><span class="n">dr3_deep2</span><span class="p">[</span><span class="s1">&#39;g&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">g_max</span> <span class="o">+</span> <span class="n">pad</span><span class="p">)</span> <span class="o">&amp;</span>
          <span class="p">(</span><span class="o">~</span><span class="n">isDEV</span><span class="p">[</span><span class="s1">&#39;dr3&#39;</span><span class="p">]))</span>


<span class="n">attrs</span><span class="o">=</span> <span class="p">[</span><span class="s1">&#39;g&#39;</span><span class="p">,</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="s1">&#39;z&#39;</span><span class="p">,</span><span class="s1">&#39;redshift&#39;</span><span class="p">,</span><span class="s1">&#39;fwhm_or_rhalf&#39;</span><span class="p">]</span>
<span class="n">bins</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">g</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">21.5</span><span class="p">,</span><span class="mi">23</span><span class="p">,</span><span class="mi">20</span><span class="p">),</span>
          <span class="n">r</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">20.5</span><span class="p">,</span><span class="mi">23</span><span class="p">,</span><span class="mi">20</span><span class="p">),</span>
          <span class="n">z</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">19</span><span class="p">,</span><span class="mi">22</span><span class="p">,</span><span class="mi">20</span><span class="p">),</span>
          <span class="n">redshift</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">20</span><span class="p">),</span>
          <span class="n">fwhm_or_rhalf</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">20</span><span class="p">))</span>
<span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">9</span><span class="p">))</span>
<span class="n">i</span><span class="o">=-</span><span class="mi">1</span>
<span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
        <span class="n">i</span><span class="o">+=</span><span class="mi">1</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">attrs</span><span class="p">):</span>
            <span class="k">continue</span>
        <span class="n">_</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="n">row</span><span class="p">,</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">dr3_deep2</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">dr3_cut</span><span class="p">,</span><span class="n">attrs</span><span class="p">[</span><span class="n">i</span><span class="p">]],</span>
                           <span class="n">histtype</span><span class="o">=</span><span class="s1">&#39;step&#39;</span><span class="p">,</span><span class="n">normed</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                           <span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="n">bins</span><span class="o">=</span><span class="n">bins</span><span class="p">[</span><span class="n">attrs</span><span class="p">[</span><span class="n">i</span><span class="p">]],</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;DR3-DP2 (EXP &amp; eBOSS Box)&#39;</span><span class="p">)</span>
        <span class="n">_</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="n">row</span><span class="p">,</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">eboss</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">eboss_cut</span><span class="p">,</span><span class="n">attrs</span><span class="p">[</span><span class="n">i</span><span class="p">]],</span>
                           <span class="n">histtype</span><span class="o">=</span><span class="s1">&#39;step&#39;</span><span class="p">,</span><span class="n">normed</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                           <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="n">bins</span><span class="o">=</span><span class="n">bins</span><span class="p">[</span><span class="n">attrs</span><span class="p">[</span><span class="n">i</span><span class="p">]],</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;eBOSS (EXP &amp; SGC)&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">row</span><span class="p">,</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">attrs</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">ax</span><span class="p">[</span><span class="n">row</span><span class="p">,</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper left&#39;</span><span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="s1">&#39;DR3-DP2: Number=</span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">dr3_deep2</span><span class="p">[</span><span class="n">dr3_cut</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="k">print</span><span class="p">(</span><span class="s1">&#39;eBOSS: Number=</span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">eboss</span><span class="p">[</span><span class="n">eboss_cut</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
DR3-DP2: Number=374
eBOSS: Number=77525
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/nb_eBOSS_DESI_Priors_45_1.png" src="../_images/nb_eBOSS_DESI_Priors_45_1.png" />
</div>
</div>
</div>
<div class="section" id="Redshift-correlations-also-reproduced!">
<h3>Redshift correlations also reproduced!<a class="headerlink" href="#Redshift-correlations-also-reproduced!" title="Permalink to this headline">Â¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [883]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1">## Reduce size of eboss_zcut so can plot</span>
<span class="n">iboot</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">eboss</span><span class="p">[</span><span class="n">eboss_cut</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">size</span><span class="o">=</span><span class="mi">5000</span><span class="p">)</span>
<span class="n">kwargs</span><span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">shade</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">shade_lowest</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
<span class="c1">##</span>

<span class="n">attrs</span><span class="o">=</span> <span class="p">[</span><span class="s1">&#39;g&#39;</span><span class="p">,</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="s1">&#39;z&#39;</span><span class="p">,</span><span class="s1">&#39;fwhm_or_rhalf&#39;</span><span class="p">]</span>
<span class="n">xylims</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">g</span><span class="o">=</span><span class="p">(</span><span class="mf">21.7</span><span class="p">,</span><span class="mi">23</span><span class="p">),</span>
          <span class="n">r</span><span class="o">=</span><span class="p">(</span><span class="mf">20.9</span><span class="p">,</span><span class="mf">22.5</span><span class="p">),</span>
          <span class="n">z</span><span class="o">=</span><span class="p">(</span><span class="mf">19.8</span><span class="p">,</span><span class="mi">22</span><span class="p">),</span>
          <span class="n">redshift</span><span class="o">=</span><span class="p">(</span><span class="mf">0.6</span><span class="p">,</span><span class="mf">1.3</span><span class="p">),</span>
          <span class="n">fwhm_or_rhalf</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
<span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">12</span><span class="p">))</span>
<span class="n">i</span><span class="o">=-</span><span class="mi">1</span>
<span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
        <span class="n">i</span><span class="o">+=</span><span class="mi">1</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">attrs</span><span class="p">):</span>
            <span class="k">continue</span>
<span class="c1">#         ax[row,col].scatter(eboss_zcut.loc[~isDEV[&#39;eboss&#39;],attrs[i]],</span>
<span class="c1">#                             eboss_zcut.loc[~isDEV[&#39;eboss&#39;],&#39;redshift&#39;],</span>
<span class="c1">#                             c=&#39;b&#39;,s=10,alpha=0.5,label=&#39;EXP, eBOSS&#39;)</span>
<span class="c1">#         ax[row,col].scatter(dr3_deep2_gcut[attrs[i]],</span>
<span class="c1">#                             dr3_deep2_gcut[&#39;redshift&#39;],</span>
<span class="c1">#                             c=&#39;r&#39;,s=10,alpha=0.5,label=&#39;EXP, DR3-DP2&#39;)</span>
        <span class="n">sns</span><span class="o">.</span><span class="n">kdeplot</span><span class="p">(</span><span class="n">eboss</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">eboss_cut</span><span class="p">,</span><span class="n">attrs</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">iboot</span><span class="p">],</span>
                    <span class="n">eboss</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">eboss_cut</span><span class="p">,</span><span class="s1">&#39;redshift&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">iboot</span><span class="p">],</span>
                    <span class="n">ax</span><span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="n">row</span><span class="p">,</span><span class="n">col</span><span class="p">],</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Blues&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;EXP, eBOSS&#39;</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">sns</span><span class="o">.</span><span class="n">kdeplot</span><span class="p">(</span><span class="n">dr3_deep2</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">dr3_cut</span><span class="p">,</span><span class="n">attrs</span><span class="p">[</span><span class="n">i</span><span class="p">]],</span>
                    <span class="n">dr3_deep2</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">dr3_cut</span><span class="p">,</span><span class="s1">&#39;redshift&#39;</span><span class="p">],</span>
                    <span class="n">ax</span><span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="n">row</span><span class="p">,</span><span class="n">col</span><span class="p">],</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;Reds&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;EXP, DR3-DP2&#39;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">row</span><span class="p">,</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">xylims</span><span class="p">[</span><span class="n">attrs</span><span class="p">[</span><span class="n">i</span><span class="p">]])</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">row</span><span class="p">,</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">xylims</span><span class="p">[</span><span class="s1">&#39;redshift&#39;</span><span class="p">])</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">row</span><span class="p">,</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">attrs</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">([</span><span class="s1">&#39;Blue: EXP, eBOSS&#39;</span><span class="p">,</span>
                <span class="s1">&#39;Red: EXP, DR3-DP2&#39;</span><span class="p">],</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper right&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>Out[883]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>&lt;matplotlib.legend.Legend at 0x18651bac8&gt;
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/nb_eBOSS_DESI_Priors_47_1.png" src="../_images/nb_eBOSS_DESI_Priors_47_1.png" />
</div>
</div>
</div>
<div class="section" id="DEV-from-DR3-Deep2-span-redshifts-[0,2]-and-0.2-mag-deeper-than-SGC-g-mag,-so-will-can-model-this-even-though-just-79-data-points">
<h3>DEV from DR3-Deep2 span redshifts [0,2] and 0.2 mag deeper than SGC g-mag, so will can model this even though just 79 data points<a class="headerlink" href="#DEV-from-DR3-Deep2-span-redshifts-[0,2]-and-0.2-mag-deeper-than-SGC-g-mag,-so-will-can-model-this-even-though-just-79-data-points" title="Permalink to this headline">Â¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [884]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">pad</span><span class="o">=</span><span class="mf">0.2</span>
<span class="n">sgc_d</span><span class="o">=</span> <span class="n">EbossBox</span><span class="p">()</span><span class="o">.</span><span class="n">SGC</span><span class="p">(</span><span class="n">dr3_deep2</span><span class="p">[</span><span class="s1">&#39;r-z&#39;</span><span class="p">],</span><span class="n">pad</span><span class="o">=</span><span class="n">pad</span><span class="p">)</span>
<span class="n">inSGC</span><span class="o">=</span> <span class="p">((</span><span class="n">dr3_deep2</span><span class="p">[</span><span class="s1">&#39;g-r&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">sgc_d</span><span class="p">[</span><span class="s1">&#39;y1&#39;</span><span class="p">])</span> <span class="o">&amp;</span>
        <span class="p">(</span><span class="n">dr3_deep2</span><span class="p">[</span><span class="s1">&#39;g-r&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">sgc_d</span><span class="p">[</span><span class="s1">&#39;y2&#39;</span><span class="p">])</span> <span class="o">&amp;</span>
        <span class="p">(</span><span class="n">dr3_deep2</span><span class="p">[</span><span class="s1">&#39;g-r&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">sgc_d</span><span class="p">[</span><span class="s1">&#39;y3&#39;</span><span class="p">])</span> <span class="o">&amp;</span>
        <span class="p">(</span><span class="n">dr3_deep2</span><span class="p">[</span><span class="s1">&#39;g-r&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">sgc_d</span><span class="p">[</span><span class="s1">&#39;y4&#39;</span><span class="p">]))</span>

<span class="n">reshift_lims</span><span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mf">2.</span><span class="p">]</span> <span class="c1"># eBOSS</span>
<span class="n">eboss_cut</span><span class="o">=</span> <span class="p">((</span><span class="o">~</span><span class="n">isNGC</span><span class="p">)</span> <span class="o">&amp;</span>
            <span class="p">(</span><span class="n">isDEV</span><span class="p">[</span><span class="s1">&#39;eboss&#39;</span><span class="p">])</span> <span class="o">&amp;</span>
            <span class="p">(</span><span class="n">isSmall</span><span class="p">)</span> <span class="o">&amp;</span>
            <span class="p">(</span><span class="n">eboss</span><span class="p">[</span><span class="s1">&#39;redshift&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">reshift_lims</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&amp;</span>
            <span class="p">(</span><span class="n">eboss</span><span class="p">[</span><span class="s1">&#39;redshift&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">reshift_lims</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>

<span class="n">g_min</span><span class="p">,</span><span class="n">g_max</span><span class="o">=</span> <span class="n">eboss</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">eboss_cut</span><span class="p">,</span><span class="s1">&#39;g&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">eboss</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">eboss_cut</span><span class="p">,</span><span class="s1">&#39;g&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
<span class="n">dr3_cut</span><span class="o">=</span> <span class="p">((</span><span class="n">inSGC</span><span class="p">)</span> <span class="o">&amp;</span>
          <span class="p">(</span><span class="n">dr3_deep2</span><span class="p">[</span><span class="s1">&#39;g&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">g_min</span> <span class="o">-</span> <span class="n">pad</span><span class="p">)</span> <span class="o">&amp;</span>
          <span class="p">(</span><span class="n">dr3_deep2</span><span class="p">[</span><span class="s1">&#39;g&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">g_max</span> <span class="o">+</span> <span class="n">pad</span><span class="p">)</span> <span class="o">&amp;</span>
          <span class="p">(</span><span class="n">isDEV</span><span class="p">[</span><span class="s1">&#39;dr3&#39;</span><span class="p">]))</span>


<span class="n">attrs</span><span class="o">=</span> <span class="p">[</span><span class="s1">&#39;g&#39;</span><span class="p">,</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="s1">&#39;z&#39;</span><span class="p">,</span><span class="s1">&#39;redshift&#39;</span><span class="p">,</span><span class="s1">&#39;fwhm_or_rhalf&#39;</span><span class="p">]</span>
<span class="n">bins</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">g</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">21.5</span><span class="p">,</span><span class="mi">23</span><span class="p">,</span><span class="mi">20</span><span class="p">),</span>
          <span class="n">r</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">20.5</span><span class="p">,</span><span class="mi">23</span><span class="p">,</span><span class="mi">20</span><span class="p">),</span>
          <span class="n">z</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">19</span><span class="p">,</span><span class="mi">22</span><span class="p">,</span><span class="mi">20</span><span class="p">),</span>
          <span class="n">redshift</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">20</span><span class="p">),</span>
          <span class="n">fwhm_or_rhalf</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">20</span><span class="p">))</span>
<span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">9</span><span class="p">))</span>
<span class="n">i</span><span class="o">=-</span><span class="mi">1</span>
<span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
        <span class="n">i</span><span class="o">+=</span><span class="mi">1</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">attrs</span><span class="p">):</span>
            <span class="k">continue</span>
        <span class="n">_</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="n">row</span><span class="p">,</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">dr3_deep2</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">dr3_cut</span><span class="p">,</span><span class="n">attrs</span><span class="p">[</span><span class="n">i</span><span class="p">]],</span>
                           <span class="n">histtype</span><span class="o">=</span><span class="s1">&#39;step&#39;</span><span class="p">,</span><span class="n">normed</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                           <span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="n">bins</span><span class="o">=</span><span class="n">bins</span><span class="p">[</span><span class="n">attrs</span><span class="p">[</span><span class="n">i</span><span class="p">]],</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;DR3-DP2 (DEV &amp; eBOSS Box)&#39;</span><span class="p">)</span>
        <span class="n">_</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="n">row</span><span class="p">,</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">eboss</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">eboss_cut</span><span class="p">,</span><span class="n">attrs</span><span class="p">[</span><span class="n">i</span><span class="p">]],</span>
                           <span class="n">histtype</span><span class="o">=</span><span class="s1">&#39;step&#39;</span><span class="p">,</span><span class="n">normed</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                           <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="n">bins</span><span class="o">=</span><span class="n">bins</span><span class="p">[</span><span class="n">attrs</span><span class="p">[</span><span class="n">i</span><span class="p">]],</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;eBOSS (DEV &amp; SGC)&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">row</span><span class="p">,</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">attrs</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">ax</span><span class="p">[</span><span class="n">row</span><span class="p">,</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper left&#39;</span><span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="s1">&#39;DR3-DP2: Number DEV=</span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">dr3_deep2</span><span class="p">[</span><span class="n">dr3_cut</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="k">print</span><span class="p">(</span><span class="s1">&#39;eBOSS: Number DEV=</span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">eboss</span><span class="p">[</span><span class="n">eboss_cut</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
DR3-DP2: Number DEV=85
eBOSS: Number DEV=7439
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/nb_eBOSS_DESI_Priors_49_1.png" src="../_images/nb_eBOSS_DESI_Priors_49_1.png" />
</div>
</div>
</div>
<div class="section" id="Same-padding-(0.2-mag)-for-EXP">
<h3>Same padding (0.2 mag) for EXP<a class="headerlink" href="#Same-padding-(0.2-mag)-for-EXP" title="Permalink to this headline">Â¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [885]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">pad</span><span class="o">=</span><span class="mf">0.2</span>
<span class="n">sgc_d</span><span class="o">=</span> <span class="n">EbossBox</span><span class="p">()</span><span class="o">.</span><span class="n">SGC</span><span class="p">(</span><span class="n">dr3_deep2</span><span class="p">[</span><span class="s1">&#39;r-z&#39;</span><span class="p">],</span><span class="n">pad</span><span class="o">=</span><span class="n">pad</span><span class="p">)</span>
<span class="n">inSGC</span><span class="o">=</span> <span class="p">((</span><span class="n">dr3_deep2</span><span class="p">[</span><span class="s1">&#39;g-r&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">sgc_d</span><span class="p">[</span><span class="s1">&#39;y1&#39;</span><span class="p">])</span> <span class="o">&amp;</span>
        <span class="p">(</span><span class="n">dr3_deep2</span><span class="p">[</span><span class="s1">&#39;g-r&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">sgc_d</span><span class="p">[</span><span class="s1">&#39;y2&#39;</span><span class="p">])</span> <span class="o">&amp;</span>
        <span class="p">(</span><span class="n">dr3_deep2</span><span class="p">[</span><span class="s1">&#39;g-r&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">sgc_d</span><span class="p">[</span><span class="s1">&#39;y3&#39;</span><span class="p">])</span> <span class="o">&amp;</span>
        <span class="p">(</span><span class="n">dr3_deep2</span><span class="p">[</span><span class="s1">&#39;g-r&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">sgc_d</span><span class="p">[</span><span class="s1">&#39;y4&#39;</span><span class="p">]))</span>

<span class="n">redshift_lims</span><span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mf">2.</span><span class="p">]</span> <span class="c1"># eBOSS</span>
<span class="n">eboss_cut</span><span class="o">=</span> <span class="p">((</span><span class="o">~</span><span class="n">isNGC</span><span class="p">)</span> <span class="o">&amp;</span>
            <span class="p">(</span><span class="o">~</span><span class="n">isDEV</span><span class="p">[</span><span class="s1">&#39;eboss&#39;</span><span class="p">])</span> <span class="o">&amp;</span>
            <span class="p">(</span><span class="n">isSmall</span><span class="p">)</span> <span class="o">&amp;</span>
            <span class="p">(</span><span class="n">eboss</span><span class="p">[</span><span class="s1">&#39;redshift&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">redshift_lims</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&amp;</span>
            <span class="p">(</span><span class="n">eboss</span><span class="p">[</span><span class="s1">&#39;redshift&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">redshift_lims</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>

<span class="n">g_min</span><span class="p">,</span><span class="n">g_max</span><span class="o">=</span> <span class="n">eboss</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">eboss_cut</span><span class="p">,</span><span class="s1">&#39;g&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">eboss</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">eboss_cut</span><span class="p">,</span><span class="s1">&#39;g&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
<span class="n">dr3_cut</span><span class="o">=</span> <span class="p">((</span><span class="n">inSGC</span><span class="p">)</span> <span class="o">&amp;</span>
          <span class="p">(</span><span class="n">dr3_deep2</span><span class="p">[</span><span class="s1">&#39;g&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">g_min</span> <span class="o">-</span> <span class="n">pad</span><span class="p">)</span> <span class="o">&amp;</span>
          <span class="p">(</span><span class="n">dr3_deep2</span><span class="p">[</span><span class="s1">&#39;g&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">g_max</span> <span class="o">+</span> <span class="n">pad</span><span class="p">)</span> <span class="o">&amp;</span>
          <span class="p">(</span><span class="o">~</span><span class="n">isDEV</span><span class="p">[</span><span class="s1">&#39;dr3&#39;</span><span class="p">]))</span>


<span class="n">attrs</span><span class="o">=</span> <span class="p">[</span><span class="s1">&#39;g&#39;</span><span class="p">,</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="s1">&#39;z&#39;</span><span class="p">,</span><span class="s1">&#39;redshift&#39;</span><span class="p">,</span><span class="s1">&#39;fwhm_or_rhalf&#39;</span><span class="p">]</span>
<span class="n">bins</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">g</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">21.5</span><span class="p">,</span><span class="mi">23</span><span class="p">,</span><span class="mi">20</span><span class="p">),</span>
          <span class="n">r</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">20.5</span><span class="p">,</span><span class="mi">23</span><span class="p">,</span><span class="mi">20</span><span class="p">),</span>
          <span class="n">z</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">19</span><span class="p">,</span><span class="mi">22</span><span class="p">,</span><span class="mi">20</span><span class="p">),</span>
          <span class="n">redshift</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">20</span><span class="p">),</span>
          <span class="n">fwhm_or_rhalf</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">20</span><span class="p">))</span>
<span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">9</span><span class="p">))</span>
<span class="n">i</span><span class="o">=-</span><span class="mi">1</span>
<span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
        <span class="n">i</span><span class="o">+=</span><span class="mi">1</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">attrs</span><span class="p">):</span>
            <span class="k">continue</span>
        <span class="n">_</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="n">row</span><span class="p">,</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">dr3_deep2</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">dr3_cut</span><span class="p">,</span><span class="n">attrs</span><span class="p">[</span><span class="n">i</span><span class="p">]],</span>
                           <span class="n">histtype</span><span class="o">=</span><span class="s1">&#39;step&#39;</span><span class="p">,</span><span class="n">normed</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                           <span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="n">bins</span><span class="o">=</span><span class="n">bins</span><span class="p">[</span><span class="n">attrs</span><span class="p">[</span><span class="n">i</span><span class="p">]],</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;DR3-DP2 (EXP &amp; eBOSS Box)&#39;</span><span class="p">)</span>
        <span class="n">_</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="n">row</span><span class="p">,</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">eboss</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">eboss_cut</span><span class="p">,</span><span class="n">attrs</span><span class="p">[</span><span class="n">i</span><span class="p">]],</span>
                           <span class="n">histtype</span><span class="o">=</span><span class="s1">&#39;step&#39;</span><span class="p">,</span><span class="n">normed</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                           <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="n">bins</span><span class="o">=</span><span class="n">bins</span><span class="p">[</span><span class="n">attrs</span><span class="p">[</span><span class="n">i</span><span class="p">]],</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;eBOSS (EXP &amp; SGC)&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">row</span><span class="p">,</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">attrs</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">ax</span><span class="p">[</span><span class="n">row</span><span class="p">,</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper left&#39;</span><span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="s1">&#39;DR3-DP2: Number=</span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">dr3_deep2</span><span class="p">[</span><span class="n">dr3_cut</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="k">print</span><span class="p">(</span><span class="s1">&#39;eBOSS: Number=</span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">eboss</span><span class="p">[</span><span class="n">eboss_cut</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
DR3-DP2: Number=1066
eBOSS: Number=77525
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/nb_eBOSS_DESI_Priors_51_1.png" src="../_images/nb_eBOSS_DESI_Priors_51_1.png" />
</div>
</div>
</div>
</div>
<div class="section" id="4-Samples-=-Model-(EXP/DEV-and-SGC/DR3-Deep2)">
<h2>4 Samples = Model (EXP/DEV and SGC/DR3-Deep2)<a class="headerlink" href="#4-Samples-=-Model-(EXP/DEV-and-SGC/DR3-Deep2)" title="Permalink to this headline">Â¶</a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">print</span><span class="p">(</span><span class="s1">&#39;SGC: ~77k EXP, 7k DEV&#39;</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s1">&#39;DR3-Deep2: ~1k EXP, 100 DEV&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
SGC: ~77k EXP, 7k DEV
DR3-Deep2: ~1k EXP, 100 DEV
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [892]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Limits</span>
<span class="c1">## eBOSS</span>
<span class="n">redshift_lims</span><span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mf">2.</span><span class="p">]</span> <span class="c1"># eBOSS</span>
<span class="n">rhalf_lim_exp</span><span class="o">=</span> <span class="p">(</span><span class="mf">0.262</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">)</span> <span class="c1"># Camera, Data</span>
<span class="n">rhalf_lim_dev</span><span class="o">=</span> <span class="p">(</span><span class="mf">0.262</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="mf">5.</span><span class="p">)</span> <span class="c1"># Camera, Data</span>
<span class="n">eboss_cut_gen</span><span class="o">=</span> <span class="p">((</span><span class="o">~</span><span class="n">isNGC</span><span class="p">)</span> <span class="o">&amp;</span>
                <span class="p">(</span><span class="n">isSmall</span><span class="p">)</span> <span class="o">&amp;</span>
                <span class="p">(</span><span class="n">eboss</span><span class="p">[</span><span class="s1">&#39;redshift&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">redshift_lims</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&amp;</span>
                <span class="p">(</span><span class="n">eboss</span><span class="p">[</span><span class="s1">&#39;redshift&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">redshift_lims</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
<span class="n">eboss_cut_exp</span><span class="o">=</span> <span class="p">((</span><span class="n">eboss_cut_gen</span><span class="p">)</span> <span class="o">&amp;</span>
                <span class="p">(</span><span class="o">~</span><span class="n">isDEV</span><span class="p">[</span><span class="s1">&#39;eboss&#39;</span><span class="p">])</span> <span class="o">&amp;</span>
                <span class="p">(</span><span class="n">eboss</span><span class="p">[</span><span class="s1">&#39;fwhm_or_rhalf&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">rhalf_lim_exp</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&amp;</span>
                <span class="p">(</span><span class="n">eboss</span><span class="p">[</span><span class="s1">&#39;fwhm_or_rhalf&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">rhalf_lim_exp</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
<span class="n">eboss_cut_dev</span><span class="o">=</span> <span class="p">((</span><span class="n">eboss_cut_gen</span><span class="p">)</span> <span class="o">&amp;</span>
                <span class="p">(</span><span class="n">isDEV</span><span class="p">[</span><span class="s1">&#39;eboss&#39;</span><span class="p">])</span> <span class="o">&amp;</span>
                <span class="p">(</span><span class="n">eboss</span><span class="p">[</span><span class="s1">&#39;fwhm_or_rhalf&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">rhalf_lim_dev</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&amp;</span>
                <span class="p">(</span><span class="n">eboss</span><span class="p">[</span><span class="s1">&#39;fwhm_or_rhalf&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">rhalf_lim_dev</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>

<span class="c1">## DR3-DP2</span>
<span class="n">g_min</span><span class="o">=</span> <span class="n">eboss</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">eboss_cut_exp</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">eboss_cut_dev</span><span class="p">),</span><span class="s1">&#39;g&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
<span class="n">g_max</span><span class="o">=</span> <span class="n">eboss</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">eboss_cut_exp</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">eboss_cut_dev</span><span class="p">),</span><span class="s1">&#39;g&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
<span class="k">assert</span><span class="p">(</span><span class="n">pad</span><span class="o">==</span><span class="mf">0.2</span><span class="p">)</span>
<span class="n">dr3_cut_gen</span><span class="o">=</span> <span class="p">((</span><span class="n">inSGC</span><span class="p">)</span> <span class="o">&amp;</span>
              <span class="p">(</span><span class="n">dr3_deep2</span><span class="p">[</span><span class="s1">&#39;g&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">g_min</span> <span class="o">-</span> <span class="n">pad</span><span class="p">)</span> <span class="o">&amp;</span>
              <span class="p">(</span><span class="n">dr3_deep2</span><span class="p">[</span><span class="s1">&#39;g&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">g_max</span> <span class="o">+</span> <span class="n">pad</span><span class="p">)</span> <span class="o">&amp;</span>
              <span class="p">(</span><span class="n">dr3_deep2</span><span class="p">[</span><span class="s1">&#39;redshift&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">redshift_lims</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&amp;</span>
              <span class="p">(</span><span class="n">dr3_deep2</span><span class="p">[</span><span class="s1">&#39;redshift&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">redshift_lims</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
<span class="n">dr3_cut_exp</span><span class="o">=</span> <span class="p">((</span><span class="n">dr3_cut_gen</span><span class="p">)</span> <span class="o">&amp;</span>
              <span class="p">(</span><span class="o">~</span><span class="n">isDEV</span><span class="p">[</span><span class="s1">&#39;dr3&#39;</span><span class="p">])</span> <span class="o">&amp;</span>
              <span class="p">(</span><span class="n">dr3_deep2</span><span class="p">[</span><span class="s1">&#39;fwhm_or_rhalf&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">rhalf_lim_exp</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&amp;</span>
              <span class="p">(</span><span class="n">dr3_deep2</span><span class="p">[</span><span class="s1">&#39;fwhm_or_rhalf&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">rhalf_lim_exp</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
<span class="n">dr3_cut_dev</span><span class="o">=</span> <span class="p">((</span><span class="n">dr3_cut_gen</span><span class="p">)</span> <span class="o">&amp;</span>
              <span class="p">(</span><span class="n">isDEV</span><span class="p">[</span><span class="s1">&#39;dr3&#39;</span><span class="p">])</span> <span class="o">&amp;</span>
              <span class="p">(</span><span class="n">dr3_deep2</span><span class="p">[</span><span class="s1">&#39;fwhm_or_rhalf&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">rhalf_lim_dev</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&amp;</span>
              <span class="p">(</span><span class="n">dr3_deep2</span><span class="p">[</span><span class="s1">&#39;fwhm_or_rhalf&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">rhalf_lim_dev</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>



<span class="n">save_cols</span><span class="o">=</span> <span class="p">[</span><span class="s1">&#39;g&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="s1">&#39;z&#39;</span><span class="p">,</span><span class="s1">&#39;fwhm_or_rhalf&#39;</span><span class="p">,</span><span class="s1">&#39;redshift&#39;</span><span class="p">]</span>

<span class="c1"># DR3-DP2: in 0.2 padded eBOSS TS box</span>
<span class="c1"># unique_identfier</span>
<span class="n">dr3_deep2</span><span class="p">[</span><span class="s1">&#39;tractor_id&#39;</span><span class="p">]</span><span class="o">=</span> <span class="n">dr3_deep2</span><span class="p">[</span><span class="s1">&#39;brickid&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;-&#39;</span> <span class="o">+</span> \
                         <span class="n">dr3_deep2</span><span class="p">[</span><span class="s1">&#39;objid&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
<span class="n">fn</span><span class="o">=</span><span class="s1">&#39;eboss_elg_dr3deep2_EXP.csv&#39;</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">fn</span><span class="p">):</span>
    <span class="p">(</span><span class="n">dr3_deep2</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">dr3_cut_exp</span><span class="p">,:]</span>
              <span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;tractor_id&#39;</span><span class="p">)</span>
              <span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="n">save_cols</span><span class="p">]</span>
              <span class="c1">#.head())</span>
              <span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span> <span class="n">index_label</span><span class="o">=</span><span class="s1">&#39;tractor_id&#39;</span><span class="p">))</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;Wrote </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">fn</span><span class="p">)</span>
<span class="n">fn</span><span class="o">=</span><span class="s1">&#39;eboss_elg_dr3deep2_DEV.csv&#39;</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">fn</span><span class="p">):</span>
    <span class="p">(</span><span class="n">dr3_deep2</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">dr3_cut_dev</span><span class="p">,:]</span>
              <span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;tractor_id&#39;</span><span class="p">)</span>
              <span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="n">save_cols</span><span class="p">]</span>
              <span class="c1">#.head())</span>
              <span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span> <span class="n">index_label</span><span class="o">=</span><span class="s1">&#39;tractor_id&#39;</span><span class="p">))</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;Wrote </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">fn</span><span class="p">)</span>

<span class="c1"># eBOSS data</span>
<span class="c1"># unique_identfier</span>
<span class="n">eboss</span><span class="p">[</span><span class="s1">&#39;sdss_id&#39;</span><span class="p">]</span><span class="o">=</span> <span class="n">eboss</span><span class="p">[</span><span class="s1">&#39;plate&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;-&#39;</span> <span class="o">+</span> \
                    <span class="n">eboss</span><span class="p">[</span><span class="s1">&#39;mjd&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;-&#39;</span> <span class="o">+</span> \
                    <span class="n">eboss</span><span class="p">[</span><span class="s1">&#39;fiberid&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
<span class="c1"># Save ~ 77k eboss data cut to redshift and rhalf limits</span>
<span class="c1"># (not doing 10k random without relacement rows from the 77k eBOSS data points)</span>
<span class="n">fn</span><span class="o">=</span><span class="s1">&#39;eboss_elg_tsspectra_EXP.csv&#39;</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">fn</span><span class="p">):</span>
    <span class="p">(</span><span class="n">eboss</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">eboss_cut_exp</span><span class="p">,:]</span>
          <span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;sdss_id&#39;</span><span class="p">)</span>
          <span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="n">save_cols</span><span class="p">]</span>
          <span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span> <span class="n">index_label</span><span class="o">=</span><span class="s1">&#39;sdss_id&#39;</span><span class="p">))</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;Wrote </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">fn</span><span class="p">)</span>
<span class="n">fn</span><span class="o">=</span><span class="s1">&#39;eboss_elg_tsspectra_DEV.csv&#39;</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">fn</span><span class="p">):</span>
    <span class="p">(</span><span class="n">eboss</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">eboss_cut_dev</span><span class="p">,:]</span>
          <span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;sdss_id&#39;</span><span class="p">)</span>
          <span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="n">save_cols</span><span class="p">]</span>
          <span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span> <span class="n">index_label</span><span class="o">=</span><span class="s1">&#39;sdss_id&#39;</span><span class="p">))</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;Wrote </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">fn</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Wrote eboss_elg_dr3deep2_EXP.csv
Wrote eboss_elg_dr3deep2_DEV.csv
Wrote eboss_elg_tsspectra_EXP.csv
Wrote eboss_elg_tsspectra_DEV.csv
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [895]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">dr3dp2_exp</span><span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;eboss_elg_dr3deep2_EXP.csv&#39;</span><span class="p">)</span>
<span class="n">dr3dp2_dev</span><span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;eboss_elg_dr3deep2_DEV.csv&#39;</span><span class="p">)</span>
<span class="n">eboss_exp</span><span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;eboss_elg_tsspectra_EXP.csv&#39;</span><span class="p">)</span>
<span class="n">eboss_dev</span><span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;eboss_elg_tsspectra_DEV.csv&#39;</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">dr3dp2_exp</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">dr3dp2_dev</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="k">print</span><span class="p">(</span><span class="n">eboss_exp</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">eboss_dev</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="k">print</span><span class="p">(</span><span class="n">dr3dp2_exp</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">eboss_exp</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
1064 85
77367 7229
Index([&#39;tractor_id&#39;, &#39;g&#39;, &#39;r&#39;, &#39;z&#39;, &#39;fwhm_or_rhalf&#39;, &#39;redshift&#39;], dtype=&#39;object&#39;)
Index([&#39;sdss_id&#39;, &#39;g&#39;, &#39;r&#39;, &#39;z&#39;, &#39;fwhm_or_rhalf&#39;, &#39;redshift&#39;], dtype=&#39;object&#39;)
</pre></div></div>
</div>
<div class="section" id="Model-for-EXP">
<h3>Model for EXP<a class="headerlink" href="#Model-for-EXP" title="Permalink to this headline">Â¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [898]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">cols</span><span class="o">=</span> <span class="p">[</span><span class="s1">&#39;g&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="s1">&#39;z&#39;</span><span class="p">,</span> <span class="s1">&#39;fwhm_or_rhalf&#39;</span><span class="p">,</span><span class="s1">&#39;redshift&#39;</span><span class="p">]</span>

<span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">9</span><span class="p">))</span>
<span class="n">i</span><span class="o">=-</span><span class="mi">1</span>
<span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
        <span class="n">i</span><span class="o">+=</span><span class="mi">1</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">cols</span><span class="p">):</span>
            <span class="k">continue</span>
        <span class="n">_</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="n">row</span><span class="p">,</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">eboss_exp</span><span class="p">[</span><span class="n">cols</span><span class="p">[</span><span class="n">i</span><span class="p">]],</span>
                           <span class="n">histtype</span><span class="o">=</span><span class="s1">&#39;step&#39;</span><span class="p">,</span><span class="n">normed</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                           <span class="n">bins</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;eboss_exp&#39;</span><span class="p">)</span> <span class="c1">#bins[col[i]])</span>
        <span class="n">_</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="n">row</span><span class="p">,</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">dr3dp2_exp</span><span class="p">[</span><span class="n">cols</span><span class="p">[</span><span class="n">i</span><span class="p">]],</span>
                           <span class="n">histtype</span><span class="o">=</span><span class="s1">&#39;step&#39;</span><span class="p">,</span><span class="n">normed</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                           <span class="n">bins</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;dr3dp2_exp&#39;</span><span class="p">)</span> <span class="c1">#bins[col[i]])</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">row</span><span class="p">,</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">cols</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="c1"># ax[1,0].set_xlim(-0.2,2)</span>
<span class="c1"># ax[1,1].set_xlim(0,2)</span>

<span class="k">print</span><span class="p">(</span><span class="s1">&#39;eboss redshift min,max=&#39;</span><span class="p">,</span><span class="n">eboss_exp</span><span class="p">[</span><span class="s1">&#39;redshift&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span><span class="n">eboss_exp</span><span class="p">[</span><span class="s1">&#39;redshift&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
<span class="k">print</span><span class="p">(</span><span class="s1">&#39;dr3dp2 redshift min,max=&#39;</span><span class="p">,</span><span class="n">dr3dp2_exp</span><span class="p">[</span><span class="s1">&#39;redshift&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span><span class="n">dr3dp2_exp</span><span class="p">[</span><span class="s1">&#39;redshift&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
<span class="k">print</span><span class="p">(</span><span class="s1">&#39;eboss rhalf min,max=&#39;</span><span class="p">,</span><span class="n">eboss_exp</span><span class="p">[</span><span class="s1">&#39;fwhm_or_rhalf&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span><span class="n">eboss_exp</span><span class="p">[</span><span class="s1">&#39;fwhm_or_rhalf&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
<span class="k">print</span><span class="p">(</span><span class="s1">&#39;dr3dp2 rhalf min,max=&#39;</span><span class="p">,</span><span class="n">dr3dp2_exp</span><span class="p">[</span><span class="s1">&#39;fwhm_or_rhalf&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span><span class="n">dr3dp2_exp</span><span class="p">[</span><span class="s1">&#39;fwhm_or_rhalf&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
eboss redshift min,max= 5.69866460864e-05 1.6508961916
dr3dp2 redshift min,max= 0.000414778420236 1.93213009834
eboss rhalf min,max= 0.20438374579 2.4978723526
dr3dp2 rhalf min,max= 0.238977983594 2.45425891876
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/nb_eBOSS_DESI_Priors_57_1.png" src="../_images/nb_eBOSS_DESI_Priors_57_1.png" />
</div>
</div>
</div>
<div class="section" id="Model-for-DEV">
<h3>Model for DEV<a class="headerlink" href="#Model-for-DEV" title="Permalink to this headline">Â¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [899]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">9</span><span class="p">))</span>
<span class="n">i</span><span class="o">=-</span><span class="mi">1</span>
<span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
        <span class="n">i</span><span class="o">+=</span><span class="mi">1</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">cols</span><span class="p">):</span>
            <span class="k">continue</span>
        <span class="n">_</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="n">row</span><span class="p">,</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">eboss_dev</span><span class="p">[</span><span class="n">cols</span><span class="p">[</span><span class="n">i</span><span class="p">]],</span>
                           <span class="n">histtype</span><span class="o">=</span><span class="s1">&#39;step&#39;</span><span class="p">,</span><span class="n">normed</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                           <span class="n">bins</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;eboss_dev&#39;</span><span class="p">)</span> <span class="c1">#bins[col[i]])</span>
        <span class="n">_</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="n">row</span><span class="p">,</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">dr3dp2_dev</span><span class="p">[</span><span class="n">cols</span><span class="p">[</span><span class="n">i</span><span class="p">]],</span>
                           <span class="n">histtype</span><span class="o">=</span><span class="s1">&#39;step&#39;</span><span class="p">,</span><span class="n">normed</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                           <span class="n">bins</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;dr3dp2_dev&#39;</span><span class="p">)</span> <span class="c1">#bins[col[i]])</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">row</span><span class="p">,</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">cols</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="c1"># ax[1,0].set_xlim(-0.2,2)</span>
<span class="c1"># ax[1,1].set_xlim(0,2)</span>

<span class="k">print</span><span class="p">(</span><span class="s1">&#39;eboss redshift min,max=&#39;</span><span class="p">,</span><span class="n">eboss_dev</span><span class="p">[</span><span class="s1">&#39;redshift&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span><span class="n">eboss_dev</span><span class="p">[</span><span class="s1">&#39;redshift&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
<span class="k">print</span><span class="p">(</span><span class="s1">&#39;dr3dp2 redshift min,max=&#39;</span><span class="p">,</span><span class="n">dr3dp2_dev</span><span class="p">[</span><span class="s1">&#39;redshift&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span><span class="n">dr3dp2_dev</span><span class="p">[</span><span class="s1">&#39;redshift&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
<span class="k">print</span><span class="p">(</span><span class="s1">&#39;eboss rhalf min,max=&#39;</span><span class="p">,</span><span class="n">eboss_dev</span><span class="p">[</span><span class="s1">&#39;fwhm_or_rhalf&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span><span class="n">eboss_dev</span><span class="p">[</span><span class="s1">&#39;fwhm_or_rhalf&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
<span class="k">print</span><span class="p">(</span><span class="s1">&#39;dr3dp2 rhalf min,max=&#39;</span><span class="p">,</span><span class="n">dr3dp2_dev</span><span class="p">[</span><span class="s1">&#39;fwhm_or_rhalf&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span><span class="n">dr3dp2_dev</span><span class="p">[</span><span class="s1">&#39;fwhm_or_rhalf&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
eboss redshift min,max= 4.56776215287e-05 1.64284992218
dr3dp2 redshift min,max= 0.114836841822 1.53109943867
eboss rhalf min,max= 0.149582266808 4.99710035324
dr3dp2 rhalf min,max= 0.186883717775 4.76907682419
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/nb_eBOSS_DESI_Priors_59_1.png" src="../_images/nb_eBOSS_DESI_Priors_59_1.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [893]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">9</span><span class="p">))</span>

<span class="n">ind</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">eboss</span><span class="p">[</span><span class="n">eboss_cut_exp</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="k">for</span> <span class="n">ishuff</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">20</span><span class="p">):</span>
    <span class="n">i</span><span class="o">=-</span><span class="mi">1</span>
    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
            <span class="n">i</span><span class="o">+=</span><span class="mi">1</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">attrs</span><span class="p">):</span>
                <span class="k">continue</span>
            <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="n">ind</span><span class="p">)</span>
            <span class="n">_</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="n">row</span><span class="p">,</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">eboss</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">eboss_cut_exp</span><span class="p">,</span><span class="n">attrs</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">ind</span><span class="p">[:</span><span class="mi">10000</span><span class="p">]],</span>
                               <span class="n">histtype</span><span class="o">=</span><span class="s1">&#39;step&#39;</span><span class="p">,</span><span class="n">normed</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                               <span class="n">bins</span><span class="o">=</span><span class="n">bins</span><span class="p">[</span><span class="n">attrs</span><span class="p">[</span><span class="n">i</span><span class="p">]])</span>
            <span class="n">ax</span><span class="p">[</span><span class="n">row</span><span class="p">,</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">attrs</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/nb_eBOSS_DESI_Priors_61_0.png" src="../_images/nb_eBOSS_DESI_Priors_61_0.png" />
</div>
</div>
</div>
</div>
<div class="section" id="n(z)-for-eBOSS-ELGs">
<h2>n(z) for eBOSS ELGs<a class="headerlink" href="#n(z)-for-eBOSS-ELGs" title="Permalink to this headline">Â¶</a></h2>
<blockquote>
<div>print(â€˜Right is the n(z) Anand Raichoor provided me, Left is my</div></blockquote>
<div class="system-message">
<p class="system-message-title">System Message: WARNING/2 (<tt class="docutils">/global/cscratch1/sd/huikong/obiwan_Aug/repos_for_docker/obiwan_webpage/obiwan/doc/nb/eBOSS_DESI_Priors.ipynb</tt>, line 2919)</p>
Block quote ends without a blank line; unexpected unindent.</div>
<p>reproduction of itâ€™)</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [845]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">zbins</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mf">2.</span><span class="o">+</span><span class="mf">0.1</span><span class="p">,</span><span class="mf">0.1</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s1">&#39;zbins=&#39;</span><span class="p">,</span><span class="n">zbins</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s1">&#39;number zs from EXP: &#39;</span><span class="p">,</span><span class="n">eboss</span><span class="p">[(</span><span class="o">~</span><span class="n">isNGC</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="o">~</span><span class="n">isDEV</span><span class="p">[</span><span class="s1">&#39;eboss&#39;</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">isSmall</span><span class="p">)]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="k">print</span><span class="p">(</span><span class="s1">&#39;number zs from DEV: &#39;</span><span class="p">,</span><span class="n">eboss</span><span class="p">[(</span><span class="o">~</span><span class="n">isNGC</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">isDEV</span><span class="p">[</span><span class="s1">&#39;eboss&#39;</span><span class="p">])</span>  <span class="o">&amp;</span> <span class="p">(</span><span class="n">isSmall</span><span class="p">)]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

<span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">wt</span><span class="p">,</span><span class="n">name</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">),[</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">eboss</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">eboss</span><span class="p">[</span><span class="s1">&#39;sector_tsr&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">],</span>
                              <span class="p">[</span><span class="s1">&#39;No wt&#39;</span><span class="p">,</span> <span class="s1">&#39;tsr&#39;</span><span class="p">]):</span>
    <span class="n">nz</span><span class="o">=</span> <span class="p">(</span><span class="n">eboss</span><span class="p">[</span><span class="s1">&#39;redshift&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">wt</span><span class="p">)[(</span><span class="o">~</span><span class="n">isNGC</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">isSmall</span><span class="p">)]</span>
    <span class="n">_</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">nz</span><span class="p">,</span><span class="n">histtype</span><span class="o">=</span><span class="s1">&#39;step&#39;</span><span class="p">,</span><span class="n">normed</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
              <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="n">bins</span><span class="o">=</span><span class="n">zbins</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;n(z)&#39;</span><span class="p">)</span>
    <span class="n">_</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="o">~</span><span class="n">isNGC</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">isDEV</span><span class="p">[</span><span class="s1">&#39;eboss&#39;</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">isSmall</span><span class="p">),</span><span class="s1">&#39;redshift&#39;</span><span class="p">],</span><span class="n">histtype</span><span class="o">=</span><span class="s1">&#39;step&#39;</span><span class="p">,</span><span class="n">normed</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                <span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="n">bins</span><span class="o">=</span><span class="n">zbins</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;DEV in S&#39;</span><span class="p">)</span>
    <span class="n">_</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="o">~</span><span class="n">isNGC</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="o">~</span><span class="n">isDEV</span><span class="p">[</span><span class="s1">&#39;eboss&#39;</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">isSmall</span><span class="p">),</span><span class="s1">&#39;redshift&#39;</span><span class="p">],</span><span class="n">histtype</span><span class="o">=</span><span class="s1">&#39;step&#39;</span><span class="p">,</span><span class="n">normed</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                       <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="n">bins</span><span class="o">=</span><span class="n">zbins</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;EXP in N&amp;S&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
zbins= [ 0.   0.1  0.2  0.3  0.4  0.5  0.6  0.7  0.8  0.9  1.   1.1  1.2  1.3  1.4
  1.5  1.6  1.7  1.8  1.9  2. ]
number zs from EXP:  77525
number zs from DEV:  7439
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>Out[845]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>&lt;matplotlib.legend.Legend at 0x1222303c8&gt;
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/nb_eBOSS_DESI_Priors_63_2.png" src="../_images/nb_eBOSS_DESI_Priors_63_2.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [846]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">df_z</span><span class="p">[</span><span class="s1">&#39;wt&#39;</span><span class="p">]</span><span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="n">df_z</span><span class="p">[</span><span class="s1">&#39;sector_tsr&#39;</span><span class="p">]</span>

<span class="n">zbins</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="mf">0.05</span><span class="p">,</span><span class="mf">2.</span><span class="o">+</span><span class="mf">0.1</span><span class="p">,</span><span class="mf">0.1</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s1">&#39;zbins=&#39;</span><span class="p">,</span><span class="n">zbins</span><span class="p">)</span>
<span class="n">df_z</span><span class="p">[</span><span class="s1">&#39;bins&#39;</span><span class="p">]</span><span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">cut</span><span class="p">(</span><span class="n">df_z</span><span class="p">[</span><span class="s1">&#39;redshift&#39;</span><span class="p">],</span><span class="n">bins</span><span class="o">=</span><span class="n">zbins</span><span class="p">)</span>
<span class="n">nz</span><span class="o">=</span> <span class="n">df_z</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,[</span><span class="s1">&#39;wt&#39;</span><span class="p">,</span><span class="s1">&#39;bins&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;bins&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">)</span>

<span class="n">zbins2</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span><span class="mf">2.</span><span class="o">+</span><span class="mf">0.1</span><span class="p">,</span><span class="mf">0.1</span><span class="p">)</span>
<span class="n">df_z</span><span class="p">[</span><span class="s1">&#39;bins2&#39;</span><span class="p">]</span><span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">cut</span><span class="p">(</span><span class="n">df_z</span><span class="p">[</span><span class="s1">&#39;redshift&#39;</span><span class="p">],</span><span class="n">bins</span><span class="o">=</span><span class="n">zbins2</span><span class="p">)</span>
<span class="n">nz2</span><span class="o">=</span> <span class="n">df_z</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,[</span><span class="s1">&#39;wt&#39;</span><span class="p">,</span><span class="s1">&#39;bins2&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;bins2&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="s1">&#39;redshift bins=&#39;</span><span class="p">,</span><span class="n">zbins</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s1">&#39;bin centers=&#39;</span><span class="p">,</span> <span class="n">nz</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">categories</span><span class="o">.</span><span class="n">mid</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s1">&#39;redshift bins2=&#39;</span><span class="p">,</span><span class="n">zbins2</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s1">&#39;bin centers2=&#39;</span><span class="p">,</span> <span class="n">nz2</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">categories</span><span class="o">.</span><span class="n">mid</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="n">nz</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">categories</span><span class="o">.</span><span class="n">mid</span><span class="p">,</span><span class="n">nz</span><span class="p">[</span><span class="s1">&#39;wt&#39;</span><span class="p">],</span><span class="n">where</span><span class="o">=</span><span class="s1">&#39;mid&#39;</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;binc 0,0.1,...&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="n">nz2</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">categories</span><span class="o">.</span><span class="n">mid</span><span class="p">,</span><span class="n">nz2</span><span class="p">[</span><span class="s1">&#39;wt&#39;</span><span class="p">],</span><span class="n">where</span><span class="o">=</span><span class="s1">&#39;mid&#39;</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;binc 0.5,0.15,...&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;redshift&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Sum 1/tsr&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;SGC&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
zbins= [-0.05  0.05  0.15  0.25  0.35  0.45  0.55  0.65  0.75  0.85  0.95  1.05
  1.15  1.25  1.35  1.45  1.55  1.65  1.75  1.85  1.95  2.05]
redshift bins= [-0.05  0.05  0.15  0.25  0.35  0.45  0.55  0.65  0.75  0.85  0.95  1.05
  1.15  1.25  1.35  1.45  1.55  1.65  1.75  1.85  1.95  2.05]
bin centers= Float64Index([0.0, 0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8, 0.9, 1.0, 1.1, 1.2,
              1.3, 1.4, 1.5, 1.6, 1.7, 1.8, 1.9, 2.0],
             dtype=&#39;float64&#39;)
redshift bins2= [ 0.   0.1  0.2  0.3  0.4  0.5  0.6  0.7  0.8  0.9  1.   1.1  1.2  1.3  1.4
  1.5  1.6  1.7  1.8  1.9  2. ]
bin centers2= Float64Index([0.05, 0.15, 0.25, 0.35, 0.45, 0.55, 0.65, 0.75, 0.85, 0.95, 1.05,
              1.15, 1.25, 1.35, 1.45, 1.55, 1.65, 1.75, 1.85, 1.95],
             dtype=&#39;float64&#39;)
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>Out[846]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>&lt;matplotlib.legend.Legend at 0x12226a2b0&gt;
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/nb_eBOSS_DESI_Priors_64_2.png" src="../_images/nb_eBOSS_DESI_Priors_64_2.png" />
</div>
</div>
<div class="section" id="n(z)-weighted-by-spectroscopic-completness-(1/TSR)">
<h3>n(z) weighted by spectroscopic completness (1/TSR)<a class="headerlink" href="#n(z)-weighted-by-spectroscopic-completness-(1/TSR)" title="Permalink to this headline">Â¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [847]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">dz</span><span class="o">=</span> <span class="mf">0.02</span>
<span class="n">zbins</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mf">2.</span><span class="o">+</span><span class="n">dz</span><span class="p">,</span><span class="n">dz</span><span class="p">)</span>
<span class="n">df_z</span><span class="p">[</span><span class="s1">&#39;bins&#39;</span><span class="p">]</span><span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">cut</span><span class="p">(</span><span class="n">df_z</span><span class="p">[</span><span class="s1">&#39;redshift&#39;</span><span class="p">],</span><span class="n">bins</span><span class="o">=</span><span class="n">zbins</span><span class="p">)</span>
<span class="n">nz</span><span class="o">=</span> <span class="n">df_z</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,[</span><span class="s1">&#39;wt&#39;</span><span class="p">,</span><span class="s1">&#39;bins&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;bins&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">)</span>
<span class="n">nz</span><span class="p">[</span><span class="s1">&#39;wt&#39;</span><span class="p">]</span><span class="o">=</span> <span class="n">nz</span><span class="p">[</span><span class="s1">&#39;wt&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">nz</span><span class="p">[</span><span class="s1">&#39;wt&#39;</span><span class="p">])</span>

<span class="k">print</span><span class="p">(</span><span class="s1">&#39;redshift bins=&#39;</span><span class="p">,</span><span class="n">zbins</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s1">&#39;bin centers=&#39;</span><span class="p">,</span> <span class="n">nz</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">categories</span><span class="o">.</span><span class="n">mid</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="n">nz</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">categories</span><span class="o">.</span><span class="n">mid</span><span class="p">,</span><span class="n">nz</span><span class="p">[</span><span class="s1">&#39;wt&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">dz</span><span class="p">,</span><span class="n">where</span><span class="o">=</span><span class="s1">&#39;mid&#39;</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;redshift&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;PDF(z), Sum(1/tsr) / max() / dz&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;SGC&#39;</span><span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="s1">&#39;isNORMED?&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">nz</span><span class="p">[</span><span class="s1">&#39;wt&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">dz</span><span class="p">)</span> <span class="o">*</span> <span class="n">dz</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
redshift bins= [ 0.    0.02  0.04  0.06  0.08  0.1   0.12  0.14  0.16  0.18  0.2   0.22
  0.24  0.26  0.28  0.3   0.32  0.34  0.36  0.38  0.4   0.42  0.44  0.46
  0.48  0.5   0.52  0.54  0.56  0.58  0.6   0.62  0.64  0.66  0.68  0.7
  0.72  0.74  0.76  0.78  0.8   0.82  0.84  0.86  0.88  0.9   0.92  0.94
  0.96  0.98  1.    1.02  1.04  1.06  1.08  1.1   1.12  1.14  1.16  1.18
  1.2   1.22  1.24  1.26  1.28  1.3   1.32  1.34  1.36  1.38  1.4   1.42
  1.44  1.46  1.48  1.5   1.52  1.54  1.56  1.58  1.6   1.62  1.64  1.66
  1.68  1.7   1.72  1.74  1.76  1.78  1.8   1.82  1.84  1.86  1.88  1.9
  1.92  1.94  1.96  1.98  2.  ]
bin centers= Float64Index([0.01, 0.03, 0.05, 0.07, 0.09, 0.11, 0.13, 0.15, 0.17, 0.19, 0.21,
              0.23, 0.25, 0.27, 0.29, 0.31, 0.33, 0.35, 0.37, 0.39, 0.41, 0.43,
              0.45, 0.47, 0.49, 0.51, 0.53, 0.55, 0.57, 0.59, 0.61, 0.63, 0.65,
              0.67, 0.69, 0.71, 0.73, 0.75, 0.77, 0.79, 0.81, 0.83, 0.85, 0.87,
              0.89, 0.91, 0.93, 0.95, 0.97, 0.99, 1.01, 1.03, 1.05, 1.07, 1.09,
              1.11, 1.13, 1.15, 1.17, 1.19, 1.21, 1.23, 1.25, 1.27, 1.29, 1.31,
              1.33, 1.35, 1.37, 1.39, 1.41, 1.43, 1.45, 1.47, 1.49, 1.51, 1.53,
              1.55, 1.57, 1.59, 1.61, 1.63, 1.65, 1.67, 1.69, 1.71, 1.73, 1.75,
              1.77, 1.79, 1.81, 1.83, 1.85, 1.87, 1.89, 1.91, 1.93, 1.95, 1.97,
              1.99],
             dtype=&#39;float64&#39;)
isNORMED? 1.00000007629
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/nb_eBOSS_DESI_Priors_66_1.png" src="../_images/nb_eBOSS_DESI_Priors_66_1.png" />
</div>
</div>
</div>
<div class="section" id="Gaussian-Mixture-for-n(z)">
<h3>Gaussian Mixture for n(z)<a class="headerlink" href="#Gaussian-Mixture-for-n(z)" title="Permalink to this headline">Â¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [849]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">gmms</span><span class="p">,</span><span class="n">i_min</span><span class="p">,</span> <span class="n">n_comp</span><span class="p">,</span> <span class="n">BICs</span><span class="o">=</span> <span class="n">my_mixture</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">X</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span>
                                     <span class="n">n_comp</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">17</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">n_comp</span><span class="p">,</span><span class="n">BICs</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
3 components
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>Out[849]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>[&lt;matplotlib.lines.Line2D at 0x1222bd898&gt;]
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/nb_eBOSS_DESI_Priors_68_2.png" src="../_images/nb_eBOSS_DESI_Priors_68_2.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [850]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span><span class="mi">12</span><span class="p">))</span>

<span class="k">for</span> <span class="n">col</span><span class="p">,</span><span class="n">n</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">([</span><span class="mi">3</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">10</span><span class="p">]):</span>
    <span class="n">i</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">n_comp</span> <span class="o">==</span> <span class="n">n</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">Xpred</span><span class="p">,</span><span class="n">Ypred</span><span class="o">=</span> <span class="n">gmms</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">10000</span><span class="p">)</span>
    <span class="n">_</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="n">bins</span><span class="o">=</span><span class="n">zbins</span><span class="p">,</span><span class="n">histtype</span><span class="o">=</span><span class="s1">&#39;step&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="n">normed</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">_</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">Xpred</span><span class="p">,</span><span class="n">bins</span><span class="o">=</span><span class="n">zbins</span><span class="p">,</span><span class="n">histtype</span><span class="o">=</span><span class="s1">&#39;step&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="n">normed</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

<span class="n">ax</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;redshift&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>Out[850]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>&lt;matplotlib.text.Text at 0x1222a8d30&gt;
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/nb_eBOSS_DESI_Priors_70_1.png" src="../_images/nb_eBOSS_DESI_Priors_70_1.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [851]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">gmm</span><span class="o">=</span> <span class="n">gmms</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">n_comp</span> <span class="o">==</span> <span class="mi">10</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]]</span>
<span class="n">z_pred</span><span class="p">,</span><span class="n">pdf_pred</span><span class="o">=</span> <span class="n">gmm</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">10000</span><span class="p">)</span>
<span class="n">_</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="n">bins</span><span class="o">=</span><span class="n">zbins</span><span class="p">,</span><span class="n">histtype</span><span class="o">=</span><span class="s1">&#39;step&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="n">normed</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">_</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">Xpred</span><span class="p">,</span><span class="n">bins</span><span class="o">=</span><span class="n">zbins</span><span class="p">,</span><span class="n">histtype</span><span class="o">=</span><span class="s1">&#39;step&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="n">normed</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/nb_eBOSS_DESI_Priors_71_0.png" src="../_images/nb_eBOSS_DESI_Priors_71_0.png" />
</div>
</div>
</div>
<div class="section" id="10-components-reproduce-true-n(z)">
<h3>10 components reproduce true n(z)<a class="headerlink" href="#10-components-reproduce-true-n(z)" title="Permalink to this headline">Â¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [848]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">nz_pdf</span><span class="o">=</span> <span class="n">nz</span><span class="p">[</span><span class="s1">&#39;wt&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
<span class="n">redshifts</span><span class="o">=</span> <span class="n">nz</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">categories</span><span class="o">.</span><span class="n">mid</span><span class="o">.</span><span class="n">values</span>
<span class="n">X</span><span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">z</span><span class="p">,</span><span class="n">num</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">redshifts</span><span class="p">,</span> <span class="n">nz_pdf</span> <span class="o">*</span> <span class="mi">10000</span><span class="p">):</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">num</span><span class="p">):</span>
        <span class="k">print</span><span class="p">(</span><span class="s1">&#39;its nan&#39;</span><span class="p">,</span><span class="n">z</span><span class="p">,</span><span class="n">num</span><span class="p">)</span>
        <span class="k">continue</span>
    <span class="n">X</span> <span class="o">+=</span> <span class="p">[</span><span class="n">z</span><span class="p">]</span> <span class="o">*</span> <span class="nb">int</span><span class="p">(</span><span class="n">num</span><span class="p">)</span>
<span class="c1"># for z,num in zip(redshifts, nz_pdf * 10000):</span>
<span class="c1">#     print(z,int(num))</span>
<span class="k">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">X</span><span class="p">),</span><span class="n">X</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

<span class="n">plt</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="n">nz</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">categories</span><span class="o">.</span><span class="n">mid</span><span class="p">,</span><span class="n">nz</span><span class="p">[</span><span class="s1">&#39;wt&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">dz</span><span class="p">,</span><span class="n">where</span><span class="o">=</span><span class="s1">&#39;mid&#39;</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;exact&#39;</span><span class="p">)</span>
<span class="n">_</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="n">bins</span><span class="o">=</span><span class="n">zbins</span><span class="p">,</span> <span class="n">normed</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;approx&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;redshift&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;PDF(z), Sum(1/tsr) / max() / dz&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;SGC&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
its nan 1.67 nan
its nan 1.69 nan
its nan 1.71 nan
its nan 1.73 nan
its nan 1.75 nan
its nan 1.77 nan
its nan 1.79 nan
its nan 1.81 nan
its nan 1.83 nan
its nan 1.85 nan
its nan 1.87 nan
its nan 1.89 nan
its nan 1.91 nan
its nan 1.93 nan
its nan 1.95 nan
9958 0.01
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>Out[848]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>&lt;matplotlib.text.Text at 0x122296908&gt;
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/nb_eBOSS_DESI_Priors_73_2.png" src="../_images/nb_eBOSS_DESI_Priors_73_2.png" />
</div>
</div>
</div>
<div class="section" id="Save-GM-model">
<h3>Save GM model<a class="headerlink" href="#Save-GM-model" title="Permalink to this headline">Â¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [904]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">GaussianMixtureModel</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">gmm</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="s1">&#39;eboss_nz_elg&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Wrote eboss_nz_elg_means.txt
Wrote eboss_nz_elg_weights.txt
Wrote eboss_nz_elg_covars.txt
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [908]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Test load</span>
<span class="n">gmm</span><span class="o">=</span> <span class="n">GaussianMixtureModel</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s1">&#39;eboss_nz_elg&#39;</span><span class="p">,</span><span class="n">py</span><span class="o">=</span><span class="s1">&#39;36&#39;</span><span class="p">,</span><span class="n">is1D</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">redshifts</span><span class="o">=</span> <span class="n">gmm</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">10000</span><span class="p">)</span>
<span class="nb">len</span><span class="p">(</span><span class="n">redshifts</span><span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">distplot</span><span class="p">(</span><span class="n">redshifts</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(10, 1)
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>Out[908]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>&lt;matplotlib.axes._subplots.AxesSubplot at 0x137306c88&gt;
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/nb_eBOSS_DESI_Priors_76_2.png" src="../_images/nb_eBOSS_DESI_Priors_76_2.png" />
</div>
</div>
</div>
</div>
<div class="section" id="Draw-n(z)-&amp;-Query-KDTree-for-nearest-redshift-in-sample">
<h2>Draw n(z) &amp; Query KDTree for nearest redshift in sample<a class="headerlink" href="#Draw-n(z)-&-Query-KDTree-for-nearest-redshift-in-sample" title="Permalink to this headline">Â¶</a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [943]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">gmm</span><span class="o">=</span> <span class="n">GaussianMixtureModel</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s1">&#39;eboss_nz_elg&#39;</span><span class="p">,</span><span class="n">py</span><span class="o">=</span><span class="s1">&#39;36&#39;</span><span class="p">,</span><span class="n">is1D</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="c1"># These are in my google drive</span>
<span class="n">dr3dp2_exp</span><span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;eboss_elg_dr3deep2_EXP.csv&#39;</span><span class="p">)</span>
<span class="n">dr3dp2_dev</span><span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;eboss_elg_dr3deep2_DEV.csv&#39;</span><span class="p">)</span>
<span class="n">eboss_exp</span><span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;eboss_elg_tsspectra_EXP.csv&#39;</span><span class="p">)</span>
<span class="n">eboss_dev</span><span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;eboss_elg_tsspectra_DEV.csv&#39;</span><span class="p">)</span>

<span class="n">dr3dp2_both</span><span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">dr3dp2_exp</span><span class="p">,</span><span class="n">dr3dp2_dev</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;rows&#39;</span><span class="p">)</span>
<span class="k">assert</span><span class="p">(</span><span class="n">dr3dp2_both</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">dr3dp2_exp</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">dr3dp2_dev</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

<span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">spatial</span>
<span class="n">trees</span><span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">dr3dp2_exp</span><span class="o">=</span> <span class="n">spatial</span><span class="o">.</span><span class="n">KDTree</span><span class="p">(</span><span class="n">dr3dp2_exp</span><span class="p">[</span><span class="s1">&#39;redshift&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)),</span>
            <span class="n">dr3dp2_dev</span><span class="o">=</span> <span class="n">spatial</span><span class="o">.</span><span class="n">KDTree</span><span class="p">(</span><span class="n">dr3dp2_dev</span><span class="p">[</span><span class="s1">&#39;redshift&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)),</span>
            <span class="n">dr3dp2_both</span><span class="o">=</span> <span class="n">spatial</span><span class="o">.</span><span class="n">KDTree</span><span class="p">(</span><span class="n">dr3dp2_both</span><span class="p">[</span><span class="s1">&#39;redshift&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)),</span>
            <span class="n">eboss_exp</span><span class="o">=</span> <span class="n">spatial</span><span class="o">.</span><span class="n">KDTree</span><span class="p">(</span><span class="n">eboss_exp</span><span class="p">[</span><span class="s1">&#39;redshift&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)),</span>
            <span class="n">eboss_dev</span><span class="o">=</span> <span class="n">spatial</span><span class="o">.</span><span class="n">KDTree</span><span class="p">(</span><span class="n">eboss_dev</span><span class="p">[</span><span class="s1">&#39;redshift&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)))</span>


<span class="k">def</span> <span class="nf">inEbossBox</span><span class="p">(</span><span class="n">rz</span><span class="p">,</span><span class="n">gr</span><span class="p">,</span><span class="n">pad</span><span class="o">=</span><span class="mf">0.</span><span class="p">):</span>
    <span class="n">sgc_d</span><span class="o">=</span> <span class="n">EbossBox</span><span class="p">()</span><span class="o">.</span><span class="n">SGC</span><span class="p">(</span><span class="n">rz</span><span class="p">,</span><span class="n">pad</span><span class="o">=</span><span class="n">pad</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">((</span><span class="n">gr</span> <span class="o">&gt;</span> <span class="n">sgc_d</span><span class="p">[</span><span class="s1">&#39;y1&#39;</span><span class="p">])</span> <span class="o">&amp;</span>
            <span class="p">(</span><span class="n">gr</span> <span class="o">&lt;</span> <span class="n">sgc_d</span><span class="p">[</span><span class="s1">&#39;y2&#39;</span><span class="p">])</span> <span class="o">&amp;</span>
            <span class="p">(</span><span class="n">gr</span> <span class="o">&lt;</span> <span class="n">sgc_d</span><span class="p">[</span><span class="s1">&#39;y3&#39;</span><span class="p">])</span> <span class="o">&amp;</span>
            <span class="p">(</span><span class="n">gr</span> <span class="o">&lt;</span> <span class="n">sgc_d</span><span class="p">[</span><span class="s1">&#39;y4&#39;</span><span class="p">]))</span>

<span class="n">inBox</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">dr3dp2_exp</span><span class="o">=</span><span class="n">inEbossBox</span><span class="p">(</span><span class="n">dr3dp2_exp</span><span class="p">[</span><span class="s1">&#39;r&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">dr3dp2_exp</span><span class="p">[</span><span class="s1">&#39;z&#39;</span><span class="p">],</span>
                                 <span class="n">dr3dp2_exp</span><span class="p">[</span><span class="s1">&#39;g&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">dr3dp2_exp</span><span class="p">[</span><span class="s1">&#39;r&#39;</span><span class="p">]),</span>
           <span class="n">dr3dp2_dev</span><span class="o">=</span><span class="n">inEbossBox</span><span class="p">(</span><span class="n">dr3dp2_dev</span><span class="p">[</span><span class="s1">&#39;r&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">dr3dp2_dev</span><span class="p">[</span><span class="s1">&#39;z&#39;</span><span class="p">],</span>
                                 <span class="n">dr3dp2_dev</span><span class="p">[</span><span class="s1">&#39;g&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">dr3dp2_dev</span><span class="p">[</span><span class="s1">&#39;r&#39;</span><span class="p">]))</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [977]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">T</span><span class="o">=</span> <span class="n">fits_table</span><span class="p">()</span>
<span class="c1"># Draw z from n(z), if z not in [0,2] redraw, store z</span>
<span class="n">redshifts</span><span class="o">=</span> <span class="n">gmm</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">10000</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">outside_lims</span><span class="p">(</span><span class="n">z</span><span class="p">):</span>
    <span class="n">red_lims</span><span class="o">=</span><span class="p">[</span><span class="mf">0.</span><span class="p">,</span><span class="mf">2.</span><span class="p">]</span>
    <span class="k">return</span> <span class="p">((</span><span class="n">z</span> <span class="o">&lt;</span> <span class="n">red_lims</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">|</span>
            <span class="p">(</span><span class="n">z</span> <span class="o">&gt;</span> <span class="n">red_lims</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>

<span class="n">i</span><span class="o">=</span><span class="mi">0</span>
<span class="n">redraw</span><span class="o">=</span> <span class="n">outside_lims</span><span class="p">(</span><span class="n">redshifts</span><span class="p">)</span>
<span class="n">num</span><span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">redshifts</span><span class="p">[</span><span class="n">redraw</span><span class="p">])</span>
<span class="k">while</span> <span class="n">num</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
    <span class="n">i</span><span class="o">+=</span><span class="mi">1</span>
    <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="mi">20</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;redrawing </span><span class="si">%d</span><span class="s1"> redshifts&#39;</span> <span class="o">%</span> <span class="n">num</span><span class="p">)</span>
    <span class="n">redshifts</span><span class="p">[</span><span class="n">redraw</span><span class="p">]</span><span class="o">=</span> <span class="n">gmm</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">num</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">redraw</span><span class="o">=</span> <span class="n">outside_lims</span><span class="p">(</span><span class="n">redshifts</span><span class="p">)</span>
    <span class="n">num</span><span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">redshifts</span><span class="p">[</span><span class="n">redraw</span><span class="p">])</span>
<span class="c1"># Store</span>
<span class="n">T</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;redshift&#39;</span><span class="p">,</span><span class="n">redshifts</span><span class="p">)</span>

<span class="c1"># flip coin, 90% assign type = EXP, 10% assign type = DEV, store type</span>
<span class="n">types</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="s1">&#39;EXP&#39;</span><span class="p">]</span><span class="o">*</span><span class="mi">9</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;DEV&#39;</span><span class="p">])</span>
<span class="n">T</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;type&#39;</span><span class="p">,</span><span class="n">types</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">types</span><span class="p">),</span><span class="n">size</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">T</span><span class="p">))])</span>

<span class="c1"># in eboss TS box</span>
<span class="c1"># in dr3_deep2 exp+dev combined sample, find NN redshift</span>
<span class="k">print</span><span class="p">(</span><span class="s1">&#39;len T=&#39;</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">T</span><span class="p">))</span>
<span class="n">_</span><span class="p">,</span><span class="n">i_both</span><span class="o">=</span> <span class="n">trees</span><span class="p">[</span><span class="s1">&#39;dr3dp2_both&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">T</span><span class="o">.</span><span class="n">redshift</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
<span class="k">print</span><span class="p">(</span><span class="s1">&#39;len i_both=&#39;</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">i_both</span><span class="p">))</span>
<span class="n">inBox</span><span class="p">[</span><span class="s1">&#39;dr3dp2_both&#39;</span><span class="p">]</span><span class="o">=</span> <span class="n">inEbossBox</span><span class="p">(</span><span class="n">dr3dp2_both</span><span class="p">[</span><span class="s1">&#39;r&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i_both</span><span class="p">]</span> <span class="o">-</span> <span class="n">dr3dp2_both</span><span class="p">[</span><span class="s1">&#39;z&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i_both</span><span class="p">],</span>
                                 <span class="n">dr3dp2_both</span><span class="p">[</span><span class="s1">&#39;g&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i_both</span><span class="p">]</span> <span class="o">-</span> <span class="n">dr3dp2_both</span><span class="p">[</span><span class="s1">&#39;r&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i_both</span><span class="p">])</span>
<span class="k">print</span><span class="p">(</span><span class="s1">&#39;len inBox=&#39;</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">inBox</span><span class="p">[</span><span class="s1">&#39;dr3dp2_both&#39;</span><span class="p">]))</span>

<span class="c1"># Assign g,r,z,rhalf for NNs + unique id + NN redshift to see how close really is...</span>
<span class="n">d</span><span class="o">=</span> <span class="p">{}</span>
<span class="n">mag_shapes</span><span class="o">=</span> <span class="p">[</span><span class="s1">&#39;g&#39;</span><span class="p">,</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="s1">&#39;z&#39;</span><span class="p">,</span><span class="s1">&#39;fwhm_or_rhalf&#39;</span><span class="p">]</span>
<span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">mag_shapes</span><span class="p">:</span>
    <span class="n">d</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">T</span><span class="p">))</span><span class="o">-</span><span class="mi">1</span>
<span class="n">d</span><span class="p">[</span><span class="s1">&#39;nn_redshift&#39;</span><span class="p">]</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">T</span><span class="p">))</span><span class="o">-</span><span class="mi">1</span>
<span class="n">d</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">T</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>

<span class="c1"># inBox, use eBOSS data</span>
<span class="n">keep</span><span class="o">=</span> <span class="p">(</span><span class="n">inBox</span><span class="p">[</span><span class="s1">&#39;dr3dp2_both&#39;</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">T</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s1">&#39;EXP&#39;</span><span class="p">)</span>
<span class="n">_</span><span class="p">,</span><span class="n">i_df</span><span class="o">=</span> <span class="n">trees</span><span class="p">[</span><span class="s1">&#39;eboss_exp&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">T</span><span class="o">.</span><span class="n">redshift</span><span class="p">[</span><span class="n">keep</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
<span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">mag_shapes</span><span class="p">:</span>
    <span class="n">d</span><span class="p">[</span><span class="n">col</span><span class="p">][</span><span class="n">keep</span><span class="p">]</span><span class="o">=</span> <span class="n">eboss_exp</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i_df</span><span class="p">]</span>
<span class="n">d</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">][</span><span class="n">keep</span><span class="p">]</span><span class="o">=</span> <span class="n">eboss_exp</span><span class="p">[</span><span class="s1">&#39;sdss_id&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i_df</span><span class="p">]</span>
<span class="n">d</span><span class="p">[</span><span class="s1">&#39;nn_redshift&#39;</span><span class="p">][</span><span class="n">keep</span><span class="p">]</span><span class="o">=</span> <span class="n">eboss_exp</span><span class="p">[</span><span class="s1">&#39;redshift&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i_df</span><span class="p">]</span>

<span class="n">keep</span><span class="o">=</span> <span class="p">(</span><span class="n">inBox</span><span class="p">[</span><span class="s1">&#39;dr3dp2_both&#39;</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">T</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s1">&#39;DEV&#39;</span><span class="p">)</span>
<span class="n">_</span><span class="p">,</span><span class="n">i_df</span><span class="o">=</span> <span class="n">trees</span><span class="p">[</span><span class="s1">&#39;eboss_dev&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">T</span><span class="o">.</span><span class="n">redshift</span><span class="p">[</span><span class="n">keep</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
<span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">mag_shapes</span><span class="p">:</span>
    <span class="n">d</span><span class="p">[</span><span class="n">col</span><span class="p">][</span><span class="n">keep</span><span class="p">]</span><span class="o">=</span> <span class="n">eboss_dev</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i_df</span><span class="p">]</span>
<span class="n">d</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">][</span><span class="n">keep</span><span class="p">]</span><span class="o">=</span> <span class="n">eboss_dev</span><span class="p">[</span><span class="s1">&#39;sdss_id&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i_df</span><span class="p">]</span>
<span class="n">d</span><span class="p">[</span><span class="s1">&#39;nn_redshift&#39;</span><span class="p">][</span><span class="n">keep</span><span class="p">]</span><span class="o">=</span> <span class="n">eboss_dev</span><span class="p">[</span><span class="s1">&#39;redshift&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i_df</span><span class="p">]</span>

<span class="c1"># outBox, use DR3-Deep2 data</span>
<span class="n">keep</span><span class="o">=</span> <span class="p">(</span><span class="o">~</span><span class="n">inBox</span><span class="p">[</span><span class="s1">&#39;dr3dp2_both&#39;</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">T</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s1">&#39;EXP&#39;</span><span class="p">)</span>
<span class="n">_</span><span class="p">,</span><span class="n">i_df</span><span class="o">=</span> <span class="n">trees</span><span class="p">[</span><span class="s1">&#39;dr3dp2_exp&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">T</span><span class="o">.</span><span class="n">redshift</span><span class="p">[</span><span class="n">keep</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
<span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">mag_shapes</span><span class="p">:</span>
    <span class="n">d</span><span class="p">[</span><span class="n">col</span><span class="p">][</span><span class="n">keep</span><span class="p">]</span><span class="o">=</span> <span class="n">dr3dp2_exp</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i_df</span><span class="p">]</span>
<span class="n">d</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">][</span><span class="n">keep</span><span class="p">]</span><span class="o">=</span> <span class="n">dr3dp2_exp</span><span class="p">[</span><span class="s1">&#39;tractor_id&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i_df</span><span class="p">]</span>
<span class="n">d</span><span class="p">[</span><span class="s1">&#39;nn_redshift&#39;</span><span class="p">][</span><span class="n">keep</span><span class="p">]</span><span class="o">=</span> <span class="n">dr3dp2_exp</span><span class="p">[</span><span class="s1">&#39;redshift&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i_df</span><span class="p">]</span>

<span class="n">keep</span><span class="o">=</span> <span class="p">(</span><span class="o">~</span><span class="n">inBox</span><span class="p">[</span><span class="s1">&#39;dr3dp2_both&#39;</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">T</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s1">&#39;DEV&#39;</span><span class="p">)</span>
<span class="n">_</span><span class="p">,</span><span class="n">i_df</span><span class="o">=</span> <span class="n">trees</span><span class="p">[</span><span class="s1">&#39;dr3dp2_dev&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">T</span><span class="o">.</span><span class="n">redshift</span><span class="p">[</span><span class="n">keep</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
<span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">mag_shapes</span><span class="p">:</span>
    <span class="n">d</span><span class="p">[</span><span class="n">col</span><span class="p">][</span><span class="n">keep</span><span class="p">]</span><span class="o">=</span> <span class="n">dr3dp2_dev</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i_df</span><span class="p">]</span>
<span class="n">d</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">][</span><span class="n">keep</span><span class="p">]</span><span class="o">=</span> <span class="n">dr3dp2_dev</span><span class="p">[</span><span class="s1">&#39;tractor_id&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i_df</span><span class="p">]</span>
<span class="n">d</span><span class="p">[</span><span class="s1">&#39;nn_redshift&#39;</span><span class="p">][</span><span class="n">keep</span><span class="p">]</span><span class="o">=</span> <span class="n">dr3dp2_dev</span><span class="p">[</span><span class="s1">&#39;redshift&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i_df</span><span class="p">]</span>

<span class="c1"># Add sersic n</span>
<span class="n">d</span><span class="p">[</span><span class="s1">&#39;n&#39;</span><span class="p">]</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">T</span><span class="p">))</span> <span class="o">-</span> <span class="mi">1</span>
<span class="n">d</span><span class="p">[</span><span class="s1">&#39;n&#39;</span><span class="p">][</span><span class="n">T</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s1">&#39;EXP&#39;</span><span class="p">]</span><span class="o">=</span> <span class="mi">1</span>
<span class="n">d</span><span class="p">[</span><span class="s1">&#39;n&#39;</span><span class="p">][</span><span class="n">T</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s1">&#39;DEV&#39;</span><span class="p">]</span><span class="o">=</span> <span class="mi">4</span>

<span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">mag_shapes</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;nn_redshift&#39;</span><span class="p">,</span><span class="s1">&#39;n&#39;</span><span class="p">]:</span>
    <span class="k">assert</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">))</span>
<span class="k">assert</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">len</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">))</span>

<span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">mag_shapes</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;nn_redshift&#39;</span><span class="p">,</span><span class="s1">&#39;n&#39;</span><span class="p">]:</span>
    <span class="n">T</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">col</span><span class="p">,</span><span class="n">d</span><span class="p">[</span><span class="n">col</span><span class="p">])</span>
<span class="n">T</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">])</span>
<span class="n">T</span><span class="o">.</span><span class="n">delete_column</span><span class="p">(</span><span class="s1">&#39;type&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(10,)
len T= 10000
len i_both= 10000
len inBox= 10000
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [978]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">T</span><span class="o">.</span><span class="n">get_columns</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>Out[978]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>[&#39;redshift&#39;, &#39;g&#39;, &#39;r&#39;, &#39;z&#39;, &#39;fwhm_or_rhalf&#39;, &#39;nn_redshift&#39;, &#39;n&#39;, &#39;id&#39;]
</pre></div>
</div>
</div>
<div class="section" id="Nearest-redshifts-are-nearly-all-within-~-0.02">
<h3>Nearest redshifts are nearly all within ~ 0.02<a class="headerlink" href="#Nearest-redshifts-are-nearly-all-within-~-0.02" title="Permalink to this headline">Â¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [979]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">sns</span><span class="o">.</span><span class="n">distplot</span><span class="p">(</span><span class="n">T</span><span class="o">.</span><span class="n">nn_redshift</span> <span class="o">-</span> <span class="n">T</span><span class="o">.</span><span class="n">redshift</span><span class="p">)</span>
<span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">T</span><span class="o">.</span><span class="n">nn_redshift</span> <span class="o">-</span> <span class="n">T</span><span class="o">.</span><span class="n">redshift</span><span class="p">)</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>Out[979]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>count    1.000000e+04
mean     6.410920e-06
std      4.001393e-03
min     -6.803535e-02
25%     -1.384403e-05
50%      1.198784e-07
75%      2.445551e-05
max      7.804136e-02
dtype: float64
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/nb_eBOSS_DESI_Priors_82_1.png" src="../_images/nb_eBOSS_DESI_Priors_82_1.png" />
</div>
</div>
</div>
<div class="section" id="Correct-fraction-of-DEV-~-10%">
<h3>Correct fraction of DEV ~ 10%<a class="headerlink" href="#Correct-fraction-of-DEV-~-10%" title="Permalink to this headline">Â¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [980]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">T</span><span class="o">.</span><span class="n">n</span><span class="p">)</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>Out[980]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>1.0    8937
4.0    1063
dtype: int64
</pre></div>
</div>
</div>
</div>
<div class="section" id="EXP/DEV-have-correct-color,-shape,-size-AND-eBOSS-n(z)">
<h3>EXP/DEV have correct color, shape, size AND eBOSS n(z)<a class="headerlink" href="#EXP/DEV-have-correct-color,-shape,-size-AND-eBOSS-n(z)" title="Permalink to this headline">Â¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [983]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">cols</span><span class="o">=</span> <span class="n">mag_shapes</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;redshift&#39;</span><span class="p">]</span>

<span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">9</span><span class="p">))</span>
<span class="n">i</span><span class="o">=-</span><span class="mi">1</span>
<span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
        <span class="n">i</span><span class="o">+=</span><span class="mi">1</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">cols</span><span class="p">):</span>
            <span class="k">continue</span>
        <span class="n">_</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="n">row</span><span class="p">,</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">T</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">cols</span><span class="p">[</span><span class="n">i</span><span class="p">])[</span><span class="n">T</span><span class="o">.</span><span class="n">n</span> <span class="o">==</span> <span class="mi">1</span><span class="p">],</span>
                           <span class="n">histtype</span><span class="o">=</span><span class="s1">&#39;step&#39;</span><span class="p">,</span><span class="n">normed</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                           <span class="n">bins</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;EXP&#39;</span><span class="p">)</span>
        <span class="n">_</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="n">row</span><span class="p">,</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">T</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">cols</span><span class="p">[</span><span class="n">i</span><span class="p">])[</span><span class="n">T</span><span class="o">.</span><span class="n">n</span> <span class="o">==</span> <span class="mf">4.</span><span class="p">],</span>
                           <span class="n">histtype</span><span class="o">=</span><span class="s1">&#39;step&#39;</span><span class="p">,</span><span class="n">normed</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                           <span class="n">bins</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;DEV&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">row</span><span class="p">,</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">cols</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>Out[983]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>&lt;matplotlib.legend.Legend at 0x1aede3780&gt;
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/nb_eBOSS_DESI_Priors_86_1.png" src="../_images/nb_eBOSS_DESI_Priors_86_1.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [206]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">ccd_coadd</span><span class="o">=</span> <span class="n">fits_table</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;HOME&#39;</span><span class="p">],</span><span class="s1">&#39;Downloads&#39;</span><span class="p">,</span>
                         <span class="s1">&#39;ebossDR3&#39;</span><span class="p">,</span><span class="s1">&#39;legacysurvey-3583p000-ccds.fits&#39;</span><span class="p">))</span>
<span class="c1">#dr3_ccds= fits_table(os.path.join(os.environ[&#39;HOME&#39;],&#39;Downloads&#39;,</span>
<span class="c1">#                         &#39;ebossDR3&#39;,&#39;survey-ccds-decals.fits.gz&#39;))</span>
<span class="c1">#dr3_ccds= fits_table(os.path.join(os.environ[&#39;HOME&#39;],&#39;Downloads&#39;,</span>
<span class="c1">#                         &#39;ebossDR3&#39;,&#39;survey-ccds-extra.fits.gz&#39;))</span>
<span class="n">dr3_ccds</span><span class="o">=</span> <span class="n">fits_table</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;HOME&#39;</span><span class="p">],</span><span class="s1">&#39;Downloads&#39;</span><span class="p">,</span>
                         <span class="s1">&#39;ebossDR3&#39;</span><span class="p">,</span><span class="s1">&#39;survey-ccds-nondecals.fits.gz&#39;</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Converted object from |S37 to &lt;U37
Converted filter from |S1 to &lt;U1
Converted date_obs from |S10 to &lt;U10
Converted ut from |S15 to &lt;U15
Converted ha from |S13 to &lt;U13
Converted propid from |S10 to &lt;U10
Converted ccdname from |S3 to &lt;U3
Converted camera from |S5 to &lt;U5
Converted expid from |S12 to &lt;U12
Converted image_filename from |S61 to &lt;U61
Converted plver from |S4 to &lt;U4
Converted skyver from |S16 to &lt;U16
Converted wcsver from |S1 to &lt;U1
Converted psfver from |S12 to &lt;U12
Converted skyplver from |S4 to &lt;U4
Converted wcsplver from |S4 to &lt;U4
Converted psfplver from |S4 to &lt;U4
Converted object from |S35 to &lt;U35
Converted filter from |S1 to &lt;U1
Converted date_obs from |S10 to &lt;U10
Converted ut from |S15 to &lt;U15
Converted ha from |S13 to &lt;U13
Converted propid from |S10 to &lt;U10
Converted ccdname from |S3 to &lt;U3
Converted camera from |S5 to &lt;U5
Converted expid from |S12 to &lt;U12
Converted image_filename from |S61 to &lt;U61
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [207]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ccd_coadd</span><span class="o">.</span><span class="n">get_columns</span><span class="p">()),</span> <span class="nb">len</span><span class="p">(</span><span class="n">dr3_ccds</span><span class="o">.</span><span class="n">get_columns</span><span class="p">()))</span>
<span class="n">same_cols</span><span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">ccd_coadd</span><span class="o">.</span><span class="n">get_columns</span><span class="p">())</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">dr3_ccds</span><span class="o">.</span><span class="n">get_columns</span><span class="p">()))</span>
<span class="k">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">same_cols</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
70 52
52
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [208]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">print</span><span class="p">(</span><span class="n">ccd_coadd</span><span class="o">.</span><span class="n">ccdname</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">ccd_coadd</span><span class="o">.</span><span class="n">image_filename</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">ccd_coadd</span><span class="o">.</span><span class="n">date_obs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="k">print</span><span class="p">(</span><span class="n">dr3_ccds</span><span class="o">.</span><span class="n">ccdname</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">dr3_ccds</span><span class="o">.</span><span class="n">image_filename</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
S25 decam/CPDES82/c4d_130902_061728_ooi_g_v1.fits.fz              2013-09-02
S29 decam/NonDECaLS/CP20130129/c4d_130130_004145_ooi_r_v1.fits.fz
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [209]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">i</span><span class="o">=</span> <span class="p">((</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">dr3_ccds</span><span class="o">.</span><span class="n">ccdname</span><span class="p">)</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;S25&#39;</span><span class="p">)</span> <span class="o">&amp;</span>
    <span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">dr3_ccds</span><span class="o">.</span><span class="n">image_filename</span><span class="p">)</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">==</span> \
               <span class="s1">&#39;decam/CPDES82/c4d_130902_061728_ooi_g_v1.fits.fz&#39;</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [210]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">dr3_ccds</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>Out[210]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>&lt;tabledata object with 1 rows and 52 columns: object=DES survey hex -12-14 tiling 4     , expnum=229686, exptime=90.0, filter=g, seeing=1.72676, date_obs=2013-09-02, mjd_obs=56537.2621324, ut=06:17:28.238325, ha=00:24:18.570 , airmass=1.16, propid=2012B-0001, zpt=25.2166, avsky=124.355, arawgain=4.6, fwhm=7.44643, crpix1=11167.8, crpix2=8436.0, crval1=358.871992422, crval2=-0.635496023898, cd1_1=-7.99839e-08, cd1_2=7.28623e-05, cd2_1=-7.28599e-05, cd2_2=-8.01916e-08, ccdnum=4, ccdname=S25, ccdzpt=25.2163, ccdzpta=25.2169, ccdzptb=25.2181, ccdphoff=0.263215, ccdphrms=0.0156626, ccdskyrms=6.17303, ccdskymag=21.6912, ccdskycounts=124.622, ccdraoff=-0.0104072, ccddecoff=-0.015203, ccdtransp=1.30667, ccdnstar=72, ccdnmatch=52, ccdnmatcha=30, ccdnmatchb=22, ccdmdncol=1.63293, temp=10.1, camera=decam, expid=00229686-S25, image_hdu=4, image_filename=decam/CPDES82/c4d_130902_061728_ooi_g_v1.fits.fz             , width=2046, height=4094, ra_bore=358.871992422, dec_bore=-0.635496023898, ra=358.407016199, dec=0.104954658094&gt;
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [212]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">same_cols</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="n">ccd_coadd</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">col</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span><span class="n">dr3_ccds</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">col</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
229686 229686
124.622 124.622
-7.99839e-08 -7.99839e-08
22 22
-0.0104072 -0.0104072
decam decam
DES survey hex -12-14 tiling 4        DES survey hex -12-14 tiling 4
00229686-S25 00229686-S25
25.2166 25.2166
7.44643 7.44643
g g
2012B-0001 2012B-0001
-8.01916e-08 -8.01916e-08
25.2169 25.2169
-0.635496023898 -0.635496023898
2046 2046
S25 S25
358.407016199 358.407016199
-0.635496023898 -0.635496023898
52 52
1.16 1.16
72 72
90.0 90.0
4 4
358.871992422 358.871992422
1.63293 1.63293
0.0156626 0.0156626
21.6912 21.6912
11167.8 11167.8
10.1 10.1
6.17303 6.17303
00:24:18.570  00:24:18.570
56537.2621324 56537.2621324
8436.0 8436.0
06:17:28.238325 06:17:28.238325
25.2181 25.2181
0.263215 0.263215
4 4
4.6 4.6
decam/CPDES82/c4d_130902_061728_ooi_g_v1.fits.fz              decam/CPDES82/c4d_130902_061728_ooi_g_v1.fits.fz
30 30
4094 4094
2013-09-02 2013-09-02
-7.28599e-05 -7.28599e-05
7.28623e-05 7.28623e-05
1.72676 1.72676
124.355 124.355
1.30667 1.30667
-0.015203 -0.015203
25.2163 25.2163
0.104954658094 0.104954658094
358.871992422 358.871992422
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [213]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">allccds</span><span class="o">=</span> <span class="p">[</span><span class="n">fits_table</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;HOME&#39;</span><span class="p">],</span><span class="s1">&#39;Downloads&#39;</span><span class="p">,</span>
                            <span class="s1">&#39;ebossDR3&#39;</span><span class="p">,</span><span class="s1">&#39;survey-ccds-</span><span class="si">%s</span><span class="s1">.fits.gz&#39;</span> <span class="o">%</span> <span class="n">name</span><span class="p">))</span>
          <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;decals&#39;</span><span class="p">,</span><span class="s1">&#39;extra&#39;</span><span class="p">,</span><span class="s1">&#39;nondecals&#39;</span><span class="p">]]</span>
<span class="n">allccds</span><span class="o">=</span> <span class="n">merge_tables</span><span class="p">(</span><span class="n">allccds</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="s1">&#39;fillzero&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Converted object from |S35 to &lt;U35
Converted filter from |S1 to &lt;U1
Converted date_obs from |S10 to &lt;U10
Converted ut from |S15 to &lt;U15
Converted ha from |S13 to &lt;U13
Converted propid from |S10 to &lt;U10
Converted ccdname from |S3 to &lt;U3
Converted camera from |S5 to &lt;U5
Converted expid from |S12 to &lt;U12
Converted image_filename from |S61 to &lt;U61
Converted object from |S37 to &lt;U37
Converted filter from |S1 to &lt;U1
Converted date_obs from |S10 to &lt;U10
Converted ut from |S15 to &lt;U15
Converted ha from |S13 to &lt;U13
Converted propid from |S10 to &lt;U10
Converted ccdname from |S3 to &lt;U3
Converted camera from |S5 to &lt;U5
Converted expid from |S12 to &lt;U12
Converted image_filename from |S61 to &lt;U61
Converted object from |S35 to &lt;U35
Converted filter from |S1 to &lt;U1
Converted date_obs from |S10 to &lt;U10
Converted ut from |S15 to &lt;U15
Converted ha from |S13 to &lt;U13
Converted propid from |S10 to &lt;U10
Converted ccdname from |S3 to &lt;U3
Converted camera from |S5 to &lt;U5
Converted expid from |S12 to &lt;U12
Converted image_filename from |S61 to &lt;U61
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [230]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">expids</span><span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="o">.</span><span class="n">expid</span><span class="p">)</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">str</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
<span class="n">ccdnames</span><span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">dr3_ccds</span><span class="o">.</span><span class="n">ccdname</span><span class="p">)</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">values</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>Out[230]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>7944
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [143]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">def</span> <span class="nf">nstars</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Rongpu Zhou&#39;s model</span>
<span class="sd">    https://desi.lbl.gov/DocDB/cgi-bin/private/RetrieveFile?docid=2966</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">c1</span><span class="p">,</span> <span class="n">c2</span><span class="p">,</span> <span class="n">c3</span> <span class="o">=</span>  <span class="p">[</span><span class="mf">0.56099869</span><span class="p">,</span> <span class="mf">0.08483852</span><span class="p">,</span>  <span class="mf">0.428828</span><span class="p">]</span>
    <span class="k">return</span> <span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">b</span><span class="p">)</span><span class="o">/</span><span class="mi">180</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> \
            <span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">c1</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">l</span><span class="o">/</span><span class="mi">180</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span><span class="o">+</span><span class="n">c2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">l</span><span class="o">/</span><span class="mi">180</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">))</span><span class="o">+</span><span class="n">c3</span>


<span class="n">xv</span><span class="p">,</span> <span class="n">yv</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">180</span><span class="p">,</span><span class="mi">180</span><span class="p">,</span><span class="mi">1000</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">80</span><span class="p">,</span><span class="mi">80</span><span class="p">,</span><span class="mi">1000</span><span class="p">))</span>
<span class="n">n</span><span class="o">=</span> <span class="n">nstars</span><span class="p">(</span><span class="n">xv</span><span class="p">,</span><span class="n">yv</span><span class="p">)</span>
<span class="n">n</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>Out[143]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>(1000, 1000)
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [155]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">xv</span><span class="p">,</span> <span class="n">yv</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">20</span><span class="p">,</span><span class="mi">1000</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">30</span><span class="p">,</span><span class="mi">50</span><span class="p">,</span><span class="mi">1000</span><span class="p">))</span>
<span class="n">n</span><span class="o">=</span> <span class="n">nstars</span><span class="p">(</span><span class="n">xv</span><span class="p">,</span><span class="n">yv</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>

<span class="n">vmin</span><span class="p">,</span><span class="n">vmax</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="n">q</span><span class="o">=</span><span class="mi">5</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="n">q</span><span class="o">=</span><span class="mi">95</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">n</span><span class="p">),</span><span class="n">vmin</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">vmin</span><span class="p">),</span><span class="n">vmax</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">vmax</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
1.33336159055
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>Out[155]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>&lt;matplotlib.colorbar.Colorbar at 0x119064b70&gt;
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/nb_eBOSS_DESI_Priors_99_2.png" src="../_images/nb_eBOSS_DESI_Priors_99_2.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [149]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">vmin</span><span class="p">,</span><span class="n">vmax</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="n">q</span><span class="o">=</span><span class="mi">5</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="n">q</span><span class="o">=</span><span class="mi">95</span><span class="p">)</span>
<span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="n">vmin</span><span class="o">=</span><span class="n">vmin</span><span class="p">,</span><span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">n</span><span class="p">),</span><span class="n">vmin</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">vmin</span><span class="p">),</span><span class="n">vmax</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">vmax</span><span class="p">))</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">RuntimeError</span>                              Traceback (most recent call last)
<span class="ansi-green-fg">&lt;ipython-input-149-988af8044db7&gt;</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span><span class="ansi-blue-fg">()</span>
<span class="ansi-green-intense-fg ansi-bold">      2</span> fig<span class="ansi-blue-fg">,</span>ax<span class="ansi-blue-fg">=</span> plt<span class="ansi-blue-fg">.</span>subplots<span class="ansi-blue-fg">(</span><span class="ansi-cyan-fg">1</span><span class="ansi-blue-fg">,</span><span class="ansi-cyan-fg">2</span><span class="ansi-blue-fg">,</span>figsize<span class="ansi-blue-fg">=</span><span class="ansi-blue-fg">(</span><span class="ansi-cyan-fg">10</span><span class="ansi-blue-fg">,</span><span class="ansi-cyan-fg">5</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">      3</span> ax<span class="ansi-blue-fg">[</span><span class="ansi-cyan-fg">0</span><span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">.</span>imshow<span class="ansi-blue-fg">(</span>n<span class="ansi-blue-fg">,</span>vmin<span class="ansi-blue-fg">=</span>vmin<span class="ansi-blue-fg">,</span>vmax<span class="ansi-blue-fg">=</span>vmax<span class="ansi-blue-fg">)</span>
<span class="ansi-green-fg">----&gt; 4</span><span class="ansi-red-fg"> </span>plt<span class="ansi-blue-fg">.</span>colorbar<span class="ansi-blue-fg">(</span>ax<span class="ansi-blue-fg">=</span>ax<span class="ansi-blue-fg">[</span><span class="ansi-cyan-fg">0</span><span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">      5</span>
<span class="ansi-green-intense-fg ansi-bold">      6</span> ax<span class="ansi-blue-fg">[</span><span class="ansi-cyan-fg">1</span><span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">.</span>imshow<span class="ansi-blue-fg">(</span>np<span class="ansi-blue-fg">.</span>log10<span class="ansi-blue-fg">(</span>n<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">,</span>vmin<span class="ansi-blue-fg">=</span>np<span class="ansi-blue-fg">.</span>log10<span class="ansi-blue-fg">(</span>vmin<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">,</span>vmax<span class="ansi-blue-fg">=</span>np<span class="ansi-blue-fg">.</span>log10<span class="ansi-blue-fg">(</span>vmax<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">)</span>

<span class="ansi-green-fg">~/miniconda3/envs/mlbook/lib/python3.6/site-packages/matplotlib/pyplot.py</span> in <span class="ansi-cyan-fg">colorbar</span><span class="ansi-blue-fg">(mappable, cax, ax, **kw)</span>
<span class="ansi-green-intense-fg ansi-bold">   2252</span>         mappable <span class="ansi-blue-fg">=</span> gci<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">   2253</span>         <span class="ansi-green-fg">if</span> mappable <span class="ansi-green-fg">is</span> <span class="ansi-green-fg">None</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">-&gt; 2254</span><span class="ansi-red-fg">             raise RuntimeError(&#39;No mappable was found to use for colorbar &#39;
</span><span class="ansi-green-intense-fg ansi-bold">   2255</span>                                <span class="ansi-blue-fg">&#39;creation. First define a mappable such as &#39;</span>
<span class="ansi-green-intense-fg ansi-bold">   2256</span>                                <span class="ansi-blue-fg">&#39;an image (with imshow) or a contour set (&#39;</span>

<span class="ansi-red-fg">RuntimeError</span>: No mappable was found to use for colorbar creation. First define a mappable such as an image (with imshow) or a contour set (with contourf).
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/nb_eBOSS_DESI_Priors_100_1.png" src="../_images/nb_eBOSS_DESI_Priors_100_1.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [150]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">vmin</span><span class="p">,</span><span class="n">vmax</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="n">q</span><span class="o">=</span><span class="mi">5</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="n">q</span><span class="o">=</span><span class="mi">95</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="n">vmin</span><span class="o">=</span><span class="n">vmin</span><span class="p">,</span><span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>Out[150]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>&lt;matplotlib.colorbar.Colorbar at 0x1193c27b8&gt;
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/nb_eBOSS_DESI_Priors_101_1.png" src="../_images/nb_eBOSS_DESI_Priors_101_1.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [151]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">n</span><span class="p">),</span><span class="n">vmin</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">vmin</span><span class="p">),</span><span class="n">vmax</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">vmax</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>Out[151]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>&lt;matplotlib.colorbar.Colorbar at 0x119778320&gt;
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/nb_eBOSS_DESI_Priors_102_1.png" src="../_images/nb_eBOSS_DESI_Priors_102_1.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [146]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">sns</span><span class="o">.</span><span class="n">distplot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">n</span><span class="o">.</span><span class="n">flatten</span><span class="p">()))</span>
<span class="c1">#plt.xlim(-1,1)</span>
<span class="k">print</span><span class="p">(</span><span class="n">n</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span><span class="n">n</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
0.436909073748 1176.345523
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/nb_eBOSS_DESI_Priors_103_1.png" src="../_images/nb_eBOSS_DESI_Priors_103_1.png" />
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1">#sns.distplot(np.log10(n.flatten()))</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="DESI">
<h1>DESI<a class="headerlink" href="#DESI" title="Permalink to this headline">Â¶</a></h1>
<div class="section" id="Use-DR5-data">
<h2>Use DR5 data<a class="headerlink" href="#Use-DR5-data" title="Permalink to this headline">Â¶</a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [583]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">DATA_DIR</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;HOME&#39;</span><span class="p">],</span><span class="s1">&#39;Downloads&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;truth&#39;</span><span class="p">)</span>
<span class="n">dr5_fns</span><span class="o">=</span> <span class="n">glob</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">DATA_DIR</span><span class="p">,</span>
                <span class="s1">&#39;dr5.0/trimmed/decals-dr5.0-deep2-field*-trim.fits&#39;</span><span class="p">))</span>
<span class="n">dp2_fns</span><span class="o">=</span> <span class="n">glob</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">DATA_DIR</span><span class="p">,</span>
                <span class="s1">&#39;dr5.0/trimmed/deep2-field*-trim.fits&#39;</span><span class="p">))</span>
<span class="k">print</span><span class="p">(</span><span class="n">dr5_fns</span><span class="p">,</span><span class="n">dp2_fns</span><span class="p">)</span>

<span class="n">dr5</span><span class="o">=</span> <span class="n">stack_tables</span><span class="p">(</span><span class="n">dr5_fns</span><span class="p">)</span>
<span class="n">dp2</span><span class="o">=</span> <span class="n">stack_tables</span><span class="p">(</span><span class="n">dp2_fns</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[&#39;/Users/kaylan1/Downloads/truth/dr5.0/trimmed/decals-dr5.0-deep2-field2-trim.fits&#39;, &#39;/Users/kaylan1/Downloads/truth/dr5.0/trimmed/decals-dr5.0-deep2-field3-trim.fits&#39;, &#39;/Users/kaylan1/Downloads/truth/dr5.0/trimmed/decals-dr5.0-deep2-field4-trim.fits&#39;] [&#39;/Users/kaylan1/Downloads/truth/dr5.0/trimmed/deep2-field2-trim.fits&#39;, &#39;/Users/kaylan1/Downloads/truth/dr5.0/trimmed/deep2-field3-trim.fits&#39;, &#39;/Users/kaylan1/Downloads/truth/dr5.0/trimmed/deep2-field4-trim.fits&#39;]
Stacking /Users/kaylan1/Downloads/truth/dr5.0/trimmed/decals-dr5.0-deep2-field2-trim.fits
Converted brickname from |S8 to &lt;U8
Converted type from |S4 to &lt;U4
Converted wise_coadd_id from |S8 to &lt;U8
Stacking /Users/kaylan1/Downloads/truth/dr5.0/trimmed/decals-dr5.0-deep2-field3-trim.fits
Converted brickname from |S8 to &lt;U8
Converted type from |S4 to &lt;U4
Converted wise_coadd_id from |S8 to &lt;U8
Stacking /Users/kaylan1/Downloads/truth/dr5.0/trimmed/decals-dr5.0-deep2-field4-trim.fits
Converted brickname from |S8 to &lt;U8
Converted type from |S4 to &lt;U4
Converted wise_coadd_id from |S8 to &lt;U8
Stacking /Users/kaylan1/Downloads/truth/dr5.0/trimmed/deep2-field2-trim.fits
Converted source from |S12 to &lt;U12
Converted vis_morph from |S1 to &lt;U1
Stacking /Users/kaylan1/Downloads/truth/dr5.0/trimmed/deep2-field3-trim.fits
Converted source from |S12 to &lt;U12
Converted vis_morph from |S1 to &lt;U1
Stacking /Users/kaylan1/Downloads/truth/dr5.0/trimmed/deep2-field4-trim.fits
Converted source from |S12 to &lt;U12
Converted vis_morph from |S1 to &lt;U1
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [584]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">def</span> <span class="nf">get_xy_pad</span><span class="p">(</span><span class="n">slope</span><span class="p">,</span><span class="n">pad</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Returns dx,dy&quot;&quot;&quot;</span>
    <span class="n">theta</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">slope</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">pad</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">),</span> <span class="n">pad</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">y1_line</span><span class="p">(</span><span class="n">rz</span><span class="p">,</span><span class="n">pad</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="n">slope</span><span class="p">,</span><span class="n">yint</span><span class="o">=</span> <span class="mf">1.15</span><span class="p">,</span><span class="o">-</span><span class="mf">0.15</span>
    <span class="k">if</span> <span class="n">pad</span><span class="p">:</span>
        <span class="n">dx</span><span class="p">,</span><span class="n">dy</span><span class="o">=</span> <span class="n">get_xy_pad</span><span class="p">(</span><span class="n">slope</span><span class="p">,</span><span class="n">pad</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">slope</span><span class="o">*</span><span class="p">(</span><span class="n">rz</span><span class="o">+</span><span class="n">dx</span><span class="p">)</span> <span class="o">+</span> <span class="n">yint</span> <span class="o">+</span> <span class="n">dy</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">slope</span><span class="o">*</span><span class="n">rz</span> <span class="o">+</span> <span class="n">yint</span>

<span class="k">def</span> <span class="nf">y2_line</span><span class="p">(</span><span class="n">rz</span><span class="p">,</span><span class="n">pad</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="n">slope</span><span class="p">,</span><span class="n">yint</span><span class="o">=</span> <span class="o">-</span><span class="mf">1.2</span><span class="p">,</span><span class="mf">1.6</span>
    <span class="k">if</span> <span class="n">pad</span><span class="p">:</span>
        <span class="n">dx</span><span class="p">,</span><span class="n">dy</span><span class="o">=</span> <span class="n">get_xy_pad</span><span class="p">(</span><span class="n">slope</span><span class="p">,</span><span class="n">pad</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">slope</span><span class="o">*</span><span class="p">(</span><span class="n">rz</span><span class="o">-</span><span class="n">dx</span><span class="p">)</span> <span class="o">+</span> <span class="n">yint</span> <span class="o">+</span> <span class="n">dy</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">slope</span><span class="o">*</span><span class="n">rz</span> <span class="o">+</span> <span class="n">yint</span>

<span class="k">def</span> <span class="nf">get_ELG_box</span><span class="p">(</span><span class="n">rz</span><span class="p">,</span><span class="n">gr</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Args:</span>
<span class="sd">        rz: r-z</span>
<span class="sd">        gr: g-r</span>
<span class="sd">        pad: magnitudes of padding to expand TS box</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">x1</span><span class="p">,</span><span class="n">y1</span><span class="o">=</span> <span class="n">rz</span><span class="p">,</span><span class="n">y1_line</span><span class="p">(</span><span class="n">rz</span><span class="p">)</span>
    <span class="n">x2</span><span class="p">,</span><span class="n">y2</span><span class="o">=</span> <span class="n">rz</span><span class="p">,</span><span class="n">y2_line</span><span class="p">(</span><span class="n">rz</span><span class="p">)</span>
    <span class="n">x3</span><span class="p">,</span><span class="n">y3</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.3</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">rz</span><span class="p">)),</span><span class="n">gr</span>
    <span class="n">x4</span><span class="p">,</span><span class="n">y4</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1.6</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">rz</span><span class="p">)),</span><span class="n">gr</span>
    <span class="k">if</span> <span class="n">pad</span><span class="p">:</span>
        <span class="n">dx</span><span class="p">,</span><span class="n">dy</span><span class="o">=</span> <span class="n">get_xy_pad</span><span class="p">(</span><span class="mf">1.15</span><span class="p">,</span><span class="n">pad</span><span class="p">)</span>
        <span class="n">x1</span><span class="p">,</span><span class="n">y1</span><span class="o">=</span> <span class="n">x1</span><span class="o">-</span><span class="n">dx</span><span class="p">,</span><span class="n">y1</span><span class="o">+</span><span class="n">dy</span>
        <span class="n">dx</span><span class="p">,</span><span class="n">dy</span><span class="o">=</span> <span class="n">get_xy_pad</span><span class="p">(</span><span class="o">-</span><span class="mf">1.2</span><span class="p">,</span><span class="n">pad</span><span class="p">)</span>
        <span class="n">x2</span><span class="p">,</span><span class="n">y2</span><span class="o">=</span> <span class="n">x2</span><span class="o">+</span><span class="n">dx</span><span class="p">,</span><span class="n">y2</span><span class="o">+</span><span class="n">dy</span>
        <span class="n">x3</span> <span class="o">-=</span> <span class="n">pad</span>
        <span class="n">x4</span> <span class="o">+=</span> <span class="n">pad</span>
    <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="n">x1</span><span class="o">=</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="o">=</span><span class="n">y1</span><span class="p">,</span>
                <span class="n">x2</span><span class="o">=</span><span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="o">=</span><span class="n">y2</span><span class="p">,</span>
                <span class="n">x3</span><span class="o">=</span><span class="n">x3</span><span class="p">,</span> <span class="n">y3</span><span class="o">=</span><span class="n">y3</span><span class="p">,</span>
                <span class="n">x4</span><span class="o">=</span><span class="n">x4</span><span class="p">,</span> <span class="n">y4</span><span class="o">=</span><span class="n">y4</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [585]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">grz_gt0</span><span class="o">=</span> <span class="p">((</span><span class="n">dr5</span><span class="o">.</span><span class="n">flux_g</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span>
          <span class="p">(</span><span class="n">dr5</span><span class="o">.</span><span class="n">flux_r</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span>
          <span class="p">(</span><span class="n">dr5</span><span class="o">.</span><span class="n">flux_z</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span>
          <span class="p">(</span><span class="n">dr5</span><span class="o">.</span><span class="n">flux_ivar_g</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span>
          <span class="p">(</span><span class="n">dr5</span><span class="o">.</span><span class="n">flux_ivar_r</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span>
          <span class="p">(</span><span class="n">dr5</span><span class="o">.</span><span class="n">flux_ivar_z</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">))</span>
<span class="c1">#redshift_gt0= dp2.zhelio &gt; 0</span>
<span class="n">complDP2_buff</span><span class="o">=</span> <span class="p">((</span><span class="n">dp2</span><span class="o">.</span><span class="n">zhelio</span> <span class="o">&gt;=</span> <span class="mf">0.8</span><span class="o">-</span><span class="mf">0.2</span><span class="p">)</span> <span class="o">&amp;</span>
                <span class="p">(</span><span class="n">dp2</span><span class="o">.</span><span class="n">zhelio</span> <span class="o">&lt;=</span> <span class="mf">1.4</span><span class="o">+</span><span class="mf">0.2</span><span class="p">))</span>

<span class="n">fwhm_or_rhalf</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dr5</span><span class="p">))</span><span class="o">-</span><span class="mi">1</span> <span class="c1"># arcsec</span>
<span class="n">isPSF</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">char</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="n">dr5</span><span class="o">.</span><span class="n">type</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;PSF&#39;</span>
<span class="n">isEXP</span><span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">char</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="n">dr5</span><span class="o">.</span><span class="n">type</span><span class="p">))</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="s1">&#39;EXP&#39;</span><span class="p">,</span><span class="s1">&#39;REX&#39;</span><span class="p">])</span>
<span class="n">isSIMP</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">char</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="n">dr5</span><span class="o">.</span><span class="n">type</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;SIMP&#39;</span>
<span class="n">isDEV</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">char</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="n">dr5</span><span class="o">.</span><span class="n">type</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;DEV&#39;</span>
<span class="n">isCOMP</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">char</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="n">dr5</span><span class="o">.</span><span class="n">type</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;COMP&#39;</span>
<span class="c1"># rhalf ~ fwhm/2</span>
<span class="n">fwhm_or_rhalf</span><span class="p">[</span><span class="n">isPSF</span><span class="p">]</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">dr5</span><span class="p">[</span><span class="n">isPSF</span><span class="p">]</span><span class="o">.</span><span class="n">psfsize_g</span><span class="p">,</span>
                                        <span class="n">dr5</span><span class="p">[</span><span class="n">isPSF</span><span class="p">]</span><span class="o">.</span><span class="n">psfsize_r</span><span class="p">,</span>
                                        <span class="n">dr5</span><span class="p">[</span><span class="n">isPSF</span><span class="p">]</span><span class="o">.</span><span class="n">psfsize_z</span><span class="p">]),</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>
<span class="n">fwhm_or_rhalf</span><span class="p">[</span><span class="n">isSIMP</span><span class="p">]</span><span class="o">=</span> <span class="mf">0.5</span>
<span class="n">fwhm_or_rhalf</span><span class="p">[</span><span class="n">isEXP</span><span class="p">]</span><span class="o">=</span> <span class="n">dr5</span><span class="p">[</span><span class="n">isEXP</span><span class="p">]</span><span class="o">.</span><span class="n">shapeexp_r</span>
<span class="n">fwhm_or_rhalf</span><span class="p">[</span><span class="n">isDEV</span><span class="p">]</span><span class="o">=</span> <span class="n">dr5</span><span class="p">[</span><span class="n">isDEV</span><span class="p">]</span><span class="o">.</span><span class="n">shapedev_r</span>
<span class="n">dr5</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;fwhm_or_rhalf&#39;</span><span class="p">,</span><span class="n">fwhm_or_rhalf</span><span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dr5</span><span class="p">),</span><span class="nb">len</span><span class="p">(</span><span class="n">dp2</span><span class="p">))</span>
<span class="k">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dr5</span><span class="p">[</span><span class="n">grz_gt0</span><span class="p">]),</span> <span class="nb">len</span><span class="p">(</span><span class="n">dr5</span><span class="p">[</span><span class="n">isDEV</span><span class="p">]),</span> <span class="nb">len</span><span class="p">(</span><span class="n">dr5</span><span class="p">[</span><span class="n">isCOMP</span><span class="p">]))</span>
<span class="k">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dr5</span><span class="p">[</span><span class="n">fwhm_or_rhalf</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="p">]),</span><span class="nb">len</span><span class="p">(</span><span class="n">dr5</span><span class="p">[</span><span class="n">complDP2_buff</span><span class="p">]))</span>

<span class="k">print</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">dr5</span><span class="o">.</span><span class="n">type</span><span class="p">))</span>
<span class="k">print</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">dr5</span><span class="o">.</span><span class="n">type</span><span class="p">)</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">dr5</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
28300 28300
27707 769 78
28283 23211
{&#39;EXP&#39;, &#39;COMP&#39;, &#39;DEV&#39;, &#39;PSF&#39;, &#39;REX&#39;}
REX     0.506325
PSF     0.324912
EXP     0.138834
DEV     0.027173
COMP    0.002756
dtype: float64
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [586]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">keep</span><span class="o">=</span> <span class="p">((</span><span class="n">grz_gt0</span><span class="p">)</span> <span class="o">&amp;</span>
       <span class="p">(</span><span class="n">isCOMP</span> <span class="o">==</span> <span class="bp">False</span><span class="p">)</span> <span class="o">&amp;</span>
       <span class="p">(</span><span class="n">fwhm_or_rhalf</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="p">)</span> <span class="o">&amp;</span>
       <span class="p">(</span><span class="n">complDP2_buff</span><span class="p">))</span>
<span class="n">dr5</span><span class="o">.</span><span class="n">cut</span><span class="p">(</span><span class="n">keep</span><span class="p">)</span>
<span class="n">dp2</span><span class="o">.</span><span class="n">cut</span><span class="p">(</span><span class="n">keep</span><span class="p">)</span>
<span class="nb">len</span><span class="p">(</span><span class="n">dr5</span><span class="p">)</span>


</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>Out[586]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>22705
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [587]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">d</span><span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">b</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">],</span><span class="s1">&#39;grz&#39;</span><span class="p">):</span>
    <span class="n">d</span><span class="p">[</span><span class="n">b</span><span class="p">]</span><span class="o">=</span> <span class="n">flux2mag</span><span class="p">(</span><span class="n">dr5</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;flux_&#39;</span><span class="o">+</span><span class="n">b</span><span class="p">)</span><span class="o">/</span><span class="n">dr5</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;mw_transmission_&#39;</span><span class="o">+</span><span class="n">b</span><span class="p">))</span>
    <span class="c1">#d[b+&#39;_ivar&#39;]= flux2mag(dr5.get(&#39;decam_flux_ivar&#39;)[:,i]/dr5.get(&#39;decam_mw_transmission&#39;)[:,i])</span>
<span class="n">d</span><span class="p">[</span><span class="s1">&#39;redshift&#39;</span><span class="p">]</span><span class="o">=</span> <span class="n">dp2</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;zhelio&#39;</span><span class="p">)</span>
<span class="n">d</span><span class="p">[</span><span class="s1">&#39;fwhm_or_rhalf&#39;</span><span class="p">]</span><span class="o">=</span> <span class="n">dr5</span><span class="o">.</span><span class="n">fwhm_or_rhalf</span>
<span class="n">d</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span><span class="o">=</span> <span class="n">dr5</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;type&#39;</span><span class="p">)</span>
<span class="n">df</span><span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;g-r&#39;</span><span class="p">]</span><span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;g&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;r&#39;</span><span class="p">]</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;r-z&#39;</span><span class="p">]</span><span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;r&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;z&#39;</span><span class="p">]</span>

<span class="c1"># TS box</span>
<span class="n">pad</span><span class="o">=</span> <span class="n">get_ELG_box</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;r-z&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;g-r&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span><span class="n">pad</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">inBox</span><span class="o">=</span> <span class="p">((</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;g-r&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">y1_line</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;r-z&#39;</span><span class="p">],</span><span class="n">pad</span><span class="o">=</span><span class="mf">0.5</span><span class="p">))</span> <span class="o">&amp;</span>
        <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;g-r&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">y2_line</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;r-z&#39;</span><span class="p">],</span><span class="n">pad</span><span class="o">=</span><span class="mf">0.5</span><span class="p">))</span> <span class="o">&amp;</span>
        <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;r-z&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mf">0.3</span> <span class="o">-</span> <span class="mf">0.5</span><span class="p">)</span> <span class="o">&amp;</span>
        <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;r-z&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mf">1.6</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">))</span>

<span class="c1"># separate out DEV, important galaxy type but in minority for Deep 2</span>
<span class="n">isDEV</span><span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;DEV&#39;</span>
<span class="k">print</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">isDEV</span><span class="p">,</span><span class="s1">&#39;type&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">())</span>
<span class="k">print</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">isDEV</span> <span class="o">==</span> <span class="bp">False</span><span class="p">,</span><span class="s1">&#39;type&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
DEV    654
Name: type, dtype: int64
REX    12046
PSF     6621
EXP     3384
Name: type, dtype: int64
</pre></div></div>
</div>
</div>
<div class="section" id="in-TS-box">
<h2>in TS box<a class="headerlink" href="#in-TS-box" title="Permalink to this headline">Â¶</a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [588]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">inBox</span><span class="p">,</span><span class="s1">&#39;r-z&#39;</span><span class="p">],</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">inBox</span><span class="p">,</span><span class="s1">&#39;g-r&#39;</span><span class="p">],</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">pad</span><span class="p">[</span><span class="s1">&#39;x1&#39;</span><span class="p">],</span><span class="n">pad</span><span class="p">[</span><span class="s1">&#39;y1&#39;</span><span class="p">],</span><span class="s1">&#39;r--&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">pad</span><span class="p">[</span><span class="s1">&#39;x2&#39;</span><span class="p">],</span><span class="n">pad</span><span class="p">[</span><span class="s1">&#39;y2&#39;</span><span class="p">],</span><span class="n">c</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">pad</span><span class="p">[</span><span class="s1">&#39;x3&#39;</span><span class="p">],</span><span class="n">pad</span><span class="p">[</span><span class="s1">&#39;y3&#39;</span><span class="p">],</span><span class="n">c</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">pad</span><span class="p">[</span><span class="s1">&#39;x4&#39;</span><span class="p">],</span><span class="n">pad</span><span class="p">[</span><span class="s1">&#39;y4&#39;</span><span class="p">],</span><span class="n">c</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;r-z&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;g-r&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">-</span><span class="mf">0.3</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="o">-</span><span class="mf">0.6</span><span class="p">,</span><span class="mf">2.2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>Out[588]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>(-0.6, 2.2)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/nb_eBOSS_DESI_Priors_113_1.png" src="../_images/nb_eBOSS_DESI_Priors_113_1.png" />
</div>
</div>
<div class="section" id="Properties-!=-func(TS-box)">
<h3>Properties != func(TS box)<a class="headerlink" href="#Properties-!=-func(TS-box)" title="Permalink to this headline">Â¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [112]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">attrs</span><span class="o">=</span> <span class="p">[</span><span class="s1">&#39;redshift&#39;</span><span class="p">,</span><span class="s1">&#39;g&#39;</span><span class="p">,</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="s1">&#39;z&#39;</span><span class="p">,</span><span class="s1">&#39;fwhm_or_rhalf&#39;</span><span class="p">]</span>

<span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>
<span class="n">i</span><span class="o">=-</span><span class="mi">1</span>
<span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
        <span class="n">i</span><span class="o">+=</span><span class="mi">1</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">attrs</span><span class="p">):</span>
            <span class="k">continue</span>
        <span class="n">_</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="n">row</span><span class="p">,</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">inBox</span><span class="p">,</span><span class="n">attrs</span><span class="p">[</span><span class="n">i</span><span class="p">]],</span><span class="n">histtype</span><span class="o">=</span><span class="s1">&#39;step&#39;</span><span class="p">,</span><span class="n">normed</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                           <span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;inBox&#39;</span><span class="p">)</span>
        <span class="n">_</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="n">row</span><span class="p">,</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">attrs</span><span class="p">[</span><span class="n">i</span><span class="p">]],</span><span class="n">histtype</span><span class="o">=</span><span class="s1">&#39;step&#39;</span><span class="p">,</span><span class="n">normed</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                           <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;All&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">row</span><span class="p">,</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">attrs</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">ax</span><span class="p">[</span><span class="n">row</span><span class="p">,</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/nb_eBOSS_DESI_Priors_115_0.png" src="../_images/nb_eBOSS_DESI_Priors_115_0.png" />
</div>
</div>
</div>
<div class="section" id="DEV-are-larger-and-brighter-than-EXP">
<h3>DEV are larger and brighter than EXP<a class="headerlink" href="#DEV-are-larger-and-brighter-than-EXP" title="Permalink to this headline">Â¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [113]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">attrs</span><span class="o">=</span> <span class="p">[</span><span class="s1">&#39;redshift&#39;</span><span class="p">,</span><span class="s1">&#39;g&#39;</span><span class="p">,</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="s1">&#39;z&#39;</span><span class="p">,</span><span class="s1">&#39;fwhm_or_rhalf&#39;</span><span class="p">]</span>

<span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>
<span class="n">i</span><span class="o">=-</span><span class="mi">1</span>
<span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
        <span class="n">i</span><span class="o">+=</span><span class="mi">1</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">attrs</span><span class="p">):</span>
            <span class="k">continue</span>
        <span class="n">_</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="n">row</span><span class="p">,</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">inBox</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">isDEV</span><span class="p">),</span><span class="n">attrs</span><span class="p">[</span><span class="n">i</span><span class="p">]],</span><span class="n">histtype</span><span class="o">=</span><span class="s1">&#39;step&#39;</span><span class="p">,</span><span class="n">normed</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                           <span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;inBox, isDEV&#39;</span><span class="p">)</span>
        <span class="n">_</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="n">row</span><span class="p">,</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">inBox</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="o">~</span><span class="n">isDEV</span><span class="p">),</span><span class="n">attrs</span><span class="p">[</span><span class="n">i</span><span class="p">]],</span><span class="n">histtype</span><span class="o">=</span><span class="s1">&#39;step&#39;</span><span class="p">,</span><span class="n">normed</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                           <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;inBox, notDEV&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">row</span><span class="p">,</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">attrs</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">ax</span><span class="p">[</span><span class="n">row</span><span class="p">,</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/nb_eBOSS_DESI_Priors_117_0.png" src="../_images/nb_eBOSS_DESI_Priors_117_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [160]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">fit_cols</span><span class="o">=</span> <span class="p">[</span><span class="s1">&#39;fwhm_or_rhalf&#39;</span><span class="p">,</span> <span class="s1">&#39;g-r&#39;</span><span class="p">,</span> <span class="s1">&#39;r-z&#39;</span><span class="p">,</span><span class="s1">&#39;z&#39;</span><span class="p">,</span><span class="s1">&#39;redshift&#39;</span><span class="p">]</span>
<span class="n">df_dev</span><span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">inBox</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">isDEV</span><span class="p">),</span><span class="n">fit_cols</span><span class="p">]</span>
<span class="n">df_notdev</span><span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">inBox</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="o">~</span><span class="n">isDEV</span><span class="p">),</span><span class="n">fit_cols</span><span class="p">]</span>
<span class="c1"># Carry on with NOT DEV</span>
<span class="n">df_notdev</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">bins</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>Out[160]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>array([[&lt;matplotlib.axes._subplots.AxesSubplot object at 0x128365a58&gt;,
        &lt;matplotlib.axes._subplots.AxesSubplot object at 0x1240ee898&gt;],
       [&lt;matplotlib.axes._subplots.AxesSubplot object at 0x123cf5eb8&gt;,
        &lt;matplotlib.axes._subplots.AxesSubplot object at 0x11d172780&gt;],
       [&lt;matplotlib.axes._subplots.AxesSubplot object at 0x126857f28&gt;,
        &lt;matplotlib.axes._subplots.AxesSubplot object at 0x126857f60&gt;]], dtype=object)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/nb_eBOSS_DESI_Priors_118_1.png" src="../_images/nb_eBOSS_DESI_Priors_118_1.png" />
</div>
</div>
</div>
</div>
<div class="section" id="Model-as-Gaussian-Mixture">
<h2>Model as Gaussian Mixture<a class="headerlink" href="#Model-as-Gaussian-Mixture" title="Permalink to this headline">Â¶</a></h2>
<div class="section" id="Fit-model">
<h3>Fit model<a class="headerlink" href="#Fit-model" title="Permalink to this headline">Â¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [115]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">X</span><span class="o">=</span> <span class="n">df_notdev</span><span class="o">.</span><span class="n">values</span>
<span class="n">gmms</span><span class="p">,</span><span class="n">i_min</span><span class="p">,</span> <span class="n">n_comp</span><span class="p">,</span> <span class="n">BICs</span><span class="o">=</span> <span class="n">my_mixture</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">n_comp</span><span class="p">,</span><span class="n">BICs</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
14 components
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>Out[115]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>[&lt;matplotlib.lines.Line2D at 0x120a4b550&gt;]
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/nb_eBOSS_DESI_Priors_121_2.png" src="../_images/nb_eBOSS_DESI_Priors_121_2.png" />
</div>
</div>
</div>
<div class="section" id="Minimum-components-for-good-model-is-8-(don't-want-to-overfit)">
<h3>Minimum components for good model is 8 (donâ€™t want to overfit)<a class="headerlink" href="#Minimum-components-for-good-model-is-8-(don't-want-to-overfit)" title="Permalink to this headline">Â¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [120]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">13</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>

<span class="k">for</span> <span class="n">row</span><span class="p">,</span><span class="n">n</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">([</span><span class="mi">8</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">12</span><span class="p">]):</span>
    <span class="n">i</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">n_comp</span> <span class="o">==</span> <span class="n">n</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">Xpred</span><span class="p">,</span><span class="n">Ypred</span><span class="o">=</span> <span class="n">gmms</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">10000</span><span class="p">)</span>
    <span class="n">_</span><span class="p">,</span><span class="n">bins</span><span class="p">,</span><span class="n">_</span><span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="n">row</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">df_notdev</span><span class="p">[</span><span class="s1">&#39;redshift&#39;</span><span class="p">],</span><span class="n">bins</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span><span class="n">histtype</span><span class="o">=</span><span class="s1">&#39;step&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="n">normed</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">_</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="n">row</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">Xpred</span><span class="p">[:,</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="n">bins</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span><span class="n">histtype</span><span class="o">=</span><span class="s1">&#39;step&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="n">normed</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="c1">#ax[1].set_xlabel(&#39;redshift&#39;)</span>

    <span class="n">_</span><span class="p">,</span><span class="n">bins</span><span class="p">,</span><span class="n">_</span><span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="n">row</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">df_notdev</span><span class="p">[</span><span class="s1">&#39;fwhm_or_rhalf&#39;</span><span class="p">],</span><span class="n">bins</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span><span class="n">histtype</span><span class="o">=</span><span class="s1">&#39;step&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="n">normed</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">_</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="n">row</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">Xpred</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span><span class="n">bins</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span><span class="n">histtype</span><span class="o">=</span><span class="s1">&#39;step&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="n">normed</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="c1">#ax[2].set_xlabel(&#39;fwhm_or_rhalf&#39;)</span>

<span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;redshift&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;fwhm_or_rhalf&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>Out[120]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>&lt;matplotlib.text.Text at 0x121b18710&gt;
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/nb_eBOSS_DESI_Priors_123_1.png" src="../_images/nb_eBOSS_DESI_Priors_123_1.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [121]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>

<span class="k">for</span> <span class="n">row</span><span class="p">,</span><span class="n">n</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">([</span><span class="mi">8</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">12</span><span class="p">]):</span>
    <span class="n">i</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">n_comp</span> <span class="o">==</span> <span class="n">n</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">Xpred</span><span class="p">,</span><span class="n">Ypred</span><span class="o">=</span> <span class="n">gmms</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">10000</span><span class="p">)</span>
    <span class="n">_</span><span class="p">,</span><span class="n">bins</span><span class="p">,</span><span class="n">_</span><span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="n">row</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">df_notdev</span><span class="p">[</span><span class="s1">&#39;z&#39;</span><span class="p">],</span><span class="n">bins</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span><span class="n">histtype</span><span class="o">=</span><span class="s1">&#39;step&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="n">normed</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">_</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="n">row</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">Xpred</span><span class="p">[:,</span><span class="o">-</span><span class="mi">2</span><span class="p">],</span><span class="n">bins</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span><span class="n">histtype</span><span class="o">=</span><span class="s1">&#39;step&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="n">normed</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

    <span class="n">_</span><span class="p">,</span><span class="n">bins</span><span class="p">,</span><span class="n">_</span><span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="n">row</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">df_notdev</span><span class="p">[</span><span class="s1">&#39;r-z&#39;</span><span class="p">]</span><span class="o">+</span><span class="n">df_notdev</span><span class="p">[</span><span class="s1">&#39;z&#39;</span><span class="p">],</span><span class="n">bins</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span><span class="n">histtype</span><span class="o">=</span><span class="s1">&#39;step&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="n">normed</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">_</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="n">row</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">Xpred</span><span class="p">[:,</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span><span class="o">+</span><span class="n">Xpred</span><span class="p">[:,</span><span class="o">-</span><span class="mi">2</span><span class="p">],</span><span class="n">bins</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span><span class="n">histtype</span><span class="o">=</span><span class="s1">&#39;step&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="n">normed</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

    <span class="n">_</span><span class="p">,</span><span class="n">bins</span><span class="p">,</span><span class="n">_</span><span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="n">row</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">df_notdev</span><span class="p">[</span><span class="s1">&#39;g-r&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">df_notdev</span><span class="p">[</span><span class="s1">&#39;r-z&#39;</span><span class="p">]</span><span class="o">+</span><span class="n">df_notdev</span><span class="p">[</span><span class="s1">&#39;z&#39;</span><span class="p">],</span><span class="n">bins</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span><span class="n">histtype</span><span class="o">=</span><span class="s1">&#39;step&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="n">normed</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">_</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="n">row</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">Xpred</span><span class="p">[:,</span><span class="o">-</span><span class="mi">4</span><span class="p">]</span> <span class="o">+</span> <span class="n">Xpred</span><span class="p">[:,</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span> <span class="o">+</span> <span class="n">Xpred</span><span class="p">[:,</span><span class="o">-</span><span class="mi">2</span><span class="p">],</span><span class="n">bins</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span><span class="n">histtype</span><span class="o">=</span><span class="s1">&#39;step&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="n">normed</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

<span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;z&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;g&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>Out[121]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>&lt;matplotlib.text.Text at 0x121f69d68&gt;
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/nb_eBOSS_DESI_Priors_124_1.png" src="../_images/nb_eBOSS_DESI_Priors_124_1.png" />
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [117]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># smallest n_comp feel is ok, don&#39;t overfit!</span>
<span class="n">gmm</span><span class="o">=</span> <span class="n">gmms</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">n_comp</span> <span class="o">==</span> <span class="mi">8</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]]</span>
<span class="n">logprob</span><span class="o">=</span> <span class="n">gmm</span><span class="o">.</span><span class="n">score_samples</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
<span class="n">responsibilities</span> <span class="o">=</span> <span class="n">gmm</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>

<span class="n">Xpred</span><span class="p">,</span><span class="n">Ypred</span><span class="o">=</span> <span class="n">gmm</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">10000</span><span class="p">)</span>
<span class="n">d</span><span class="o">=</span><span class="p">{}</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">col</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">fit_cols</span><span class="p">):</span>
    <span class="n">d</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">=</span> <span class="n">Xpred</span><span class="p">[:,</span><span class="n">i</span><span class="p">]</span>
<span class="n">df_pred</span><span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="Model-in-TS-region">
<h3>Model in TS region<a class="headerlink" href="#Model-in-TS-region" title="Permalink to this headline">Â¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [77]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">df_notdev</span><span class="p">[</span><span class="s1">&#39;r-z&#39;</span><span class="p">],</span><span class="n">df_notdev</span><span class="p">[</span><span class="s1">&#39;g-r&#39;</span><span class="p">],</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.05</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">df_pred</span><span class="p">[</span><span class="s1">&#39;r-z&#39;</span><span class="p">],</span><span class="n">df_pred</span><span class="p">[</span><span class="s1">&#39;g-r&#39;</span><span class="p">],</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.05</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
    <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;r-z&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">2.5</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;g-r&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>Out[77]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>&lt;matplotlib.text.Text at 0x11c6a6e80&gt;
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/nb_eBOSS_DESI_Priors_127_1.png" src="../_images/nb_eBOSS_DESI_Priors_127_1.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [79]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">df_new</span><span class="p">[</span><span class="s1">&#39;z&#39;</span><span class="p">],</span><span class="n">df_notdev</span><span class="p">[</span><span class="s1">&#39;fwhm_or_rhalf&#39;</span><span class="p">],</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.05</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">df_pred</span><span class="p">[</span><span class="s1">&#39;z&#39;</span><span class="p">],</span><span class="n">df_pred</span><span class="p">[</span><span class="s1">&#39;fwhm_or_rhalf&#39;</span><span class="p">],</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.05</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
    <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;z mag&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;fwhm_or_rhalf&#39;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
    <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">19</span><span class="p">,</span><span class="mi">26</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mf">4.5</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/nb_eBOSS_DESI_Priors_128_0.png" src="../_images/nb_eBOSS_DESI_Priors_128_0.png" />
</div>
</div>
</div>
<div class="section" id="Redshift-correlations">
<h3>Redshift correlations<a class="headerlink" href="#Redshift-correlations" title="Permalink to this headline">Â¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [80]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">df_notdev</span><span class="p">[</span><span class="s1">&#39;z&#39;</span><span class="p">],</span><span class="n">df_notdev</span><span class="p">[</span><span class="s1">&#39;redshift&#39;</span><span class="p">],</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.05</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">df_pred</span><span class="p">[</span><span class="s1">&#39;z&#39;</span><span class="p">],</span><span class="n">df_pred</span><span class="p">[</span><span class="s1">&#39;redshift&#39;</span><span class="p">],</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.05</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
    <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;z mag&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;redshift&#39;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
    <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">19</span><span class="p">,</span><span class="mi">26</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">1.7</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/nb_eBOSS_DESI_Priors_130_0.png" src="../_images/nb_eBOSS_DESI_Priors_130_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [94]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">df_notdev</span><span class="p">[</span><span class="s1">&#39;r-z&#39;</span><span class="p">],</span><span class="n">df_notdev</span><span class="p">[</span><span class="s1">&#39;redshift&#39;</span><span class="p">],</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.05</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">df_pred</span><span class="p">[</span><span class="s1">&#39;r-z&#39;</span><span class="p">],</span><span class="n">df_pred</span><span class="p">[</span><span class="s1">&#39;redshift&#39;</span><span class="p">],</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.05</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;r-z&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="o">-</span><span class="mf">0.6</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mf">0.2</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>

<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">df_notdev</span><span class="p">[</span><span class="s1">&#39;g-r&#39;</span><span class="p">],</span><span class="n">df_notdev</span><span class="p">[</span><span class="s1">&#39;redshift&#39;</span><span class="p">],</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.05</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">df_pred</span><span class="p">[</span><span class="s1">&#39;g-r&#39;</span><span class="p">],</span><span class="n">df_pred</span><span class="p">[</span><span class="s1">&#39;redshift&#39;</span><span class="p">],</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.05</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;g-r&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mf">0.2</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
    <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;redshift&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/nb_eBOSS_DESI_Priors_131_0.png" src="../_images/nb_eBOSS_DESI_Priors_131_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [96]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">sns</span><span class="o">.</span><span class="n">distplot</span><span class="p">(</span><span class="n">df_new</span><span class="p">[</span><span class="s1">&#39;fwhm_or_rhalf&#39;</span><span class="p">])</span>
<span class="n">df_new</span><span class="p">[</span><span class="s1">&#39;fwhm_or_rhalf&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>Out[96]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>count    15919.000000
mean         0.537243
std          0.271235
min          0.113250
25%          0.320844
50%          0.536520
75%          0.678899
max          4.954905
Name: fwhm_or_rhalf, dtype: float64
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/nb_eBOSS_DESI_Priors_132_1.png" src="../_images/nb_eBOSS_DESI_Priors_132_1.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [97]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">print</span><span class="p">(</span><span class="n">fit_cols</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[&#39;fwhm_or_rhalf&#39;, &#39;g-r&#39;, &#39;r-z&#39;, &#39;z&#39;, &#39;redshift&#39;]
</pre></div></div>
</div>
</div>
</div>
<div class="section" id="Sample-=-Model">
<h2>Sample = Model<a class="headerlink" href="#Sample-=-Model" title="Permalink to this headline">Â¶</a></h2>
<div class="section" id="Starting-sample-of-10k">
<h3>Starting sample of 10k<a class="headerlink" href="#Starting-sample-of-10k" title="Permalink to this headline">Â¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [124]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">Xpred</span><span class="p">,</span><span class="n">Ypred</span><span class="o">=</span> <span class="n">gmm</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">10000</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>

<span class="n">_</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">Xpred</span><span class="p">[:,</span><span class="mi">3</span><span class="p">],</span><span class="n">bins</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span><span class="n">histtype</span><span class="o">=</span><span class="s1">&#39;step&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="n">normed</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;z mag&#39;</span><span class="p">)</span>

<span class="n">_</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">Xpred</span><span class="p">[:,</span><span class="mi">2</span><span class="p">:</span><span class="mi">3</span><span class="o">+</span><span class="mi">1</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span><span class="n">bins</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span><span class="n">histtype</span><span class="o">=</span><span class="s1">&#39;step&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="n">normed</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;r mag&#39;</span><span class="p">)</span>

<span class="n">_</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">Xpred</span><span class="p">[:,</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="o">+</span><span class="mi">1</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span><span class="n">bins</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span><span class="n">histtype</span><span class="o">=</span><span class="s1">&#39;step&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="n">normed</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;g mag&#39;</span><span class="p">)</span>

<span class="n">_</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">Xpred</span><span class="p">[:,</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="n">bins</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span><span class="n">histtype</span><span class="o">=</span><span class="s1">&#39;step&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="n">normed</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;redshift&#39;</span><span class="p">)</span>

<span class="n">_</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">Xpred</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span><span class="n">bins</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span><span class="n">histtype</span><span class="o">=</span><span class="s1">&#39;step&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="n">normed</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;fwhm_or_rhalf&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>Out[124]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>&lt;matplotlib.text.Text at 0x12390b208&gt;
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/nb_eBOSS_DESI_Priors_136_1.png" src="../_images/nb_eBOSS_DESI_Priors_136_1.png" />
</div>
</div>
</div>
<div class="section" id="Resample-until-10k-within-redshift-and-size-limits">
<h3>Resample until 10k within redshift and size limits<a class="headerlink" href="#Resample-until-10k-within-redshift-and-size-limits" title="Permalink to this headline">Â¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [133]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">def</span> <span class="nf">ELGcuts</span><span class="p">(</span><span class="n">Xpred</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Args:</span>
<span class="sd">        Xpred: (N,5) array-like</span>
<span class="sd">            5 columns are:</span>
<span class="sd">            fit_cols= [&#39;fwhm_or_rhalf&#39;, &#39;g-r&#39;, &#39;r-z&#39;,&#39;z&#39;,&#39;redshift&#39;]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">red_lim</span><span class="o">=</span> <span class="p">(</span><span class="mf">0.6</span><span class="p">,</span><span class="mf">1.6</span><span class="p">)</span> <span class="c1"># DESI</span>
    <span class="n">rhalf_lim</span><span class="o">=</span> <span class="p">(</span><span class="mf">0.262</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span><span class="mf">2.</span><span class="p">)</span> <span class="c1"># Camera, Data</span>
    <span class="n">g</span><span class="p">,</span><span class="n">r</span><span class="p">,</span><span class="n">z</span><span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">24.0</span><span class="p">,</span><span class="mf">23.4</span><span class="p">,</span><span class="mf">22.5</span><span class="p">])</span><span class="o">+</span><span class="mf">0.5</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">((</span><span class="n">Xpred</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">rhalf_lim</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">|</span>
            <span class="p">(</span><span class="n">Xpred</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">rhalf_lim</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">|</span>
            <span class="p">(</span><span class="n">Xpred</span><span class="p">[:,</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">red_lim</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">|</span>
            <span class="p">(</span><span class="n">Xpred</span><span class="p">[:,</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">red_lim</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">|</span>
            <span class="p">(</span><span class="n">Xpred</span><span class="p">[:,</span><span class="mi">3</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">z</span><span class="p">)</span> <span class="o">|</span> <span class="c1">#beyond mag limit</span>
            <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">Xpred</span><span class="p">[:,</span><span class="mi">2</span><span class="p">:</span><span class="mi">3</span><span class="o">+</span><span class="mi">1</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">r</span><span class="p">)</span> <span class="o">|</span>
            <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">Xpred</span><span class="p">[:,</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="o">+</span><span class="mi">1</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">g</span><span class="p">)</span>
            <span class="p">)</span>

<span class="n">Xpred</span><span class="p">,</span><span class="n">Ypred</span><span class="o">=</span> <span class="n">gmm</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">10000</span><span class="p">)</span>
<span class="n">i</span><span class="o">=</span><span class="mi">0</span>
<span class="n">outLimit</span><span class="o">=</span> <span class="n">ELGcuts</span><span class="p">(</span><span class="n">Xpred</span><span class="p">)</span>
<span class="n">num</span><span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">Ypred</span><span class="p">[</span><span class="n">outLimit</span><span class="p">])</span>
<span class="k">while</span> <span class="n">num</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
    <span class="n">i</span><span class="o">+=</span><span class="mi">1</span>
    <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="mi">20</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span>
    <span class="k">print</span><span class="p">(</span><span class="n">num</span><span class="p">)</span>
    <span class="n">Xpred</span><span class="p">[</span><span class="n">outLimit</span><span class="p">,:],</span><span class="n">Ypred</span><span class="p">[</span><span class="n">outLimit</span><span class="p">]</span><span class="o">=</span> <span class="n">gmm</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">num</span><span class="p">)</span>
    <span class="n">outLimit</span><span class="o">=</span> <span class="n">ELGcuts</span><span class="p">(</span><span class="n">Xpred</span><span class="p">)</span>
    <span class="n">num</span><span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">Ypred</span><span class="p">[</span><span class="n">outLimit</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
4345
1934
881
382
177
88
39
17
7
3
1
1
1
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [134]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">d</span><span class="o">=</span><span class="p">{}</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">col</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">fit_cols</span><span class="p">):</span>
    <span class="n">d</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">=</span> <span class="n">Xpred</span><span class="p">[:,</span><span class="n">i</span><span class="p">]</span>
<span class="n">df_fin</span><span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [135]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">df_new</span><span class="p">[</span><span class="s1">&#39;r-z&#39;</span><span class="p">],</span><span class="n">df_new</span><span class="p">[</span><span class="s1">&#39;g-r&#39;</span><span class="p">],</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.05</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">df_fin</span><span class="p">[</span><span class="s1">&#39;r-z&#39;</span><span class="p">],</span><span class="n">df_fin</span><span class="p">[</span><span class="s1">&#39;g-r&#39;</span><span class="p">],</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.05</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
    <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;r-z&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">2.5</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;g-r&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>Out[135]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>&lt;matplotlib.text.Text at 0x123d1a358&gt;
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/nb_eBOSS_DESI_Priors_140_1.png" src="../_images/nb_eBOSS_DESI_Priors_140_1.png" />
</div>
</div>
</div>
<div class="section" id="The-GM-mixture-produced-a-sample-that-was-then-filtered-to-our-redshift-and-mag-limits">
<h3>The GM mixture produced a sample that was then filtered to our redshift and mag limits<a class="headerlink" href="#The-GM-mixture-produced-a-sample-that-was-then-filtered-to-our-redshift-and-mag-limits" title="Permalink to this headline">Â¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [137]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>

<span class="n">_</span><span class="p">,</span><span class="n">bins</span><span class="p">,</span><span class="n">_</span><span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">df_new</span><span class="p">[</span><span class="s1">&#39;z&#39;</span><span class="p">],</span><span class="n">bins</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span><span class="n">histtype</span><span class="o">=</span><span class="s1">&#39;step&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="n">normed</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">_</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">df_fin</span><span class="p">[</span><span class="s1">&#39;z&#39;</span><span class="p">],</span><span class="n">bins</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span><span class="n">histtype</span><span class="o">=</span><span class="s1">&#39;step&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="n">normed</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;z mag&#39;</span><span class="p">)</span>

<span class="n">_</span><span class="p">,</span><span class="n">bins</span><span class="p">,</span><span class="n">_</span><span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">df_new</span><span class="p">[</span><span class="s1">&#39;r-z&#39;</span><span class="p">]</span><span class="o">+</span><span class="n">df_new</span><span class="p">[</span><span class="s1">&#39;z&#39;</span><span class="p">],</span><span class="n">bins</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span><span class="n">histtype</span><span class="o">=</span><span class="s1">&#39;step&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="n">normed</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">_</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">df_fin</span><span class="p">[</span><span class="s1">&#39;r-z&#39;</span><span class="p">]</span><span class="o">+</span><span class="n">df_fin</span><span class="p">[</span><span class="s1">&#39;z&#39;</span><span class="p">],</span><span class="n">bins</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span><span class="n">histtype</span><span class="o">=</span><span class="s1">&#39;step&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="n">normed</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;r mag&#39;</span><span class="p">)</span>

<span class="n">_</span><span class="p">,</span><span class="n">bins</span><span class="p">,</span><span class="n">_</span><span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">df_new</span><span class="p">[</span><span class="s1">&#39;g-r&#39;</span><span class="p">]</span><span class="o">+</span><span class="n">df_new</span><span class="p">[</span><span class="s1">&#39;r-z&#39;</span><span class="p">]</span><span class="o">+</span><span class="n">df_new</span><span class="p">[</span><span class="s1">&#39;z&#39;</span><span class="p">],</span><span class="n">bins</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span><span class="n">histtype</span><span class="o">=</span><span class="s1">&#39;step&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="n">normed</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">_</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">df_fin</span><span class="p">[</span><span class="s1">&#39;g-r&#39;</span><span class="p">]</span><span class="o">+</span><span class="n">df_fin</span><span class="p">[</span><span class="s1">&#39;r-z&#39;</span><span class="p">]</span><span class="o">+</span><span class="n">df_fin</span><span class="p">[</span><span class="s1">&#39;z&#39;</span><span class="p">],</span><span class="n">bins</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span><span class="n">histtype</span><span class="o">=</span><span class="s1">&#39;step&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="n">normed</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;g mag&#39;</span><span class="p">)</span>


<span class="n">_</span><span class="p">,</span><span class="n">bins</span><span class="p">,</span><span class="n">_</span><span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">df_new</span><span class="p">[</span><span class="s1">&#39;redshift&#39;</span><span class="p">],</span><span class="n">bins</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span><span class="n">histtype</span><span class="o">=</span><span class="s1">&#39;step&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="n">normed</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">_</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">df_fin</span><span class="p">[</span><span class="s1">&#39;redshift&#39;</span><span class="p">],</span><span class="n">bins</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span><span class="n">histtype</span><span class="o">=</span><span class="s1">&#39;step&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="n">normed</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;redshift&#39;</span><span class="p">)</span>

<span class="n">_</span><span class="p">,</span><span class="n">bins</span><span class="p">,</span><span class="n">_</span><span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">df_new</span><span class="p">[</span><span class="s1">&#39;fwhm_or_rhalf&#39;</span><span class="p">],</span><span class="n">bins</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span><span class="n">histtype</span><span class="o">=</span><span class="s1">&#39;step&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="n">normed</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">_</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">df_fin</span><span class="p">[</span><span class="s1">&#39;fwhm_or_rhalf&#39;</span><span class="p">],</span><span class="n">bins</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span><span class="n">histtype</span><span class="o">=</span><span class="s1">&#39;step&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="n">normed</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;fwhm_or_rhalf&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>Out[137]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>&lt;matplotlib.text.Text at 0x12404f5f8&gt;
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/nb_eBOSS_DESI_Priors_142_1.png" src="../_images/nb_eBOSS_DESI_Priors_142_1.png" />
</div>
</div>
</div>
<div class="section" id="Save-the-model-produced-sample">
<h3>Save the model produced sample<a class="headerlink" href="#Save-the-model-produced-sample" title="Permalink to this headline">Â¶</a></h3>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [138]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">df_fin</span><span class="o">.</span><span class="n">columns</span>
<span class="n">a</span><span class="o">=</span><span class="n">fits_table</span><span class="p">()</span>
<span class="n">a</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df_fin</span><span class="p">)))</span>
<span class="n">a</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;rhalf&#39;</span><span class="p">,</span><span class="n">df_fin</span><span class="p">[</span><span class="s1">&#39;fwhm_or_rhalf&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
<span class="n">a</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;redshift&#39;</span><span class="p">,</span><span class="n">df_fin</span><span class="p">[</span><span class="s1">&#39;redshift&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
<span class="n">a</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;z&#39;</span><span class="p">,</span><span class="n">df_fin</span><span class="p">[</span><span class="s1">&#39;z&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
<span class="n">a</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="n">df_fin</span><span class="p">[</span><span class="s1">&#39;r-z&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span> <span class="o">+</span> <span class="n">a</span><span class="o">.</span><span class="n">z</span><span class="p">)</span>
<span class="n">a</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;g&#39;</span><span class="p">,</span><span class="n">df_fin</span><span class="p">[</span><span class="s1">&#39;g-r&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span> <span class="o">+</span> <span class="n">a</span><span class="o">.</span><span class="n">r</span><span class="p">)</span>
<span class="n">a</span><span class="o">.</span><span class="n">writeto</span><span class="p">(</span><span class="s1">&#39;elg_sample_5dim_10k.fits&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="Model-DEV">
<h2>Model DEV<a class="headerlink" href="#Model-DEV" title="Permalink to this headline">Â¶</a></h2>
<div class="section" id="Fit-Mixture">
<h3>Fit Mixture<a class="headerlink" href="#Fit-Mixture" title="Permalink to this headline">Â¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [170]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">X</span><span class="o">=</span> <span class="n">df_dev</span><span class="o">.</span><span class="n">values</span>
<span class="k">print</span><span class="p">(</span><span class="s1">&#39;Training Size=&#39;</span><span class="p">,</span><span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">gmms</span><span class="p">,</span><span class="n">i_min</span><span class="p">,</span> <span class="n">n_comp</span><span class="p">,</span> <span class="n">BICs</span><span class="o">=</span> <span class="n">my_mixture</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="n">n_comp</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">14</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">n_comp</span><span class="p">,</span><span class="n">BICs</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Training Size= 225
2 components
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>Out[170]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>[&lt;matplotlib.lines.Line2D at 0x128f70358&gt;]
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/nb_eBOSS_DESI_Priors_147_2.png" src="../_images/nb_eBOSS_DESI_Priors_147_2.png" />
</div>
</div>
</div>
<div class="section" id="Cannot-build-a-good-model,-simply-not-nough-DEV-data-points">
<h3>Cannot build a good model, simply not nough DEV data points<a class="headerlink" href="#Cannot-build-a-good-model,-simply-not-nough-DEV-data-points" title="Permalink to this headline">Â¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [174]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">13</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>

<span class="k">for</span> <span class="n">row</span><span class="p">,</span><span class="n">n</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">([</span><span class="mi">2</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">10</span><span class="p">]):</span>
    <span class="n">i</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">n_comp</span> <span class="o">==</span> <span class="n">n</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">Xpred</span><span class="p">,</span><span class="n">Ypred</span><span class="o">=</span> <span class="n">gmms</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">10000</span><span class="p">)</span>
    <span class="n">_</span><span class="p">,</span><span class="n">bins</span><span class="p">,</span><span class="n">_</span><span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="n">row</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">df_dev</span><span class="p">[</span><span class="s1">&#39;redshift&#39;</span><span class="p">],</span><span class="n">bins</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span><span class="n">histtype</span><span class="o">=</span><span class="s1">&#39;step&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="n">normed</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">_</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="n">row</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">Xpred</span><span class="p">[:,</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="n">bins</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span><span class="n">histtype</span><span class="o">=</span><span class="s1">&#39;step&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="n">normed</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="c1">#ax[1].set_xlabel(&#39;redshift&#39;)</span>

    <span class="n">_</span><span class="p">,</span><span class="n">bins</span><span class="p">,</span><span class="n">_</span><span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="n">row</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">df_dev</span><span class="p">[</span><span class="s1">&#39;fwhm_or_rhalf&#39;</span><span class="p">],</span><span class="n">bins</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span><span class="n">histtype</span><span class="o">=</span><span class="s1">&#39;step&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="n">normed</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">_</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="n">row</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">Xpred</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span><span class="n">bins</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span><span class="n">histtype</span><span class="o">=</span><span class="s1">&#39;step&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="n">normed</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="c1">#ax[2].set_xlabel(&#39;fwhm_or_rhalf&#39;)</span>

<span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;redshift&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;fwhm_or_rhalf&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>Out[174]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>&lt;matplotlib.text.Text at 0x129deef28&gt;
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/nb_eBOSS_DESI_Priors_149_1.png" src="../_images/nb_eBOSS_DESI_Priors_149_1.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [175]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>

<span class="k">for</span> <span class="n">row</span><span class="p">,</span><span class="n">n</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">([</span><span class="mi">2</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">10</span><span class="p">]):</span>
    <span class="n">i</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">n_comp</span> <span class="o">==</span> <span class="n">n</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">Xpred</span><span class="p">,</span><span class="n">Ypred</span><span class="o">=</span> <span class="n">gmms</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">10000</span><span class="p">)</span>
    <span class="n">_</span><span class="p">,</span><span class="n">bins</span><span class="p">,</span><span class="n">_</span><span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="n">row</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">df_dev</span><span class="p">[</span><span class="s1">&#39;z&#39;</span><span class="p">],</span><span class="n">bins</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span><span class="n">histtype</span><span class="o">=</span><span class="s1">&#39;step&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="n">normed</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">_</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="n">row</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">Xpred</span><span class="p">[:,</span><span class="o">-</span><span class="mi">2</span><span class="p">],</span><span class="n">bins</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span><span class="n">histtype</span><span class="o">=</span><span class="s1">&#39;step&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="n">normed</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

    <span class="n">_</span><span class="p">,</span><span class="n">bins</span><span class="p">,</span><span class="n">_</span><span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="n">row</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">df_dev</span><span class="p">[</span><span class="s1">&#39;r-z&#39;</span><span class="p">]</span><span class="o">+</span><span class="n">df_dev</span><span class="p">[</span><span class="s1">&#39;z&#39;</span><span class="p">],</span><span class="n">bins</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span><span class="n">histtype</span><span class="o">=</span><span class="s1">&#39;step&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="n">normed</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">_</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="n">row</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">Xpred</span><span class="p">[:,</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span><span class="o">+</span><span class="n">Xpred</span><span class="p">[:,</span><span class="o">-</span><span class="mi">2</span><span class="p">],</span><span class="n">bins</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span><span class="n">histtype</span><span class="o">=</span><span class="s1">&#39;step&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="n">normed</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

    <span class="n">_</span><span class="p">,</span><span class="n">bins</span><span class="p">,</span><span class="n">_</span><span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="n">row</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">df_dev</span><span class="p">[</span><span class="s1">&#39;g-r&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">df_dev</span><span class="p">[</span><span class="s1">&#39;r-z&#39;</span><span class="p">]</span><span class="o">+</span><span class="n">df_dev</span><span class="p">[</span><span class="s1">&#39;z&#39;</span><span class="p">],</span><span class="n">bins</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span><span class="n">histtype</span><span class="o">=</span><span class="s1">&#39;step&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="n">normed</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">_</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="n">row</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">Xpred</span><span class="p">[:,</span><span class="o">-</span><span class="mi">4</span><span class="p">]</span> <span class="o">+</span> <span class="n">Xpred</span><span class="p">[:,</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span> <span class="o">+</span> <span class="n">Xpred</span><span class="p">[:,</span><span class="o">-</span><span class="mi">2</span><span class="p">],</span><span class="n">bins</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span><span class="n">histtype</span><span class="o">=</span><span class="s1">&#39;step&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="n">normed</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

<span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;z&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;g&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>Out[175]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>&lt;matplotlib.text.Text at 0x12a389518&gt;
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/nb_eBOSS_DESI_Priors_150_1.png" src="../_images/nb_eBOSS_DESI_Priors_150_1.png" />
</div>
</div>
</div>
</div>
<div class="section" id="Model-the-DESI-n(z)">
<h2>Model the DESI n(z)<a class="headerlink" href="#Model-the-DESI-n(z)" title="Permalink to this headline">Â¶</a></h2>
<div class="section" id="100,000-random-draws-from-sanches-&amp;-kirkby,-w/out-replacement">
<h3>100,000 random draws from sanches &amp; kirkby, w/out replacement<a class="headerlink" href="#100,000-random-draws-from-sanches-&-kirkby,-w/out-replacement" title="Permalink to this headline">Â¶</a></h3>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [232]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">z1e5</span><span class="o">=</span> <span class="n">fits_table</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">DATA_DIR</span><span class="p">,</span><span class="s1">&#39;sanchez_kirkby_z1e5.fits&#39;</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [233]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">_</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">z1e5</span><span class="o">.</span><span class="n">z_cosmo</span><span class="p">,</span><span class="n">bins</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span><span class="n">histtype</span><span class="o">=</span><span class="s1">&#39;step&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="n">normed</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/nb_eBOSS_DESI_Priors_154_0.png" src="../_images/nb_eBOSS_DESI_Priors_154_0.png" />
</div>
</div>
</div>
<div class="section" id="Fit-Gaussian-Mixture">
<h3>Fit Gaussian Mixture<a class="headerlink" href="#Fit-Gaussian-Mixture" title="Permalink to this headline">Â¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [234]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">X</span><span class="o">=</span> <span class="n">z1e5</span><span class="o">.</span><span class="n">z_cosmo</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">gmms</span><span class="p">,</span><span class="n">i_min</span><span class="p">,</span> <span class="n">n_comp</span><span class="p">,</span> <span class="n">BICs</span><span class="o">=</span> <span class="n">my_mixture</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">n_comp</span><span class="p">,</span><span class="n">BICs</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
4 components
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>Out[234]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>[&lt;matplotlib.lines.Line2D at 0x11d4f5278&gt;]
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/nb_eBOSS_DESI_Priors_156_2.png" src="../_images/nb_eBOSS_DESI_Priors_156_2.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [235]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">13</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>

<span class="k">for</span> <span class="n">col</span><span class="p">,</span><span class="n">n</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">([</span><span class="mi">4</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">12</span><span class="p">]):</span>
    <span class="n">i</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">n_comp</span> <span class="o">==</span> <span class="n">n</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">Xpred</span><span class="p">,</span><span class="n">Ypred</span><span class="o">=</span> <span class="n">gmms</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">10000</span><span class="p">)</span>
    <span class="n">_</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">z1e5</span><span class="o">.</span><span class="n">z_cosmo</span><span class="p">,</span><span class="n">bins</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span><span class="n">histtype</span><span class="o">=</span><span class="s1">&#39;step&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="n">normed</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">_</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">Xpred</span><span class="p">,</span><span class="n">bins</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span><span class="n">histtype</span><span class="o">=</span><span class="s1">&#39;step&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="n">normed</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

<span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;redshift&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>Out[235]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>&lt;matplotlib.text.Text at 0x11d5104a8&gt;
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/nb_eBOSS_DESI_Priors_157_1.png" src="../_images/nb_eBOSS_DESI_Priors_157_1.png" />
</div>
</div>
</div>
<div class="section" id="12-compoents-to-intentionally-overfit-(we-want-the-exact-n(z))">
<h3>12 compoents to intentionally overfit (we want the exact n(z))<a class="headerlink" href="#12-compoents-to-intentionally-overfit-(we-want-the-exact-n(z))" title="Permalink to this headline">Â¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [236]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">gmm</span><span class="o">=</span> <span class="n">gmms</span><span class="p">[</span><span class="mi">12</span><span class="p">]</span>
<span class="n">z_pred</span><span class="p">,</span><span class="n">pdf_pred</span><span class="o">=</span> <span class="n">gmm</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">100000</span><span class="p">)</span>
<span class="n">_</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">z1e5</span><span class="o">.</span><span class="n">z_cosmo</span><span class="p">,</span><span class="n">bins</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span><span class="n">histtype</span><span class="o">=</span><span class="s1">&#39;step&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="n">normed</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">_</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">z_pred</span><span class="p">,</span><span class="n">bins</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span><span class="n">histtype</span><span class="o">=</span><span class="s1">&#39;step&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="n">normed</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/nb_eBOSS_DESI_Priors_159_0.png" src="../_images/nb_eBOSS_DESI_Priors_159_0.png" />
</div>
</div>
</div>
<div class="section" id="Save-the-model">
<h3>Save the model<a class="headerlink" href="#Save-the-model" title="Permalink to this headline">Â¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [239]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">GaussianMixtureModel</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">gmm</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="s1">&#39;elg_nz&#39;</span><span class="p">,</span> <span class="n">py</span><span class="o">=</span><span class="s1">&#39;36&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Wrote elg_nz_means_36.txt
Wrote elg_nz_weights_36.txt
Wrote elg_nz_covars_36.txt
</pre></div></div>
</div>
</div>
</div>
<div class="section" id="Build-our-final-sample-(from-the-DR3-Deep2-and-n(z)-model)">
<h2>Build our final sample (from the DR3-Deep2 and n(z) model)<a class="headerlink" href="#Build-our-final-sample-(from-the-DR3-Deep2-and-n(z)-model)" title="Permalink to this headline">Â¶</a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">spatial</span>
<span class="n">sample_5d_10k</span><span class="o">=</span><span class="n">fits_table</span><span class="p">(</span><span class="s1">&#39;elg_sample_5dim_10k.fits&#39;</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">obiwan.common</span> <span class="kn">import</span> <span class="n">fits2pandas</span>
<span class="n">sample_5d_10k</span><span class="o">=</span> <span class="n">fits2pandas</span><span class="p">(</span><span class="n">sample_5d_10k</span><span class="p">)</span>

<span class="n">tree</span> <span class="o">=</span> <span class="n">spatial</span><span class="o">.</span><span class="n">KDTree</span><span class="p">(</span><span class="n">sample_5d_10k</span><span class="p">[</span><span class="s1">&#39;redshift&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [253]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">gmm</span><span class="o">.</span><span class="n">covariances_</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>Out[253]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>(15, 1, 1)
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">model</span><span class="o">=</span> <span class="n">GaussianMixtureModel</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="s1">&#39;elg_nz&#39;</span><span class="p">,</span><span class="n">py</span><span class="o">=</span><span class="s1">&#39;36&#39;</span><span class="p">,</span><span class="n">is1D</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">z</span><span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">1000</span><span class="p">)</span>
<span class="n">_</span><span class="p">,</span><span class="n">ind</span><span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
<span class="n">randoms</span><span class="o">=</span> <span class="n">sample_5d_10k</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span>

<span class="k">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">sample_5d_10k</span><span class="p">),</span><span class="nb">len</span><span class="p">(</span><span class="n">z</span><span class="p">),</span><span class="nb">len</span><span class="p">(</span><span class="n">randoms</span><span class="p">))</span>
<span class="k">print</span><span class="p">(</span><span class="n">randoms</span><span class="o">.</span><span class="n">columns</span><span class="p">),</span> <span class="k">print</span><span class="p">(</span><span class="n">sample_5d_10k</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(15,)
10000 1000 1000
Index([&#39;g&#39;, &#39;id&#39;, &#39;r&#39;, &#39;redshift&#39;, &#39;rhalf&#39;, &#39;z&#39;], dtype=&#39;object&#39;)
Index([&#39;g&#39;, &#39;id&#39;, &#39;r&#39;, &#39;redshift&#39;, &#39;rhalf&#39;, &#39;z&#39;], dtype=&#39;object&#39;)
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>Out[13]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>(None, None)
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [18]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="n">z</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">randoms</span><span class="p">[</span><span class="s1">&#39;redshift&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[ 1.17863478] 1.17876047504
[ 1.17322301] 1.17322153666
[ 1.1506008] 1.15054300718
[ 1.19767244] 1.19775757811
[ 1.19893259] 1.19892718065
[ 1.15093723] 1.15096243379
[ 1.15994011] 1.15990993527
[ 1.15066201] 1.15067316369
[ 1.13602797] 1.13600715492
[ 1.15877533] 1.1587258549
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [306]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Randoms table</span>
<span class="n">a</span><span class="o">=</span><span class="n">fits_table</span><span class="p">()</span>
<span class="n">a</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">randoms</span><span class="p">)))</span>
<span class="n">a</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;id_5d10k_sample&#39;</span><span class="p">,</span><span class="n">randoms</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
<span class="n">a</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;rhalf&#39;</span><span class="p">,</span><span class="n">randoms</span><span class="p">[</span><span class="s1">&#39;rhalf&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
<span class="n">a</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;redshift&#39;</span><span class="p">,</span><span class="n">randoms</span><span class="p">[</span><span class="s1">&#39;redshift&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
<span class="n">a</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;z&#39;</span><span class="p">,</span><span class="n">randoms</span><span class="p">[</span><span class="s1">&#39;z&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
<span class="n">a</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="n">randoms</span><span class="p">[</span><span class="s1">&#39;r&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
<span class="n">a</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;g&#39;</span><span class="p">,</span><span class="n">randoms</span><span class="p">[</span><span class="s1">&#39;g&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
<span class="n">a</span><span class="o">.</span><span class="n">writeto</span><span class="p">(</span><span class="s1">&#39;randoms_1.fits&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="Final-sample-has-DR3-Deep2-color,-shape,-size-AND-DESI-n(z)">
<h3>Final sample has DR3-Deep2 color, shape, size AND DESI n(z)<a class="headerlink" href="#Final-sample-has-DR3-Deep2-color,-shape,-size-AND-DESI-n(z)" title="Permalink to this headline">Â¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [139]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">df_fin</span><span class="p">[</span><span class="s1">&#39;r-z&#39;</span><span class="p">],</span><span class="n">df_fin</span><span class="p">[</span><span class="s1">&#39;g-r&#39;</span><span class="p">],</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.05</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">randoms</span><span class="p">[</span><span class="s1">&#39;r-z&#39;</span><span class="p">],</span><span class="n">randoms</span><span class="p">[</span><span class="s1">&#39;g-r&#39;</span><span class="p">],</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.05</span><span class="p">)</span>
<span class="n">_</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">z_10k</span><span class="o">.</span><span class="n">z_cosmo</span><span class="p">,</span><span class="n">bins</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span><span class="n">histtype</span><span class="o">=</span><span class="s1">&#39;step&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="n">normed</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">_</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">randoms</span><span class="p">[</span><span class="s1">&#39;redshift&#39;</span><span class="p">],</span><span class="n">bins</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span><span class="n">histtype</span><span class="o">=</span><span class="s1">&#39;step&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="n">normed</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
    <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;r-z&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">2.5</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;g-r&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;redshift&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>Out[139]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>&lt;matplotlib.text.Text at 0x122cdfa20&gt;
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/nb_eBOSS_DESI_Priors_170_1.png" src="../_images/nb_eBOSS_DESI_Priors_170_1.png" />
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">tenk</span><span class="o">=</span> <span class="n">fits_table</span><span class="p">(</span><span class="s1">&#39;../../etc/elg_sample_5dim_10k.fits&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="42%-is-in-the-TS-box">
<h3>42% is in the TS box<a class="headerlink" href="#42%-is-in-the-TS-box" title="Permalink to this headline">Â¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">gr</span><span class="o">=</span> <span class="n">tenk</span><span class="o">.</span><span class="n">g</span> <span class="o">-</span> <span class="n">tenk</span><span class="o">.</span><span class="n">r</span>
<span class="n">rz</span><span class="o">=</span> <span class="n">tenk</span><span class="o">.</span><span class="n">r</span> <span class="o">-</span> <span class="n">tenk</span><span class="o">.</span><span class="n">z</span>
<span class="n">inBox</span><span class="o">=</span> <span class="p">((</span><span class="n">gr</span> <span class="o">&lt;=</span> <span class="n">y1_line</span><span class="p">(</span><span class="n">rz</span><span class="p">))</span> <span class="o">&amp;</span>
        <span class="p">(</span><span class="n">gr</span> <span class="o">&lt;=</span> <span class="n">y2_line</span><span class="p">(</span><span class="n">rz</span><span class="p">))</span> <span class="o">&amp;</span>
        <span class="p">(</span><span class="n">rz</span> <span class="o">&gt;=</span> <span class="mf">0.3</span><span class="p">)</span> <span class="o">&amp;</span>
        <span class="p">(</span><span class="n">rz</span> <span class="o">&lt;=</span> <span class="mf">1.6</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">rz</span><span class="p">,</span><span class="n">gr</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">rz</span><span class="p">[</span><span class="n">inBox</span><span class="p">],</span><span class="n">gr</span><span class="p">[</span><span class="n">inBox</span><span class="p">],</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">rz</span><span class="p">[</span><span class="n">inBox</span><span class="p">])</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">rz</span><span class="p">)))</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
0.4201
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/nb_eBOSS_DESI_Priors_173_1.png" src="../_images/nb_eBOSS_DESI_Priors_173_1.png" />
</div>
</div>
</div>
</div>
</div>
<div class="section" id="Cosmos-Randoms">
<h1>Cosmos Randoms<a class="headerlink" href="#Cosmos-Randoms" title="Permalink to this headline">Â¶</a></h1>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [29]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">r</span><span class="o">=</span> <span class="n">fits_table</span><span class="p">(</span><span class="s1">&#39;/Users/kaylan1/Downloads/randoms_seed_1_startid_1.fits&#39;</span><span class="p">)</span>
<span class="n">ra</span><span class="p">,</span><span class="n">dec</span><span class="o">=</span> <span class="p">[</span><span class="mf">149.7</span><span class="p">,</span> <span class="mf">150.8</span><span class="p">],[</span><span class="mf">1.6</span><span class="p">,</span> <span class="mf">2.7</span><span class="p">]</span>
<span class="n">r</span><span class="o">.</span><span class="n">get_columns</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>Out[29]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>[&#39;id&#39;, &#39;ra&#39;, &#39;dec&#39;, &#39;n&#39;, &#39;rhalf&#39;, &#39;g&#39;, &#39;r&#39;, &#39;z&#39;, &#39;ba&#39;, &#39;pa&#39;]
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [36]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">ra</span><span class="p">,</span><span class="n">r</span><span class="o">.</span><span class="n">dec</span><span class="p">,</span><span class="n">s</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.01</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">ra</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">dec</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/nb_eBOSS_DESI_Priors_176_0.png" src="../_images/nb_eBOSS_DESI_Priors_176_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [31]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="nb">set</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">n</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">n</span><span class="p">[</span><span class="n">r</span><span class="o">.</span><span class="n">n</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]),</span> <span class="nb">len</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">n</span><span class="p">[</span><span class="n">r</span><span class="o">.</span><span class="n">n</span> <span class="o">==</span> <span class="mi">4</span><span class="p">]),</span> <span class="nb">set</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">rhalf</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>Out[31]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>({1.0, 4.0}, 120000, 120000, {0.5})
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [32]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="nb">len</span><span class="p">(</span><span class="n">r</span><span class="p">),</span><span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">id</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>Out[32]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>(240000, 240000)
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [37]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">ba</span><span class="p">,</span><span class="n">r</span><span class="o">.</span><span class="n">pa</span><span class="p">,</span><span class="n">s</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.01</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>Out[37]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>&lt;matplotlib.collections.PathCollection at 0x1188bcd30&gt;
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/nb_eBOSS_DESI_Priors_179_1.png" src="../_images/nb_eBOSS_DESI_Priors_179_1.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [34]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">limit</span><span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">g</span><span class="o">=</span><span class="mf">24.0</span><span class="p">,</span>
            <span class="n">r</span><span class="o">=</span><span class="mf">23.4</span><span class="p">,</span>
            <span class="n">z</span><span class="o">=</span><span class="mf">22.5</span><span class="p">)</span>
<span class="k">for</span> <span class="n">b</span><span class="p">,</span><span class="n">color</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="s1">&#39;grz&#39;</span><span class="p">,</span><span class="s1">&#39;gbk&#39;</span><span class="p">):</span>
    <span class="n">lo</span><span class="p">,</span><span class="n">hi</span><span class="o">=</span> <span class="n">limit</span><span class="p">[</span><span class="n">b</span><span class="p">]</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="n">limit</span><span class="p">[</span><span class="n">b</span><span class="p">]</span><span class="o">+</span><span class="mf">0.5</span>
    <span class="n">bins</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">lo</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span><span class="n">hi</span><span class="o">+</span><span class="mf">0.5</span><span class="p">,</span><span class="n">num</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
    <span class="n">_</span><span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">b</span><span class="p">),</span><span class="n">bins</span><span class="o">=</span><span class="n">bins</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span><span class="n">histtype</span><span class="o">=</span><span class="s1">&#39;step&#39;</span><span class="p">,</span>
                <span class="n">label</span><span class="o">=</span><span class="n">b</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">lo</span><span class="p">,</span><span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="n">color</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">hi</span><span class="p">,</span><span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="n">color</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>Out[34]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>&lt;matplotlib.legend.Legend at 0x116319d68&gt;
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/nb_eBOSS_DESI_Priors_180_1.png" src="../_images/nb_eBOSS_DESI_Priors_180_1.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [35]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">def</span> <span class="nf">isElg</span><span class="p">(</span><span class="n">g</span><span class="p">,</span><span class="n">r</span><span class="p">,</span><span class="n">z</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">((</span><span class="n">r</span> <span class="o">&lt;</span> <span class="mf">23.4</span><span class="p">)</span> <span class="o">&amp;</span>
            <span class="p">(</span><span class="n">r</span><span class="o">-</span><span class="n">z</span> <span class="o">&gt;</span> <span class="mf">0.3</span><span class="p">)</span> <span class="o">&amp;</span>
            <span class="p">(</span><span class="n">r</span><span class="o">-</span><span class="n">z</span> <span class="o">&lt;</span> <span class="mf">1.6</span><span class="p">)</span> <span class="o">&amp;</span>
            <span class="p">(</span><span class="n">g</span><span class="o">-</span><span class="n">r</span> <span class="o">&lt;</span> <span class="mf">1.15</span><span class="o">*</span><span class="p">(</span><span class="n">r</span><span class="o">-</span><span class="n">z</span><span class="p">)</span> <span class="o">-</span> <span class="mf">0.15</span><span class="p">)</span> <span class="o">&amp;</span>
            <span class="p">(</span><span class="n">g</span><span class="o">-</span><span class="n">r</span> <span class="o">&lt;</span> <span class="mf">1.6</span> <span class="o">-</span> <span class="mf">1.2</span><span class="o">*</span><span class="p">(</span><span class="n">r</span><span class="o">-</span><span class="n">z</span><span class="p">))</span>
           <span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s1">&#39;fraction TS ELG = </span><span class="si">%f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="n">isElg</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">g</span><span class="p">,</span><span class="n">r</span><span class="o">.</span><span class="n">r</span><span class="p">,</span><span class="n">r</span><span class="o">.</span><span class="n">z</span><span class="p">)])</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">r</span><span class="p">)))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
fraction TS ELG = 0.119608
</pre></div></div>
</div>
</div>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
    </p>
    <p>
        &copy; Copyright 2014-2018, Kaylan Burleigh, John Moustakas.<br/>
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.7.6.<br/>
    </p>
  </div>
</footer>
  </body>
</html>