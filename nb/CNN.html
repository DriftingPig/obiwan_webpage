<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Visualize the training data &#8212; obiwan 1.2.0 documentation</title>
    <link rel="stylesheet" href="../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="../_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="../_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-3.3.7/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-sphinx.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">

  </head><body>

  <div id="navbar" class="navbar navbar-default ">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="../index.html">
          Obiwan</a>
        <span class="navbar-text navbar-version pull-left"><b>1.2.0</b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
                <li><a href="../api.html">API</a></li>
                <li><a href="../tutorials.html">Tutorials</a></li>
                <li><a href="../deeplearning.html">Deep Learning</a></li>
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="../index.html">Pages <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"></ul>
</li>
              
                <li class="dropdown">
  <a role="button"
     id="dLabelLocalToc"
     data-toggle="dropdown"
     data-target="#"
     href="#">This Page <b class="caret"></b></a>
  <ul class="dropdown-menu localtoc"
      role="menu"
      aria-labelledby="dLabelLocalToc"><ul>
<li><a class="reference internal" href="#">Visualize the training data</a><ul>
<li><a class="reference internal" href="#read-the-hdf5-files">read the hdf5 files</a></li>
<li><a class="reference internal" href="#For-each-sim-mag_g,-draw-the-nearest-dr5-mag_g,-without-replacements">For each sim mag_g, draw the nearest dr5 mag_g, without replacements</a></li>
<li><a class="reference internal" href="#Mosaic-of-training-images">Mosaic of training images</a></li>
</ul>
</li>
<li><a class="reference internal" href="#Load-training-data-(.npy-files-created-with-&quot;split_traintest.py&quot;-script)">Load training data (.npy files created with “split_traintest.py” script)</a></li>
<li><a class="reference internal" href="#Build-the-CNN">Build the CNN</a><ul>
<li><a class="reference internal" href="#Layers-(check-that-size-of-each-layer-makes-sense)">Layers (check that size of each layer makes sense)</a></li>
<li><a class="reference internal" href="#Train-(4-epochs)">Train (4 epochs)</a></li>
<li><a class="reference internal" href="#Restart-from-checkpoints">Restart from checkpoints</a></li>
</ul>
</li>
<li><a class="reference internal" href="#Real-vs.-Fake-galaxies-in-TS-box">Real vs. Fake galaxies in TS box</a><ul>
<li><a class="reference internal" href="#Real-galaxies-are-brighter">Real galaxies are brighter</a></li>
<li><a class="reference internal" href="#apply-cuts-at-bright-end">apply cuts at bright end</a></li>
</ul>
</li>
</ul>
</ul>
</li>
              
            
            
              
                
              
            
            
            
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="col-md-12 content">
      
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput,
div.nbinput div.prompt,
div.nbinput div.input_area,
div.nbinput div[class*=highlight],
div.nbinput div[class*=highlight] pre,
div.nboutput,
div.nbinput div.prompt,
div.nbinput div.output_area,
div.nboutput div[class*=highlight],
div.nboutput div[class*=highlight] pre {
    background: none;
    border: none;
    padding: 0 0;
    margin: 0;
    box-shadow: none;
}

/* avoid gaps between output lines */
div.nboutput div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput,
div.nboutput {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput,
    div.nboutput {
        flex-direction: column;
    }
}

/* input container */
div.nbinput {
    padding-top: 5px;
}

/* last container */
div.nblast {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput div.prompt pre {
    color: #303F9F;
}

/* output prompt */
div.nboutput div.prompt pre {
    color: #D84315;
}

/* all prompts */
div.nbinput div.prompt,
div.nboutput div.prompt {
    min-width: 9ex;
    padding-top: 0.4em;
    padding-right: 0.4em;
    text-align: right;
    flex: 0;
}
@media (max-width: 540px) {
    div.nbinput div.prompt,
    div.nboutput div.prompt {
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput div.prompt.empty {
        padding: 0;
    }
}

/* disable scrollbars on prompts */
div.nbinput div.prompt pre,
div.nboutput div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput div.input_area,
div.nboutput div.output_area {
    padding: 0.4em;
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput div.input_area,
    div.nboutput div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput div.input_area {
    border: 1px solid #cfcfcf;
    border-radius: 2px;
    background: #f7f7f7;
}

/* override MathJax center alignment in output cells */
div.nboutput div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.pngmath center alignment in output cells */
div.nboutput div.math p {
    text-align: left;
}

/* standard error */
div.nboutput div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }
</style>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="kn">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">h5py</span>

<span class="kn">from</span> <span class="nn">astrometry.util.fits</span> <span class="kn">import</span> <span class="n">fits_table</span><span class="p">,</span> <span class="n">merge_tables</span>

<span class="c1"># To plot pretty figures</span>
<span class="o">%</span><span class="k">matplotlib</span> inline
<span class="c1">#%matplotlib notebook</span>

<span class="c1"># to make this notebook&#39;s output stable across runs</span>
<span class="k">def</span> <span class="nf">reset_graph</span><span class="p">(</span><span class="n">seed</span><span class="o">=</span><span class="mi">7</span><span class="p">):</span>
    <span class="n">tf</span><span class="o">.</span><span class="n">reset_default_graph</span><span class="p">()</span>
    <span class="n">tf</span><span class="o">.</span><span class="n">set_random_seed</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>
    <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>

<span class="kn">import</span> <span class="nn">matplotlib</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;axes.labelsize&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">14</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;xtick.labelsize&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">12</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;ytick.labelsize&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">12</span>

<span class="kn">import</span> <span class="nn">tensorflow</span> <span class="kn">as</span> <span class="nn">tf</span>

<span class="o">%</span><span class="k">load_ext</span> autoreload
<span class="o">%</span><span class="k">autoreload</span> 2
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="stderr output_area docutils container">
<div class="highlight"><pre>
/Users/kaylan1/miniconda3/envs/mlbook/lib/python3.6/importlib/_bootstrap.py:205: RuntimeWarning: compiletime version 3.5 of module &#39;tensorflow.python.framework.fast_tensor_util&#39; does not match runtime version 3.6
  return f(*args, **kwds)
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [30]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">obiwan.qa.visual</span> <span class="kn">import</span> <span class="n">plotImage</span><span class="p">,</span> <span class="n">readImage</span><span class="p">,</span> <span class="n">sliceImage</span>
</pre></div>
</div>
</div>
<div class="section" id="Visualize-the-training-data">
<h1>Visualize the training data<a class="headerlink" href="#Visualize-the-training-data" title="Permalink to this headline">¶</a></h1>
<div class="section" id="read-the-hdf5-files">
<h2>read the hdf5 files<a class="headerlink" href="#read-the-hdf5-files" title="Permalink to this headline">¶</a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [123]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">f_dr5</span><span class="o">=</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;HOME&#39;</span><span class="p">],</span><span class="s1">&#39;DOWNLOADS&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;google_ai/hdf5/</span><span class="si">%s</span><span class="s1">/121/1211p060/img_ivar_grz.hdf5&#39;</span> <span class="o">%</span> <span class="s1">&#39;dr5&#39;</span><span class="p">),</span>
                    <span class="s1">&#39;r&#39;</span><span class="p">)</span>
<span class="n">f_dr5_jpeg</span><span class="o">=</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;HOME&#39;</span><span class="p">],</span><span class="s1">&#39;DOWNLOADS&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;google_ai/hdf5/</span><span class="si">%s</span><span class="s1">/121/1211p060/jpeg_grz.hdf5&#39;</span> <span class="o">%</span> <span class="s1">&#39;dr5&#39;</span><span class="p">),</span>
                    <span class="s1">&#39;r&#39;</span><span class="p">)</span>
<span class="n">dr5_sorted_ids</span><span class="o">=</span> <span class="n">fits_table</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;HOME&#39;</span><span class="p">],</span><span class="s1">&#39;DOWNLOADS&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;google_ai/hdf5/</span><span class="si">%s</span><span class="s1">/121/1211p060/sorted_ids.fits&#39;</span> <span class="o">%</span> <span class="s1">&#39;dr5&#39;</span><span class="p">))</span>

<span class="n">f_sim</span><span class="o">=</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;HOME&#39;</span><span class="p">],</span><span class="s1">&#39;DOWNLOADS&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;google_ai/hdf5/</span><span class="si">%s</span><span class="s1">/121/1211p060/img_ivar_grz.hdf5&#39;</span> <span class="o">%</span> <span class="s1">&#39;sim&#39;</span><span class="p">),</span>
                 <span class="s1">&#39;r&#39;</span><span class="p">)</span>

<span class="n">f_sim_jpeg</span><span class="o">=</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;HOME&#39;</span><span class="p">],</span><span class="s1">&#39;DOWNLOADS&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;google_ai/hdf5/</span><span class="si">%s</span><span class="s1">/121/1211p060/jpeg_grz.hdf5&#39;</span> <span class="o">%</span> <span class="s1">&#39;sim&#39;</span><span class="p">),</span>
                 <span class="s1">&#39;r&#39;</span><span class="p">)</span>
<span class="n">sim_sorted_ids</span><span class="o">=</span> <span class="n">fits_table</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;HOME&#39;</span><span class="p">],</span><span class="s1">&#39;DOWNLOADS&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;google_ai/hdf5/</span><span class="si">%s</span><span class="s1">/121/1211p060/sorted_ids.fits&#39;</span> <span class="o">%</span> <span class="s1">&#39;sim&#39;</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [124]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">keys</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">dr5</span><span class="o">=</span><span class="p">[</span><span class="n">key</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">f_dr5</span><span class="o">.</span><span class="n">keys</span><span class="p">()],</span>
          <span class="n">sim</span><span class="o">=</span><span class="p">[</span><span class="n">key</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">f_sim</span><span class="o">.</span><span class="n">keys</span><span class="p">()])</span>
          <span class="c1">#jpeg=list(f_sim_jpeg.keys()))</span>
<span class="nb">len</span><span class="p">(</span><span class="n">keys</span><span class="p">[</span><span class="s1">&#39;dr5&#39;</span><span class="p">]),</span><span class="nb">len</span><span class="p">(</span><span class="n">dr5_sorted_ids</span><span class="p">),</span><span class="nb">len</span><span class="p">(</span><span class="n">keys</span><span class="p">[</span><span class="s1">&#39;sim&#39;</span><span class="p">]),</span><span class="nb">len</span><span class="p">(</span><span class="n">sim_sorted_ids</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>Out[124]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>(880, 880, 259, 259)
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [125]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">f_sim</span><span class="p">[</span><span class="s1">&#39;/</span><span class="si">%s</span><span class="s1">/ivar&#39;</span> <span class="o">%</span> <span class="n">keys</span><span class="p">[</span><span class="s1">&#39;sim&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]]</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>Out[125]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>(64, 64, 3)
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [126]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">print</span><span class="p">(</span><span class="n">sim_sorted_ids</span><span class="o">.</span><span class="n">get_columns</span><span class="p">())</span>
<span class="k">for</span> <span class="n">T</span> <span class="ow">in</span> <span class="n">sim_sorted_ids</span><span class="p">[:</span><span class="mi">10</span><span class="p">]:</span> <span class="k">print</span><span class="p">(</span><span class="n">T</span><span class="o">.</span><span class="n">id</span><span class="p">,</span><span class="n">T</span><span class="o">.</span><span class="n">mag_g</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[&#39;id&#39;, &#39;mag_g&#39;]
103080843 21.3871759879
370074523 21.9118273261
114185542 22.1511480357
106085338 22.2520302338
61604085 22.4234469734
243535310 22.4476237756
156101043 22.516784148
8341765 22.5456832241
114521399 22.5477962344
85407414 22.6195802363
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [130]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">_</span><span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">sim_sorted_ids</span><span class="o">.</span><span class="n">mag_g</span><span class="p">,</span><span class="n">histtype</span><span class="o">=</span><span class="s1">&#39;step&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">)</span>
<span class="n">_</span><span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">dr5_sorted_ids</span><span class="o">.</span><span class="n">mag_g</span><span class="p">,</span><span class="n">histtype</span><span class="o">=</span><span class="s1">&#39;step&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;g&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/nb_CNN_8_0.png" src="../_images/nb_CNN_8_0.png" />
</div>
</div>
</div>
<div class="section" id="For-each-sim-mag_g,-draw-the-nearest-dr5-mag_g,-without-replacements">
<h2>For each sim mag_g, draw the nearest dr5 mag_g, without replacements<a class="headerlink" href="#For-each-sim-mag_g,-draw-the-nearest-dr5-mag_g,-without-replacements" title="Permalink to this headline">¶</a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [151]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">dr5_mags</span><span class="o">=</span> <span class="n">dr5_sorted_ids</span><span class="o">.</span><span class="n">mag_g</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">id_dr5_draw</span><span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">sim_mag</span> <span class="ow">in</span> <span class="n">sim_sorted_ids</span><span class="o">.</span><span class="n">mag_g</span><span class="p">:</span>
    <span class="n">i</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">dr5_mags</span> <span class="o">-</span> <span class="n">sim_mag</span><span class="p">))</span>
    <span class="n">id_dr5_draw</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dr5_sorted_ids</span><span class="o">.</span><span class="n">id</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="n">len_i</span><span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">dr5_mags</span><span class="p">)</span>
    <span class="n">dr5_mags</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">dr5_mags</span><span class="p">,</span><span class="n">dr5_mags</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="k">assert</span><span class="p">(</span><span class="n">len_i</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">dr5_mags</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="stderr output_area docutils container">
<div class="highlight"><pre>
/Users/kaylan1/miniconda3/envs/mlbook/lib/python3.6/site-packages/ipykernel_launcher.py:7: DeprecationWarning: using a non-integer array as obj in delete will result in an error in the future
  import sys
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [157]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">20</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="n">dr5_sorted_ids</span><span class="p">[</span><span class="n">dr5_sorted_ids</span><span class="o">.</span><span class="n">id</span> <span class="o">==</span> <span class="n">id_dr5_draw</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span><span class="o">.</span><span class="n">mag_g</span><span class="p">,</span> <span class="n">sim_sorted_ids</span><span class="o">.</span><span class="n">mag_g</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[ 21.39718819] 21.3871759879
[ 21.90782928] 21.9118273261
[ 22.14355278] 22.1511480357
[ 22.217062] 22.2520302338
[ 22.41222191] 22.4234469734
[ 22.4383316] 22.4476237756
[ 22.48746109] 22.516784148
[ 22.48746109] 22.5456832241
[ 22.48746109] 22.5477962344
[ 22.5747509] 22.6195802363
[ 22.62215424] 22.6675529884
[ 22.62044716] 22.6677327543
[ 22.63945389] 22.694754685
[ 22.64107895] 22.7006423466
[ 22.69321251] 22.7392880101
[ 22.69935799] 22.750211746
[ 22.69935799] 22.7524777029
[ 22.7031498] 22.7607775988
[ 22.71958923] 22.7808052859
[ 22.71958923] 22.7834926551
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [191]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">matplotlib</span> <span class="kn">as</span> <span class="nn">mpl</span>
<span class="n">fontsize</span><span class="o">=</span> <span class="mi">15</span>
<span class="n">mpl</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;axes.titlesize&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">fontsize</span>
<span class="n">mpl</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;axes.labelsize&#39;</span><span class="p">]</span><span class="o">=</span> <span class="n">fontsize</span>
<span class="n">mpl</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;font.size&#39;</span><span class="p">]</span><span class="o">=</span> <span class="n">fontsize</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [221]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">def</span> <span class="nf">fake_real_mosaic</span><span class="p">(</span><span class="n">i_start</span><span class="p">,</span> <span class="n">nrow</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span><span class="n">ncol</span><span class="o">=</span><span class="mi">7</span><span class="p">):</span>
    <span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrow</span><span class="p">,</span><span class="n">ncol</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="n">ncol</span><span class="o">*</span><span class="mf">1.5</span><span class="p">,</span><span class="mf">1.5</span><span class="o">*</span><span class="n">nrow</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">hspace</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span><span class="n">wspace</span><span class="o">=</span><span class="mf">0.01</span><span class="p">)</span>
    <span class="n">d_text</span><span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">rotation</span><span class="o">=</span><span class="s1">&#39;horizontal&#39;</span><span class="p">,</span>
               <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span>
                <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">)</span>

    <span class="c1"># Real</span>
    <span class="n">i_real</span><span class="o">=</span><span class="n">i_start</span><span class="o">-</span><span class="mi">1</span>
    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">nrow</span><span class="p">,</span><span class="mi">2</span><span class="p">):</span>
        <span class="n">i_real</span><span class="o">+=</span><span class="mi">1</span>
        <span class="n">plotImage</span><span class="p">()</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">f_dr5_jpeg</span><span class="p">[</span><span class="s1">&#39;/</span><span class="si">%s</span><span class="s1">/img&#39;</span> <span class="o">%</span> <span class="n">id_dr5_draw</span><span class="p">[</span><span class="n">i_real</span><span class="p">]],</span><span class="n">ax</span><span class="p">[</span><span class="n">row</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">iband</span><span class="p">,</span><span class="n">col</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">4</span><span class="p">)):</span>
            <span class="n">plotImage</span><span class="p">()</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">f_dr5</span><span class="p">[</span><span class="s1">&#39;/</span><span class="si">%s</span><span class="s1">/img&#39;</span> <span class="o">%</span> <span class="n">id_dr5_draw</span><span class="p">[</span><span class="n">i_real</span><span class="p">]][:,:,</span><span class="n">iband</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">,</span><span class="n">ax</span><span class="p">[</span><span class="n">row</span><span class="p">,</span><span class="n">col</span><span class="p">],</span><span class="n">qs</span><span class="o">=</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span><span class="mi">97</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">iband</span><span class="p">,</span><span class="n">col</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">7</span><span class="p">)):</span>
            <span class="n">plotImage</span><span class="p">()</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">f_dr5</span><span class="p">[</span><span class="s1">&#39;/</span><span class="si">%s</span><span class="s1">/ivar&#39;</span> <span class="o">%</span> <span class="n">id_dr5_draw</span><span class="p">[</span><span class="n">i_real</span><span class="p">]][:,:,</span><span class="n">iband</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">,</span><span class="n">ax</span><span class="p">[</span><span class="n">row</span><span class="p">,</span><span class="n">col</span><span class="p">],</span><span class="n">qs</span><span class="o">=</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span><span class="mi">97</span><span class="p">])</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">row</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">1.05</span><span class="p">,</span><span class="mf">0.5</span><span class="p">,</span><span class="s1">&#39;</span><span class="si">%.2f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">dr5_sorted_ids</span><span class="p">[</span><span class="n">dr5_sorted_ids</span><span class="o">.</span><span class="n">id</span> <span class="o">==</span> <span class="n">id_dr5_draw</span><span class="p">[</span><span class="n">i_real</span><span class="p">]]</span><span class="o">.</span><span class="n">mag_g</span><span class="p">,</span>
                        <span class="n">transform</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="n">row</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span><span class="o">**</span><span class="n">d_text</span><span class="p">)</span>
    <span class="c1"># Fake</span>
    <span class="n">i_fake</span><span class="o">=</span><span class="n">i_start</span><span class="o">-</span><span class="mi">1</span>
    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">nrow</span><span class="p">,</span><span class="mi">2</span><span class="p">):</span>
        <span class="n">i_fake</span><span class="o">+=</span><span class="mi">1</span>
        <span class="n">plotImage</span><span class="p">()</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">f_sim_jpeg</span><span class="p">[</span><span class="s1">&#39;/</span><span class="si">%s</span><span class="s1">/img&#39;</span> <span class="o">%</span> <span class="n">sim_sorted_ids</span><span class="o">.</span><span class="n">id</span><span class="p">[</span><span class="n">i_fake</span><span class="p">]],</span><span class="n">ax</span><span class="p">[</span><span class="n">row</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">iband</span><span class="p">,</span><span class="n">col</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">4</span><span class="p">)):</span>
            <span class="n">plotImage</span><span class="p">()</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">f_sim</span><span class="p">[</span><span class="s1">&#39;/</span><span class="si">%s</span><span class="s1">/img&#39;</span> <span class="o">%</span> <span class="n">sim_sorted_ids</span><span class="o">.</span><span class="n">id</span><span class="p">[</span><span class="n">i_fake</span><span class="p">]][:,:,</span><span class="n">iband</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">,</span><span class="n">ax</span><span class="p">[</span><span class="n">row</span><span class="p">,</span><span class="n">col</span><span class="p">],</span><span class="n">qs</span><span class="o">=</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span><span class="mi">97</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">iband</span><span class="p">,</span><span class="n">col</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">7</span><span class="p">)):</span>
            <span class="n">plotImage</span><span class="p">()</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">f_sim</span><span class="p">[</span><span class="s1">&#39;/</span><span class="si">%s</span><span class="s1">/ivar&#39;</span> <span class="o">%</span> <span class="n">sim_sorted_ids</span><span class="o">.</span><span class="n">id</span><span class="p">[</span><span class="n">i_fake</span><span class="p">]][:,:,</span><span class="n">iband</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">,</span><span class="n">ax</span><span class="p">[</span><span class="n">row</span><span class="p">,</span><span class="n">col</span><span class="p">],</span><span class="n">qs</span><span class="o">=</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span><span class="mi">97</span><span class="p">])</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">row</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">1.05</span><span class="p">,</span><span class="mf">0.5</span><span class="p">,</span><span class="s1">&#39;</span><span class="si">%.2f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">sim_sorted_ids</span><span class="o">.</span><span class="n">mag_g</span><span class="p">[</span><span class="n">i_fake</span><span class="p">],</span>
                        <span class="n">transform</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="n">row</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span><span class="o">**</span><span class="n">d_text</span><span class="p">)</span>


    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nrow</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ncol</span><span class="p">):</span>
            <span class="n">ax</span><span class="p">[</span><span class="n">row</span><span class="p">,</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">([])</span>
            <span class="n">ax</span><span class="p">[</span><span class="n">row</span><span class="p">,</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">([])</span>

    <span class="k">for</span> <span class="n">col</span><span class="p">,</span><span class="n">name</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">ncol</span><span class="p">),</span>
                        <span class="p">[</span><span class="s1">&#39;g+r+z&#39;</span><span class="p">,</span><span class="s1">&#39;g&#39;</span><span class="p">,</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="s1">&#39;z&#39;</span><span class="p">,</span><span class="s1">&#39;ivar(g)&#39;</span><span class="p">,</span><span class="s1">&#39;ivar(r)&#39;</span><span class="p">,</span><span class="s1">&#39;ivar(z)&#39;</span><span class="p">]):</span>
        <span class="n">tlab</span><span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
    <span class="n">mlab</span><span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">1.05</span><span class="p">,</span><span class="mf">1.1</span><span class="p">,</span><span class="s1">&#39;mag(g)&#39;</span><span class="p">,</span>
                        <span class="n">transform</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span><span class="o">**</span><span class="n">d_text</span><span class="p">)</span>
    <span class="n">d_lab</span><span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">rotation</span><span class="o">=</span><span class="s1">&#39;horizontal&#39;</span><span class="p">,</span>
               <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">,</span>
               <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">nrow</span><span class="p">,</span><span class="mi">2</span><span class="p">):</span>
        <span class="n">ylab</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="n">row</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;R&quot;</span><span class="p">,</span><span class="o">**</span><span class="n">d_lab</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">nrow</span><span class="p">,</span><span class="mi">2</span><span class="p">):</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">row</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;F&quot;</span><span class="p">,</span><span class="o">**</span><span class="n">d_lab</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;fake_real_mosaic_istart_</span><span class="si">%d</span><span class="s1">.png&#39;</span> <span class="o">%</span> <span class="n">i_start</span><span class="p">,</span>
                <span class="n">bbox_extra_artists</span><span class="o">=</span><span class="p">[</span><span class="n">tlab</span><span class="p">,</span><span class="n">ylab</span><span class="p">,</span><span class="n">mlab</span><span class="p">],</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="Mosaic-of-training-images">
<h2>Mosaic of training images<a class="headerlink" href="#Mosaic-of-training-images" title="Permalink to this headline">¶</a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [225]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Brightest</span>
<span class="n">fake_real_mosaic</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">nrow</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span><span class="n">ncol</span><span class="o">=</span><span class="mi">7</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/nb_CNN_15_0.png" src="../_images/nb_CNN_15_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [223]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Faintest</span>
<span class="n">fake_real_mosaic</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">sim_sorted_ids</span><span class="p">)</span><span class="o">-</span><span class="nb">int</span><span class="p">(</span><span class="n">nrow</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">nrow</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span><span class="n">ncol</span><span class="o">=</span><span class="mi">7</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/nb_CNN_16_0.png" src="../_images/nb_CNN_16_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [224]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Median</span>
<span class="n">fake_real_mosaic</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">sim_sorted_ids</span><span class="p">)</span><span class="o">//</span><span class="mi">2</span><span class="p">,</span> <span class="n">nrow</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span><span class="n">ncol</span><span class="o">=</span><span class="mi">7</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/nb_CNN_17_0.png" src="../_images/nb_CNN_17_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Loop over all sim sources</span>
<span class="k">for</span> <span class="n">istart</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">sim_sorted_ids</span><span class="p">),</span><span class="mi">8</span><span class="p">):</span>
    <span class="n">fake_real_mosaic</span><span class="p">(</span><span class="n">istart</span><span class="p">,</span> <span class="n">nrow</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span><span class="n">ncol</span><span class="o">=</span><span class="mi">7</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="stderr output_area docutils container">
<div class="highlight"><pre>
/Users/kaylan1/miniconda3/envs/mlbook/lib/python3.6/site-packages/matplotlib/pyplot.py:524: RuntimeWarning: More than 20 figures have been opened. Figures created through the pyplot interface (`matplotlib.pyplot.figure`) are retained until explicitly closed and may consume too much memory. (To control this warning, see the rcParam `figure.max_open_warning`).
  max_open_warning, RuntimeWarning)
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">IndexError</span>                                Traceback (most recent call last)
<span class="ansi-green-fg">&lt;ipython-input-227-a6e3b923c3b1&gt;</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span><span class="ansi-blue-fg">()</span>
<span class="ansi-green-intense-fg ansi-bold">      1</span> <span class="ansi-green-fg">for</span> istart <span class="ansi-green-fg">in</span> np<span class="ansi-blue-fg">.</span>arange<span class="ansi-blue-fg">(</span><span class="ansi-cyan-fg">0</span><span class="ansi-blue-fg">,</span>len<span class="ansi-blue-fg">(</span>sim_sorted_ids<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">,</span><span class="ansi-cyan-fg">8</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">----&gt; 2</span><span class="ansi-red-fg">     </span>fake_real_mosaic<span class="ansi-blue-fg">(</span>istart<span class="ansi-blue-fg">,</span> nrow<span class="ansi-blue-fg">=</span><span class="ansi-cyan-fg">8</span><span class="ansi-blue-fg">,</span>ncol<span class="ansi-blue-fg">=</span><span class="ansi-cyan-fg">7</span><span class="ansi-blue-fg">)</span>

<span class="ansi-green-fg">&lt;ipython-input-221-ad060ee414cb&gt;</span> in <span class="ansi-cyan-fg">fake_real_mosaic</span><span class="ansi-blue-fg">(i_start, nrow, ncol)</span>
<span class="ansi-green-intense-fg ansi-bold">     10</span>     <span class="ansi-green-fg">for</span> row <span class="ansi-green-fg">in</span> np<span class="ansi-blue-fg">.</span>arange<span class="ansi-blue-fg">(</span><span class="ansi-cyan-fg">0</span><span class="ansi-blue-fg">,</span>nrow<span class="ansi-blue-fg">,</span><span class="ansi-cyan-fg">2</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">     11</span>         i_real<span class="ansi-blue-fg">+=</span><span class="ansi-cyan-fg">1</span>
<span class="ansi-green-fg">---&gt; 12</span><span class="ansi-red-fg">         </span>plotImage<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">.</span>imshow<span class="ansi-blue-fg">(</span>f_dr5_jpeg<span class="ansi-blue-fg">[</span><span class="ansi-blue-fg">&#39;/%s/img&#39;</span> <span class="ansi-blue-fg">%</span> id_dr5_draw<span class="ansi-blue-fg">[</span>i_real<span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">,</span>ax<span class="ansi-blue-fg">[</span>row<span class="ansi-blue-fg">,</span><span class="ansi-cyan-fg">0</span><span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">     13</span>         <span class="ansi-green-fg">for</span> iband<span class="ansi-blue-fg">,</span>col <span class="ansi-green-fg">in</span> enumerate<span class="ansi-blue-fg">(</span>range<span class="ansi-blue-fg">(</span><span class="ansi-cyan-fg">1</span><span class="ansi-blue-fg">,</span><span class="ansi-cyan-fg">4</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">     14</span>             plotImage<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">.</span>imshow<span class="ansi-blue-fg">(</span>f_dr5<span class="ansi-blue-fg">[</span><span class="ansi-blue-fg">&#39;/%s/img&#39;</span> <span class="ansi-blue-fg">%</span> id_dr5_draw<span class="ansi-blue-fg">[</span>i_real<span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">[</span><span class="ansi-blue-fg">:</span><span class="ansi-blue-fg">,</span><span class="ansi-blue-fg">:</span><span class="ansi-blue-fg">,</span>iband<span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">.</span>T<span class="ansi-blue-fg">,</span>ax<span class="ansi-blue-fg">[</span>row<span class="ansi-blue-fg">,</span>col<span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">,</span>qs<span class="ansi-blue-fg">=</span><span class="ansi-blue-fg">[</span><span class="ansi-cyan-fg">3</span><span class="ansi-blue-fg">,</span><span class="ansi-cyan-fg">97</span><span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">)</span>

<span class="ansi-red-fg">IndexError</span>: list index out of range
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/nb_CNN_18_2.png" src="../_images/nb_CNN_18_2.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/nb_CNN_18_3.png" src="../_images/nb_CNN_18_3.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/nb_CNN_18_4.png" src="../_images/nb_CNN_18_4.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/nb_CNN_18_5.png" src="../_images/nb_CNN_18_5.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/nb_CNN_18_6.png" src="../_images/nb_CNN_18_6.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/nb_CNN_18_7.png" src="../_images/nb_CNN_18_7.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/nb_CNN_18_8.png" src="../_images/nb_CNN_18_8.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="stderr output_area docutils container">
<div class="highlight"><pre>
IOPub data rate exceeded.
The notebook server will temporarily stop sending output
to the client in order to avoid crashing it.
To change this limit, set the config variable
`--NotebookApp.iopub_data_rate_limit`.
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/nb_CNN_18_10.png" src="../_images/nb_CNN_18_10.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/nb_CNN_18_11.png" src="../_images/nb_CNN_18_11.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/nb_CNN_18_12.png" src="../_images/nb_CNN_18_12.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="stderr output_area docutils container">
<div class="highlight"><pre>
IOPub data rate exceeded.
The notebook server will temporarily stop sending output
to the client in order to avoid crashing it.
To change this limit, set the config variable
`--NotebookApp.iopub_data_rate_limit`.
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/nb_CNN_18_14.png" src="../_images/nb_CNN_18_14.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/nb_CNN_18_15.png" src="../_images/nb_CNN_18_15.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/nb_CNN_18_16.png" src="../_images/nb_CNN_18_16.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/nb_CNN_18_17.png" src="../_images/nb_CNN_18_17.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/nb_CNN_18_18.png" src="../_images/nb_CNN_18_18.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/nb_CNN_18_19.png" src="../_images/nb_CNN_18_19.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="stderr output_area docutils container">
<div class="highlight"><pre>
IOPub data rate exceeded.
The notebook server will temporarily stop sending output
to the client in order to avoid crashing it.
To change this limit, set the config variable
`--NotebookApp.iopub_data_rate_limit`.
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/nb_CNN_18_21.png" src="../_images/nb_CNN_18_21.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/nb_CNN_18_22.png" src="../_images/nb_CNN_18_22.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/nb_CNN_18_23.png" src="../_images/nb_CNN_18_23.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="stderr output_area docutils container">
<div class="highlight"><pre>
IOPub data rate exceeded.
The notebook server will temporarily stop sending output
to the client in order to avoid crashing it.
To change this limit, set the config variable
`--NotebookApp.iopub_data_rate_limit`.
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/nb_CNN_18_25.png" src="../_images/nb_CNN_18_25.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/nb_CNN_18_26.png" src="../_images/nb_CNN_18_26.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">glob</span> <span class="kn">import</span> <span class="n">glob</span>
<span class="n">fns</span><span class="o">=</span> <span class="n">glob</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;HOME&#39;</span><span class="p">],</span><span class="s1">&#39;Downloads&#39;</span><span class="p">,</span>
                <span class="s1">&#39;dr5_testtrain/testtrain/121/1211p060/xtrain_*.npy&#39;</span><span class="p">))</span>
<span class="n">xtrain</span><span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span> <span class="k">for</span> <span class="n">fn</span> <span class="ow">in</span> <span class="n">fns</span><span class="p">]</span>
<span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">(</span><span class="n">xtrain</span><span class="p">)</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>Out[12]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>(1408, 64, 64, 6)
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [34]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">jpg</span><span class="o">=</span> <span class="n">readImage</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;HOME&#39;</span><span class="p">],</span><span class="s1">&#39;DOWNLOADS&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;google_ai/legacysurvey-1211p060-image.jpg&#39;</span><span class="p">),</span><span class="n">jpeg</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">sliceImage</span><span class="p">(</span><span class="n">jpg</span><span class="p">,</span><span class="n">xslice</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">20</span><span class="p">),</span><span class="n">yslice</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">20</span><span class="p">))</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>Out[34]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>(10, 10, 3)
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [29]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="s1">&#39;/global/cscratch1/sd/kaylanb/obiwan_out/elg_dr5_coadds/coadd/121/1211p060/rs0&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>Out[29]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>&#39;rs0&#39;
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="Load-training-data-(.npy-files-created-with-&quot;split_traintest.py&quot;-script)">
<h1>Load training data (.npy files created with “split_traintest.py” script)<a class="headerlink" href="#Load-training-data-(.npy-files-created-with-"split_traintest.py"-script)" title="Permalink to this headline">¶</a></h1>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">dr</span><span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;HOME&#39;</span><span class="p">],</span><span class="s1">&#39;Downloads&#39;</span><span class="p">,</span>
                <span class="s1">&#39;dr5_testtrain/testtrain/121/1211p060&#39;</span><span class="p">)</span>
<span class="n">xtrain</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dr</span><span class="p">,</span><span class="s1">&#39;xtrain_1.npy&#39;</span><span class="p">))</span>
<span class="n">ytrain</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dr</span><span class="p">,</span><span class="s1">&#39;ytrain_1.npy&#39;</span><span class="p">))</span>
<span class="n">xtrain</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span><span class="n">ytrain</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">ytrain</span><span class="p">[</span><span class="n">ytrain</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]),</span><span class="nb">set</span><span class="p">(</span><span class="n">ytrain</span><span class="p">)</span>

</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>Out[7]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>((512, 64, 64, 6), (512,), 250, {0.0, 1.0})
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [26]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">isFake</span><span class="o">=</span> <span class="n">ytrain</span> <span class="o">==</span> <span class="mi">1</span>
<span class="n">img_inds</span><span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">]</span>

<span class="n">nrow</span><span class="p">,</span><span class="n">ncol</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="mi">8</span>
<span class="k">for</span> <span class="n">band</span><span class="p">,</span><span class="n">iband</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="s1">&#39;grz&#39;</span><span class="p">,</span><span class="n">img_inds</span><span class="p">):</span>
    <span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrow</span><span class="p">,</span><span class="n">ncol</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
    <span class="n">i</span><span class="o">=-</span><span class="mi">1</span>
    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nrow</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ncol</span><span class="p">):</span>
            <span class="n">i</span><span class="o">+=</span><span class="mi">1</span>
            <span class="n">plotImage</span><span class="p">()</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">xtrain</span><span class="p">[</span><span class="n">isFake</span><span class="p">][</span><span class="n">i</span><span class="p">,:,:,</span><span class="n">iband</span><span class="p">],</span><span class="n">ax</span><span class="p">[</span><span class="n">row</span><span class="p">,</span><span class="n">col</span><span class="p">])</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">-band&#39;</span> <span class="o">%</span> <span class="n">band</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/nb_CNN_24_0.png" src="../_images/nb_CNN_24_0.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/nb_CNN_24_1.png" src="../_images/nb_CNN_24_1.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/nb_CNN_24_2.png" src="../_images/nb_CNN_24_2.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [28]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">img_inds</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">])</span><span class="o">+</span><span class="mi">1</span>

<span class="n">nrow</span><span class="p">,</span><span class="n">ncol</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="mi">8</span>
<span class="k">for</span> <span class="n">band</span><span class="p">,</span><span class="n">iband</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="s1">&#39;grz&#39;</span><span class="p">,</span><span class="n">img_inds</span><span class="p">):</span>
    <span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrow</span><span class="p">,</span><span class="n">ncol</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
    <span class="n">i</span><span class="o">=-</span><span class="mi">1</span>
    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nrow</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ncol</span><span class="p">):</span>
            <span class="n">i</span><span class="o">+=</span><span class="mi">1</span>
            <span class="n">plotImage</span><span class="p">()</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">xtrain</span><span class="p">[</span><span class="n">isFake</span><span class="p">][</span><span class="n">i</span><span class="p">,:,:,</span><span class="n">iband</span><span class="p">],</span><span class="n">ax</span><span class="p">[</span><span class="n">row</span><span class="p">,</span><span class="n">col</span><span class="p">])</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s1">&#39;ivar-</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">band</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/nb_CNN_25_0.png" src="../_images/nb_CNN_25_0.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/nb_CNN_25_1.png" src="../_images/nb_CNN_25_1.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/nb_CNN_25_2.png" src="../_images/nb_CNN_25_2.png" />
</div>
</div>
</div>
<div class="section" id="Build-the-CNN">
<h1>Build the CNN<a class="headerlink" href="#Build-the-CNN" title="Permalink to this headline">¶</a></h1>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [31]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">xtrain</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="o">...</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">xtrain</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span><span class="n">ytrain</span><span class="o">.</span><span class="n">dtype</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>Out[31]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>((64, 64, 6), dtype(&#39;float32&#39;), dtype(&#39;float64&#39;))
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [67]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Design:</span>
<span class="c1"># input, 3x(conv + avg pool), 2x(fc)</span>

<span class="n">height</span><span class="p">,</span><span class="n">width</span><span class="p">,</span><span class="n">channels</span> <span class="o">=</span> <span class="p">(</span><span class="mi">64</span><span class="p">,</span><span class="mi">64</span><span class="p">,</span><span class="mi">6</span><span class="p">)</span> <span class="c1">#images_real.shape</span>

<span class="n">reset_graph</span><span class="p">()</span>

<span class="n">conv_kwargs</span><span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">strides</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                  <span class="n">padding</span><span class="o">=</span><span class="s1">&#39;SAME&#39;</span><span class="p">,</span>
                  <span class="n">activation</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">relu</span><span class="p">)</span>
<span class="n">pool_kwargs</span><span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">ksize</span><span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span>
                  <span class="n">strides</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span>
                  <span class="n">padding</span><span class="o">=</span><span class="s1">&#39;VALID&#39;</span><span class="p">)</span>

<span class="k">with</span> <span class="n">tf</span><span class="o">.</span><span class="n">name_scope</span><span class="p">(</span><span class="s2">&quot;inputs&quot;</span><span class="p">):</span>
    <span class="n">X</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">placeholder</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">float32</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="p">[</span><span class="bp">None</span><span class="p">,</span><span class="n">height</span><span class="p">,</span><span class="n">width</span><span class="p">,</span><span class="n">channels</span><span class="p">],</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;X&quot;</span><span class="p">)</span> <span class="c1">#training data shape</span>
    <span class="c1">#X_reshaped = tf.reshape(X, shape=[-1, height, width, channels])</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">placeholder</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">int32</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="p">[</span><span class="bp">None</span><span class="p">],</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;y&quot;</span><span class="p">)</span>

<span class="n">init</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">global_variables_initializer</span><span class="p">()</span>

<span class="c1"># 64x64</span>
<span class="k">with</span> <span class="n">tf</span><span class="o">.</span><span class="n">name_scope</span><span class="p">(</span><span class="s2">&quot;layer1&quot;</span><span class="p">):</span>
    <span class="n">conv1</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">conv2d</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">filters</span><span class="o">=</span><span class="mi">2</span><span class="o">*</span><span class="n">channels</span><span class="p">,</span> <span class="n">kernel_size</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span>
                             <span class="o">**</span><span class="n">conv_kwargs</span><span class="p">)</span>
    <span class="n">pool1</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">avg_pool</span><span class="p">(</span><span class="n">conv1</span><span class="p">,</span> <span class="o">**</span><span class="n">pool_kwargs</span><span class="p">)</span>

<span class="c1"># 32x32</span>
<span class="k">with</span> <span class="n">tf</span><span class="o">.</span><span class="n">name_scope</span><span class="p">(</span><span class="s2">&quot;layer2&quot;</span><span class="p">):</span>
    <span class="n">conv2</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">conv2d</span><span class="p">(</span><span class="n">pool1</span><span class="p">,</span> <span class="n">filters</span><span class="o">=</span><span class="mi">4</span><span class="o">*</span><span class="n">channels</span><span class="p">,</span> <span class="n">kernel_size</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span>
                             <span class="o">**</span><span class="n">conv_kwargs</span><span class="p">)</span>
    <span class="n">pool2</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">avg_pool</span><span class="p">(</span><span class="n">conv2</span><span class="p">,</span> <span class="o">**</span><span class="n">pool_kwargs</span><span class="p">)</span>

<span class="c1"># 16x16</span>
<span class="k">with</span> <span class="n">tf</span><span class="o">.</span><span class="n">name_scope</span><span class="p">(</span><span class="s2">&quot;layer3&quot;</span><span class="p">):</span>
    <span class="n">conv3</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">conv2d</span><span class="p">(</span><span class="n">pool2</span><span class="p">,</span> <span class="n">filters</span><span class="o">=</span><span class="mi">8</span><span class="o">*</span><span class="n">channels</span><span class="p">,</span> <span class="n">kernel_size</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span>
                             <span class="o">**</span><span class="n">conv_kwargs</span><span class="p">)</span>
    <span class="n">pool3</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">avg_pool</span><span class="p">(</span><span class="n">conv3</span><span class="p">,</span> <span class="o">**</span><span class="n">pool_kwargs</span><span class="p">)</span>
    <span class="c1"># next is fc</span>
    <span class="n">pool3_flat</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">pool3</span><span class="p">,</span>
                            <span class="n">shape</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">pool3</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">pool3</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">pool3</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">3</span><span class="p">]])</span>


<span class="k">with</span> <span class="n">tf</span><span class="o">.</span><span class="n">name_scope</span><span class="p">(</span><span class="s2">&quot;fc&quot;</span><span class="p">):</span>
    <span class="n">fc</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">dense</span><span class="p">(</span><span class="n">pool3_flat</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">relu</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;fc&quot;</span><span class="p">)</span>

<span class="k">with</span> <span class="n">tf</span><span class="o">.</span><span class="n">name_scope</span><span class="p">(</span><span class="s2">&quot;output&quot;</span><span class="p">):</span>
    <span class="n">logits</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">dense</span><span class="p">(</span><span class="n">fc</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;output&quot;</span><span class="p">)</span> <span class="c1"># 2 classes</span>
    <span class="n">Y_proba</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">softmax</span><span class="p">(</span><span class="n">logits</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Y_proba&quot;</span><span class="p">)</span>

<span class="k">with</span> <span class="n">tf</span><span class="o">.</span><span class="n">name_scope</span><span class="p">(</span><span class="s2">&quot;train&quot;</span><span class="p">):</span>
    <span class="n">xentropy</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">sparse_softmax_cross_entropy_with_logits</span><span class="p">(</span><span class="n">logits</span><span class="o">=</span><span class="n">logits</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="n">y</span><span class="p">)</span>
    <span class="n">loss</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">reduce_mean</span><span class="p">(</span><span class="n">xentropy</span><span class="p">)</span>
    <span class="n">optimizer</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">train</span><span class="o">.</span><span class="n">AdamOptimizer</span><span class="p">()</span>
    <span class="n">training_op</span> <span class="o">=</span> <span class="n">optimizer</span><span class="o">.</span><span class="n">minimize</span><span class="p">(</span><span class="n">loss</span><span class="p">)</span>

<span class="k">with</span> <span class="n">tf</span><span class="o">.</span><span class="n">name_scope</span><span class="p">(</span><span class="s2">&quot;eval&quot;</span><span class="p">):</span>
    <span class="n">correct</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">in_top_k</span><span class="p">(</span><span class="n">logits</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">accuracy</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">reduce_mean</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">correct</span><span class="p">,</span> <span class="n">tf</span><span class="o">.</span><span class="n">float32</span><span class="p">))</span>

<span class="n">init</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">global_variables_initializer</span><span class="p">()</span>
<span class="n">saver</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">train</span><span class="o">.</span><span class="n">Saver</span><span class="p">()</span>

<span class="n">loss_summary</span><span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">summary</span><span class="o">.</span><span class="n">scalar</span><span class="p">(</span><span class="s1">&#39;loss&#39;</span><span class="p">,</span> <span class="n">loss</span><span class="p">)</span>
<span class="n">accur_summary</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">summary</span><span class="o">.</span><span class="n">scalar</span><span class="p">(</span><span class="s1">&#39;accuracy&#39;</span><span class="p">,</span> <span class="n">accuracy</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [75]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">logits</span><span class="o">.</span><span class="n">op</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">loss</span><span class="o">.</span><span class="n">op</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">accuracy</span><span class="o">.</span><span class="n">op</span><span class="o">.</span><span class="n">name</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>Out[75]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>(&#39;output/output/BiasAdd&#39;, &#39;train/Mean&#39;, &#39;eval/Mean&#39;)
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [68]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">def</span> <span class="nf">BatchGen</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">batch_size</span><span class="o">=</span><span class="mi">32</span><span class="p">):</span>
    <span class="c1"># if not perfect divide, will drop extra training instances</span>
    <span class="n">N</span><span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">ind</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array_split</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">N</span><span class="p">),</span><span class="n">N</span> <span class="o">//</span> <span class="n">batch_size</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">ind</span><span class="p">:</span>
        <span class="k">yield</span> <span class="n">X</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="o">...</span><span class="p">],</span><span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span> <span class="c1">#.reshape(-1,1).astype(np.int32)</span>

<span class="n">a</span><span class="o">=</span><span class="n">BatchGen</span><span class="p">(</span><span class="n">xtrain</span><span class="p">,</span><span class="n">ytrain</span><span class="p">,</span><span class="n">batch_size</span><span class="o">=</span><span class="mi">32</span><span class="p">)</span>
<span class="k">for</span> <span class="n">X_</span><span class="p">,</span><span class="n">y_</span> <span class="ow">in</span> <span class="n">a</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;batch:&#39;</span><span class="p">,</span><span class="n">X_</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span><span class="n">y_</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
batch: (32, 64, 64, 6) (32,)
batch: (32, 64, 64, 6) (32,)
batch: (32, 64, 64, 6) (32,)
batch: (32, 64, 64, 6) (32,)
batch: (32, 64, 64, 6) (32,)
batch: (32, 64, 64, 6) (32,)
batch: (32, 64, 64, 6) (32,)
batch: (32, 64, 64, 6) (32,)
batch: (32, 64, 64, 6) (32,)
batch: (32, 64, 64, 6) (32,)
batch: (32, 64, 64, 6) (32,)
batch: (32, 64, 64, 6) (32,)
batch: (32, 64, 64, 6) (32,)
batch: (32, 64, 64, 6) (32,)
batch: (32, 64, 64, 6) (32,)
batch: (32, 64, 64, 6) (32,)
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [69]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>

<span class="k">def</span> <span class="nf">get_logdir</span><span class="p">(</span><span class="n">root_logdir</span><span class="p">):</span>
    <span class="n">now</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y%m</span><span class="si">%d</span><span class="s2">%H%M%S&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="s2">&quot;{}/run-{}/&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">root_logdir</span><span class="p">,</span> <span class="n">now</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="Layers-(check-that-size-of-each-layer-makes-sense)">
<h2>Layers (check that size of each layer makes sense)<a class="headerlink" href="#Layers-(check-that-size-of-each-layer-makes-sense)" title="Permalink to this headline">¶</a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [70]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">batch_size</span><span class="o">=</span><span class="mi">32</span>
<span class="n">X_</span><span class="p">,</span><span class="n">y_</span><span class="o">=</span> <span class="n">xtrain</span><span class="p">[:</span><span class="n">batch_size</span><span class="p">,</span><span class="o">...</span><span class="p">],</span><span class="n">ytrain</span><span class="p">[:</span><span class="n">batch_size</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>

<span class="k">with</span> <span class="n">tf</span><span class="o">.</span><span class="n">Session</span><span class="p">()</span> <span class="k">as</span> <span class="n">sess</span><span class="p">:</span>
    <span class="n">sess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">init</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="n">sess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">feed_dict</span><span class="o">=</span><span class="p">{</span><span class="n">X</span><span class="p">:</span> <span class="n">X_</span><span class="p">})</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="n">sess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">conv1</span><span class="p">,</span> <span class="n">feed_dict</span><span class="o">=</span><span class="p">{</span><span class="n">X</span><span class="p">:</span> <span class="n">X_</span><span class="p">})</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="n">sess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">pool1</span><span class="p">,</span> <span class="n">feed_dict</span><span class="o">=</span><span class="p">{</span><span class="n">X</span><span class="p">:</span> <span class="n">X_</span><span class="p">})</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="n">sess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">conv2</span><span class="p">,</span> <span class="n">feed_dict</span><span class="o">=</span><span class="p">{</span><span class="n">X</span><span class="p">:</span> <span class="n">X_</span><span class="p">})</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="n">sess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">pool2</span><span class="p">,</span> <span class="n">feed_dict</span><span class="o">=</span><span class="p">{</span><span class="n">X</span><span class="p">:</span> <span class="n">X_</span><span class="p">})</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="n">sess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">conv3</span><span class="p">,</span> <span class="n">feed_dict</span><span class="o">=</span><span class="p">{</span><span class="n">X</span><span class="p">:</span> <span class="n">X_</span><span class="p">})</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="n">sess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">pool3</span><span class="p">,</span> <span class="n">feed_dict</span><span class="o">=</span><span class="p">{</span><span class="n">X</span><span class="p">:</span> <span class="n">X_</span><span class="p">})</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="n">sess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">pool3_flat</span><span class="p">,</span> <span class="n">feed_dict</span><span class="o">=</span><span class="p">{</span><span class="n">X</span><span class="p">:</span> <span class="n">X_</span><span class="p">})</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="n">sess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">fc</span><span class="p">,</span> <span class="n">feed_dict</span><span class="o">=</span><span class="p">{</span><span class="n">X</span><span class="p">:</span> <span class="n">X_</span><span class="p">})</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="n">sess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">logits</span><span class="p">,</span> <span class="n">feed_dict</span><span class="o">=</span><span class="p">{</span><span class="n">X</span><span class="p">:</span> <span class="n">X_</span><span class="p">})</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(32, 64, 64, 6)
(32, 64, 64, 12)
(32, 32, 32, 12)
(32, 32, 32, 24)
(32, 16, 16, 24)
(32, 16, 16, 48)
(32, 8, 8, 48)
(32, 3072)
(32, 64)
(32, 2)
</pre></div></div>
</div>
</div>
<div class="section" id="Train-(4-epochs)">
<h2>Train (4 epochs)<a class="headerlink" href="#Train-(4-epochs)" title="Permalink to this headline">¶</a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [72]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">xtrain</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dr</span><span class="p">,</span><span class="s1">&#39;xtrain_1.npy&#39;</span><span class="p">))</span>
<span class="n">ytrain</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dr</span><span class="p">,</span><span class="s1">&#39;ytrain_1.npy&#39;</span><span class="p">))</span>
<span class="n">file_writer</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">summary</span><span class="o">.</span><span class="n">FileWriter</span><span class="p">(</span><span class="n">get_logdir</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;HOME&#39;</span><span class="p">],</span><span class="s1">&#39;Downloads&#39;</span><span class="p">,</span>
                                                <span class="s2">&quot;cnn&quot;</span><span class="p">,</span><span class="s1">&#39;logs&#39;</span><span class="p">)),</span>
                                    <span class="n">tf</span><span class="o">.</span><span class="n">get_default_graph</span><span class="p">())</span>

<span class="n">n_epochs</span> <span class="o">=</span> <span class="mi">4</span>
<span class="n">batch_size</span> <span class="o">=</span> <span class="mi">32</span>
<span class="n">n_batches</span><span class="o">=</span> <span class="n">ytrain</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">//</span><span class="n">batch_size</span> <span class="o">+</span> <span class="mi">1</span>

<span class="k">with</span> <span class="n">tf</span><span class="o">.</span><span class="n">Session</span><span class="p">()</span> <span class="k">as</span> <span class="n">sess</span><span class="p">:</span>
    <span class="n">sess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">init</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">epoch</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_epochs</span><span class="p">):</span>
        <span class="n">data_gen</span><span class="o">=</span> <span class="n">BatchGen</span><span class="p">(</span><span class="n">xtrain</span><span class="p">,</span><span class="n">ytrain</span><span class="p">,</span><span class="n">batch_size</span><span class="p">)</span>
        <span class="n">batch_index</span><span class="o">=</span><span class="mi">0</span>
        <span class="k">for</span> <span class="n">X_</span><span class="p">,</span><span class="n">y_</span> <span class="ow">in</span> <span class="n">data_gen</span><span class="p">:</span>
            <span class="n">sess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">training_op</span><span class="p">,</span> <span class="n">feed_dict</span><span class="o">=</span><span class="p">{</span><span class="n">X</span><span class="p">:</span> <span class="n">X_</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="n">y_</span><span class="p">})</span>
            <span class="n">batch_index</span><span class="o">+=</span><span class="mi">1</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">%</span> <span class="mi">1</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">step</span> <span class="o">=</span> <span class="n">epoch</span> <span class="o">*</span> <span class="n">n_batches</span> <span class="o">+</span> <span class="n">batch_index</span>
                <span class="n">file_writer</span><span class="o">.</span><span class="n">add_summary</span><span class="p">(</span><span class="n">loss_summary</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="n">feed_dict</span><span class="o">=</span><span class="p">{</span><span class="n">X</span><span class="p">:</span> <span class="n">X_</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="n">y_</span><span class="p">}),</span>
                                        <span class="n">step</span><span class="p">)</span>
                <span class="n">file_writer</span><span class="o">.</span><span class="n">add_summary</span><span class="p">(</span><span class="n">accur_summary</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="n">feed_dict</span><span class="o">=</span><span class="p">{</span><span class="n">X</span><span class="p">:</span> <span class="n">X_</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="n">y_</span><span class="p">}),</span>
                                        <span class="n">step</span><span class="p">)</span>

        <span class="n">acc_train</span> <span class="o">=</span> <span class="n">accuracy</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="n">feed_dict</span><span class="o">=</span><span class="p">{</span><span class="n">X</span><span class="p">:</span> <span class="n">X_</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="n">y_</span><span class="p">})</span>
        <span class="k">print</span><span class="p">(</span><span class="n">epoch</span><span class="p">,</span> <span class="s2">&quot;Train accuracy:&quot;</span><span class="p">,</span> <span class="n">acc_train</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">epoch</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">save_path</span> <span class="o">=</span> <span class="n">saver</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">sess</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;HOME&#39;</span><span class="p">],</span><span class="s1">&#39;Downloads&#39;</span><span class="p">,</span>
                                                  <span class="s2">&quot;cnn/checkpoint.ckpt&quot;</span><span class="p">))</span>
    <span class="n">save_path</span> <span class="o">=</span> <span class="n">saver</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">sess</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;HOME&#39;</span><span class="p">],</span><span class="s1">&#39;Downloads&#39;</span><span class="p">,</span>
                                              <span class="s2">&quot;cnn/final.ckpt&quot;</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
0 Train accuracy: 0.46875
1 Train accuracy: 0.78125
2 Train accuracy: 0.75
3 Train accuracy: 0.84375
</pre></div></div>
</div>
</div>
<div class="section" id="Restart-from-checkpoints">
<h2>Restart from checkpoints<a class="headerlink" href="#Restart-from-checkpoints" title="Permalink to this headline">¶</a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [59]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">xtrain</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dr</span><span class="p">,</span><span class="s1">&#39;xtrain_2.npy&#39;</span><span class="p">))</span>
<span class="n">ytrain</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dr</span><span class="p">,</span><span class="s1">&#39;ytrain_2.npy&#39;</span><span class="p">))</span>
<span class="k">with</span> <span class="n">tf</span><span class="o">.</span><span class="n">Session</span><span class="p">()</span> <span class="k">as</span> <span class="n">sess</span><span class="p">:</span>
    <span class="c1"># Equiv of sess.run(init)</span>
    <span class="n">saver</span><span class="o">.</span><span class="n">restore</span><span class="p">(</span><span class="n">sess</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;HOME&#39;</span><span class="p">],</span><span class="s1">&#39;Downloads&#39;</span><span class="p">,</span>
                                              <span class="s2">&quot;cnn/final.ckpt&quot;</span><span class="p">))</span>
    <span class="c1">#print(&#39;resorted model has accur=&#39;,accuracy.eval())</span>
    <span class="k">for</span> <span class="n">epoch</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_epochs</span><span class="p">):</span>
        <span class="n">data_gen</span><span class="o">=</span> <span class="n">BatchGen</span><span class="p">(</span><span class="n">xtrain</span><span class="p">,</span><span class="n">ytrain</span><span class="p">,</span><span class="n">batch_size</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">X_</span><span class="p">,</span><span class="n">y_</span> <span class="ow">in</span> <span class="n">data_gen</span><span class="p">:</span>
            <span class="n">sess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">training_op</span><span class="p">,</span> <span class="n">feed_dict</span><span class="o">=</span><span class="p">{</span><span class="n">X</span><span class="p">:</span> <span class="n">X_</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="n">y_</span><span class="p">})</span>
        <span class="n">acc_train</span> <span class="o">=</span> <span class="n">accuracy</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="n">feed_dict</span><span class="o">=</span><span class="p">{</span><span class="n">X</span><span class="p">:</span> <span class="n">X_</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="n">y_</span><span class="p">})</span>
        <span class="k">print</span><span class="p">(</span><span class="n">epoch</span><span class="p">,</span> <span class="s2">&quot;Train accuracy:&quot;</span><span class="p">,</span> <span class="n">acc_train</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">epoch</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">save_path</span> <span class="o">=</span> <span class="n">saver</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">sess</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;HOME&#39;</span><span class="p">],</span><span class="s1">&#39;Downloads&#39;</span><span class="p">,</span>
                                                  <span class="s2">&quot;cnn/checkpoint.ckpt&quot;</span><span class="p">))</span>
    <span class="n">save_path</span> <span class="o">=</span> <span class="n">saver</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">sess</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;HOME&#39;</span><span class="p">],</span><span class="s1">&#39;Downloads&#39;</span><span class="p">,</span>
                                              <span class="s2">&quot;cnn/final.ckpt&quot;</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
INFO:tensorflow:Restoring parameters from /Users/kaylan/Downloads/cnn/final.ckpt
0 Train accuracy: 0.90625
1 Train accuracy: 0.90625
2 Train accuracy: 0.90625
3 Train accuracy: 0.90625
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">f_real</span><span class="o">=</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;HOME&#39;</span><span class="p">],</span><span class="s1">&#39;DOWNLOADS&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;dr5_hdf5/hdf5/121/1211p060/img_ivar_grz.hdf5&#39;</span><span class="p">),</span>
                    <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="c1">#1165p107</span>
<span class="n">dr5_tractor</span><span class="o">=</span> <span class="n">fits_table</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;HOME&#39;</span><span class="p">],</span><span class="s1">&#39;DOWNLOADS&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;dr5_hdf5/hdf5/121/1211p060/tractor-1211p060.fits&#39;</span><span class="p">))</span>


<span class="n">f_fake</span><span class="o">=</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;HOME&#39;</span><span class="p">],</span><span class="s1">&#39;DOWNLOADS&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;elg_dr5_coadds/hdf5/121/1211p060/img_ivar_grz.hdf5&#39;</span><span class="p">),</span>
                    <span class="s1">&#39;r&#39;</span><span class="p">)</span>
<span class="n">simcat</span><span class="o">=</span> <span class="n">fits_table</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;HOME&#39;</span><span class="p">],</span><span class="s1">&#39;DOWNLOADS&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;elg_dr5_coadds/hdf5/121/1211p060&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;simcat-elg-1211p060-rsALL.fits&#39;</span><span class="p">))</span>

<span class="k">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">f_real</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span><span class="nb">len</span><span class="p">(</span><span class="n">f_fake</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">f_real</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span><span class="nb">len</span><span class="p">(</span><span class="n">f_fake</span><span class="o">.</span><span class="n">keys</span><span class="p">())]))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">OSError</span>                                   Traceback (most recent call last)
<span class="ansi-green-fg">&lt;ipython-input-4-45479c8404b2&gt;</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span><span class="ansi-blue-fg">()</span>
<span class="ansi-green-intense-fg ansi-bold">      1</span> f_real= h5py.File(os.path.join(os.environ[&#39;HOME&#39;],&#39;DOWNLOADS&#39;,
<span class="ansi-green-intense-fg ansi-bold">      2</span>                     &#39;dr5_hdf5/hdf5/121/1211p060/img_ivar_grz.hdf5&#39;),
<span class="ansi-green-fg">----&gt; 3</span><span class="ansi-red-fg">                     &#39;r&#39;) #1165p107
</span><span class="ansi-green-intense-fg ansi-bold">      4</span> dr5_tractor= fits_table(os.path.join(os.environ[&#39;HOME&#39;],&#39;DOWNLOADS&#39;,
<span class="ansi-green-intense-fg ansi-bold">      5</span>                     &#39;dr5_hdf5/hdf5/121/1211p060/tractor-1211p060.fits&#39;))

<span class="ansi-green-fg">~/miniconda3/envs/tensorflow/lib/python3.5/site-packages/h5py/_hl/files.py</span> in <span class="ansi-cyan-fg">__init__</span><span class="ansi-blue-fg">(self, name, mode, driver, libver, userblock_size, swmr, **kwds)</span>
<span class="ansi-green-intense-fg ansi-bold">    267</span>             <span class="ansi-green-fg">with</span> phil<span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">    268</span>                 fapl <span class="ansi-blue-fg">=</span> make_fapl<span class="ansi-blue-fg">(</span>driver<span class="ansi-blue-fg">,</span> libver<span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">**</span>kwds<span class="ansi-blue-fg">)</span>
<span class="ansi-green-fg">--&gt; 269</span><span class="ansi-red-fg">                 </span>fid <span class="ansi-blue-fg">=</span> make_fid<span class="ansi-blue-fg">(</span>name<span class="ansi-blue-fg">,</span> mode<span class="ansi-blue-fg">,</span> userblock_size<span class="ansi-blue-fg">,</span> fapl<span class="ansi-blue-fg">,</span> swmr<span class="ansi-blue-fg">=</span>swmr<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    270</span>
<span class="ansi-green-intense-fg ansi-bold">    271</span>                 <span class="ansi-green-fg">if</span> swmr_support<span class="ansi-blue-fg">:</span>

<span class="ansi-green-fg">~/miniconda3/envs/tensorflow/lib/python3.5/site-packages/h5py/_hl/files.py</span> in <span class="ansi-cyan-fg">make_fid</span><span class="ansi-blue-fg">(name, mode, userblock_size, fapl, fcpl, swmr)</span>
<span class="ansi-green-intense-fg ansi-bold">     97</span>         <span class="ansi-green-fg">if</span> swmr <span class="ansi-green-fg">and</span> swmr_support<span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">     98</span>             flags <span class="ansi-blue-fg">|=</span> h5f<span class="ansi-blue-fg">.</span>ACC_SWMR_READ
<span class="ansi-green-fg">---&gt; 99</span><span class="ansi-red-fg">         </span>fid <span class="ansi-blue-fg">=</span> h5f<span class="ansi-blue-fg">.</span>open<span class="ansi-blue-fg">(</span>name<span class="ansi-blue-fg">,</span> flags<span class="ansi-blue-fg">,</span> fapl<span class="ansi-blue-fg">=</span>fapl<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    100</span>     <span class="ansi-green-fg">elif</span> mode <span class="ansi-blue-fg">==</span> <span class="ansi-blue-fg">&#39;r+&#39;</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">    101</span>         fid <span class="ansi-blue-fg">=</span> h5f<span class="ansi-blue-fg">.</span>open<span class="ansi-blue-fg">(</span>name<span class="ansi-blue-fg">,</span> h5f<span class="ansi-blue-fg">.</span>ACC_RDWR<span class="ansi-blue-fg">,</span> fapl<span class="ansi-blue-fg">=</span>fapl<span class="ansi-blue-fg">)</span>

<span class="ansi-green-fg">h5py/_objects.pyx</span> in <span class="ansi-cyan-fg">h5py._objects.with_phil.wrapper</span><span class="ansi-blue-fg">()</span>

<span class="ansi-green-fg">h5py/_objects.pyx</span> in <span class="ansi-cyan-fg">h5py._objects.with_phil.wrapper</span><span class="ansi-blue-fg">()</span>

<span class="ansi-green-fg">h5py/h5f.pyx</span> in <span class="ansi-cyan-fg">h5py.h5f.open</span><span class="ansi-blue-fg">()</span>

<span class="ansi-red-fg">OSError</span>: Unable to open file (unable to open file: name = &#39;/Users/kaylan/DOWNLOADS/dr5_hdf5/hdf5/121/1211p060/img_ivar_grz.hdf5&#39;, errno = 2, error message = &#39;No such file or directory&#39;, flags = 0, o_flags = 0)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [87]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">def</span> <span class="nf">get_data</span><span class="p">(</span><span class="n">f</span><span class="p">,</span><span class="n">num</span><span class="o">=</span><span class="mi">128</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Returns numpy array (num,64,64,6)&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">([</span><span class="n">f</span><span class="p">[</span><span class="n">key</span><span class="o">+</span><span class="s1">&#39;/img&#39;</span><span class="p">],</span><span class="n">f</span><span class="p">[</span><span class="n">key</span><span class="o">+</span><span class="s1">&#39;/ivar&#39;</span><span class="p">]],</span><span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">64</span><span class="p">,</span><span class="mi">64</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
                     <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">keys</span><span class="p">())[:</span><span class="n">num</span><span class="p">]])</span>

<span class="k">def</span> <span class="nf">get_data_imgonly</span><span class="p">(</span><span class="n">f</span><span class="p">,</span><span class="n">num</span><span class="o">=</span><span class="mi">128</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Returns numpy array (num,64,64,3)&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">f</span><span class="p">[</span><span class="n">key</span><span class="o">+</span><span class="s1">&#39;/img&#39;</span><span class="p">],(</span><span class="mi">64</span><span class="p">,</span><span class="mi">64</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
                     <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">keys</span><span class="p">())[:</span><span class="n">num</span><span class="p">]])</span>

<span class="n">real</span><span class="o">=</span> <span class="n">get_data_imgonly</span><span class="p">(</span><span class="n">f_real</span><span class="p">,</span><span class="n">n</span><span class="p">)</span>
<span class="n">real</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>Out[87]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>(128, 64, 64, 6)
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [92]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">inHdf5</span><span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">dr5_tractor</span><span class="o">.</span><span class="n">objid</span><span class="p">)</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">f_real</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
<span class="k">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dr5_tractor</span><span class="p">[</span><span class="n">inHdf5</span><span class="p">]),</span><span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">f_real</span><span class="o">.</span><span class="n">keys</span><span class="p">())))</span>
<span class="n">dr5_tractor</span><span class="o">.</span><span class="n">cut</span><span class="p">(</span><span class="n">inHdf5</span><span class="p">)</span>
<span class="c1"># flux_gt_0= ((inHdf5) &amp;</span>
<span class="c1">#             (dr5_tractor.flux_g &gt; 0) &amp;</span>
<span class="c1">#             (dr5_tractor.flux_r &gt; 0) &amp;</span>
<span class="c1">#             (dr5_tractor.flux_z &gt; 0))</span>
<span class="c1"># dr5_tractor.cut(flux_gt_0)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
880 880
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [93]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">d</span><span class="o">=</span> <span class="p">{</span><span class="n">b</span><span class="p">:</span><span class="n">dr5_tractor</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;flux_&#39;</span><span class="o">+</span><span class="n">b</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="s1">&#39;grz&#39;</span><span class="p">}</span>
<span class="n">df</span><span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
<span class="n">df</span><span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">byteswap</span><span class="p">()</span><span class="o">.</span><span class="n">newbyteorder</span><span class="p">())</span>
<span class="n">df</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>Out[93]:
</pre></div>
</div>
<div class="output_area docutils container">
<div>
<style>
    .dataframe thead tr:only-child th {
        text-align: right;
    }

    .dataframe thead th {
        text-align: left;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>g</th>
      <th>r</th>
      <th>z</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>880.000000</td>
      <td>880.000000</td>
      <td>880.000000</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>0.761698</td>
      <td>1.529735</td>
      <td>2.634772</td>
    </tr>
    <tr>
      <th>std</th>
      <td>0.746897</td>
      <td>1.434992</td>
      <td>2.366555</td>
    </tr>
    <tr>
      <th>min</th>
      <td>0.145401</td>
      <td>0.261415</td>
      <td>0.613148</td>
    </tr>
    <tr>
      <th>25%</th>
      <td>0.282475</td>
      <td>0.506985</td>
      <td>1.009587</td>
    </tr>
    <tr>
      <th>50%</th>
      <td>0.447857</td>
      <td>0.891814</td>
      <td>1.629145</td>
    </tr>
    <tr>
      <th>75%</th>
      <td>0.962490</td>
      <td>2.082288</td>
      <td>3.528070</td>
    </tr>
    <tr>
      <th>max</th>
      <td>4.510773</td>
      <td>6.133409</td>
      <td>14.447383</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [96]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">def</span> <span class="nf">flux2mag</span><span class="p">(</span><span class="n">nmgy</span><span class="p">):</span>
    <span class="k">return</span> <span class="o">-</span><span class="mf">2.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">nmgy</span><span class="p">)</span> <span class="o">-</span> <span class="mi">9</span><span class="p">)</span>

<span class="k">assert</span><span class="p">(</span><span class="s1">&#39;g&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">dr5_tractor</span><span class="o">.</span><span class="n">get_columns</span><span class="p">())</span>
<span class="k">assert</span><span class="p">(</span><span class="s1">&#39;g&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">simcat</span><span class="o">.</span><span class="n">get_columns</span><span class="p">())</span>
<span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="s1">&#39;grz&#39;</span><span class="p">:</span>
    <span class="n">dr5_tractor</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">flux2mag</span><span class="p">(</span><span class="n">dr5_tractor</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;flux_&#39;</span><span class="o">+</span><span class="n">b</span><span class="p">)</span><span class="o">/</span><span class="n">dr5_tractor</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;mw_transmission_&#39;</span><span class="o">+</span><span class="n">b</span><span class="p">)))</span>
    <span class="n">simcat</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">flux2mag</span><span class="p">(</span><span class="n">simcat</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">b</span><span class="o">+</span><span class="s1">&#39;flux&#39;</span><span class="p">)))</span>
<span class="n">dr5_tractor</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;gr&#39;</span><span class="p">,</span> <span class="n">dr5_tractor</span><span class="o">.</span><span class="n">g</span> <span class="o">-</span> <span class="n">dr5_tractor</span><span class="o">.</span><span class="n">r</span><span class="p">)</span>
<span class="n">dr5_tractor</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;rz&#39;</span><span class="p">,</span> <span class="n">dr5_tractor</span><span class="o">.</span><span class="n">r</span> <span class="o">-</span> <span class="n">dr5_tractor</span><span class="o">.</span><span class="n">z</span><span class="p">)</span>
<span class="n">simcat</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;gr&#39;</span><span class="p">,</span> <span class="n">simcat</span><span class="o">.</span><span class="n">g</span> <span class="o">-</span> <span class="n">simcat</span><span class="o">.</span><span class="n">r</span><span class="p">)</span>
<span class="n">simcat</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;rz&#39;</span><span class="p">,</span> <span class="n">simcat</span><span class="o">.</span><span class="n">r</span> <span class="o">-</span> <span class="n">simcat</span><span class="o">.</span><span class="n">z</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="Real-vs.-Fake-galaxies-in-TS-box">
<h1>Real vs. Fake galaxies in TS box<a class="headerlink" href="#Real-vs.-Fake-galaxies-in-TS-box" title="Permalink to this headline">¶</a></h1>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [99]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">dr5_tractor</span><span class="o">.</span><span class="n">rz</span><span class="p">,</span><span class="n">dr5_tractor</span><span class="o">.</span><span class="n">gr</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;dr5&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">simcat</span><span class="o">.</span><span class="n">rz</span><span class="p">,</span> <span class="n">simcat</span><span class="o">.</span><span class="n">gr</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="s1">&#39;g&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;sim&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">simcat</span><span class="o">.</span><span class="n">rz</span><span class="p">,</span> <span class="n">simcat</span><span class="o">.</span><span class="n">gr</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="s1">&#39;g&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;sim&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">dr5_tractor</span><span class="o">.</span><span class="n">rz</span><span class="p">,</span><span class="n">dr5_tractor</span><span class="o">.</span><span class="n">gr</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;dr5&#39;</span><span class="p">)</span>
<span class="c1"># ax.plot(pad[&#39;x1&#39;],pad[&#39;y1&#39;],&#39;r--&#39;)</span>
<span class="c1"># ax.plot(pad[&#39;x2&#39;],pad[&#39;y2&#39;],c=&#39;r&#39;,ls=&#39;--&#39;,lw=2)</span>
<span class="c1"># ax.plot(pad[&#39;x3&#39;],pad[&#39;y3&#39;],c=&#39;r&#39;,ls=&#39;--&#39;,lw=2)</span>
<span class="c1"># ax.plot(pad[&#39;x4&#39;],pad[&#39;y4&#39;],c=&#39;r&#39;,ls=&#39;--&#39;,lw=2)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
    <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;r-z&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;g-r&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">-</span><span class="mf">0.3</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="o">-</span><span class="mf">0.6</span><span class="p">,</span><span class="mf">2.2</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/nb_CNN_46_0.png" src="../_images/nb_CNN_46_0.png" />
</div>
</div>
<div class="section" id="Real-galaxies-are-brighter">
<h2>Real galaxies are brighter<a class="headerlink" href="#Real-galaxies-are-brighter" title="Permalink to this headline">¶</a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [97]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">seaborn</span> <span class="kn">as</span> <span class="nn">sns</span>
<span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">b</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="s1">&#39;grz&#39;</span><span class="p">):</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">distplot</span><span class="p">(</span><span class="n">dr5_tractor</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">b</span><span class="p">),</span><span class="n">kde</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">)</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">distplot</span><span class="p">(</span><span class="n">simcat</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">b</span><span class="p">),</span><span class="n">kde</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;g&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">b</span> <span class="o">+</span> <span class="s1">&#39; mag&#39;</span><span class="p">)</span>

</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/nb_CNN_48_0.png" src="../_images/nb_CNN_48_0.png" />
</div>
</div>
</div>
<div class="section" id="apply-cuts-at-bright-end">
<h2>apply cuts at bright end<a class="headerlink" href="#apply-cuts-at-bright-end" title="Permalink to this headline">¶</a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [101]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">def</span> <span class="nf">inRegion</span><span class="p">(</span><span class="n">rz</span><span class="p">,</span><span class="n">gr</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">((</span><span class="n">rz</span> <span class="o">&gt;</span> <span class="mf">0.5</span><span class="p">)</span> <span class="o">&amp;</span>
            <span class="p">(</span><span class="n">rz</span> <span class="o">&lt;</span> <span class="mf">1.</span><span class="p">)</span> <span class="o">&amp;</span>
            <span class="p">(</span><span class="n">gr</span> <span class="o">&gt;</span> <span class="mf">0.5</span><span class="p">)</span> <span class="o">&amp;</span>
            <span class="p">(</span><span class="n">gr</span> <span class="o">&lt;</span> <span class="mf">1.</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">isFaint</span><span class="p">(</span><span class="n">g</span><span class="p">,</span><span class="n">r</span><span class="p">,</span><span class="n">z</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">((</span><span class="n">g</span> <span class="o">&gt;</span> <span class="mf">23.</span><span class="p">)</span> <span class="o">&amp;</span>
            <span class="p">(</span><span class="n">r</span> <span class="o">&gt;</span> <span class="mf">22.5</span><span class="p">)</span> <span class="o">&amp;</span>
            <span class="p">(</span><span class="n">z</span> <span class="o">&gt;</span> <span class="mf">21.5</span><span class="p">))</span>

<span class="n">dr5_keep</span><span class="o">=</span> <span class="p">((</span><span class="n">inRegion</span><span class="p">(</span><span class="n">dr5_tractor</span><span class="o">.</span><span class="n">rz</span><span class="p">,</span><span class="n">dr5_tractor</span><span class="o">.</span><span class="n">gr</span><span class="p">))</span> <span class="o">&amp;</span>
           <span class="p">(</span><span class="n">isFaint</span><span class="p">(</span><span class="n">dr5_tractor</span><span class="o">.</span><span class="n">g</span><span class="p">,</span><span class="n">dr5_tractor</span><span class="o">.</span><span class="n">r</span><span class="p">,</span><span class="n">dr5_tractor</span><span class="o">.</span><span class="n">z</span><span class="p">)))</span>
<span class="n">sim_keep</span><span class="o">=</span> <span class="p">((</span><span class="n">inRegion</span><span class="p">(</span><span class="n">simcat</span><span class="o">.</span><span class="n">rz</span><span class="p">,</span> <span class="n">simcat</span><span class="o">.</span><span class="n">gr</span><span class="p">))</span> <span class="o">&amp;</span>
           <span class="p">(</span><span class="n">isFaint</span><span class="p">(</span><span class="n">simcat</span><span class="o">.</span><span class="n">g</span><span class="p">,</span><span class="n">simcat</span><span class="o">.</span><span class="n">r</span><span class="p">,</span><span class="n">simcat</span><span class="o">.</span><span class="n">z</span><span class="p">)))</span>


<span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">b</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="s1">&#39;grz&#39;</span><span class="p">):</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">distplot</span><span class="p">(</span><span class="n">dr5_tractor</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">b</span><span class="p">)[</span><span class="n">dr5_keep</span><span class="p">],</span><span class="n">kde</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">)</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">distplot</span><span class="p">(</span><span class="n">simcat</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">b</span><span class="p">)[</span><span class="n">sim_keep</span><span class="p">],</span><span class="n">kde</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;g&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">b</span> <span class="o">+</span> <span class="s1">&#39; mag&#39;</span><span class="p">)</span>


<span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">dr5_tractor</span><span class="o">.</span><span class="n">rz</span><span class="p">[</span><span class="n">dr5_keep</span><span class="p">],</span> <span class="n">dr5_tractor</span><span class="o">.</span><span class="n">gr</span><span class="p">[</span><span class="n">dr5_keep</span><span class="p">],</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;dr5&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">simcat</span><span class="o">.</span><span class="n">rz</span><span class="p">[</span><span class="n">sim_keep</span><span class="p">],</span> <span class="n">simcat</span><span class="o">.</span><span class="n">gr</span><span class="p">[</span><span class="n">sim_keep</span><span class="p">],</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="s1">&#39;g&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;sim&#39;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
    <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;r-z&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;g-r&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">-</span><span class="mf">0.3</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="o">-</span><span class="mf">0.6</span><span class="p">,</span><span class="mf">2.2</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

<span class="k">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dr5_tractor</span><span class="p">[</span><span class="n">dr5_keep</span><span class="p">]),</span> <span class="nb">len</span><span class="p">(</span><span class="n">simcat</span><span class="p">[</span><span class="n">sim_keep</span><span class="p">]))</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="stderr output_area docutils container">
<div class="highlight"><pre>
/Users/kaylan1/miniconda3/envs/mlbook/lib/python3.6/site-packages/matplotlib/axes/_axes.py:545: UserWarning: No labelled objects found. Use label=&#39;...&#39; kwarg on individual plots.
  warnings.warn(&#34;No labelled objects found. &#34;
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
135 544
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/nb_CNN_50_2.png" src="../_images/nb_CNN_50_2.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/nb_CNN_50_3.png" src="../_images/nb_CNN_50_3.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [102]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">spatial</span>
<span class="n">dr5_grz</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">g</span><span class="p">,</span><span class="n">r</span><span class="p">,</span><span class="n">z</span><span class="p">]</span>
                  <span class="k">for</span> <span class="n">g</span><span class="p">,</span><span class="n">r</span><span class="p">,</span><span class="n">z</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">dr5_tractor</span><span class="o">.</span><span class="n">g</span><span class="p">[</span><span class="n">dr5_keep</span><span class="p">],</span>
                                   <span class="n">dr5_tractor</span><span class="o">.</span><span class="n">r</span><span class="p">[</span><span class="n">dr5_keep</span><span class="p">],</span>
                                   <span class="n">dr5_tractor</span><span class="o">.</span><span class="n">z</span><span class="p">[</span><span class="n">dr5_keep</span><span class="p">])])</span>
<span class="n">sim_grz</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">g</span><span class="p">,</span><span class="n">r</span><span class="p">,</span><span class="n">z</span><span class="p">]</span>
                  <span class="k">for</span> <span class="n">g</span><span class="p">,</span><span class="n">r</span><span class="p">,</span><span class="n">z</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">simcat</span><span class="o">.</span><span class="n">g</span><span class="p">[</span><span class="n">sim_keep</span><span class="p">],</span>
                                   <span class="n">simcat</span><span class="o">.</span><span class="n">r</span><span class="p">[</span><span class="n">sim_keep</span><span class="p">],</span>
                                   <span class="n">simcat</span><span class="o">.</span><span class="n">z</span><span class="p">[</span><span class="n">sim_keep</span><span class="p">])])</span>

<span class="k">print</span><span class="p">(</span><span class="n">dr5_grz</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">sim_grz</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="n">dr5_tree</span> <span class="o">=</span> <span class="n">spatial</span><span class="o">.</span><span class="n">KDTree</span><span class="p">(</span><span class="n">dr5_grz</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(135, 3) (544, 3)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [103]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">d</span><span class="p">,</span><span class="n">ind</span><span class="o">=</span><span class="n">dr5_tree</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">sim_grz</span><span class="p">,</span><span class="n">p</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ind</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
544
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>Out[103]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>(array([  19.,   47.,  102.,  133.,  120.,   57.,   47.,   13.,    5.,    1.]),
 array([ 0.00694428,  0.03292467,  0.05890506,  0.08488544,  0.11086583,
         0.13684621,  0.1628266 ,  0.18880698,  0.21478737,  0.24076775,
         0.26674814]),
 &lt;a list of 10 Patch objects&gt;)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/nb_CNN_54_2.png" src="../_images/nb_CNN_54_2.png" />
</div>
</div>
</div>
</div>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
    </p>
    <p>
        &copy; Copyright 2014-2018, Kaylan Burleigh, John Moustakas.<br/>
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.7.6.<br/>
    </p>
  </div>
</footer>
  </body>
</html>