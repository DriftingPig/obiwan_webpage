<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>heatmaps &#8212; obiwan 1.2.0 documentation</title>
    <link rel="stylesheet" href="../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="../_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="../_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-3.3.7/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-sphinx.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">

  </head><body>

  <div id="navbar" class="navbar navbar-default ">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="../index.html">
          Obiwan</a>
        <span class="navbar-text navbar-version pull-left"><b>1.2.0</b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
                <li><a href="../api.html">API</a></li>
                <li><a href="../tutorials.html">Tutorials</a></li>
                <li><a href="../deeplearning.html">Deep Learning</a></li>
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="../index.html">Pages <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"></ul>
</li>
              
                <li class="dropdown">
  <a role="button"
     id="dLabelLocalToc"
     data-toggle="dropdown"
     data-target="#"
     href="#">This Page <b class="caret"></b></a>
  <ul class="dropdown-menu localtoc"
      role="menu"
      aria-labelledby="dLabelLocalToc"><ul>
<li><a class="reference internal" href="#">heatmaps</a></li>
<li><a class="reference internal" href="#obiwan-outputs">obiwan outputs</a><ul>
<li><a class="reference internal" href="#Input-properties-(eBOSS)">Input properties (eBOSS)</a><ul>
<li><a class="reference internal" href="#NGC-only">NGC only</a></li>
</ul>
</li>
<li><a class="reference internal" href="#fracflux,-fracin,-ranges?">fracflux, fracin, ranges?</a></li>
</ul>
</li>
<li><a class="reference internal" href="#Are-the-any-systematics-in-psql-vs.-+noise-fluxes?">Are the any systematics in psql vs. +noise fluxes?</a></li>
<li><a class="reference internal" href="#Fraction-recovered">Fraction recovered</a></li>
<li><a class="reference internal" href="#horizontal-bar-plot-by-type:-number-input,-recovered,-measures-of-PSF,-EXP...">horizontal bar plot by type: number input, recovered, measures of PSF, EXPâ€¦</a></li>
<li><a class="reference internal" href="#Confusion-matrix">Confusion matrix</a><ul>
<li><a class="reference internal" href="#What-do-input-ELGs-look-like-in-color-space-for-input-and-measured-colors?">What do input ELGs look like in color space for input and measured colors?</a></li>
</ul>
</li>
<li><a class="reference internal" href="#There-are-two-ways-to-loose-ELGs">There are two ways to loose ELGs</a></li>
<li><a class="reference internal" href="#There-are-two-ways-to-measure-an-ELG">There are two ways to measure an ELG</a></li>
<li><a class="reference internal" href="#Hist-for-the-three-above-colors,-three-hists-per-band">Hist for the three above colors, three hists per band</a></li>
<li><a class="reference internal" href="#dmag-for-the-three-above-colors">dmag for the three above colors</a></li>
<li><a class="reference internal" href="#dflux/std-dev-vs.-Unit-Gaussian">dflux/std dev vs. Unit Gaussian</a><ul>
<li><a class="reference internal" href="#How-to-Fix-dflux-using-apflux_resid!!!!">How to Fix dflux using apflux_resid!!!!</a></li>
</ul>
</li>
<li><a class="reference internal" href="#Delta-plots">Delta plots</a></li>
<li><a class="reference internal" href="#Compare-to-straigth-truth-and-measured-quanities">Compare to straigth truth and measured quanities</a></li>
</ul>
</ul>
</li>
              
            
            
              
                
              
            
            
            
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="col-md-12 content">
      
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput,
div.nbinput div.prompt,
div.nbinput div.input_area,
div.nbinput div[class*=highlight],
div.nbinput div[class*=highlight] pre,
div.nboutput,
div.nbinput div.prompt,
div.nbinput div.output_area,
div.nboutput div[class*=highlight],
div.nboutput div[class*=highlight] pre {
    background: none;
    border: none;
    padding: 0 0;
    margin: 0;
    box-shadow: none;
}

/* avoid gaps between output lines */
div.nboutput div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput,
div.nboutput {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput,
    div.nboutput {
        flex-direction: column;
    }
}

/* input container */
div.nbinput {
    padding-top: 5px;
}

/* last container */
div.nblast {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput div.prompt pre {
    color: #303F9F;
}

/* output prompt */
div.nboutput div.prompt pre {
    color: #D84315;
}

/* all prompts */
div.nbinput div.prompt,
div.nboutput div.prompt {
    min-width: 9ex;
    padding-top: 0.4em;
    padding-right: 0.4em;
    text-align: right;
    flex: 0;
}
@media (max-width: 540px) {
    div.nbinput div.prompt,
    div.nboutput div.prompt {
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput div.prompt.empty {
        padding: 0;
    }
}

/* disable scrollbars on prompts */
div.nbinput div.prompt pre,
div.nboutput div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput div.input_area,
div.nboutput div.output_area {
    padding: 0.4em;
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput div.input_area,
    div.nboutput div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput div.input_area {
    border: 1px solid #cfcfcf;
    border-radius: 2px;
    background: #f7f7f7;
}

/* override MathJax center alignment in output cells */
div.nboutput div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.pngmath center alignment in output cells */
div.nboutput div.math p {
    text-align: left;
}

/* standard error */
div.nboutput div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }
</style>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="kn">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="kn">as</span> <span class="nn">sns</span>
<span class="kn">from</span> <span class="nn">astrometry.util.fits</span> <span class="kn">import</span> <span class="n">fits_table</span><span class="p">,</span> <span class="n">merge_tables</span>

<span class="c1"># to make this notebook&#39;s output stable across runs</span>
<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">7</span><span class="p">)</span>

<span class="c1"># To plot pretty figures</span>
<span class="o">%</span><span class="k">matplotlib</span> inline
<span class="kn">import</span> <span class="nn">matplotlib</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;axes.labelsize&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">14</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;xtick.labelsize&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">12</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;ytick.labelsize&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">12</span>

<span class="o">%</span><span class="k">load_ext</span> autoreload
<span class="o">%</span><span class="k">autoreload</span> 2
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">obiwan.qa.plots_common</span> <span class="kn">as</span> <span class="nn">plots</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="stderr output_area docutils container">
<div class="highlight"><pre>
/Users/kaylan1/miniconda3/envs/mlbook/lib/python3.6/site-packages/matplotlib/__init__.py:1405: UserWarning:
This call to matplotlib.use() has no effect because the backend has already
been chosen; matplotlib.use() must be called *before* pylab, matplotlib.pyplot,
or matplotlib.backends is imported for the first time.

  warnings.warn(_use_error_msg)
</pre></div></div>
</div>
<div class="section" id="heatmaps">
<h1>heatmaps<a class="headerlink" href="#heatmaps" title="Permalink to this headline">Â¶</a></h1>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">summary</span><span class="o">=</span> <span class="n">fits_table</span><span class="p">(</span><span class="s1">&#39;summary.fits&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Converted brickname from |S8 to &lt;U8
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">bricks</span><span class="o">=</span> <span class="n">fits_table</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;HOME&#39;</span><span class="p">],</span><span class="s1">&#39;Downloads&#39;</span><span class="p">,</span>
                                <span class="s1">&#39;survey-bricks.fits.gz&#39;</span><span class="p">))</span>
<span class="n">keep</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">char</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="n">bricks</span><span class="o">.</span><span class="n">brickname</span><span class="p">))</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">char</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="n">summary</span><span class="o">.</span><span class="n">brickname</span><span class="p">))</span>
<span class="n">bricks</span><span class="o">.</span><span class="n">cut</span><span class="p">(</span><span class="n">keep</span><span class="p">)</span>
<span class="n">bricks</span><span class="o">=</span> <span class="n">bricks</span><span class="p">[</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">bricks</span><span class="o">.</span><span class="n">brickname</span><span class="p">)]</span>
<span class="n">summary</span><span class="o">=</span> <span class="n">summary</span><span class="p">[</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">summary</span><span class="o">.</span><span class="n">brickname</span><span class="p">)]</span>
<span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;ra&#39;</span><span class="p">,</span><span class="s1">&#39;dec&#39;</span><span class="p">]:</span>
    <span class="n">summary</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">key</span><span class="p">,</span><span class="n">bricks</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Converted brickname from |S8 to &lt;U8
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [33]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>

<span class="n">num_density</span><span class="o">=</span> <span class="n">summary</span><span class="o">.</span><span class="n">n_injected</span> <span class="o">/</span> <span class="mf">0.25</span><span class="o">**</span><span class="mi">2</span> <span class="c1"># n/deg2</span>
<span class="n">keep</span><span class="o">=</span><span class="n">summary</span><span class="o">.</span><span class="n">dec</span> <span class="o">&gt;</span> <span class="mi">10</span>

<span class="n">kw</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">edgecolors</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span><span class="n">s</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span><span class="n">rasterized</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">cax</span><span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">summary</span><span class="o">.</span><span class="n">ra</span><span class="p">[</span><span class="n">keep</span><span class="p">],</span><span class="n">summary</span><span class="o">.</span><span class="n">dec</span><span class="p">[</span><span class="n">keep</span><span class="p">],</span>
                <span class="n">c</span><span class="o">=</span><span class="n">num_density</span><span class="p">[</span><span class="n">keep</span><span class="p">],</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>

<span class="n">cbar</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">cax</span><span class="p">)</span> <span class="c1">#, ticks=[-1, 0, 1])</span>
<span class="n">cbar</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s1">&#39;Number / deg2&#39;</span><span class="p">)</span>
<span class="c1">#cbar.ax.set_yticklabels([&#39;&lt; -1&#39;, &#39;0&#39;, &#39;&gt; 1&#39;])</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/nb_obiwan_methods_paper_5_0.png" src="../_images/nb_obiwan_methods_paper_5_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [34]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>plt.scatter<span class="o">?</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="stderr output_area docutils container">
<div class="highlight"><pre>
/Users/kaylan1/miniconda3/envs/mlbook/lib/python3.6/site-packages/matplotlib/__init__.py:1405: UserWarning:
This call to matplotlib.use() has no effect because the backend has already
been chosen; matplotlib.use() must be called *before* pylab, matplotlib.pyplot,
or matplotlib.backends is imported for the first time.

  warnings.warn(_use_error_msg)
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>

<span></span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">summary</span><span class="o">.</span><span class="n">ra</span><span class="p">,</span><span class="n">summary</span><span class="o">.</span><span class="n">dec</span><span class="p">,</span><span class="n">num_density</span><span class="p">)</span>
<span class="c1">#plt.imshow(x,y,c=z)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="obiwan-outputs">
<h1>obiwan outputs<a class="headerlink" href="#obiwan-outputs" title="Permalink to this headline">Â¶</a></h1>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1">#dat= fits_table(&#39;randoms_rank98.fits&#39;)</span>
<span class="n">dat</span><span class="o">=</span> <span class="n">fits_table</span><span class="p">(</span><span class="s1">&#39;randoms_rank90.fits&#39;</span><span class="p">)</span> <span class="c1"># apflux_resid info</span>
<span class="nb">len</span><span class="p">(</span><span class="n">dat</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Converted unique_id from |S20 to &lt;U20
Converted tractor_brickname from |S4 to &lt;U4
Converted tractor_type from |S4 to &lt;U4
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>Out[3]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>8113
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [62]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">dat</span><span class="o">.</span><span class="n">get_columns</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>Out[62]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>[&#39;id&#39;,
 &#39;ra&#39;,
 &#39;dec&#39;,
 &#39;x&#39;,
 &#39;y&#39;,
 &#39;gflux&#39;,
 &#39;mw_transmission_g&#39;,
 &#39;rflux&#39;,
 &#39;mw_transmission_r&#39;,
 &#39;zflux&#39;,
 &#39;mw_transmission_z&#39;,
 &#39;n&#39;,
 &#39;rhalf&#39;,
 &#39;e1&#39;,
 &#39;e2&#39;,
 &#39;unique_id&#39;,
 &#39;psql_id&#39;,
 &#39;psql_ra&#39;,
 &#39;psql_dec&#39;,
 &#39;psql_g&#39;,
 &#39;psql_r&#39;,
 &#39;psql_z&#39;,
 &#39;psql_rhalf&#39;,
 &#39;psql_n&#39;,
 &#39;psql_ba&#39;,
 &#39;psql_pa&#39;,
 &#39;psql_redshift&#39;,
 &#39;tractor_release&#39;,
 &#39;tractor_brickid&#39;,
 &#39;tractor_brickname&#39;,
 &#39;tractor_objid&#39;,
 &#39;tractor_brick_primary&#39;,
 &#39;tractor_type&#39;,
 &#39;tractor_ra&#39;,
 &#39;tractor_dec&#39;,
 &#39;tractor_ra_ivar&#39;,
 &#39;tractor_dec_ivar&#39;,
 &#39;tractor_bx&#39;,
 &#39;tractor_by&#39;,
 &#39;tractor_dchisq&#39;,
 &#39;tractor_ebv&#39;,
 &#39;tractor_mjd_min&#39;,
 &#39;tractor_mjd_max&#39;,
 &#39;tractor_flux_u&#39;,
 &#39;tractor_flux_g&#39;,
 &#39;tractor_flux_r&#39;,
 &#39;tractor_flux_i&#39;,
 &#39;tractor_flux_z&#39;,
 &#39;tractor_flux_y&#39;,
 &#39;tractor_flux_ivar_u&#39;,
 &#39;tractor_flux_ivar_g&#39;,
 &#39;tractor_flux_ivar_r&#39;,
 &#39;tractor_flux_ivar_i&#39;,
 &#39;tractor_flux_ivar_z&#39;,
 &#39;tractor_flux_ivar_y&#39;,
 &#39;tractor_apflux_g&#39;,
 &#39;tractor_apflux_r&#39;,
 &#39;tractor_apflux_z&#39;,
 &#39;tractor_apflux_resid_g&#39;,
 &#39;tractor_apflux_resid_r&#39;,
 &#39;tractor_apflux_resid_z&#39;,
 &#39;tractor_mw_transmission_u&#39;,
 &#39;tractor_mw_transmission_g&#39;,
 &#39;tractor_mw_transmission_r&#39;,
 &#39;tractor_mw_transmission_i&#39;,
 &#39;tractor_mw_transmission_z&#39;,
 &#39;tractor_mw_transmission_y&#39;,
 &#39;tractor_nobs_u&#39;,
 &#39;tractor_nobs_g&#39;,
 &#39;tractor_nobs_r&#39;,
 &#39;tractor_nobs_i&#39;,
 &#39;tractor_nobs_z&#39;,
 &#39;tractor_nobs_y&#39;,
 &#39;tractor_rchisq_u&#39;,
 &#39;tractor_rchisq_g&#39;,
 &#39;tractor_rchisq_r&#39;,
 &#39;tractor_rchisq_i&#39;,
 &#39;tractor_rchisq_z&#39;,
 &#39;tractor_rchisq_y&#39;,
 &#39;tractor_fracflux_u&#39;,
 &#39;tractor_fracflux_g&#39;,
 &#39;tractor_fracflux_r&#39;,
 &#39;tractor_fracflux_i&#39;,
 &#39;tractor_fracflux_z&#39;,
 &#39;tractor_fracflux_y&#39;,
 &#39;tractor_fracmasked_u&#39;,
 &#39;tractor_fracmasked_g&#39;,
 &#39;tractor_fracmasked_r&#39;,
 &#39;tractor_fracmasked_i&#39;,
 &#39;tractor_fracmasked_z&#39;,
 &#39;tractor_fracmasked_y&#39;,
 &#39;tractor_fracin_u&#39;,
 &#39;tractor_fracin_g&#39;,
 &#39;tractor_fracin_r&#39;,
 &#39;tractor_fracin_i&#39;,
 &#39;tractor_fracin_z&#39;,
 &#39;tractor_fracin_y&#39;,
 &#39;tractor_anymask_u&#39;,
 &#39;tractor_anymask_g&#39;,
 &#39;tractor_anymask_r&#39;,
 &#39;tractor_anymask_i&#39;,
 &#39;tractor_anymask_z&#39;,
 &#39;tractor_anymask_y&#39;,
 &#39;tractor_allmask_u&#39;,
 &#39;tractor_allmask_g&#39;,
 &#39;tractor_allmask_r&#39;,
 &#39;tractor_allmask_i&#39;,
 &#39;tractor_allmask_z&#39;,
 &#39;tractor_allmask_y&#39;,
 &#39;tractor_psfsize_u&#39;,
 &#39;tractor_psfsize_g&#39;,
 &#39;tractor_psfsize_r&#39;,
 &#39;tractor_psfsize_i&#39;,
 &#39;tractor_psfsize_z&#39;,
 &#39;tractor_psfsize_y&#39;,
 &#39;tractor_psfdepth_u&#39;,
 &#39;tractor_psfdepth_g&#39;,
 &#39;tractor_psfdepth_r&#39;,
 &#39;tractor_psfdepth_i&#39;,
 &#39;tractor_psfdepth_z&#39;,
 &#39;tractor_psfdepth_y&#39;,
 &#39;tractor_galdepth_u&#39;,
 &#39;tractor_galdepth_g&#39;,
 &#39;tractor_galdepth_r&#39;,
 &#39;tractor_galdepth_i&#39;,
 &#39;tractor_galdepth_z&#39;,
 &#39;tractor_galdepth_y&#39;,
 &#39;tractor_fracdev&#39;,
 &#39;tractor_fracdev_ivar&#39;,
 &#39;tractor_shapeexp_r&#39;,
 &#39;tractor_shapeexp_r_ivar&#39;,
 &#39;tractor_shapeexp_e1&#39;,
 &#39;tractor_shapeexp_e1_ivar&#39;,
 &#39;tractor_shapeexp_e2&#39;,
 &#39;tractor_shapeexp_e2_ivar&#39;,
 &#39;tractor_shapedev_r&#39;,
 &#39;tractor_shapedev_r_ivar&#39;,
 &#39;tractor_shapedev_e1&#39;,
 &#39;tractor_shapedev_e1_ivar&#39;,
 &#39;tractor_shapedev_e2&#39;,
 &#39;tractor_shapedev_e2_ivar&#39;,
 &#39;obiwan_mask&#39;,
 &#39;targets_mask&#39;]
</pre></div>
</div>
</div>
<div class="section" id="Input-properties-(eBOSS)">
<h2>Input properties (eBOSS)<a class="headerlink" href="#Input-properties-(eBOSS)" title="Permalink to this headline">Â¶</a></h2>
<ul class="simple">
<li>ra,dec region</li>
<li>brightness, shape, size, redshift</li>
</ul>
<div class="section" id="NGC-only">
<h3>NGC only<a class="headerlink" href="#NGC-only" title="Permalink to this headline">Â¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">region</span><span class="o">=</span><span class="s1">&#39;ngc&#39;</span>
<span class="n">corners</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">ngc</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">ra</span><span class="o">=</span><span class="p">(</span><span class="mi">126</span><span class="p">,</span><span class="mi">168</span><span class="p">),</span><span class="n">dec</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span><span class="mi">34</span><span class="p">)))</span>

<span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">kw</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">m</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span><span class="n">s</span><span class="o">=</span><span class="mf">5.</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.75</span><span class="p">)</span>
<span class="c1"># plots.myscatter(ax,dat.ra,dat.dec,</span>
<span class="c1">#                 color=&#39;b&#39;,label=&#39;uniform_randoms&#39;,**kw)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">dat</span><span class="o">.</span><span class="n">ra</span><span class="p">,</span><span class="n">dat</span><span class="o">.</span><span class="n">dec</span><span class="p">,</span><span class="s1">&#39;b,&#39;</span><span class="p">)</span>
<span class="n">isRec</span><span class="o">=</span> <span class="n">dat</span><span class="o">.</span><span class="n">obiwan_mask</span> <span class="o">==</span> <span class="mi">1</span>
<span class="c1"># plots.myscatter(ax,dat.ra[isRec],dat.dec[isRec],</span>
<span class="c1">#                 color=&#39;y&#39;,label=&#39;uniform_randoms&#39;,**kw)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">dat</span><span class="o">.</span><span class="n">ra</span><span class="p">[</span><span class="n">isRec</span><span class="p">],</span><span class="n">dat</span><span class="o">.</span><span class="n">dec</span><span class="p">[</span><span class="n">isRec</span><span class="p">],</span><span class="s1">&#39;g,&#39;</span><span class="p">)</span>
<span class="c1"># plt.xlim(corners[region][&#39;ra&#39;])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">153</span><span class="p">,</span><span class="mf">153.75</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="n">corners</span><span class="p">[</span><span class="n">region</span><span class="p">][</span><span class="s1">&#39;dec&#39;</span><span class="p">])</span>

</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>Out[6]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>(14, 34)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/nb_obiwan_methods_paper_12_1.png" src="../_images/nb_obiwan_methods_paper_12_1.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">def</span> <span class="nf">myhist</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span><span class="n">data</span><span class="p">,</span><span class="n">bins</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="n">normed</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">ls</span><span class="o">=</span><span class="s1">&#39;solid&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
           <span class="nb">range</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">return_h</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="n">kw</span><span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">bins</span><span class="o">=</span><span class="n">bins</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span><span class="n">normed</span><span class="o">=</span><span class="n">normed</span><span class="p">,</span>
             <span class="n">histtype</span><span class="o">=</span><span class="s1">&#39;step&#39;</span><span class="p">,</span><span class="nb">range</span><span class="o">=</span><span class="nb">range</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="n">lw</span><span class="p">,</span><span class="n">ls</span><span class="o">=</span><span class="n">ls</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">label</span><span class="p">:</span>
        <span class="n">kw</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">)</span>
    <span class="n">h</span><span class="p">,</span><span class="n">bins</span><span class="p">,</span><span class="n">_</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="o">**</span><span class="n">kw</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">return_h</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">h</span>

<span class="k">def</span> <span class="nf">my_step</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span><span class="n">bins</span><span class="p">,</span><span class="n">height</span><span class="p">,</span>
            <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="n">ls</span><span class="o">=</span><span class="s1">&#39;solid&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;if plt.hist returns tuple (height,bins) then this reproces that plot.</span>

<span class="sd">    e.g. bin centers and horizontal lines at the right place...</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">kw</span><span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="n">lw</span><span class="p">,</span><span class="n">ls</span><span class="o">=</span><span class="n">ls</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">label</span><span class="p">:</span>
        <span class="n">kw</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="n">bins</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="n">height</span><span class="p">,</span><span class="n">where</span><span class="o">=</span><span class="s1">&#39;mid&#39;</span><span class="p">,</span><span class="o">**</span><span class="n">kw</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span><span class="n">axes</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">12</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">hspace</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span><span class="n">wspace</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
<span class="n">xlim</span><span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">g</span><span class="o">=</span><span class="p">(</span><span class="mf">21.5</span><span class="p">,</span><span class="mf">23.25</span><span class="p">),</span>
           <span class="n">r</span><span class="o">=</span><span class="p">(</span><span class="mf">20.5</span><span class="p">,</span><span class="mi">23</span><span class="p">),</span>
           <span class="n">z</span><span class="o">=</span><span class="p">(</span><span class="mf">19.5</span><span class="p">,</span><span class="mf">22.5</span><span class="p">))</span>

<span class="n">kw_hist</span><span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">bins</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span><span class="n">normed</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
<span class="k">for</span> <span class="n">ax</span><span class="p">,</span><span class="n">band</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">axes</span><span class="p">,</span><span class="s1">&#39;grz&#39;</span><span class="p">):</span>
    <span class="n">flux</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">input_noise_ext</span><span class="o">=</span> <span class="n">dat</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">band</span><span class="o">+</span><span class="s1">&#39;flux&#39;</span><span class="p">),</span>
              <span class="n">intput_noise</span><span class="o">=</span> <span class="n">dat</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">band</span><span class="o">+</span><span class="s1">&#39;flux&#39;</span><span class="p">)</span><span class="o">/</span>\
                          <span class="n">dat</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;mw_transmission_&#39;</span><span class="o">+</span><span class="n">band</span><span class="p">),</span>
              <span class="nb">input</span><span class="o">=</span> <span class="n">plots</span><span class="o">.</span><span class="n">mag2flux</span><span class="p">(</span><span class="n">dat</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;psql_&#39;</span><span class="o">+</span><span class="n">band</span><span class="p">))</span>
             <span class="p">)</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span><span class="n">color</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">flux</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)),</span>
                         <span class="s1">&#39;kbg&#39;</span><span class="p">):</span>
        <span class="n">mag</span><span class="o">=</span> <span class="n">plots</span><span class="o">.</span><span class="n">flux2mag</span><span class="p">(</span><span class="n">flux</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
        <span class="n">myhist</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span><span class="n">mag</span><span class="p">,</span><span class="nb">range</span><span class="o">=</span><span class="n">xlim</span><span class="p">[</span><span class="n">band</span><span class="p">],</span>
               <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="n">key</span><span class="p">,</span><span class="o">**</span><span class="n">kw_hist</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> (AB mag)&#39;</span> <span class="o">%</span> <span class="n">band</span><span class="p">)</span>

<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper left&#39;</span><span class="p">)</span>



</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>Out[5]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>&lt;matplotlib.legend.Legend at 0x115935240&gt;
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/nb_obiwan_methods_paper_13_1.png" src="../_images/nb_obiwan_methods_paper_13_1.png" />
</div>
</div>
</div>
</div>
<div class="section" id="fracflux,-fracin,-ranges?">
<h2>fracflux, fracin, ranges?<a class="headerlink" href="#fracflux,-fracin,-ranges?" title="Permalink to this headline">Â¶</a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [18]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">fig</span><span class="p">,</span><span class="n">axes</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">12</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">hspace</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span><span class="n">wspace</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>

<span class="n">xlim</span><span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>

<span class="n">isRec</span><span class="o">=</span> <span class="n">dat</span><span class="o">.</span><span class="n">obiwan_mask</span> <span class="o">==</span> <span class="mi">1</span>
<span class="n">kw_hist</span><span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">bins</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span><span class="n">normed</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
<span class="k">for</span> <span class="n">ax</span><span class="p">,</span><span class="n">band</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">axes</span><span class="p">,</span><span class="s1">&#39;grz&#39;</span><span class="p">):</span>
    <span class="n">myhist</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span><span class="n">dat</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;tractor_fracflux_</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">band</span><span class="p">)[</span><span class="n">isRec</span><span class="p">],</span>
           <span class="nb">range</span><span class="o">=</span><span class="n">xlim</span><span class="p">,</span><span class="o">**</span><span class="n">kw_hist</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/nb_obiwan_methods_paper_15_0.png" src="../_images/nb_obiwan_methods_paper_15_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [24]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">fig</span><span class="p">,</span><span class="n">axes</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">12</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">hspace</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span><span class="n">wspace</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>

<span class="n">xlim</span><span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mf">0.2</span><span class="p">,</span><span class="mf">1.2</span><span class="p">)</span>

<span class="n">isRec</span><span class="o">=</span> <span class="n">dat</span><span class="o">.</span><span class="n">obiwan_mask</span> <span class="o">==</span> <span class="mi">1</span>
<span class="n">kw_hist</span><span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">bins</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span><span class="n">normed</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
<span class="k">for</span> <span class="n">ax</span><span class="p">,</span><span class="n">band</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">axes</span><span class="p">,</span><span class="s1">&#39;grz&#39;</span><span class="p">):</span>
    <span class="n">myhist</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span><span class="n">dat</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;tractor_fracin_</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">band</span><span class="p">)[</span><span class="n">isRec</span><span class="p">],</span>
           <span class="nb">range</span><span class="o">=</span><span class="n">xlim</span><span class="p">,</span><span class="o">**</span><span class="n">kw_hist</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>

<span class="n">fracin</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">dat</span><span class="o">.</span><span class="n">tractor_fracin_g</span><span class="p">,</span>
                          <span class="n">dat</span><span class="o">.</span><span class="n">tractor_fracin_r</span><span class="p">,</span>
                          <span class="n">dat</span><span class="o">.</span><span class="n">tractor_fracin_z</span><span class="p">]),</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">0.7</span>
<span class="k">print</span><span class="p">(</span><span class="s1">&#39;Fracin cut removes </span><span class="si">%d</span><span class="s1">/</span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dat</span><span class="p">[</span><span class="o">~</span><span class="n">fracin</span><span class="p">]),</span><span class="nb">len</span><span class="p">(</span><span class="n">dat</span><span class="p">)))</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="stderr output_area docutils container">
<div class="highlight"><pre>
/Users/kaylan1/miniconda3/envs/mlbook/lib/python3.6/site-packages/ipykernel_launcher.py:15: RuntimeWarning: invalid value encountered in greater
  from ipykernel import kernelapp as app
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Fracin cut removes 2103/8113
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/nb_obiwan_methods_paper_16_2.png" src="../_images/nb_obiwan_methods_paper_16_2.png" />
</div>
</div>
</div>
</div>
<div class="section" id="Are-the-any-systematics-in-psql-vs.-+noise-fluxes?">
<h1>Are the any systematics in psql vs. +noise fluxes?<a class="headerlink" href="#Are-the-any-systematics-in-psql-vs.-+noise-fluxes?" title="Permalink to this headline">Â¶</a></h1>
<div class="system-message">
<p class="system-message-title">System Message: SEVERE/4 (<tt class="docutils">/global/cscratch1/sd/huikong/obiwan_Aug/repos_for_docker/obiwan_webpage/obiwan/doc/nb/obiwan_methods_paper.ipynb</tt>, line 658)</p>
<p>Title level inconsistent:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">No</span><span class="p">,</span> <span class="n">but</span> <span class="n">looks</span> <span class="n">like</span> <span class="n">bug</span> <span class="ow">in</span> <span class="n">option</span> <span class="n">to</span> <span class="n">add</span> <span class="n">noise</span><span class="p">,</span> <span class="n">looks</span> <span class="n">like</span> <span class="n">noise</span> <span class="n">wasn</span><span class="s1">&#39;t added... Or is it that the noise added averages to zero for the ~ 20x20 pixels or whatever</span>
<span class="o">~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [726]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>

<span class="n">kw_hist</span><span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">bins</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span><span class="n">normed</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
<span class="n">ylim</span><span class="o">=</span><span class="mf">2e-15</span>
<span class="k">for</span> <span class="n">band</span><span class="p">,</span><span class="n">color</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="s1">&#39;grz&#39;</span><span class="p">,</span><span class="s1">&#39;gbm&#39;</span><span class="p">):</span>
    <span class="n">flux</span><span class="o">=</span> <span class="n">plots</span><span class="o">.</span><span class="n">mag2flux</span><span class="p">(</span><span class="n">dat</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;psql_&#39;</span><span class="o">+</span><span class="n">band</span><span class="p">))</span>
    <span class="n">flux_noise</span><span class="o">=</span> <span class="n">dat</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">band</span><span class="o">+</span><span class="s1">&#39;flux&#39;</span><span class="p">)</span><span class="o">/</span>\
                    <span class="n">dat</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;mw_transmission_&#39;</span><span class="o">+</span><span class="n">band</span><span class="p">)</span>
    <span class="n">myhist</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span><span class="n">flux_noise</span><span class="o">-</span><span class="n">flux</span><span class="p">,</span><span class="nb">range</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="n">ylim</span><span class="p">,</span><span class="n">ylim</span><span class="p">),</span><span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span>
           <span class="n">label</span><span class="o">=</span><span class="n">band</span><span class="p">,</span><span class="o">**</span><span class="n">kw_hist</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Number&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;dflux (input - db)&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>Out[726]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>&lt;matplotlib.legend.Legend at 0x15cba4e10&gt;
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/nb_obiwan_methods_paper_18_1.png" src="../_images/nb_obiwan_methods_paper_18_1.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [720]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">xlim</span><span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">g</span><span class="o">=</span><span class="p">(</span><span class="mf">21.5</span><span class="p">,</span><span class="mf">23.25</span><span class="p">),</span>
           <span class="n">r</span><span class="o">=</span><span class="p">(</span><span class="mf">20.5</span><span class="p">,</span><span class="mi">23</span><span class="p">),</span>
           <span class="n">z</span><span class="o">=</span><span class="p">(</span><span class="mf">19.5</span><span class="p">,</span><span class="mf">22.5</span><span class="p">))</span>

<span class="n">kw_hist</span><span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="n">bins</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span><span class="n">normed</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
<span class="n">ylim</span><span class="o">=</span><span class="mf">2e-15</span>
<span class="k">for</span> <span class="n">ax</span><span class="p">,</span><span class="n">band</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">axes</span><span class="p">,</span><span class="s1">&#39;grz&#39;</span><span class="p">):</span>
    <span class="n">flux</span><span class="o">=</span> <span class="n">plots</span><span class="o">.</span><span class="n">mag2flux</span><span class="p">(</span><span class="n">dat</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;psql_&#39;</span><span class="o">+</span><span class="n">band</span><span class="p">))</span>
    <span class="n">flux_noise</span><span class="o">=</span> <span class="n">dat</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">band</span><span class="o">+</span><span class="s1">&#39;flux&#39;</span><span class="p">)</span><span class="o">/</span>\
                    <span class="n">dat</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;mw_transmission_&#39;</span><span class="o">+</span><span class="n">band</span><span class="p">)</span>
    <span class="n">g</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">jointplot</span><span class="p">(</span><span class="n">plots</span><span class="o">.</span><span class="n">flux2mag</span><span class="p">(</span><span class="n">flux_noise</span><span class="p">),</span><span class="n">flux_noise</span><span class="o">-</span><span class="n">flux</span><span class="p">,</span>
                      <span class="n">stat_func</span><span class="o">=</span><span class="bp">None</span><span class="p">)</span>
                      <span class="c1">#plots.flux2mag(-1*(flux_noise - flux))) # color=&quot;g&quot;)</span>
    <span class="n">g</span><span class="o">.</span><span class="n">ax_joint</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">-</span><span class="n">ylim</span><span class="p">,</span><span class="n">ylim</span><span class="p">)</span>
    <span class="n">g</span><span class="o">.</span><span class="n">ax_joint</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">band</span><span class="o">+</span><span class="s1">&#39; mag&#39;</span><span class="p">)</span>
    <span class="n">g</span><span class="o">.</span><span class="n">ax_joint</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;dflux (input - db)&#39;</span><span class="p">)</span>

<span class="c1"># ax.legend() #loc=&#39;upper left&#39;)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/nb_obiwan_methods_paper_19_0.png" src="../_images/nb_obiwan_methods_paper_19_0.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/nb_obiwan_methods_paper_19_1.png" src="../_images/nb_obiwan_methods_paper_19_1.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/nb_obiwan_methods_paper_19_2.png" src="../_images/nb_obiwan_methods_paper_19_2.png" />
</div>
</div>
</div>
<div class="section" id="Fraction-recovered">
<h1>Fraction recovered<a class="headerlink" href="#Fraction-recovered" title="Permalink to this headline">Â¶</a></h1>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [618]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">eboss_or_desi</span><span class="o">=</span><span class="s1">&#39;eboss&#39;</span>

<span class="n">fig</span><span class="p">,</span><span class="n">axes</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">12</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">hspace</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span><span class="n">wspace</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
<span class="n">xlim</span><span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">g</span><span class="o">=</span><span class="p">(</span><span class="mf">21.5</span><span class="p">,</span><span class="mf">23.25</span><span class="p">),</span>
           <span class="n">r</span><span class="o">=</span><span class="p">(</span><span class="mf">20.5</span><span class="p">,</span><span class="mi">23</span><span class="p">),</span>
           <span class="n">z</span><span class="o">=</span><span class="p">(</span><span class="mf">19.5</span><span class="p">,</span><span class="mf">22.5</span><span class="p">))</span>


<span class="k">class</span> <span class="nc">getDepth</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">desi</span><span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">g</span><span class="o">=</span><span class="mf">24.0</span><span class="p">,</span>
                        <span class="n">r</span><span class="o">=</span><span class="mf">23.4</span><span class="p">,</span>
                        <span class="n">z</span><span class="o">=</span><span class="mf">22.5</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">eboss_ngc</span><span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">g</span><span class="o">=</span><span class="mf">22.9</span><span class="p">,</span>
                             <span class="n">r</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">desi</span><span class="p">[</span><span class="s1">&#39;r&#39;</span><span class="p">],</span>
                             <span class="n">z</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">desi</span><span class="p">[</span><span class="s1">&#39;z&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">eboss_sgc</span><span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">g</span><span class="o">=</span><span class="mf">22.825</span><span class="p">,</span>
                             <span class="n">r</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">desi</span><span class="p">[</span><span class="s1">&#39;r&#39;</span><span class="p">],</span>
                             <span class="n">z</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">desi</span><span class="p">[</span><span class="s1">&#39;z&#39;</span><span class="p">])</span>
<span class="c1"># D= plots.getDepth()</span>
<span class="n">D</span><span class="o">=</span> <span class="n">getDepth</span><span class="p">()</span>

<span class="n">kw</span><span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">normed</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span><span class="n">return_vals</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="k">for</span> <span class="n">ax</span><span class="p">,</span><span class="n">band</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">axes</span><span class="p">,</span><span class="s1">&#39;grz&#39;</span><span class="p">):</span>
    <span class="n">mag</span><span class="o">=</span> <span class="n">plots</span><span class="o">.</span><span class="n">flux2mag</span><span class="p">(</span><span class="n">dat</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">band</span><span class="o">+</span><span class="s1">&#39;flux&#39;</span><span class="p">))</span>
    <span class="n">mag_rec</span><span class="o">=</span> <span class="n">mag</span><span class="p">[</span><span class="n">isRec</span><span class="p">]</span>
    <span class="n">n</span><span class="p">,</span><span class="n">bins</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">histogram</span><span class="p">(</span><span class="n">mag</span><span class="p">,</span><span class="n">bins</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span><span class="nb">range</span><span class="o">=</span><span class="n">xlim</span><span class="p">[</span><span class="n">band</span><span class="p">],</span><span class="n">normed</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
    <span class="n">n_rec</span><span class="p">,</span><span class="n">_</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">histogram</span><span class="p">(</span><span class="n">mag</span><span class="p">[</span><span class="n">isRec</span><span class="p">],</span><span class="n">bins</span><span class="o">=</span><span class="n">bins</span><span class="p">,</span><span class="nb">range</span><span class="o">=</span><span class="n">xlim</span><span class="p">[</span><span class="n">band</span><span class="p">],</span><span class="n">normed</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
    <span class="n">my_step</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span><span class="n">bins</span><span class="p">,</span><span class="n">n_rec</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span><span class="o">/</span><span class="n">n</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
    <span class="c1">#ax.axvline(plots.getDepth().eboss_ngc(band),c=&#39;k&#39;,ls=&#39;--&#39;)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">D</span><span class="o">.</span><span class="n">eboss_ngc</span><span class="p">[</span><span class="n">band</span><span class="p">],</span><span class="n">c</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
<span class="c1">#     ax.step(bins[:-1],n_rec/n,where=&#39;mid&#39;)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> (AB mag)&#39;</span> <span class="o">%</span> <span class="n">band</span><span class="p">)</span>
<span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="n">axes</span><span class="p">:</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Fraction Recovered&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper left&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="stderr output_area docutils container">
<div class="highlight"><pre>
/Users/kaylan1/miniconda3/envs/mlbook/lib/python3.6/site-packages/ipykernel_launcher.py:30: RuntimeWarning: invalid value encountered in true_divide
/Users/kaylan1/miniconda3/envs/mlbook/lib/python3.6/site-packages/matplotlib/cbook.py:2649: UserWarning: Saw kwargs [&#39;ls&#39;, &#39;linestyle&#39;] which are all aliases for &#39;linestyle&#39;.  Kept value from &#39;linestyle&#39;
  seen=seen, canon=canonical, used=seen[-1]))
/Users/kaylan1/miniconda3/envs/mlbook/lib/python3.6/site-packages/matplotlib/axes/_axes.py:545: UserWarning: No labelled objects found. Use label=&#39;...&#39; kwarg on individual plots.
  warnings.warn(&#34;No labelled objects found. &#34;
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/nb_obiwan_methods_paper_21_1.png" src="../_images/nb_obiwan_methods_paper_21_1.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [508]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">wspace</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>

<span class="n">kw</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="n">m</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span><span class="n">s</span><span class="o">=</span><span class="mf">10.</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.25</span><span class="p">)</span>
<span class="n">plots</span><span class="o">.</span><span class="n">myscatter_open</span><span class="p">(</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">dat</span><span class="o">.</span><span class="n">e1</span><span class="p">,</span><span class="n">dat</span><span class="o">.</span><span class="n">e2</span><span class="p">,</span><span class="o">**</span><span class="n">kw</span><span class="p">)</span>
<span class="n">plots</span><span class="o">.</span><span class="n">myscatter_open</span><span class="p">(</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">dat</span><span class="o">.</span><span class="n">psql_ba</span><span class="p">,</span><span class="n">dat</span><span class="o">.</span><span class="n">psql_pa</span><span class="p">,</span><span class="o">**</span><span class="n">kw</span><span class="p">)</span>

<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="nb">abs</span><span class="p">((</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">get_xlim</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">get_xlim</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span><span class="o">/</span>\
                     <span class="p">(</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">get_xlim</span><span class="p">()[</span><span class="mi">0</span><span class="p">])))</span>

<span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">xlab</span><span class="p">,</span><span class="n">ylab</span> <span class="ow">in</span> <span class="p">[(</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;e1&#39;</span><span class="p">,</span><span class="s1">&#39;e2&#39;</span><span class="p">),(</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39;ba&#39;</span><span class="p">,</span><span class="s1">&#39;pa&#39;</span><span class="p">)]:</span>
    <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">xlab</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">ylab</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/nb_obiwan_methods_paper_22_0.png" src="../_images/nb_obiwan_methods_paper_22_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [509]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">wspace</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>

<span class="n">isRec</span><span class="o">=</span> <span class="n">dat</span><span class="o">.</span><span class="n">obiwan_mask</span> <span class="o">==</span> <span class="mi">1</span>
<span class="n">kw</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="n">m</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span><span class="n">s</span><span class="o">=</span><span class="mf">10.</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.25</span><span class="p">)</span>
<span class="n">plots</span><span class="o">.</span><span class="n">myscatter_open</span><span class="p">(</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">dat</span><span class="o">.</span><span class="n">e1</span><span class="p">[</span><span class="n">isRec</span><span class="p">],</span><span class="n">dat</span><span class="o">.</span><span class="n">e2</span><span class="p">[</span><span class="n">isRec</span><span class="p">],</span><span class="o">**</span><span class="n">kw</span><span class="p">)</span>
<span class="n">plots</span><span class="o">.</span><span class="n">myscatter_open</span><span class="p">(</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">dat</span><span class="o">.</span><span class="n">psql_ba</span><span class="p">[</span><span class="n">isRec</span><span class="p">],</span><span class="n">dat</span><span class="o">.</span><span class="n">psql_pa</span><span class="p">[</span><span class="n">isRec</span><span class="p">],</span><span class="o">**</span><span class="n">kw</span><span class="p">)</span>

<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="nb">abs</span><span class="p">((</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">get_xlim</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">get_xlim</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span><span class="o">/</span>\
                     <span class="p">(</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">get_xlim</span><span class="p">()[</span><span class="mi">0</span><span class="p">])))</span>

<span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">xlab</span><span class="p">,</span><span class="n">ylab</span> <span class="ow">in</span> <span class="p">[(</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;e1&#39;</span><span class="p">,</span><span class="s1">&#39;e2&#39;</span><span class="p">),(</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39;ba&#39;</span><span class="p">,</span><span class="s1">&#39;pa&#39;</span><span class="p">)]:</span>
    <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">xlab</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">ylab</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s1">&#39;Recovered&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>Out[509]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>&lt;matplotlib.text.Text at 0x145d19828&gt;
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/nb_obiwan_methods_paper_23_1.png" src="../_images/nb_obiwan_methods_paper_23_1.png" />
</div>
</div>
</div>
<div class="section" id="horizontal-bar-plot-by-type:-number-input,-recovered,-measures-of-PSF,-EXP...">
<h1>horizontal bar plot by type: number input, recovered, measures of PSF, EXPâ€¦<a class="headerlink" href="#horizontal-bar-plot-by-type:-number-input,-recovered,-measures-of-PSF,-EXP..." title="Permalink to this headline">Â¶</a></h1>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [35]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">types</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">char</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="n">dat</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;tractor_type&#39;</span><span class="p">))</span>
<span class="n">types</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">types</span><span class="p">)</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="s1">&#39;SIMP&#39;</span><span class="p">,</span><span class="s1">&#39;REX&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">values</span><span class="p">]</span><span class="o">=</span> <span class="s1">&#39;EXP&#39;</span>
<span class="n">use_types</span><span class="o">=</span> <span class="p">[</span><span class="s1">&#39;PSF&#39;</span><span class="p">,</span><span class="s1">&#39;EXP&#39;</span><span class="p">,</span><span class="s1">&#39;DEV&#39;</span><span class="p">,</span><span class="s1">&#39;COMP&#39;</span><span class="p">]</span>

<span class="n">isRec</span><span class="o">=</span><span class="n">dat</span><span class="o">.</span><span class="n">obiwan_mask</span> <span class="o">==</span> <span class="mi">1</span>
<span class="c1">#number input, recovered,...</span>
<span class="n">injected</span><span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">dat</span><span class="p">[</span><span class="n">dat</span><span class="o">.</span><span class="n">n</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]),</span><span class="nb">len</span><span class="p">(</span><span class="n">dat</span><span class="p">[</span><span class="n">dat</span><span class="o">.</span><span class="n">n</span> <span class="o">==</span> <span class="mi">4</span><span class="p">]),</span><span class="mi">0</span><span class="p">]</span>
<span class="n">recovered</span><span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">dat</span><span class="p">[(</span><span class="n">isRec</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">dat</span><span class="o">.</span><span class="n">n</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)]),</span>
                  <span class="nb">len</span><span class="p">(</span><span class="n">dat</span><span class="p">[(</span><span class="n">isRec</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">dat</span><span class="o">.</span><span class="n">n</span> <span class="o">==</span> <span class="mi">4</span><span class="p">)]),</span><span class="mi">0</span><span class="p">]</span>
<span class="n">tractor</span><span class="o">=</span> <span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">dat</span><span class="p">[(</span><span class="n">isRec</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">types</span> <span class="o">==</span> <span class="n">typ</span><span class="p">)])</span>
               <span class="k">for</span> <span class="n">typ</span> <span class="ow">in</span> <span class="n">use_types</span><span class="p">]</span>

<span class="n">df</span><span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="n">use_types</span><span class="p">,</span>
                      <span class="n">injected</span><span class="o">=</span><span class="n">injected</span><span class="p">,</span>
                      <span class="n">recovered</span><span class="o">=</span><span class="n">recovered</span><span class="p">,</span>
                      <span class="n">tractor</span><span class="o">=</span><span class="n">tractor</span><span class="p">))</span>
<span class="n">df</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;type&#39;</span><span class="p">,</span><span class="n">inplace</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>Out[35]:
</pre></div>
</div>
<div class="output_area docutils container">
<div>
<style>
    .dataframe thead tr:only-child th {
        text-align: right;
    }

    .dataframe thead th {
        text-align: left;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>injected</th>
      <th>recovered</th>
      <th>tractor</th>
    </tr>
    <tr>
      <th>type</th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>PSF</th>
      <td>0</td>
      <td>0</td>
      <td>176</td>
    </tr>
    <tr>
      <th>EXP</th>
      <td>7453</td>
      <td>6428</td>
      <td>6507</td>
    </tr>
    <tr>
      <th>DEV</th>
      <td>839</td>
      <td>714</td>
      <td>451</td>
    </tr>
    <tr>
      <th>COMP</th>
      <td>0</td>
      <td>0</td>
      <td>8</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [36]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">df</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">barh</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
<span class="n">xlab</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Number&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;hey&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/nb_obiwan_methods_paper_26_0.png" src="../_images/nb_obiwan_methods_paper_26_0.png" />
</div>
</div>
</div>
<div class="section" id="Confusion-matrix">
<h1>Confusion matrix<a class="headerlink" href="#Confusion-matrix" title="Permalink to this headline">Â¶</a></h1>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [44]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">def</span> <span class="nf">create_confusion_matrix</span><span class="p">(</span><span class="n">answer_type</span><span class="p">,</span><span class="n">predict_type</span><span class="p">,</span>
                            <span class="n">poss_types</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;PSF&#39;</span><span class="p">,</span><span class="s1">&#39;SIMP&#39;</span><span class="p">,</span><span class="s1">&#39;EXP&#39;</span><span class="p">,</span><span class="s1">&#39;DEV&#39;</span><span class="p">,</span><span class="s1">&#39;COMP&#39;</span><span class="p">,</span><span class="s1">&#39;REX&#39;</span><span class="p">]):</span>
    <span class="sd">&#39;&#39;&#39;compares classifications of matched objects, returns 2D array which is conf matrix and xylabels</span>
<span class="sd">    return 5x5 confusion matrix and colum/row names</span>
<span class="sd">    answer_type,predict_type -- arrays of same length with reference and prediction types&#39;&#39;&#39;</span>
    <span class="k">for</span> <span class="n">typ</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">(</span><span class="n">answer_type</span><span class="p">):</span> <span class="k">assert</span><span class="p">(</span><span class="n">typ</span> <span class="ow">in</span> <span class="n">poss_types</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">typ</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">(</span><span class="n">predict_type</span><span class="p">):</span> <span class="k">assert</span><span class="p">(</span><span class="n">typ</span> <span class="ow">in</span> <span class="n">poss_types</span><span class="p">)</span>
    <span class="n">ans_types</span><span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">poss_types</span><span class="p">)</span>
    <span class="n">cm</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">poss_types</span><span class="p">),</span><span class="nb">len</span><span class="p">(</span><span class="n">poss_types</span><span class="p">)))</span><span class="o">-</span><span class="mi">1</span>
    <span class="k">for</span> <span class="n">i_ans</span><span class="p">,</span><span class="n">ans_type</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">poss_types</span><span class="p">):</span>
        <span class="n">ind</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">answer_type</span> <span class="o">==</span> <span class="n">ans_type</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">i_pred</span><span class="p">,</span><span class="n">pred_type</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">poss_types</span><span class="p">):</span>
            <span class="n">n_pred</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">predict_type</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">==</span> <span class="n">pred_type</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">size</span>
            <span class="k">if</span> <span class="n">ind</span><span class="o">.</span><span class="n">size</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span> <span class="n">cm</span><span class="p">[</span><span class="n">i_ans</span><span class="p">,</span><span class="n">i_pred</span><span class="p">]</span><span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">n_pred</span><span class="p">)</span><span class="o">/</span><span class="n">ind</span><span class="o">.</span><span class="n">size</span> <span class="c1"># ind.size is constant for loop over pred_types</span>
            <span class="k">else</span><span class="p">:</span> <span class="n">cm</span><span class="p">[</span><span class="n">i_ans</span><span class="p">,</span><span class="n">i_pred</span><span class="p">]</span><span class="o">=</span> <span class="mi">0</span> <span class="c1">#np.nan</span>
    <span class="k">return</span> <span class="n">cm</span>

<span class="k">def</span> <span class="nf">plot_confusion_matrix</span><span class="p">(</span><span class="n">cm</span><span class="p">,</span><span class="n">answer_names</span><span class="p">,</span><span class="n">all_names</span><span class="p">,</span> <span class="n">qafile</span><span class="o">=</span><span class="s1">&#39;test.png&#39;</span><span class="p">):</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">cm</span><span class="p">,</span> <span class="n">interpolation</span><span class="o">=</span><span class="s1">&#39;nearest&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">Blues</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">vmax</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">cbar</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">all_names</span><span class="p">)),</span> <span class="n">all_names</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">answer_names</span><span class="p">)),</span> <span class="n">answer_names</span><span class="p">)</span>
    <span class="n">ylab</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Truth&#39;</span><span class="p">)</span>
    <span class="n">xlab</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Tractor&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">answer_names</span><span class="p">)):</span>
        <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">all_names</span><span class="p">)):</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">cm</span><span class="p">[</span><span class="n">row</span><span class="p">,</span><span class="n">col</span><span class="p">]):</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">col</span><span class="p">,</span><span class="n">row</span><span class="p">,</span><span class="s1">&#39;n/a&#39;</span><span class="p">,</span><span class="n">va</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span><span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">cm</span><span class="p">[</span><span class="n">row</span><span class="p">,</span><span class="n">col</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.5</span><span class="p">:</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">col</span><span class="p">,</span><span class="n">row</span><span class="p">,</span><span class="s1">&#39;</span><span class="si">%.2f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">cm</span><span class="p">[</span><span class="n">row</span><span class="p">,</span><span class="n">col</span><span class="p">],</span><span class="n">va</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span><span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;yellow&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">col</span><span class="p">,</span><span class="n">row</span><span class="p">,</span><span class="s1">&#39;</span><span class="si">%.2f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">cm</span><span class="p">[</span><span class="n">row</span><span class="p">,</span><span class="n">col</span><span class="p">],</span><span class="n">va</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span><span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">qafile</span><span class="p">,</span> <span class="n">bbox_extra_artists</span><span class="o">=</span><span class="p">[</span><span class="n">xlab</span><span class="p">,</span><span class="n">ylab</span><span class="p">],</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">,</span><span class="n">dpi</span><span class="o">=</span><span class="mi">150</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="c1"># Confusion matrix for distribution of object types</span>
<span class="c1"># Basic cm, use slim=False</span>
<span class="c1">#types= [&#39;PSF&#39;,&#39;REX&#39;, &#39;SIMP&#39;, &#39;EXP&#39;, &#39;DEV&#39;, &#39;COMP&#39;]</span>
<span class="n">input_type</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="s1">&#39;EXP&#39;</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">dat</span><span class="p">))</span>
<span class="n">input_type</span><span class="p">[(</span><span class="n">isRec</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">dat</span><span class="o">.</span><span class="n">n</span> <span class="o">==</span> <span class="mi">4</span><span class="p">)]</span><span class="o">=</span> <span class="s1">&#39;DEV&#39;</span>
<span class="n">cm</span><span class="o">=</span> <span class="n">create_confusion_matrix</span><span class="p">(</span><span class="n">input_type</span><span class="p">[</span><span class="n">isRec</span><span class="p">],</span><span class="n">types</span><span class="p">[</span><span class="n">isRec</span><span class="p">],</span> <span class="n">poss_types</span><span class="o">=</span><span class="n">use_types</span><span class="p">)</span>
<span class="n">qafile</span> <span class="o">=</span> <span class="s1">&#39;cm.png&#39;</span>
<span class="n">plot_confusion_matrix</span><span class="p">(</span><span class="n">cm</span><span class="p">,</span><span class="n">use_types</span><span class="p">,</span><span class="n">use_types</span><span class="p">,</span> <span class="n">qafile</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [529]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>

<span class="n">xlim</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mf">2.5</span><span class="p">)</span>
<span class="n">kw</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">normed</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span><span class="nb">range</span><span class="o">=</span><span class="n">xlim</span><span class="p">)</span>

<span class="n">n</span><span class="p">,</span><span class="n">bins</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">histogram</span><span class="p">(</span><span class="n">dat</span><span class="o">.</span><span class="n">rhalf</span><span class="p">,</span><span class="n">bins</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span><span class="o">**</span><span class="n">kw</span><span class="p">)</span>
<span class="n">n_rec</span><span class="p">,</span><span class="n">_</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">histogram</span><span class="p">(</span><span class="n">dat</span><span class="o">.</span><span class="n">rhalf</span><span class="p">[</span><span class="n">isRec</span><span class="p">],</span><span class="n">bins</span><span class="o">=</span><span class="n">bins</span><span class="p">,</span><span class="o">**</span><span class="n">kw</span><span class="p">)</span>
<span class="n">my_step</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span><span class="n">bins</span><span class="p">,</span><span class="n">n_rec</span><span class="o">/</span><span class="n">n</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;rhalf (arcsec)&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Fraction Recovered&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">1.</span><span class="p">)</span>

</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="stderr output_area docutils container">
<div class="highlight"><pre>
/Users/kaylan1/miniconda3/envs/mlbook/lib/python3.6/site-packages/ipykernel_launcher.py:8: RuntimeWarning: invalid value encountered in true_divide

/Users/kaylan1/miniconda3/envs/mlbook/lib/python3.6/site-packages/matplotlib/cbook.py:2649: UserWarning: Saw kwargs [&#39;ls&#39;, &#39;linestyle&#39;] which are all aliases for &#39;linestyle&#39;.  Kept value from &#39;linestyle&#39;
  seen=seen, canon=canonical, used=seen[-1]))
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>Out[529]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>(0.0, 1.0)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/nb_obiwan_methods_paper_29_2.png" src="../_images/nb_obiwan_methods_paper_29_2.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [541]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">def</span> <span class="nf">eboss_ts</span><span class="p">(</span><span class="n">gmag</span><span class="p">,</span><span class="n">rz</span><span class="p">,</span><span class="n">gr</span><span class="p">,</span><span class="n">region</span><span class="o">=</span><span class="s1">&#39;ngc&#39;</span><span class="p">):</span>
    <span class="n">colorCut</span><span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">sgc</span><span class="o">=</span> <span class="p">((</span><span class="n">gmag</span> <span class="o">&gt;</span> <span class="mf">21.825</span><span class="p">)</span> <span class="o">&amp;</span>
                         <span class="p">(</span><span class="n">gmag</span> <span class="o">&lt;</span> <span class="mf">22.825</span><span class="p">)</span> <span class="o">&amp;</span>
                         <span class="p">(</span><span class="o">-</span><span class="mf">0.068</span> <span class="o">*</span> <span class="n">rz</span> <span class="o">+</span> <span class="mf">0.457</span> <span class="o">&lt;</span> <span class="n">gr</span><span class="p">)</span> <span class="o">&amp;</span>
                         <span class="p">(</span><span class="n">gr</span> <span class="o">&lt;</span> <span class="mf">0.112</span> <span class="o">*</span> <span class="n">rz</span> <span class="o">+</span> <span class="mf">0.773</span><span class="p">)</span> <span class="o">&amp;</span>
                         <span class="p">(</span><span class="mf">0.218</span> <span class="o">*</span> <span class="n">gr</span> <span class="o">+</span> <span class="mf">0.571</span> <span class="o">&lt;</span> <span class="n">rz</span><span class="p">)</span> <span class="o">&amp;</span>
                         <span class="p">(</span><span class="n">rz</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mf">0.555</span> <span class="o">*</span> <span class="n">gr</span> <span class="o">+</span> <span class="mf">1.901</span><span class="p">)),</span>
                   <span class="n">ngc</span><span class="o">=</span> <span class="p">((</span><span class="n">gmag</span> <span class="o">&gt;</span> <span class="mf">21.825</span><span class="p">)</span> <span class="o">&amp;</span>
                         <span class="p">(</span><span class="n">gmag</span> <span class="o">&lt;</span> <span class="mf">22.9</span><span class="p">)</span> <span class="o">&amp;</span>
                         <span class="p">(</span><span class="o">-</span><span class="mf">0.068</span> <span class="o">*</span> <span class="n">rz</span> <span class="o">+</span> <span class="mf">0.457</span> <span class="o">&lt;</span> <span class="n">gr</span><span class="p">)</span> <span class="o">&amp;</span>
                         <span class="p">(</span><span class="n">gr</span> <span class="o">&lt;</span> <span class="mf">0.112</span> <span class="o">*</span> <span class="n">rz</span> <span class="o">+</span> <span class="mf">0.773</span><span class="p">)</span> <span class="o">&amp;</span>
                         <span class="p">(</span><span class="mf">0.637</span> <span class="o">*</span> <span class="n">gr</span> <span class="o">+</span> <span class="mf">0.399</span> <span class="o">&lt;</span> <span class="n">rz</span><span class="p">)</span> <span class="o">&amp;</span>
                         <span class="p">(</span><span class="n">rz</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mf">0.555</span> <span class="o">*</span> <span class="n">gr</span> <span class="o">+</span> <span class="mf">1.901</span><span class="p">)))</span>
    <span class="k">return</span> <span class="n">colorCut</span><span class="p">[</span><span class="n">region</span><span class="p">]</span>

<span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">12</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">hspace</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span><span class="n">wspace</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>

<span class="n">rz</span><span class="o">=</span> <span class="n">dat</span><span class="o">.</span><span class="n">psql_r</span> <span class="o">-</span> <span class="n">dat</span><span class="o">.</span><span class="n">psql_z</span>
<span class="n">gr</span><span class="o">=</span> <span class="n">dat</span><span class="o">.</span><span class="n">psql_g</span> <span class="o">-</span> <span class="n">dat</span><span class="o">.</span><span class="n">psql_r</span>
<span class="n">is_elg_input</span><span class="o">=</span> <span class="n">eboss_ts</span><span class="p">(</span><span class="n">dat</span><span class="o">.</span><span class="n">psql_g</span><span class="p">,</span><span class="n">rz</span><span class="p">,</span><span class="n">gr</span><span class="p">,</span><span class="n">region</span><span class="o">=</span><span class="s1">&#39;ngc&#39;</span><span class="p">)</span>
<span class="n">is_elg_trac</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dat</span><span class="p">),</span><span class="nb">bool</span><span class="p">)</span>
<span class="n">mags</span><span class="o">=</span><span class="p">{}</span>
<span class="k">for</span> <span class="n">band</span> <span class="ow">in</span> <span class="s1">&#39;grz&#39;</span><span class="p">:</span>
    <span class="n">mags</span><span class="p">[</span><span class="n">band</span><span class="p">]</span><span class="o">=</span> <span class="n">plots</span><span class="o">.</span><span class="n">flux2mag</span><span class="p">(</span><span class="n">dat</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;tractor_flux_&#39;</span><span class="o">+</span><span class="n">band</span><span class="p">)[</span><span class="n">isRec</span><span class="p">]</span><span class="o">/</span>\
                                 <span class="n">dat</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;tractor_mw_transmission_&#39;</span><span class="o">+</span><span class="n">band</span><span class="p">)[</span><span class="n">isRec</span><span class="p">])</span>
<span class="n">is_elg_trac</span><span class="p">[</span><span class="n">isRec</span><span class="p">][</span><span class="n">eboss_ts</span><span class="p">(</span><span class="n">mags</span><span class="p">[</span><span class="s1">&#39;g&#39;</span><span class="p">],</span><span class="n">mags</span><span class="p">[</span><span class="s1">&#39;r&#39;</span><span class="p">]</span><span class="o">-</span><span class="n">mags</span><span class="p">[</span><span class="s1">&#39;z&#39;</span><span class="p">],</span><span class="n">mags</span><span class="p">[</span><span class="s1">&#39;g&#39;</span><span class="p">]</span><span class="o">-</span><span class="n">mags</span><span class="p">[</span><span class="s1">&#39;r&#39;</span><span class="p">],</span><span class="n">region</span><span class="o">=</span><span class="s1">&#39;ngc&#39;</span><span class="p">)]</span><span class="o">=</span> <span class="bp">True</span>

<span class="n">kw</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">marker</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">,</span><span class="n">s</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">kw_hist</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">bins</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span><span class="nb">range</span><span class="o">=</span><span class="p">(</span><span class="mf">21.5</span><span class="p">,</span><span class="mf">23.25</span><span class="p">),</span><span class="n">normed</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>

<span class="n">lab</span><span class="p">,</span><span class="n">keep</span><span class="o">=</span> <span class="s1">&#39;recovered &amp; ELG (input) &amp; ELG (tractor)&#39;</span><span class="p">,</span> <span class="p">((</span><span class="n">is_elg_input</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">isRec</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">is_elg_trac</span><span class="p">))</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">rz</span><span class="p">[</span><span class="n">keep</span><span class="p">],</span><span class="n">gr</span><span class="p">[</span><span class="n">keep</span><span class="p">],</span>
                <span class="n">c</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="n">lab</span><span class="p">,</span><span class="o">**</span><span class="n">kw</span><span class="p">)</span>
<span class="n">myhist</span><span class="p">(</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span><span class="n">dat</span><span class="o">.</span><span class="n">psql_g</span><span class="p">[</span><span class="n">keep</span><span class="p">],</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="n">lab</span><span class="p">,</span><span class="o">**</span><span class="n">kw_hist</span><span class="p">)</span>
<span class="n">lab</span><span class="p">,</span><span class="n">keep</span><span class="o">=</span> <span class="s1">&#39;recovered &amp; ELG (input) &amp; not ELG (tractor)&#39;</span><span class="p">,</span> <span class="p">((</span><span class="n">is_elg_input</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">isRec</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="o">~</span><span class="n">is_elg_trac</span><span class="p">))</span>
<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">rz</span><span class="p">[</span><span class="n">keep</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">rz</span><span class="p">[</span><span class="n">keep</span><span class="p">],</span><span class="n">gr</span><span class="p">[</span><span class="n">keep</span><span class="p">],</span>
                    <span class="n">c</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="n">lab</span><span class="p">,</span><span class="o">**</span><span class="n">kw</span><span class="p">)</span>
    <span class="n">myhist</span><span class="p">(</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span><span class="n">dat</span><span class="o">.</span><span class="n">psql_g</span><span class="p">[</span><span class="n">keep</span><span class="p">],</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="n">lab</span><span class="p">,</span><span class="o">**</span><span class="n">kw_hist</span><span class="p">)</span>

<span class="n">lab</span><span class="p">,</span><span class="n">keep</span><span class="o">=</span> <span class="s1">&#39;not recovered &amp; ELG&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">is_elg_input</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="o">~</span><span class="n">isRec</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">rz</span><span class="p">[</span><span class="n">keep</span><span class="p">],</span><span class="n">gr</span><span class="p">[</span><span class="n">keep</span><span class="p">],</span>
                <span class="n">c</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="n">lab</span><span class="p">,</span><span class="o">**</span><span class="n">kw</span><span class="p">)</span>
<span class="n">myhist</span><span class="p">(</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span><span class="n">dat</span><span class="o">.</span><span class="n">psql_g</span><span class="p">[</span><span class="n">keep</span><span class="p">],</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="n">lab</span><span class="p">,</span><span class="o">**</span><span class="n">kw_hist</span><span class="p">)</span>

<span class="n">lab</span><span class="p">,</span><span class="n">keep</span><span class="o">=</span> <span class="s1">&#39;recovered &amp; not ELG (input) &amp; not ELG (tractor)&#39;</span><span class="p">,</span> <span class="p">((</span><span class="o">~</span><span class="n">is_elg_input</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">isRec</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="o">~</span><span class="n">is_elg_trac</span><span class="p">))</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">rz</span><span class="p">[</span><span class="n">keep</span><span class="p">],</span><span class="n">gr</span><span class="p">[</span><span class="n">keep</span><span class="p">],</span>
                <span class="n">c</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="n">lab</span><span class="p">,</span><span class="o">**</span><span class="n">kw</span><span class="p">)</span>
<span class="n">myhist</span><span class="p">(</span><span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span><span class="n">dat</span><span class="o">.</span><span class="n">psql_g</span><span class="p">[</span><span class="n">keep</span><span class="p">],</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="n">lab</span><span class="p">,</span><span class="o">**</span><span class="n">kw_hist</span><span class="p">)</span>
<span class="n">lab</span><span class="p">,</span><span class="n">keep</span><span class="o">=</span> <span class="s1">&#39;recovered &amp; not ELG (input) &amp; ELG (tractor)&#39;</span><span class="p">,</span> <span class="p">((</span><span class="o">~</span><span class="n">is_elg_input</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">isRec</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">is_elg_trac</span><span class="p">))</span>
<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">rz</span><span class="p">[</span><span class="n">keep</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">rz</span><span class="p">[</span><span class="n">keep</span><span class="p">],</span><span class="n">gr</span><span class="p">[</span><span class="n">keep</span><span class="p">],</span>
                    <span class="n">c</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="n">lab</span><span class="p">,</span><span class="o">**</span><span class="n">kw</span><span class="p">)</span>
    <span class="n">myhist</span><span class="p">(</span><span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span><span class="n">dat</span><span class="o">.</span><span class="n">psql_g</span><span class="p">[</span><span class="n">keep</span><span class="p">],</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="n">lab</span><span class="p">,</span><span class="o">**</span><span class="n">kw_hist</span><span class="p">)</span>

<span class="n">lab</span><span class="p">,</span><span class="n">keep</span><span class="o">=</span> <span class="s1">&#39;not recovered &amp; not ELG&#39;</span><span class="p">,</span> <span class="p">(</span><span class="o">~</span><span class="n">is_elg_input</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="o">~</span><span class="n">isRec</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">rz</span><span class="p">[</span><span class="n">keep</span><span class="p">],</span><span class="n">gr</span><span class="p">[</span><span class="n">keep</span><span class="p">],</span>
                <span class="n">c</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="n">lab</span><span class="p">,</span><span class="o">**</span><span class="n">kw</span><span class="p">)</span>
<span class="n">myhist</span><span class="p">(</span><span class="n">ax</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span><span class="n">dat</span><span class="o">.</span><span class="n">psql_g</span><span class="p">[</span><span class="n">keep</span><span class="p">],</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="n">lab</span><span class="p">,</span><span class="o">**</span><span class="n">kw_hist</span><span class="p">)</span>

<span class="n">num_plotted</span><span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">rz</span><span class="p">[(</span><span class="n">is_elg_input</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">isRec</span><span class="p">)])</span> <span class="o">+</span> \
             <span class="nb">len</span><span class="p">(</span><span class="n">rz</span><span class="p">[(</span><span class="n">is_elg_input</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="o">~</span><span class="n">isRec</span><span class="p">)])</span> <span class="o">+</span> \
             <span class="nb">len</span><span class="p">(</span><span class="n">rz</span><span class="p">[(</span><span class="o">~</span><span class="n">is_elg_input</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">isRec</span><span class="p">)])</span> <span class="o">+</span> \
             <span class="nb">len</span><span class="p">(</span><span class="n">rz</span><span class="p">[(</span><span class="o">~</span><span class="n">is_elg_input</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="o">~</span><span class="n">isRec</span><span class="p">)])</span>
<span class="k">assert</span><span class="p">(</span><span class="n">num_plotted</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">rz</span><span class="p">))</span>


<span class="n">ax</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;r-z&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;g&#39;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
    <span class="n">ax</span><span class="p">[</span><span class="n">row</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;g-r&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="n">row</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Number&#39;</span><span class="p">)</span>

<span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">row</span><span class="p">,</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper left&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="n">row</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="n">row</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mf">0.2</span><span class="p">,</span><span class="mf">1.3</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="stderr output_area docutils container">
<div class="highlight"><pre>
/Users/kaylan1/PhdStudent/Research/desi/obiwan/py/obiwan/qa/plots.py:39: RuntimeWarning: divide by zero encountered in log10
  np.linspace(ylim[0],ylim[1],nbins[1])))
/Users/kaylan1/PhdStudent/Research/desi/obiwan/py/obiwan/qa/plots.py:39: RuntimeWarning: invalid value encountered in log10
  np.linspace(ylim[0],ylim[1],nbins[1])))
/Users/kaylan1/miniconda3/envs/mlbook/lib/python3.6/site-packages/ipykernel_launcher.py:27: RuntimeWarning: invalid value encountered in subtract
/Users/kaylan1/miniconda3/envs/mlbook/lib/python3.6/site-packages/ipykernel_launcher.py:6: RuntimeWarning: invalid value encountered in greater

/Users/kaylan1/miniconda3/envs/mlbook/lib/python3.6/site-packages/ipykernel_launcher.py:6: RuntimeWarning: invalid value encountered in less

/Users/kaylan1/miniconda3/envs/mlbook/lib/python3.6/site-packages/ipykernel_launcher.py:7: RuntimeWarning: invalid value encountered in less
  import sys
/Users/kaylan1/miniconda3/envs/mlbook/lib/python3.6/site-packages/ipykernel_launcher.py:12: RuntimeWarning: invalid value encountered in greater
  if sys.path[0] == &#39;&#39;:
/Users/kaylan1/miniconda3/envs/mlbook/lib/python3.6/site-packages/ipykernel_launcher.py:12: RuntimeWarning: invalid value encountered in less
  if sys.path[0] == &#39;&#39;:
/Users/kaylan1/miniconda3/envs/mlbook/lib/python3.6/site-packages/ipykernel_launcher.py:13: RuntimeWarning: invalid value encountered in less
  del sys.path[0]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(8292,) (8292,)
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/nb_obiwan_methods_paper_30_2.png" src="../_images/nb_obiwan_methods_paper_30_2.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [460]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">dat</span><span class="o">.</span><span class="n">get_columns</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>Out[460]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>[&#39;id&#39;,
 &#39;ra&#39;,
 &#39;dec&#39;,
 &#39;x&#39;,
 &#39;y&#39;,
 &#39;gflux&#39;,
 &#39;mw_transmission_g&#39;,
 &#39;rflux&#39;,
 &#39;mw_transmission_r&#39;,
 &#39;zflux&#39;,
 &#39;mw_transmission_z&#39;,
 &#39;n&#39;,
 &#39;rhalf&#39;,
 &#39;e1&#39;,
 &#39;e2&#39;,
 &#39;unique_id&#39;,
 &#39;psql_id&#39;,
 &#39;psql_ra&#39;,
 &#39;psql_dec&#39;,
 &#39;psql_g&#39;,
 &#39;psql_r&#39;,
 &#39;psql_z&#39;,
 &#39;psql_rhalf&#39;,
 &#39;psql_n&#39;,
 &#39;psql_ba&#39;,
 &#39;psql_pa&#39;,
 &#39;psql_redshift&#39;,
 &#39;tractor_release&#39;,
 &#39;tractor_brickid&#39;,
 &#39;tractor_brickname&#39;,
 &#39;tractor_objid&#39;,
 &#39;tractor_brick_primary&#39;,
 &#39;tractor_type&#39;,
 &#39;tractor_ra&#39;,
 &#39;tractor_dec&#39;,
 &#39;tractor_ra_ivar&#39;,
 &#39;tractor_dec_ivar&#39;,
 &#39;tractor_bx&#39;,
 &#39;tractor_by&#39;,
 &#39;tractor_dchisq&#39;,
 &#39;tractor_ebv&#39;,
 &#39;tractor_mjd_min&#39;,
 &#39;tractor_mjd_max&#39;,
 &#39;tractor_flux_u&#39;,
 &#39;tractor_flux_g&#39;,
 &#39;tractor_flux_r&#39;,
 &#39;tractor_flux_i&#39;,
 &#39;tractor_flux_z&#39;,
 &#39;tractor_flux_y&#39;,
 &#39;tractor_flux_ivar_u&#39;,
 &#39;tractor_flux_ivar_g&#39;,
 &#39;tractor_flux_ivar_r&#39;,
 &#39;tractor_flux_ivar_i&#39;,
 &#39;tractor_flux_ivar_z&#39;,
 &#39;tractor_flux_ivar_y&#39;,
 &#39;tractor_apflux_resid_g&#39;,
 &#39;tractor_apflux_resid_r&#39;,
 &#39;tractor_apflux_resid_z&#39;,
 &#39;tractor_mw_transmission_u&#39;,
 &#39;tractor_mw_transmission_g&#39;,
 &#39;tractor_mw_transmission_r&#39;,
 &#39;tractor_mw_transmission_i&#39;,
 &#39;tractor_mw_transmission_z&#39;,
 &#39;tractor_mw_transmission_y&#39;,
 &#39;tractor_nobs_u&#39;,
 &#39;tractor_nobs_g&#39;,
 &#39;tractor_nobs_r&#39;,
 &#39;tractor_nobs_i&#39;,
 &#39;tractor_nobs_z&#39;,
 &#39;tractor_nobs_y&#39;,
 &#39;tractor_rchisq_u&#39;,
 &#39;tractor_rchisq_g&#39;,
 &#39;tractor_rchisq_r&#39;,
 &#39;tractor_rchisq_i&#39;,
 &#39;tractor_rchisq_z&#39;,
 &#39;tractor_rchisq_y&#39;,
 &#39;tractor_fracflux_u&#39;,
 &#39;tractor_fracflux_g&#39;,
 &#39;tractor_fracflux_r&#39;,
 &#39;tractor_fracflux_i&#39;,
 &#39;tractor_fracflux_z&#39;,
 &#39;tractor_fracflux_y&#39;,
 &#39;tractor_fracmasked_u&#39;,
 &#39;tractor_fracmasked_g&#39;,
 &#39;tractor_fracmasked_r&#39;,
 &#39;tractor_fracmasked_i&#39;,
 &#39;tractor_fracmasked_z&#39;,
 &#39;tractor_fracmasked_y&#39;,
 &#39;tractor_fracin_u&#39;,
 &#39;tractor_fracin_g&#39;,
 &#39;tractor_fracin_r&#39;,
 &#39;tractor_fracin_i&#39;,
 &#39;tractor_fracin_z&#39;,
 &#39;tractor_fracin_y&#39;,
 &#39;tractor_anymask_u&#39;,
 &#39;tractor_anymask_g&#39;,
 &#39;tractor_anymask_r&#39;,
 &#39;tractor_anymask_i&#39;,
 &#39;tractor_anymask_z&#39;,
 &#39;tractor_anymask_y&#39;,
 &#39;tractor_allmask_u&#39;,
 &#39;tractor_allmask_g&#39;,
 &#39;tractor_allmask_r&#39;,
 &#39;tractor_allmask_i&#39;,
 &#39;tractor_allmask_z&#39;,
 &#39;tractor_allmask_y&#39;,
 &#39;tractor_psfsize_u&#39;,
 &#39;tractor_psfsize_g&#39;,
 &#39;tractor_psfsize_r&#39;,
 &#39;tractor_psfsize_i&#39;,
 &#39;tractor_psfsize_z&#39;,
 &#39;tractor_psfsize_y&#39;,
 &#39;tractor_psfdepth_u&#39;,
 &#39;tractor_psfdepth_g&#39;,
 &#39;tractor_psfdepth_r&#39;,
 &#39;tractor_psfdepth_i&#39;,
 &#39;tractor_psfdepth_z&#39;,
 &#39;tractor_psfdepth_y&#39;,
 &#39;tractor_galdepth_u&#39;,
 &#39;tractor_galdepth_g&#39;,
 &#39;tractor_galdepth_r&#39;,
 &#39;tractor_galdepth_i&#39;,
 &#39;tractor_galdepth_z&#39;,
 &#39;tractor_galdepth_y&#39;,
 &#39;tractor_fracdev&#39;,
 &#39;tractor_fracdev_ivar&#39;,
 &#39;tractor_shapeexp_r&#39;,
 &#39;tractor_shapeexp_r_ivar&#39;,
 &#39;tractor_shapeexp_e1&#39;,
 &#39;tractor_shapeexp_e1_ivar&#39;,
 &#39;tractor_shapeexp_e2&#39;,
 &#39;tractor_shapeexp_e2_ivar&#39;,
 &#39;tractor_shapedev_r&#39;,
 &#39;tractor_shapedev_r_ivar&#39;,
 &#39;tractor_shapedev_e1&#39;,
 &#39;tractor_shapedev_e1_ivar&#39;,
 &#39;tractor_shapedev_e2&#39;,
 &#39;tractor_shapedev_e2_ivar&#39;,
 &#39;obiwan_mask&#39;,
 &#39;targets_mask&#39;]
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [470]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>

<span class="c1"># xlim=(0,2.5)</span>
<span class="n">xlim</span><span class="o">=</span><span class="bp">None</span>
<span class="n">kw</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="nb">range</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">normed</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span><span class="n">bins</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>

<span class="n">myhist</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span><span class="n">dat</span><span class="o">.</span><span class="n">psql_redshift</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;input&#39;</span><span class="p">,</span><span class="o">**</span><span class="n">kw</span><span class="p">)</span>

<span class="n">lab</span><span class="p">,</span><span class="n">keep</span><span class="o">=</span> <span class="s1">&#39;input &amp; ELG&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">is_elg_input</span><span class="p">)</span>
<span class="n">myhist</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span><span class="n">dat</span><span class="o">.</span><span class="n">psql_redshift</span><span class="p">[</span><span class="n">keep</span><span class="p">],</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;g&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="n">lab</span><span class="p">,</span><span class="o">**</span><span class="n">kw</span><span class="p">)</span>

<span class="n">lab</span><span class="p">,</span><span class="n">keep</span><span class="o">=</span> <span class="s1">&#39;recovered &amp; ELG&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">isRec</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">is_elg_input</span><span class="p">)</span>
<span class="n">myhist</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span><span class="n">dat</span><span class="o">.</span><span class="n">psql_redshift</span><span class="p">[</span><span class="n">keep</span><span class="p">],</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="n">lab</span><span class="p">,</span><span class="o">**</span><span class="n">kw</span><span class="p">)</span>

<span class="n">lab</span><span class="p">,</span><span class="n">keep</span><span class="o">=</span> <span class="s1">&#39;not recovered &amp; ELG&#39;</span><span class="p">,</span> <span class="p">(</span><span class="o">~</span><span class="n">isRec</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">is_elg_input</span><span class="p">)</span>
<span class="n">myhist</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span><span class="n">dat</span><span class="o">.</span><span class="n">psql_redshift</span><span class="p">[</span><span class="n">keep</span><span class="p">],</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;m&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="n">lab</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;redshift&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Number&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper left&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>Out[470]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>&lt;matplotlib.legend.Legend at 0x138d644e0&gt;
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/nb_obiwan_methods_paper_32_1.png" src="../_images/nb_obiwan_methods_paper_32_1.png" />
</div>
</div>
<div class="system-message">
<p class="system-message-title">System Message: SEVERE/4 (<tt class="docutils">/global/cscratch1/sd/huikong/obiwan_Aug/repos_for_docker/obiwan_webpage/obiwan/doc/nb/obiwan_methods_paper.ipynb</tt>, line 1508)</p>
<p>Title level inconsistent:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mi">2</span> <span class="n">panel</span> <span class="n">plot</span>
<span class="o">~~~~~~~~~~~~</span>
</pre></div>
</div>
</div>
<ul class="simple">
<li>left panel</li>
<li>fraction of input that are ELGs based on truth input</li>
<li>fraction of ELGs that are recovered</li>
<li>right panel</li>
<li>fraction of recovered ELGs that are tractor would call ELGs (correct
targets)</li>
<li>fraction of recovered ELGs that tractor would not call ELGs (lost
targets)</li>
<li>fraction of recovered that are not ELGs but would would call ELGs
(contaminated targets)</li>
</ul>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [549]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">rz</span><span class="o">=</span> <span class="n">dat</span><span class="o">.</span><span class="n">psql_r</span> <span class="o">-</span> <span class="n">dat</span><span class="o">.</span><span class="n">psql_z</span>
<span class="n">gr</span><span class="o">=</span> <span class="n">dat</span><span class="o">.</span><span class="n">psql_g</span> <span class="o">-</span> <span class="n">dat</span><span class="o">.</span><span class="n">psql_r</span>
<span class="n">is_elg_input</span><span class="o">=</span> <span class="n">eboss_ts</span><span class="p">(</span><span class="n">dat</span><span class="o">.</span><span class="n">psql_g</span><span class="p">,</span><span class="n">rz</span><span class="p">,</span><span class="n">gr</span><span class="p">,</span><span class="n">region</span><span class="o">=</span><span class="s1">&#39;ngc&#39;</span><span class="p">)</span>
<span class="n">is_elg_trac</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dat</span><span class="p">),</span><span class="nb">bool</span><span class="p">)</span>
<span class="n">mags</span><span class="o">=</span><span class="p">{}</span>
<span class="k">for</span> <span class="n">band</span> <span class="ow">in</span> <span class="s1">&#39;grz&#39;</span><span class="p">:</span>
    <span class="n">mags</span><span class="p">[</span><span class="n">band</span><span class="p">]</span><span class="o">=</span> <span class="n">plots</span><span class="o">.</span><span class="n">flux2mag</span><span class="p">(</span><span class="n">dat</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;tractor_flux_&#39;</span><span class="o">+</span><span class="n">band</span><span class="p">)[</span><span class="n">isRec</span><span class="p">]</span><span class="o">/</span>\
                                 <span class="n">dat</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;tractor_mw_transmission_&#39;</span><span class="o">+</span><span class="n">band</span><span class="p">)[</span><span class="n">isRec</span><span class="p">])</span>
<span class="n">is_elg_trac</span><span class="p">[</span><span class="n">isRec</span><span class="p">][</span><span class="n">eboss_ts</span><span class="p">(</span><span class="n">mags</span><span class="p">[</span><span class="s1">&#39;g&#39;</span><span class="p">],</span><span class="n">mags</span><span class="p">[</span><span class="s1">&#39;r&#39;</span><span class="p">]</span><span class="o">-</span><span class="n">mags</span><span class="p">[</span><span class="s1">&#39;z&#39;</span><span class="p">],</span><span class="n">mags</span><span class="p">[</span><span class="s1">&#39;g&#39;</span><span class="p">]</span><span class="o">-</span><span class="n">mags</span><span class="p">[</span><span class="s1">&#39;r&#39;</span><span class="p">],</span><span class="n">region</span><span class="o">=</span><span class="s1">&#39;ngc&#39;</span><span class="p">)]</span><span class="o">=</span> <span class="bp">True</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="stderr output_area docutils container">
<div class="highlight"><pre>
/Users/kaylan1/PhdStudent/Research/desi/obiwan/py/obiwan/qa/plots.py:39: RuntimeWarning: divide by zero encountered in log10
  np.linspace(ylim[0],ylim[1],nbins[1])))
/Users/kaylan1/PhdStudent/Research/desi/obiwan/py/obiwan/qa/plots.py:39: RuntimeWarning: invalid value encountered in log10
  np.linspace(ylim[0],ylim[1],nbins[1])))
/Users/kaylan1/miniconda3/envs/mlbook/lib/python3.6/site-packages/ipykernel_launcher.py:8: RuntimeWarning: invalid value encountered in subtract

/Users/kaylan1/miniconda3/envs/mlbook/lib/python3.6/site-packages/ipykernel_launcher.py:6: RuntimeWarning: invalid value encountered in greater

/Users/kaylan1/miniconda3/envs/mlbook/lib/python3.6/site-packages/ipykernel_launcher.py:6: RuntimeWarning: invalid value encountered in less

/Users/kaylan1/miniconda3/envs/mlbook/lib/python3.6/site-packages/ipykernel_launcher.py:7: RuntimeWarning: invalid value encountered in less
  import sys
/Users/kaylan1/miniconda3/envs/mlbook/lib/python3.6/site-packages/ipykernel_launcher.py:12: RuntimeWarning: invalid value encountered in greater
  if sys.path[0] == &#39;&#39;:
/Users/kaylan1/miniconda3/envs/mlbook/lib/python3.6/site-packages/ipykernel_launcher.py:12: RuntimeWarning: invalid value encountered in less
  if sys.path[0] == &#39;&#39;:
/Users/kaylan1/miniconda3/envs/mlbook/lib/python3.6/site-packages/ipykernel_launcher.py:13: RuntimeWarning: invalid value encountered in less
  del sys.path[0]
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [556]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">mags</span><span class="p">[</span><span class="s1">&#39;g&#39;</span><span class="p">],</span><span class="n">mags</span><span class="p">[</span><span class="s1">&#39;g&#39;</span><span class="p">]</span><span class="o">-</span><span class="n">dat</span><span class="o">.</span><span class="n">psql_g</span><span class="p">[</span><span class="n">isRec</span><span class="p">],</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>Out[556]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>(-1, 1)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/nb_obiwan_methods_paper_35_1.png" src="../_images/nb_obiwan_methods_paper_35_1.png" />
</div>
</div>
<div class="section" id="What-do-input-ELGs-look-like-in-color-space-for-input-and-measured-colors?">
<h2>What do input ELGs look like in color space for input and measured colors?<a class="headerlink" href="#What-do-input-ELGs-look-like-in-color-space-for-input-and-measured-colors?" title="Permalink to this headline">Â¶</a></h2>
</div>
</div>
<div class="section" id="There-are-two-ways-to-loose-ELGs">
<h1>There are two ways to loose ELGs<a class="headerlink" href="#There-are-two-ways-to-loose-ELGs" title="Permalink to this headline">Â¶</a></h1>
<ul class="simple">
<li>donâ€™t recover them</li>
<li>recover them but measured properties fail target selection</li>
</ul>
</div>
<div class="section" id="There-are-two-ways-to-measure-an-ELG">
<h1>There are two ways to measure an ELG<a class="headerlink" href="#There-are-two-ways-to-measure-an-ELG" title="Permalink to this headline">Â¶</a></h1>
<ul class="simple">
<li>Truly passes TS, then recover it with measure that still pass TS</li>
<li>does not pass TS, but recover it and measure error is such that is
passes TS</li>
</ul>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [600]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">fig</span><span class="p">,</span><span class="n">axes</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">9</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">wspace</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span><span class="n">hspace</span><span class="o">=</span><span class="mf">0.4</span><span class="p">)</span>

<span class="n">kw_scatter</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">marker</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">,</span><span class="n">s</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">kw_hist</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="nb">range</span><span class="o">=</span><span class="p">(</span><span class="mf">21.5</span><span class="p">,</span><span class="mf">23.5</span><span class="p">),</span><span class="n">normed</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>

<span class="c1"># Row 0</span>
<span class="n">row</span><span class="o">=</span><span class="mi">0</span>
<span class="n">lab</span><span class="p">,</span><span class="n">keep</span><span class="o">=</span> <span class="s1">&#39;true ELG&#39;</span><span class="p">,</span><span class="n">isRec</span> <span class="o">&amp;</span> <span class="n">is_elg_input</span>
<span class="n">axes</span><span class="p">[</span><span class="n">row</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">dat</span><span class="o">.</span><span class="n">psql_r</span><span class="p">[</span><span class="n">keep</span><span class="p">]</span><span class="o">-</span><span class="n">dat</span><span class="o">.</span><span class="n">psql_z</span><span class="p">[</span><span class="n">keep</span><span class="p">],</span>
              <span class="n">dat</span><span class="o">.</span><span class="n">psql_g</span><span class="p">[</span><span class="n">keep</span><span class="p">]</span><span class="o">-</span><span class="n">dat</span><span class="o">.</span><span class="n">psql_r</span><span class="p">[</span><span class="n">keep</span><span class="p">],</span>
              <span class="n">c</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="n">lab</span><span class="p">,</span><span class="o">**</span><span class="n">kw_scatter</span><span class="p">)</span>
<span class="n">myhist</span><span class="p">(</span><span class="n">axes</span><span class="p">[</span><span class="n">row</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span><span class="n">dat</span><span class="o">.</span><span class="n">psql_g</span><span class="p">[</span><span class="n">keep</span><span class="p">],</span><span class="n">bins</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="n">lab</span><span class="p">,</span><span class="o">**</span><span class="n">kw_hist</span><span class="p">)</span>

<span class="c1"># Rows 1 &amp; 2</span>
<span class="n">mags</span><span class="o">=</span><span class="p">{}</span>
<span class="k">for</span> <span class="n">band</span> <span class="ow">in</span> <span class="s1">&#39;grz&#39;</span><span class="p">:</span>
    <span class="n">mags</span><span class="p">[</span><span class="n">band</span><span class="p">]</span><span class="o">=</span> <span class="n">plots</span><span class="o">.</span><span class="n">flux2mag</span><span class="p">(</span><span class="n">dat</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;tractor_flux_&#39;</span><span class="o">+</span><span class="n">band</span><span class="p">)</span><span class="o">/</span>\
                                 <span class="n">dat</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;tractor_mw_transmission_&#39;</span><span class="o">+</span><span class="n">band</span><span class="p">))</span>
<span class="n">is_elg_trac</span><span class="o">=</span> <span class="n">eboss_ts</span><span class="p">(</span><span class="n">mags</span><span class="p">[</span><span class="s1">&#39;g&#39;</span><span class="p">],</span><span class="n">mags</span><span class="p">[</span><span class="s1">&#39;r&#39;</span><span class="p">]</span><span class="o">-</span><span class="n">mags</span><span class="p">[</span><span class="s1">&#39;z&#39;</span><span class="p">],</span><span class="n">mags</span><span class="p">[</span><span class="s1">&#39;g&#39;</span><span class="p">]</span><span class="o">-</span><span class="n">mags</span><span class="p">[</span><span class="s1">&#39;r&#39;</span><span class="p">],</span><span class="n">region</span><span class="o">=</span><span class="s1">&#39;ngc&#39;</span><span class="p">)</span>

<span class="n">lab</span><span class="p">,</span><span class="n">keep</span><span class="o">=</span> <span class="s1">&#39;lost (recovered but fail TS)&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">isRec</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">is_elg_input</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="o">~</span><span class="n">is_elg_trac</span><span class="p">)</span>
<span class="n">row</span><span class="o">=</span><span class="mi">1</span>
<span class="n">axes</span><span class="p">[</span><span class="n">row</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">dat</span><span class="o">.</span><span class="n">psql_r</span><span class="p">[</span><span class="n">keep</span><span class="p">]</span><span class="o">-</span><span class="n">dat</span><span class="o">.</span><span class="n">psql_z</span><span class="p">[</span><span class="n">keep</span><span class="p">],</span>
                    <span class="n">dat</span><span class="o">.</span><span class="n">psql_g</span><span class="p">[</span><span class="n">keep</span><span class="p">]</span><span class="o">-</span><span class="n">dat</span><span class="o">.</span><span class="n">psql_r</span><span class="p">[</span><span class="n">keep</span><span class="p">],</span>
                    <span class="n">c</span><span class="o">=</span><span class="s1">&#39;g&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="n">lab</span><span class="p">,</span><span class="o">**</span><span class="n">kw_scatter</span><span class="p">)</span>
<span class="n">myhist</span><span class="p">(</span><span class="n">axes</span><span class="p">[</span><span class="n">row</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span><span class="n">dat</span><span class="o">.</span><span class="n">psql_g</span><span class="p">[</span><span class="n">keep</span><span class="p">],</span><span class="n">bins</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;g&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="n">lab</span><span class="p">,</span><span class="o">**</span><span class="n">kw_hist</span><span class="p">)</span>
<span class="n">row</span><span class="o">=</span><span class="mi">2</span>
<span class="n">axes</span><span class="p">[</span><span class="n">row</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">mags</span><span class="p">[</span><span class="s1">&#39;r&#39;</span><span class="p">][</span><span class="n">keep</span><span class="p">]</span><span class="o">-</span><span class="n">mags</span><span class="p">[</span><span class="s1">&#39;z&#39;</span><span class="p">][</span><span class="n">keep</span><span class="p">],</span>
                    <span class="n">mags</span><span class="p">[</span><span class="s1">&#39;g&#39;</span><span class="p">][</span><span class="n">keep</span><span class="p">]</span><span class="o">-</span><span class="n">mags</span><span class="p">[</span><span class="s1">&#39;r&#39;</span><span class="p">][</span><span class="n">keep</span><span class="p">],</span>
                    <span class="n">c</span><span class="o">=</span><span class="s1">&#39;g&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="n">lab</span><span class="p">,</span><span class="o">**</span><span class="n">kw_scatter</span><span class="p">)</span>
<span class="n">myhist</span><span class="p">(</span><span class="n">axes</span><span class="p">[</span><span class="n">row</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span><span class="n">mags</span><span class="p">[</span><span class="s1">&#39;g&#39;</span><span class="p">][</span><span class="n">keep</span><span class="p">],</span><span class="n">bins</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;g&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="n">lab</span><span class="p">,</span><span class="o">**</span><span class="n">kw_hist</span><span class="p">)</span>

<span class="n">lab</span><span class="p">,</span><span class="n">keep</span><span class="o">=</span> <span class="s1">&#39;Tractor ELG (correct)&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">isRec</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">is_elg_input</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">is_elg_trac</span><span class="p">)</span>
<span class="n">row</span><span class="o">=</span><span class="mi">1</span>
<span class="n">axes</span><span class="p">[</span><span class="n">row</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">dat</span><span class="o">.</span><span class="n">psql_r</span><span class="p">[</span><span class="n">keep</span><span class="p">]</span><span class="o">-</span><span class="n">dat</span><span class="o">.</span><span class="n">psql_z</span><span class="p">[</span><span class="n">keep</span><span class="p">],</span>
                    <span class="n">dat</span><span class="o">.</span><span class="n">psql_g</span><span class="p">[</span><span class="n">keep</span><span class="p">]</span><span class="o">-</span><span class="n">dat</span><span class="o">.</span><span class="n">psql_r</span><span class="p">[</span><span class="n">keep</span><span class="p">],</span>
                    <span class="n">c</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="n">lab</span><span class="p">,</span><span class="o">**</span><span class="n">kw_scatter</span><span class="p">)</span>
<span class="n">myhist</span><span class="p">(</span><span class="n">axes</span><span class="p">[</span><span class="n">row</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span><span class="n">dat</span><span class="o">.</span><span class="n">psql_g</span><span class="p">[</span><span class="n">keep</span><span class="p">],</span><span class="n">bins</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="n">lab</span><span class="p">,</span><span class="o">**</span><span class="n">kw_hist</span><span class="p">)</span>
<span class="n">row</span><span class="o">=</span><span class="mi">2</span>
<span class="n">axes</span><span class="p">[</span><span class="n">row</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">mags</span><span class="p">[</span><span class="s1">&#39;r&#39;</span><span class="p">][</span><span class="n">keep</span><span class="p">]</span><span class="o">-</span><span class="n">mags</span><span class="p">[</span><span class="s1">&#39;z&#39;</span><span class="p">][</span><span class="n">keep</span><span class="p">],</span>
                    <span class="n">mags</span><span class="p">[</span><span class="s1">&#39;g&#39;</span><span class="p">][</span><span class="n">keep</span><span class="p">]</span><span class="o">-</span><span class="n">mags</span><span class="p">[</span><span class="s1">&#39;r&#39;</span><span class="p">][</span><span class="n">keep</span><span class="p">],</span>
                    <span class="n">c</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="n">lab</span><span class="p">,</span><span class="o">**</span><span class="n">kw_scatter</span><span class="p">)</span>
<span class="n">myhist</span><span class="p">(</span><span class="n">axes</span><span class="p">[</span><span class="n">row</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span><span class="n">mags</span><span class="p">[</span><span class="s1">&#39;g&#39;</span><span class="p">][</span><span class="n">keep</span><span class="p">],</span><span class="n">bins</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="n">lab</span><span class="p">,</span><span class="o">**</span><span class="n">kw_hist</span><span class="p">)</span>

<span class="n">lab</span><span class="p">,</span><span class="n">keep</span><span class="o">=</span> <span class="s1">&#39;Tractor ELG (contamiation)&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">isRec</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="o">~</span><span class="n">is_elg_input</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">is_elg_trac</span><span class="p">)</span>
<span class="n">row</span><span class="o">=</span><span class="mi">1</span>
<span class="n">axes</span><span class="p">[</span><span class="n">row</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">dat</span><span class="o">.</span><span class="n">psql_r</span><span class="p">[</span><span class="n">keep</span><span class="p">]</span><span class="o">-</span><span class="n">dat</span><span class="o">.</span><span class="n">psql_z</span><span class="p">[</span><span class="n">keep</span><span class="p">],</span>
                    <span class="n">dat</span><span class="o">.</span><span class="n">psql_g</span><span class="p">[</span><span class="n">keep</span><span class="p">]</span><span class="o">-</span><span class="n">dat</span><span class="o">.</span><span class="n">psql_r</span><span class="p">[</span><span class="n">keep</span><span class="p">],</span>
                    <span class="n">c</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="n">lab</span><span class="p">,</span><span class="o">**</span><span class="n">kw_scatter</span><span class="p">)</span>
<span class="n">myhist</span><span class="p">(</span><span class="n">axes</span><span class="p">[</span><span class="n">row</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span><span class="n">dat</span><span class="o">.</span><span class="n">psql_g</span><span class="p">[</span><span class="n">keep</span><span class="p">],</span><span class="n">bins</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;c&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="n">lab</span><span class="p">,</span><span class="o">**</span><span class="n">kw_hist</span><span class="p">)</span>
<span class="n">row</span><span class="o">=</span><span class="mi">2</span>
<span class="n">axes</span><span class="p">[</span><span class="n">row</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">mags</span><span class="p">[</span><span class="s1">&#39;r&#39;</span><span class="p">][</span><span class="n">keep</span><span class="p">]</span><span class="o">-</span><span class="n">mags</span><span class="p">[</span><span class="s1">&#39;z&#39;</span><span class="p">][</span><span class="n">keep</span><span class="p">],</span>
                    <span class="n">mags</span><span class="p">[</span><span class="s1">&#39;g&#39;</span><span class="p">][</span><span class="n">keep</span><span class="p">]</span><span class="o">-</span><span class="n">mags</span><span class="p">[</span><span class="s1">&#39;r&#39;</span><span class="p">][</span><span class="n">keep</span><span class="p">],</span>
                    <span class="n">c</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="n">lab</span><span class="p">,</span><span class="o">**</span><span class="n">kw_scatter</span><span class="p">)</span>
<span class="n">myhist</span><span class="p">(</span><span class="n">axes</span><span class="p">[</span><span class="n">row</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span><span class="n">mags</span><span class="p">[</span><span class="s1">&#39;g&#39;</span><span class="p">][</span><span class="n">keep</span><span class="p">],</span><span class="n">bins</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;c&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="n">lab</span><span class="p">,</span><span class="o">**</span><span class="n">kw_hist</span><span class="p">)</span>


<span class="n">lab</span><span class="p">,</span><span class="n">keep</span><span class="o">=</span> <span class="s1">&#39;lost (not recovered)&#39;</span><span class="p">,</span> <span class="p">(</span><span class="o">~</span><span class="n">isRec</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">is_elg_input</span><span class="p">)</span>
<span class="n">row</span><span class="o">=</span><span class="mi">1</span>
<span class="n">axes</span><span class="p">[</span><span class="n">row</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">dat</span><span class="o">.</span><span class="n">psql_r</span><span class="p">[</span><span class="n">keep</span><span class="p">]</span><span class="o">-</span><span class="n">dat</span><span class="o">.</span><span class="n">psql_z</span><span class="p">[</span><span class="n">keep</span><span class="p">],</span>
                    <span class="n">dat</span><span class="o">.</span><span class="n">psql_g</span><span class="p">[</span><span class="n">keep</span><span class="p">]</span><span class="o">-</span><span class="n">dat</span><span class="o">.</span><span class="n">psql_r</span><span class="p">[</span><span class="n">keep</span><span class="p">],</span>
                    <span class="n">c</span><span class="o">=</span><span class="s1">&#39;m&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="n">lab</span><span class="p">,</span><span class="o">**</span><span class="n">kw_scatter</span><span class="p">)</span>
<span class="n">myhist</span><span class="p">(</span><span class="n">axes</span><span class="p">[</span><span class="n">row</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span><span class="n">dat</span><span class="o">.</span><span class="n">psql_g</span><span class="p">[</span><span class="n">keep</span><span class="p">],</span><span class="n">bins</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;m&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="n">lab</span><span class="p">,</span><span class="o">**</span><span class="n">kw_hist</span><span class="p">)</span>
<span class="n">row</span><span class="o">=</span><span class="mi">2</span>
<span class="n">axes</span><span class="p">[</span><span class="n">row</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">mags</span><span class="p">[</span><span class="s1">&#39;r&#39;</span><span class="p">][</span><span class="n">keep</span><span class="p">]</span><span class="o">-</span><span class="n">mags</span><span class="p">[</span><span class="s1">&#39;z&#39;</span><span class="p">][</span><span class="n">keep</span><span class="p">],</span>
                    <span class="n">mags</span><span class="p">[</span><span class="s1">&#39;g&#39;</span><span class="p">][</span><span class="n">keep</span><span class="p">]</span><span class="o">-</span><span class="n">mags</span><span class="p">[</span><span class="s1">&#39;r&#39;</span><span class="p">][</span><span class="n">keep</span><span class="p">],</span>
                    <span class="n">c</span><span class="o">=</span><span class="s1">&#39;m&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="n">lab</span><span class="p">,</span><span class="o">**</span><span class="n">kw_scatter</span><span class="p">)</span>
<span class="n">myhist</span><span class="p">(</span><span class="n">axes</span><span class="p">[</span><span class="n">row</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span><span class="n">mags</span><span class="p">[</span><span class="s1">&#39;g&#39;</span><span class="p">][</span><span class="n">keep</span><span class="p">],</span><span class="n">bins</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;m&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="n">lab</span><span class="p">,</span><span class="o">**</span><span class="n">kw_hist</span><span class="p">)</span>


<span class="n">col</span><span class="o">=</span><span class="mi">0</span>
<span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
    <span class="n">axes</span><span class="p">[</span><span class="n">row</span><span class="p">,</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="n">row</span><span class="p">,</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mf">0.2</span><span class="p">,</span><span class="mf">1.3</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;True r-z&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;True g-r&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;True r-z&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;True g-r&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Tractor r-z&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Tractor g-r&#39;</span><span class="p">)</span>

<span class="n">col</span><span class="o">=</span><span class="mi">1</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;True g&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;True g&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Tractor g&#39;</span><span class="p">)</span>
<span class="n">kw_leg</span><span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper left&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="o">**</span><span class="n">kw_leg</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="o">**</span><span class="n">kw_leg</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="o">**</span><span class="n">kw_leg</span><span class="p">)</span>




<span class="c1"># myhist(axes[2],mags[&#39;g&#39;][keep],bins=bins,color=&#39;g&#39;,label=&#39;meas ELG&#39;,**kw)</span>
<span class="c1"># keep= (isRec) &amp; (is_elg_input) &amp; (~is_elg_trac)</span>
<span class="c1"># myhist(axes[2],mags[&#39;g&#39;][keep],bins=bins,color=&#39;k&#39;,label=&#39;meas not ELG&#39;,**kw)</span>

<span class="c1"># #for ax in axes:</span>
<span class="c1"># #     ax.set_xlim(0.5,2)</span>
<span class="c1"># #     ax.set_ylim(0.2,1.3)</span>
<span class="c1"># for ax in axes[2:]:</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="stderr output_area docutils container">
<div class="highlight"><pre>
/Users/kaylan1/PhdStudent/Research/desi/obiwan/py/obiwan/qa/plots.py:39: RuntimeWarning: divide by zero encountered in log10
  np.linspace(ylim[0],ylim[1],nbins[1])))
/Users/kaylan1/PhdStudent/Research/desi/obiwan/py/obiwan/qa/plots.py:39: RuntimeWarning: invalid value encountered in log10
  np.linspace(ylim[0],ylim[1],nbins[1])))
/Users/kaylan1/miniconda3/envs/mlbook/lib/python3.6/site-packages/ipykernel_launcher.py:19: RuntimeWarning: invalid value encountered in subtract
/Users/kaylan1/miniconda3/envs/mlbook/lib/python3.6/site-packages/ipykernel_launcher.py:6: RuntimeWarning: invalid value encountered in greater

/Users/kaylan1/miniconda3/envs/mlbook/lib/python3.6/site-packages/ipykernel_launcher.py:6: RuntimeWarning: invalid value encountered in less

/Users/kaylan1/miniconda3/envs/mlbook/lib/python3.6/site-packages/ipykernel_launcher.py:7: RuntimeWarning: invalid value encountered in less
  import sys
/Users/kaylan1/miniconda3/envs/mlbook/lib/python3.6/site-packages/ipykernel_launcher.py:12: RuntimeWarning: invalid value encountered in greater
  if sys.path[0] == &#39;&#39;:
/Users/kaylan1/miniconda3/envs/mlbook/lib/python3.6/site-packages/ipykernel_launcher.py:12: RuntimeWarning: invalid value encountered in less
  if sys.path[0] == &#39;&#39;:
/Users/kaylan1/miniconda3/envs/mlbook/lib/python3.6/site-packages/ipykernel_launcher.py:13: RuntimeWarning: invalid value encountered in less
  del sys.path[0]
/Users/kaylan1/miniconda3/envs/mlbook/lib/python3.6/site-packages/ipykernel_launcher.py:28: RuntimeWarning: invalid value encountered in subtract
/Users/kaylan1/miniconda3/envs/mlbook/lib/python3.6/site-packages/ipykernel_launcher.py:29: RuntimeWarning: invalid value encountered in subtract
/Users/kaylan1/.local/lib/python3.6/site-packages/numpy/lib/function_base.py:748: RuntimeWarning: invalid value encountered in greater_equal
  keep = (tmp_a &gt;= mn)
/Users/kaylan1/.local/lib/python3.6/site-packages/numpy/lib/function_base.py:749: RuntimeWarning: invalid value encountered in less_equal
  keep &amp;= (tmp_a &lt;= mx)
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>Out[600]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>&lt;matplotlib.legend.Legend at 0x14943ec18&gt;
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/nb_obiwan_methods_paper_37_2.png" src="../_images/nb_obiwan_methods_paper_37_2.png" />
</div>
</div>
</div>
<div class="section" id="Hist-for-the-three-above-colors,-three-hists-per-band">
<h1>Hist for the three above colors, three hists per band<a class="headerlink" href="#Hist-for-the-three-above-colors,-three-hists-per-band" title="Permalink to this headline">Â¶</a></h1>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [686]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">x_ivar</span><span class="o">=</span><span class="mi">0</span>
<span class="n">x_var</span><span class="o">=</span> <span class="p">[</span><span class="s1">&#39;true_mag&#39;</span><span class="p">,</span><span class="s1">&#39;galdepth&#39;</span><span class="p">,</span><span class="s1">&#39;redshift&#39;</span><span class="p">][</span><span class="n">x_ivar</span><span class="p">]</span>
<span class="n">kw_hist</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">bins</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span><span class="n">normed</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>

<span class="n">figs</span><span class="p">,</span><span class="n">axes</span><span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">hspace</span><span class="o">=</span><span class="mf">0.4</span><span class="p">)</span>

<span class="n">ratio_area</span><span class="o">=</span> <span class="mf">1.</span>
<span class="k">for</span> <span class="n">ax</span><span class="p">,</span><span class="n">band</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">axes</span><span class="p">,</span><span class="s1">&#39;grz&#39;</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">x_var</span> <span class="o">==</span> <span class="s1">&#39;true_mag&#39;</span><span class="p">:</span>
        <span class="n">_x_var</span><span class="o">=</span> <span class="n">plots</span><span class="o">.</span><span class="n">flux2mag</span><span class="p">(</span><span class="n">dat</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">band</span><span class="o">+</span><span class="s1">&#39;flux&#39;</span><span class="p">)</span><span class="o">/</span>\
                               <span class="n">dat</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;mw_transmission_&#39;</span><span class="o">+</span><span class="n">band</span><span class="p">))</span>
        <span class="n">xlab</span><span class="o">=</span> <span class="s1">&#39;true mag </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">band</span>
        <span class="n">xlim</span><span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">g</span><span class="o">=</span><span class="p">(</span><span class="mf">21.6</span><span class="p">,</span><span class="mi">23</span><span class="p">),</span>
                   <span class="n">r</span><span class="o">=</span><span class="p">(</span><span class="mf">20.75</span><span class="p">,</span><span class="mf">22.5</span><span class="p">),</span>
                   <span class="n">z</span><span class="o">=</span><span class="p">(</span><span class="mf">19.5</span><span class="p">,</span><span class="mi">22</span><span class="p">))</span>
    <span class="k">elif</span> <span class="n">x_var</span> <span class="o">==</span> <span class="s1">&#39;galdepth&#39;</span><span class="p">:</span>
        <span class="n">flux_for_depth</span><span class="o">=</span> <span class="mi">5</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">dat</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;tractor_galdepth_&#39;</span><span class="o">+</span><span class="n">band</span><span class="p">))</span>
        <span class="n">_x_var</span><span class="o">=</span> <span class="n">plots</span><span class="o">.</span><span class="n">flux2mag</span><span class="p">(</span><span class="n">flux_for_depth</span><span class="o">/</span>\
                                 <span class="n">dat</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;mw_transmission_&#39;</span><span class="o">+</span><span class="n">band</span><span class="p">))</span>
        <span class="n">xlab</span><span class="o">=</span> <span class="s1">&#39;galdepth </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">band</span>
        <span class="n">xlim</span><span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">g</span><span class="o">=</span><span class="p">(</span><span class="mf">22.5</span><span class="p">,</span><span class="mf">24.5</span><span class="p">),</span>
                   <span class="n">r</span><span class="o">=</span><span class="p">(</span><span class="mf">22.5</span><span class="p">,</span><span class="mf">24.5</span><span class="p">),</span>
                   <span class="n">z</span><span class="o">=</span><span class="p">(</span><span class="mf">21.5</span><span class="p">,</span><span class="mf">23.5</span><span class="p">))</span>
    <span class="k">elif</span> <span class="n">x_var</span> <span class="o">==</span> <span class="s1">&#39;redshift&#39;</span><span class="p">:</span>
        <span class="n">_x_var</span><span class="o">=</span> <span class="n">dat</span><span class="o">.</span><span class="n">psql_redshift</span>
        <span class="n">xlab</span><span class="o">=</span> <span class="s1">&#39;redshift&#39;</span>
        <span class="n">xlim</span><span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">g</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mf">1.5</span><span class="p">),</span>
                   <span class="n">r</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mf">1.5</span><span class="p">),</span>
                   <span class="n">z</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mf">1.5</span><span class="p">))</span>
    <span class="c1">#isPostiveFlux= ((np.isfinite(dmag)) &amp;</span>
    <span class="c1">#                (np.isfinite(true_mag)))</span>
    <span class="c1">#isPostiveFlux= np.ones(len(dmag),bool)</span>
    <span class="c1">#print(&#39;true_mag=&#39;,true_mag[isPostiveFlux],&#39;trac_mag=&#39;,dmag[isPostiveFlux])</span>

    <span class="c1"># Plot</span>
    <span class="k">for</span> <span class="n">lab</span><span class="p">,</span><span class="n">color</span><span class="p">,</span><span class="n">keep</span> <span class="ow">in</span> <span class="p">[(</span><span class="s1">&#39;lost (recovered but fail TS)&#39;</span><span class="p">,</span><span class="s1">&#39;g&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">isRec</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">is_elg_input</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="o">~</span><span class="n">is_elg_trac</span><span class="p">)),</span>
                           <span class="p">(</span><span class="s1">&#39;Tractor ELG&#39;</span><span class="p">,</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">isRec</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">is_elg_input</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">is_elg_trac</span><span class="p">)),</span>
                           <span class="p">(</span><span class="s1">&#39;Tractor ELG (contamiation)&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">,(</span><span class="n">isRec</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="o">~</span><span class="n">is_elg_input</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">is_elg_trac</span><span class="p">))]:</span>
        <span class="n">myhist</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span><span class="n">_x_var</span><span class="p">[</span><span class="n">keep</span><span class="p">],</span><span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="n">lab</span><span class="p">,</span><span class="nb">range</span><span class="o">=</span><span class="n">xlim</span><span class="p">[</span><span class="n">band</span><span class="p">],</span><span class="o">**</span><span class="n">kw_hist</span><span class="p">)</span>
    <span class="n">ylab</span><span class="o">=</span><span class="s1">&#39;Number&#39;</span>
    <span class="k">if</span> <span class="n">kw_hist</span><span class="p">[</span><span class="s1">&#39;normed&#39;</span><span class="p">]:</span>
        <span class="n">ylab</span><span class="o">=</span><span class="s1">&#39;PDF&#39;</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">ylab</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">xlab</span><span class="p">)</span>

<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mf">1.01</span><span class="p">),</span><span class="n">ncol</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span><span class="n">markerscale</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>Out[686]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>&lt;matplotlib.legend.Legend at 0x15f2840b8&gt;
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/nb_obiwan_methods_paper_39_1.png" src="../_images/nb_obiwan_methods_paper_39_1.png" />
</div>
</div>
</div>
<div class="section" id="dmag-for-the-three-above-colors">
<h1>dmag for the three above colors<a class="headerlink" href="#dmag-for-the-three-above-colors" title="Permalink to this headline">Â¶</a></h1>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [693]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">percentile_lines</span><span class="o">=</span><span class="bp">False</span>
<span class="n">x_ivar</span><span class="o">=</span><span class="mi">0</span>
<span class="n">y_ivar</span><span class="o">=</span><span class="mi">0</span>
<span class="n">x_var</span><span class="o">=</span> <span class="p">[</span><span class="s1">&#39;true_mag&#39;</span><span class="p">,</span><span class="s1">&#39;galdepth&#39;</span><span class="p">,</span><span class="s1">&#39;redshift&#39;</span><span class="p">][</span><span class="n">x_ivar</span><span class="p">]</span>
<span class="n">y_var</span><span class="o">=</span> <span class="p">[</span><span class="s1">&#39;dmag&#39;</span><span class="p">,</span><span class="s1">&#39;chisq&#39;</span><span class="p">][</span><span class="n">y_ivar</span><span class="p">]</span>

<span class="n">figs</span><span class="p">,</span><span class="n">axes</span><span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">hspace</span><span class="o">=</span><span class="mf">0.4</span><span class="p">)</span>

<span class="n">ratio_area</span><span class="o">=</span> <span class="mf">1.</span>
<span class="k">for</span> <span class="n">ax</span><span class="p">,</span><span class="n">band</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">axes</span><span class="p">,</span><span class="s1">&#39;grz&#39;</span><span class="p">):</span>
    <span class="n">fix</span><span class="o">=</span> <span class="n">ratio_area</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">average</span><span class="p">([</span><span class="n">dat</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;tractor_apflux_resid_&#39;</span><span class="o">+</span><span class="n">band</span><span class="p">)[:,</span><span class="mi">6</span><span class="p">],</span>
                                  <span class="n">dat</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;tractor_apflux_resid_&#39;</span><span class="o">+</span><span class="n">band</span><span class="p">)[:,</span><span class="mi">7</span><span class="p">]],</span>
                                <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">assert</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">fix</span><span class="p">))</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">dat</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">y_var</span> <span class="o">==</span> <span class="s1">&#39;dmag&#39;</span><span class="p">:</span>
        <span class="n">_y_var</span><span class="o">=</span> <span class="n">plots</span><span class="o">.</span><span class="n">flux2mag</span><span class="p">(</span><span class="n">dat</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;tractor_flux_&#39;</span><span class="o">+</span><span class="n">band</span><span class="p">))</span> <span class="o">-</span>\
                   <span class="n">plots</span><span class="o">.</span><span class="n">flux2mag</span><span class="p">(</span><span class="n">dat</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">band</span><span class="o">+</span><span class="s1">&#39;flux&#39;</span><span class="p">)</span><span class="o">+</span>  <span class="n">fix</span><span class="p">)</span>
        <span class="n">ylab</span><span class="o">=</span> <span class="s1">&#39;dmag (Tractor - True)&#39;</span>
        <span class="n">ylim</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">y_var</span> <span class="o">==</span> <span class="s1">&#39;chisq&#39;</span><span class="p">:</span>
        <span class="n">_y_var</span><span class="o">=</span> <span class="n">dat</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;tractor_flux_&#39;</span><span class="o">+</span><span class="n">band</span><span class="p">)</span> <span class="o">-</span>\
                   <span class="p">(</span><span class="n">dat</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">band</span><span class="o">+</span><span class="s1">&#39;flux&#39;</span><span class="p">)</span><span class="o">+</span>  <span class="n">fix</span><span class="p">)</span>
        <span class="n">_y_var</span> <span class="o">*=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">dat</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;tractor_flux_ivar_&#39;</span><span class="o">+</span><span class="n">band</span><span class="p">))</span>
        <span class="n">ylab</span><span class="o">=</span> <span class="s1">&#39;chiflux (Tractor - True) * sqrt(ivar)&#39;</span>
        <span class="n">ylim</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">x_var</span> <span class="o">==</span> <span class="s1">&#39;true_mag&#39;</span><span class="p">:</span>
        <span class="n">_x_var</span><span class="o">=</span> <span class="n">plots</span><span class="o">.</span><span class="n">flux2mag</span><span class="p">(</span><span class="n">dat</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">band</span><span class="o">+</span><span class="s1">&#39;flux&#39;</span><span class="p">)</span><span class="o">/</span>\
                               <span class="n">dat</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;mw_transmission_&#39;</span><span class="o">+</span><span class="n">band</span><span class="p">))</span>
        <span class="n">xlab</span><span class="o">=</span> <span class="s1">&#39;true mag </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">band</span>
        <span class="n">xlim</span><span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">g</span><span class="o">=</span><span class="p">(</span><span class="mf">21.6</span><span class="p">,</span><span class="mi">23</span><span class="p">),</span>
                   <span class="n">r</span><span class="o">=</span><span class="p">(</span><span class="mf">20.75</span><span class="p">,</span><span class="mf">22.5</span><span class="p">),</span>
                   <span class="n">z</span><span class="o">=</span><span class="p">(</span><span class="mf">19.5</span><span class="p">,</span><span class="mi">22</span><span class="p">))</span>
    <span class="k">elif</span> <span class="n">x_var</span> <span class="o">==</span> <span class="s1">&#39;galdepth&#39;</span><span class="p">:</span>
        <span class="n">flux_for_depth</span><span class="o">=</span> <span class="mi">5</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">dat</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;tractor_galdepth_&#39;</span><span class="o">+</span><span class="n">band</span><span class="p">))</span>
        <span class="n">_x_var</span><span class="o">=</span> <span class="n">plots</span><span class="o">.</span><span class="n">flux2mag</span><span class="p">(</span><span class="n">flux_for_depth</span><span class="o">/</span>\
                                 <span class="n">dat</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;mw_transmission_&#39;</span><span class="o">+</span><span class="n">band</span><span class="p">))</span>
        <span class="n">xlab</span><span class="o">=</span> <span class="s1">&#39;galdepth </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">band</span>
        <span class="n">xlim</span><span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">g</span><span class="o">=</span><span class="p">(</span><span class="mi">21</span><span class="p">,</span><span class="mf">24.5</span><span class="p">),</span>
                   <span class="n">r</span><span class="o">=</span><span class="p">(</span><span class="mi">21</span><span class="p">,</span><span class="mf">24.5</span><span class="p">),</span>
                   <span class="n">z</span><span class="o">=</span><span class="p">(</span><span class="mi">21</span><span class="p">,</span><span class="mf">24.5</span><span class="p">))</span>
    <span class="k">elif</span> <span class="n">x_var</span> <span class="o">==</span> <span class="s1">&#39;redshift&#39;</span><span class="p">:</span>
        <span class="n">_x_var</span><span class="o">=</span> <span class="n">dat</span><span class="o">.</span><span class="n">psql_redshift</span>
        <span class="n">xlab</span><span class="o">=</span> <span class="s1">&#39;redshift&#39;</span>
        <span class="n">xlim</span><span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">g</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mf">1.5</span><span class="p">),</span>
                   <span class="n">r</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mf">1.5</span><span class="p">),</span>
                   <span class="n">z</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mf">1.5</span><span class="p">))</span>

    <span class="c1">#isPostiveFlux= ((np.isfinite(dmag)) &amp;</span>
    <span class="c1">#                (np.isfinite(true_mag)))</span>
    <span class="c1">#isPostiveFlux= np.ones(len(dmag),bool)</span>
    <span class="c1">#print(&#39;true_mag=&#39;,true_mag[isPostiveFlux],&#39;trac_mag=&#39;,dmag[isPostiveFlux])</span>

    <span class="c1"># Plot</span>
    <span class="k">for</span> <span class="n">lab</span><span class="p">,</span><span class="n">color</span><span class="p">,</span><span class="n">keep</span> <span class="ow">in</span> <span class="p">[(</span><span class="s1">&#39;lost (recovered but fail TS)&#39;</span><span class="p">,</span><span class="s1">&#39;g&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">isRec</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">is_elg_input</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="o">~</span><span class="n">is_elg_trac</span><span class="p">)),</span>
                           <span class="p">(</span><span class="s1">&#39;Tractor ELG&#39;</span><span class="p">,</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">isRec</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">is_elg_input</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">is_elg_trac</span><span class="p">)),</span>
                           <span class="p">(</span><span class="s1">&#39;Tractor ELG (contamiation)&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">,(</span><span class="n">isRec</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="o">~</span><span class="n">is_elg_input</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">is_elg_trac</span><span class="p">))]:</span>
        <span class="k">if</span> <span class="n">percentile_lines</span><span class="p">:</span>
            <span class="n">binned</span><span class="o">=</span> <span class="n">plots</span><span class="o">.</span><span class="n">bin_up</span><span class="p">(</span><span class="n">_x_var</span><span class="p">[</span><span class="n">keep</span><span class="p">],</span><span class="n">_y_var</span><span class="p">[</span><span class="n">keep</span><span class="p">],</span>
                                 <span class="n">bin_minmax</span><span class="o">=</span><span class="n">xlim</span><span class="p">[</span><span class="n">band</span><span class="p">],</span><span class="n">nbins</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">perc</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;q25&#39;</span><span class="p">,</span><span class="s1">&#39;q75&#39;</span><span class="p">]:</span>
                <span class="n">kw</span><span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">c</span><span class="o">=</span><span class="n">color</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">perc</span> <span class="o">==</span> <span class="s1">&#39;q25&#39;</span><span class="p">:</span>
                    <span class="n">kw</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="n">lab</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">binned</span><span class="p">[</span><span class="s1">&#39;binc&#39;</span><span class="p">],</span><span class="n">binned</span><span class="p">[</span><span class="n">perc</span><span class="p">],</span><span class="o">**</span><span class="n">kw</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">_x_var</span><span class="p">[</span><span class="n">keep</span><span class="p">],</span><span class="n">_y_var</span><span class="p">[</span><span class="n">keep</span><span class="p">],</span>
                       <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">s</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="n">color</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="n">lab</span><span class="p">)</span>
            <span class="c1">#ax.scatter(true_mag[(isPostiveFlux) &amp; (keep)],dmag[(isPostiveFlux) &amp; (keep)],</span>
            <span class="c1">#           alpha=1,s=5,c=color,label=lab)</span>

<span class="k">for</span> <span class="n">ax</span><span class="p">,</span><span class="n">band</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">axes</span><span class="p">,</span><span class="s1">&#39;grz&#39;</span><span class="p">):</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">ylim</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">ylab</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mf">1.01</span><span class="p">),</span><span class="n">ncol</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span><span class="n">markerscale</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>

<span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="n">axes</span><span class="p">:</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">xlab</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="stderr output_area docutils container">
<div class="highlight"><pre>
/Users/kaylan1/PhdStudent/Research/desi/obiwan/py/obiwan/qa/plots.py:39: RuntimeWarning: divide by zero encountered in log10
  np.linspace(ylim[0],ylim[1],nbins[1])))
/Users/kaylan1/PhdStudent/Research/desi/obiwan/py/obiwan/qa/plots.py:39: RuntimeWarning: invalid value encountered in log10
  np.linspace(ylim[0],ylim[1],nbins[1])))
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/nb_obiwan_methods_paper_41_1.png" src="../_images/nb_obiwan_methods_paper_41_1.png" />
</div>
</div>
</div>
<div class="section" id="dflux/std-dev-vs.-Unit-Gaussian">
<h1>dflux/std dev vs. Unit Gaussian<a class="headerlink" href="#dflux/std-dev-vs.-Unit-Gaussian" title="Permalink to this headline">Â¶</a></h1>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [96]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">figs</span><span class="p">,</span><span class="n">axes</span><span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">hspace</span><span class="o">=</span><span class="mf">0.4</span><span class="p">)</span>

<span class="n">isRec</span><span class="o">=</span> <span class="n">dat</span><span class="o">.</span><span class="n">obiwan_mask</span> <span class="o">==</span> <span class="mi">1</span>

<span class="n">xlims</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">4</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span>
<span class="k">for</span> <span class="n">ax</span><span class="p">,</span><span class="n">band</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">axes</span><span class="p">,</span><span class="s1">&#39;grz&#39;</span><span class="p">):</span>
    <span class="n">apflux_apflux_diff</span><span class="o">=</span> <span class="n">dat</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;tractor_apflux_&#39;</span><span class="o">+</span><span class="n">band</span><span class="p">)[:,</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span>\
                    <span class="n">dat</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;tractor_apflux_&#39;</span><span class="o">+</span><span class="n">band</span><span class="p">)[:,</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">apflux_apfluxresid_diff</span><span class="o">=</span> <span class="n">dat</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;tractor_apflux_&#39;</span><span class="o">+</span><span class="n">band</span><span class="p">)[:,</span><span class="mi">5</span><span class="p">]</span> <span class="o">-</span> \
                    <span class="n">dat</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;tractor_apflux_resid_&#39;</span><span class="o">+</span><span class="n">band</span><span class="p">)[:,</span><span class="mi">5</span><span class="p">]</span>

    <span class="n">bins</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">xlims</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">xlims</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">num</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
    <span class="n">myhist</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span><span class="n">apflux_apflux_diff</span><span class="p">[</span><span class="n">isRec</span><span class="p">],</span><span class="n">bins</span><span class="o">=</span><span class="n">bins</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span>
           <span class="n">normed</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;fix: apflux_apflux_diff&#39;</span><span class="p">)</span>
    <span class="n">myhist</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span><span class="n">apflux_apfluxresid_diff</span><span class="p">[</span><span class="n">isRec</span><span class="p">],</span><span class="n">bins</span><span class="o">=</span><span class="n">bins</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span>
           <span class="n">normed</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;fix: apfluxresid_apflux_diff&#39;</span><span class="p">)</span>
    <span class="c1">#ax.axvline(np.median(fix[isRec]),c=&#39;y&#39;,ls=&#39;-&#39;,label=&#39;median(fix)&#39;)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="n">ls</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">)</span>
    <span class="n">plots</span><span class="o">.</span><span class="n">mytext</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span><span class="mf">0.9</span><span class="p">,</span><span class="mf">0.9</span><span class="p">,</span><span class="n">band</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>

    <span class="c1">#isPostiveFlux= ((np.isfinite(dmag)) &amp;</span>
    <span class="c1">#                (np.isfinite(true_mag)))</span>
    <span class="c1">#isPostiveFlux= np.ones(len(dmag),bool)</span>
    <span class="c1">#print(&#39;true_mag=&#39;,true_mag[isPostiveFlux],&#39;trac_mag=&#39;,dmag[isPostiveFlux])</span>

<span class="n">xlab</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;apflux difference&#39;</span><span class="p">)</span>
<span class="c1">#for ax,band in zip(axes,&#39;grz&#39;):</span>
<span class="c1">#    ax.set_xlim(ylim)</span>
<span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="n">axes</span><span class="p">:</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;PDF&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mf">1.01</span><span class="p">),</span><span class="n">ncol</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span><span class="n">markerscale</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>Out[96]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>&lt;matplotlib.legend.Legend at 0x11f3f5898&gt;
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/nb_obiwan_methods_paper_43_1.png" src="../_images/nb_obiwan_methods_paper_43_1.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [93]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">figs</span><span class="p">,</span><span class="n">axes</span><span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">hspace</span><span class="o">=</span><span class="mf">0.4</span><span class="p">)</span>

<span class="n">apply_fix</span><span class="o">=</span> <span class="bp">True</span>
<span class="n">sub_median</span><span class="o">=</span> <span class="bp">False</span>

<span class="n">isRec</span><span class="o">=</span> <span class="n">dat</span><span class="o">.</span><span class="n">obiwan_mask</span> <span class="o">==</span> <span class="mi">1</span>
<span class="n">data_lab</span><span class="o">=</span><span class="s1">&#39;data&#39;</span>
<span class="k">if</span> <span class="n">apply_fix</span><span class="p">:</span>
    <span class="n">data_lab</span><span class="o">+=</span><span class="s1">&#39;+fix&#39;</span>
<span class="k">if</span> <span class="n">sub_median</span><span class="p">:</span>
    <span class="n">data_lab</span><span class="o">+=</span><span class="s1">&#39;-median&#39;</span>

<span class="n">xlims</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">4</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span>
<span class="k">for</span> <span class="n">ax</span><span class="p">,</span><span class="n">band</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">axes</span><span class="p">,</span><span class="s1">&#39;grz&#39;</span><span class="p">):</span>
    <span class="c1">#fix= dat.get(&#39;tractor_apflux_&#39;+band)[:,-1] -\</span>
    <span class="c1">#        dat.get(&#39;tractor_apflux_&#39;+band)[:,-2]</span>
    <span class="n">fix</span><span class="o">=</span> <span class="n">dat</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;tractor_apflux_&#39;</span><span class="o">+</span><span class="n">band</span><span class="p">)[:,</span><span class="mi">4</span><span class="p">]</span> <span class="o">-</span> \
            <span class="n">dat</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;tractor_apflux_resid_&#39;</span><span class="o">+</span><span class="n">band</span><span class="p">)[:,</span><span class="mi">4</span><span class="p">]</span>
    <span class="n">dflux</span><span class="o">=</span> <span class="n">dat</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;tractor_flux_&#39;</span><span class="o">+</span><span class="n">band</span><span class="p">)</span> <span class="o">-</span> <span class="n">dat</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">band</span><span class="o">+</span><span class="s1">&#39;flux&#39;</span><span class="p">)</span>
    <span class="n">dflux_wfix</span><span class="o">=</span> <span class="n">dflux</span> <span class="o">+</span> <span class="n">fix</span>

    <span class="n">bins</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">xlims</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">xlims</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">num</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
    <span class="n">myhist</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span><span class="n">dflux</span><span class="p">[</span><span class="n">isRec</span><span class="p">],</span><span class="n">bins</span><span class="o">=</span><span class="n">bins</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span>
           <span class="n">label</span><span class="o">=</span><span class="s1">&#39;data&#39;</span><span class="p">,</span><span class="n">normed</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">myhist</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span><span class="n">dflux_wfix</span><span class="p">[</span><span class="n">isRec</span><span class="p">],</span><span class="n">bins</span><span class="o">=</span><span class="n">bins</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span>
           <span class="n">label</span><span class="o">=</span><span class="s1">&#39;data_wfix&#39;</span><span class="p">,</span><span class="n">normed</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="c1">#ax.axvline(np.median(dflux[isRec]),c=&#39;y&#39;,ls=&#39;-&#39;,label=&#39;median(data)&#39;)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="n">ls</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">)</span>
    <span class="n">plots</span><span class="o">.</span><span class="n">mytext</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span><span class="mf">0.9</span><span class="p">,</span><span class="mf">0.9</span><span class="p">,</span><span class="n">band</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>

    <span class="c1">#isPostiveFlux= ((np.isfinite(dmag)) &amp;</span>
    <span class="c1">#                (np.isfinite(true_mag)))</span>
    <span class="c1">#isPostiveFlux= np.ones(len(dmag),bool)</span>
    <span class="c1">#print(&#39;true_mag=&#39;,true_mag[isPostiveFlux],&#39;trac_mag=&#39;,dmag[isPostiveFlux])</span>

<span class="n">xlab</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\Delta$flux (Tractor - True)&#39;</span><span class="p">)</span>
<span class="c1">#for ax,band in zip(axes,&#39;grz&#39;):</span>
<span class="c1">#    ax.set_xlim(ylim)</span>
<span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="n">axes</span><span class="p">:</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;PDF&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mf">1.01</span><span class="p">),</span><span class="n">ncol</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span><span class="n">markerscale</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>Out[93]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>&lt;matplotlib.legend.Legend at 0x11ebbc7f0&gt;
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/nb_obiwan_methods_paper_44_1.png" src="../_images/nb_obiwan_methods_paper_44_1.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [128]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">figs</span><span class="p">,</span><span class="n">axes</span><span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">hspace</span><span class="o">=</span><span class="mf">0.4</span><span class="p">)</span>

<span class="n">apply_fix</span><span class="o">=</span> <span class="bp">False</span>
<span class="n">sub_mean</span><span class="o">=</span> <span class="bp">True</span>
<span class="n">use_psql_flux</span><span class="o">=</span><span class="bp">False</span>
<span class="n">num_std_lims</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">6</span><span class="p">,</span><span class="mi">6</span><span class="p">)</span>

<span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="kn">import</span> <span class="n">norm</span>
<span class="n">rv</span> <span class="o">=</span> <span class="n">norm</span><span class="p">()</span>
<span class="n">isRec</span><span class="o">=</span> <span class="n">dat</span><span class="o">.</span><span class="n">obiwan_mask</span> <span class="o">==</span> <span class="mi">1</span>

<span class="k">def</span> <span class="nf">gauss_model</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="mi">1</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>

<span class="k">for</span> <span class="n">ax</span><span class="p">,</span><span class="n">band</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">axes</span><span class="p">,</span><span class="s1">&#39;grz&#39;</span><span class="p">):</span>
    <span class="n">data_lab</span><span class="o">=</span> <span class="s1">&#39;data&#39;</span>
    <span class="k">if</span> <span class="n">apply_fix</span><span class="p">:</span>
        <span class="n">fix</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">average</span><span class="p">([</span><span class="n">dat</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;tractor_apflux_resid_&#39;</span><span class="o">+</span><span class="n">band</span><span class="p">)[:,</span><span class="mi">6</span><span class="p">],</span>
                         <span class="n">dat</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;tractor_apflux_resid_&#39;</span><span class="o">+</span><span class="n">band</span><span class="p">)[:,</span><span class="mi">7</span><span class="p">]],</span>
                        <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">data_lab</span><span class="o">+=</span><span class="s1">&#39;+fix&#39;</span>
        <span class="c1">#fix= apflux_apfluxresid_diff= dat.get(&#39;tractor_apflux_&#39;+band)[:,5] - \</span>
        <span class="c1">#            dat.get(&#39;tractor_apflux_resid_&#39;+band)[:,5]</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="n">fix</span><span class="o">=</span><span class="mi">0</span>
    <span class="k">if</span> <span class="n">use_psql_flux</span><span class="p">:</span>
        <span class="n">num_std_dev</span><span class="o">=</span> <span class="n">dat</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;tractor_flux_&#39;</span><span class="o">+</span><span class="n">band</span><span class="p">)</span> <span class="o">-</span>\
                       <span class="p">(</span><span class="n">plots</span><span class="o">.</span><span class="n">mag2flux</span><span class="p">(</span><span class="n">dat</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;psql_&#39;</span><span class="o">+</span><span class="n">band</span><span class="p">))</span><span class="o">+</span>  <span class="n">fix</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">num_std_dev</span><span class="o">=</span> <span class="n">dat</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;tractor_flux_&#39;</span><span class="o">+</span><span class="n">band</span><span class="p">)</span> <span class="o">-</span>\
                        <span class="p">(</span><span class="n">dat</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">band</span><span class="o">+</span><span class="s1">&#39;flux&#39;</span><span class="p">)</span><span class="o">+</span>  <span class="n">fix</span><span class="p">)</span>

    <span class="n">num_std_dev</span> <span class="o">*=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">dat</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;tractor_flux_ivar_&#39;</span><span class="o">+</span><span class="n">band</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">sub_mean</span><span class="p">:</span>
        <span class="c1">#keep= ((num_std_dev &gt;= num_std_lims[0]) &amp;</span>
        <span class="c1">#       (num_std_dev &lt;= num_std_lims[0])</span>
        <span class="n">dflux_mean</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">num_std_dev</span><span class="p">[</span><span class="n">isRec</span><span class="p">])</span>
        <span class="n">num_std_dev</span> <span class="o">-=</span> <span class="n">dflux_mean</span>
        <span class="k">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">: dflux_mean=</span><span class="si">%f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">band</span><span class="p">,</span><span class="n">dflux_mean</span><span class="p">))</span>
        <span class="n">data_lab</span><span class="o">+=</span><span class="s1">&#39; minus mean (</span><span class="si">%.2f</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="n">dflux_mean</span>

    <span class="n">bins</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">num_std_lims</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">num_std_lims</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">num</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
    <span class="n">h</span><span class="o">=</span><span class="n">myhist</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span><span class="n">num_std_dev</span><span class="p">[</span><span class="n">isRec</span><span class="p">],</span><span class="n">bins</span><span class="o">=</span><span class="n">bins</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span>
           <span class="n">label</span><span class="o">=</span><span class="n">data_lab</span><span class="p">,</span><span class="n">normed</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
           <span class="n">return_h</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

    <span class="kn">from</span> <span class="nn">scipy.optimize</span> <span class="kn">import</span> <span class="n">leastsq</span>
    <span class="c1">#fitfunc = lambda p, x: p[0]*np.cos(2*np.pi/p[1]*x+p[2]) + p[3]</span>
    <span class="n">errfunc</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">p</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="n">gauss_model</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="n">y</span>
    <span class="n">p0</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.</span><span class="p">]</span> <span class="c1"># Initial guess</span>
    <span class="n">binc</span><span class="o">=</span> <span class="p">(</span><span class="n">bins</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">bins</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span><span class="o">/</span><span class="mi">2</span>
    <span class="n">p1</span><span class="p">,</span> <span class="n">success</span> <span class="o">=</span> <span class="n">leastsq</span><span class="p">(</span><span class="n">errfunc</span><span class="p">,</span> <span class="n">p0</span><span class="p">[:],</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">binc</span><span class="p">,</span> <span class="n">h</span><span class="p">))</span>
    <span class="k">assert</span><span class="p">(</span><span class="n">success</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">norm_fit</span><span class="o">=</span> <span class="n">norm</span><span class="p">(</span><span class="n">scale</span><span class="o">=</span><span class="n">p1</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">bins</span><span class="p">,</span><span class="n">norm_fit</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">bins</span><span class="p">),</span><span class="s1">&#39;k-&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;Fit $\sigma=$</span><span class="si">%.2f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">p1</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>


    <span class="c1">#ax.axvline(np.mean(num_std_dev[isRec]),c=&#39;g&#39;,ls=&#39;--&#39;,label=&#39;mean(data)&#39;)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">bins</span><span class="p">,</span><span class="n">rv</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">bins</span><span class="p">),</span><span class="s1">&#39;k--&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;Standard Norm&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="n">ls</span><span class="o">=</span><span class="s1">&#39;dotted&#39;</span><span class="p">)</span>
    <span class="n">plots</span><span class="o">.</span><span class="n">mytext</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span><span class="mf">0.9</span><span class="p">,</span><span class="mf">0.9</span><span class="p">,</span><span class="n">band</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
    <span class="c1">#isPostiveFlux= ((np.isfinite(dmag)) &amp;</span>
    <span class="c1">#                (np.isfinite(true_mag)))</span>
    <span class="c1">#isPostiveFlux= np.ones(len(dmag),bool)</span>
    <span class="c1">#print(&#39;true_mag=&#39;,true_mag[isPostiveFlux],&#39;trac_mag=&#39;,dmag[isPostiveFlux])</span>

<span class="n">xlab</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\Delta$flux (Tractor - True) * sqrt(ivar)&#39;</span><span class="p">)</span>
<span class="c1">#for ax,band in zip(axes,&#39;grz&#39;):</span>
<span class="c1">#    ax.set_xlim(ylim)</span>
<span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="n">axes</span><span class="p">:</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;PDF&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper left&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span><span class="n">markerscale</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
g: dflux_mean=-1.481467
r: dflux_mean=-1.928699
z: dflux_mean=-1.641154
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/nb_obiwan_methods_paper_45_1.png" src="../_images/nb_obiwan_methods_paper_45_1.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [134]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">types</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">char</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="n">dat</span><span class="o">.</span><span class="n">tractor_type</span><span class="p">)</span>
<span class="n">types</span><span class="p">[</span><span class="n">types</span> <span class="o">==</span> <span class="s1">&#39;EXP&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>Out[134]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>{&#39;&#39;, &#39;COMP&#39;, &#39;DEV&#39;, &#39;EXP&#39;, &#39;PSF&#39;, &#39;SIMP&#39;}
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [147]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">typ</span><span class="o">=</span> <span class="s1">&#39;exp&#39;</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">dat</span><span class="o">.</span><span class="n">rhalf</span><span class="p">[</span><span class="n">types</span> <span class="o">==</span> <span class="n">typ</span><span class="o">.</span><span class="n">upper</span><span class="p">()],</span><span class="n">dat</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;tractor_shape&#39;</span><span class="o">+</span><span class="n">typ</span><span class="o">+</span><span class="s1">&#39;_r&#39;</span><span class="p">)[</span><span class="n">types</span> <span class="o">==</span> <span class="n">typ</span><span class="o">.</span><span class="n">upper</span><span class="p">()])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>Out[147]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>(0, 3)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/nb_obiwan_methods_paper_47_1.png" src="../_images/nb_obiwan_methods_paper_47_1.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [152]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">typ</span><span class="o">=</span><span class="s1">&#39;dev&#39;</span>
<span class="n">isType</span><span class="o">=</span> <span class="n">types</span> <span class="o">==</span> <span class="n">typ</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
<span class="n">x</span><span class="o">=</span><span class="mi">1</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">dat</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;tractor_shape</span><span class="si">%s</span><span class="s1">_e1_ivar&#39;</span> <span class="o">%</span> <span class="n">typ</span><span class="p">))</span>
<span class="n">keep</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">isType</span>
<span class="n">_</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">keep</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="stderr output_area docutils container">
<div class="highlight"><pre>
/Users/kaylan1/miniconda3/envs/mlbook/lib/python3.6/site-packages/ipykernel_launcher.py:3: RuntimeWarning: divide by zero encountered in true_divide
  This is separate from the ipykernel package so we can avoid doing imports until
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/nb_obiwan_methods_paper_48_1.png" src="../_images/nb_obiwan_methods_paper_48_1.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [142]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">dat</span><span class="o">.</span><span class="n">e1</span><span class="p">[</span><span class="n">isRec</span><span class="p">],</span><span class="n">dat</span><span class="o">.</span><span class="n">tractor_shapeexp_e1</span><span class="p">[</span><span class="n">isRec</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>Out[142]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>&lt;matplotlib.collections.PathCollection at 0x116d2f160&gt;
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/nb_obiwan_methods_paper_49_1.png" src="../_images/nb_obiwan_methods_paper_49_1.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [153]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">dat</span><span class="o">.</span><span class="n">e2</span><span class="p">[</span><span class="n">isRec</span><span class="p">],</span><span class="o">-</span><span class="n">dat</span><span class="o">.</span><span class="n">tractor_shapeexp_e2</span><span class="p">[</span><span class="n">isRec</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>Out[153]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>&lt;matplotlib.collections.PathCollection at 0x124206f98&gt;
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/nb_obiwan_methods_paper_50_1.png" src="../_images/nb_obiwan_methods_paper_50_1.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [131]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">band</span><span class="o">=</span><span class="s1">&#39;g&#39;</span>
<span class="n">xlim</span><span class="o">=</span><span class="p">(</span><span class="mi">22</span><span class="p">,</span><span class="mf">25.5</span><span class="p">)</span>
<span class="n">ylim</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">)</span>
<span class="n">nbins</span><span class="o">=</span><span class="p">(</span><span class="mi">60</span><span class="p">,</span><span class="mi">30</span><span class="p">)</span>

<span class="n">num_std_dev</span><span class="o">=</span> <span class="n">dat</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;tractor_flux_&#39;</span><span class="o">+</span><span class="n">band</span><span class="p">)</span> <span class="o">-</span>\
                        <span class="n">dat</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">band</span><span class="o">+</span><span class="s1">&#39;flux&#39;</span><span class="p">)</span>
<span class="n">num_std_dev</span> <span class="o">*=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">dat</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;tractor_flux_ivar_&#39;</span><span class="o">+</span><span class="n">band</span><span class="p">))</span>
<span class="n">true_mag</span><span class="o">=</span> <span class="n">plots</span><span class="o">.</span><span class="n">flux2mag</span><span class="p">(</span><span class="n">dat</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">band</span><span class="o">+</span><span class="s1">&#39;flux&#39;</span><span class="p">)</span><span class="o">/</span>\
                           <span class="n">dat</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;mw_transmission_&#39;</span><span class="o">+</span><span class="n">band</span><span class="p">))</span>

<span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="c1">#plots.myhist2D(ax,true_mag[isRec],num_std_dev[isRec],</span>
<span class="c1">#               xlim=xlim,ylim=(-10,10),nbins=(60,30))</span>
<span class="c1">#bins= np.linspace(xlim[0],xlim[1],num=30)</span>

<span class="n">H</span><span class="p">,</span> <span class="n">xbins</span><span class="p">,</span> <span class="n">ybins</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">histogram2d</span><span class="p">(</span><span class="n">true_mag</span><span class="p">[</span><span class="n">isRec</span><span class="p">],</span><span class="n">num_std_dev</span><span class="p">[</span><span class="n">isRec</span><span class="p">],</span>
                                 <span class="n">bins</span><span class="o">=</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">xlim</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">xlim</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">nbins</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
                                       <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">ylim</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">ylim</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">nbins</span><span class="p">[</span><span class="mi">1</span><span class="p">])))</span>
<span class="n">cmap</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">binary</span>
<span class="n">cmap</span><span class="o">.</span><span class="n">set_bad</span><span class="p">(</span><span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="mf">1.</span><span class="p">)</span>
<span class="n">H</span><span class="p">[</span><span class="n">H</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c1"># prevent warnings in log10</span>
<span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">H</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span>
          <span class="c1">#extent=[xbins[0], xbins[-1], ybins[0], ybins[-1]],</span>
          <span class="n">extent</span><span class="o">=</span><span class="p">[</span><span class="n">xlim</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">xlim</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">ylim</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ylim</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span>
          <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span> <span class="n">interpolation</span><span class="o">=</span><span class="s1">&#39;nearest&#39;</span><span class="p">,</span>
          <span class="n">aspect</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>Out[131]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>&lt;matplotlib.image.AxesImage at 0x1218f2208&gt;
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/nb_obiwan_methods_paper_51_1.png" src="../_images/nb_obiwan_methods_paper_51_1.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [728]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>

<span class="n">kw</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="nb">range</span><span class="o">=</span><span class="p">(</span><span class="mi">21</span><span class="p">,</span><span class="mi">24</span><span class="p">),</span><span class="n">normed</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">myhist</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span><span class="n">dat</span><span class="o">.</span><span class="n">psql_g</span><span class="p">[</span><span class="n">isRec</span><span class="p">],</span><span class="n">bins</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;truth&#39;</span><span class="p">,</span><span class="o">**</span><span class="n">kw</span><span class="p">)</span>
<span class="n">myhist</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span><span class="n">mags</span><span class="p">[</span><span class="s1">&#39;g&#39;</span><span class="p">],</span><span class="n">bins</span><span class="o">=</span><span class="n">bins</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;g&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;meas&#39;</span><span class="p">,</span><span class="o">**</span><span class="n">kw</span><span class="p">)</span>
<span class="n">myhist</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span><span class="n">dat</span><span class="o">.</span><span class="n">psql_g</span><span class="p">[</span> <span class="n">is_elg_input</span><span class="p">],</span><span class="n">bins</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;truth + ELG&#39;</span><span class="p">,</span><span class="o">**</span><span class="n">kw</span><span class="p">)</span>

<span class="c1">#for ax in axes:</span>
<span class="c1">#     ax.set_xlim(0.5,2)</span>
<span class="c1">#     ax.set_ylim(0.2,1.3)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;g&#39;</span><span class="p">)</span>
<span class="c1">#     ax.set_ylabel(&#39;g-r&#39;)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper left&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>Out[728]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>&lt;matplotlib.legend.Legend at 0x15bb1b7f0&gt;
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/nb_obiwan_methods_paper_52_1.png" src="../_images/nb_obiwan_methods_paper_52_1.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [548]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">fig</span><span class="p">,</span><span class="n">axes</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">wspace</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
<span class="c1"># xlim=(0,2.5)</span>
<span class="n">xlim</span><span class="o">=</span><span class="bp">None</span>
<span class="n">kw</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="nb">range</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span><span class="n">normed</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>

<span class="c1"># Left panel</span>
<span class="n">ax</span><span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">n_tot</span><span class="p">,</span><span class="n">bins</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">histogram</span><span class="p">(</span><span class="n">dat</span><span class="o">.</span><span class="n">psql_redshift</span><span class="p">,</span><span class="n">bins</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span><span class="o">**</span><span class="n">kw</span><span class="p">)</span>

<span class="n">lab</span><span class="p">,</span><span class="n">keep</span><span class="o">=</span> <span class="s1">&#39;ELG fraction&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">is_elg_input</span><span class="p">)</span>
<span class="n">n_elg</span><span class="p">,</span><span class="n">bins</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">histogram</span><span class="p">(</span><span class="n">dat</span><span class="o">.</span><span class="n">psql_redshift</span><span class="p">[</span><span class="n">keep</span><span class="p">],</span><span class="n">bins</span><span class="o">=</span><span class="n">bins</span><span class="p">,</span><span class="o">**</span><span class="n">kw</span><span class="p">)</span>
<span class="n">my_step</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span><span class="n">bins</span><span class="p">,</span><span class="n">n_elg</span><span class="o">/</span><span class="n">n_tot</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="n">lab</span><span class="p">)</span>

<span class="n">lab</span><span class="p">,</span><span class="n">keep</span><span class="o">=</span> <span class="s1">&#39;ELG fraction &amp; Recovered&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">isRec</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">is_elg_input</span><span class="p">)</span>
<span class="n">n_elg_rec</span><span class="p">,</span><span class="n">_</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">histogram</span><span class="p">(</span><span class="n">dat</span><span class="o">.</span><span class="n">psql_redshift</span><span class="p">[</span><span class="n">keep</span><span class="p">],</span><span class="n">bins</span><span class="o">=</span><span class="n">bins</span><span class="p">,</span><span class="o">**</span><span class="n">kw</span><span class="p">)</span>
<span class="n">my_step</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span><span class="n">bins</span><span class="p">,</span><span class="n">n_elg_rec</span><span class="o">/</span><span class="n">n_tot</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;g&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="n">lab</span><span class="p">)</span>

<span class="c1"># Right panel</span>
<span class="n">ax</span><span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">lab</span><span class="p">,</span><span class="n">keep</span><span class="o">=</span> <span class="s1">&#39;correct Targets&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">isRec</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">is_elg_input</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">is_elg_trac</span><span class="p">)</span>
<span class="n">n_corr</span><span class="p">,</span><span class="n">_</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">histogram</span><span class="p">(</span><span class="n">dat</span><span class="o">.</span><span class="n">psql_redshift</span><span class="p">[</span><span class="n">keep</span><span class="p">],</span><span class="n">bins</span><span class="o">=</span><span class="n">bins</span><span class="p">,</span><span class="o">**</span><span class="n">kw</span><span class="p">)</span>
<span class="n">my_step</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span><span class="n">bins</span><span class="p">,</span><span class="n">n_corr</span><span class="o">/</span><span class="n">n_elg_rec</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="n">lab</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s1">&#39;n_corr=&#39;</span><span class="p">,</span><span class="n">n_corr</span><span class="p">)</span>

<span class="n">lab</span><span class="p">,</span><span class="n">keep</span><span class="o">=</span> <span class="s1">&#39;lost Targets&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">isRec</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">is_elg_input</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="o">~</span><span class="n">is_elg_trac</span><span class="p">)</span>
<span class="n">n_lost</span><span class="p">,</span><span class="n">_</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">histogram</span><span class="p">(</span><span class="n">dat</span><span class="o">.</span><span class="n">psql_redshift</span><span class="p">[</span><span class="n">keep</span><span class="p">],</span><span class="n">bins</span><span class="o">=</span><span class="n">bins</span><span class="p">,</span><span class="o">**</span><span class="n">kw</span><span class="p">)</span>
<span class="n">my_step</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span><span class="n">bins</span><span class="p">,</span><span class="n">n_lost</span><span class="o">/</span><span class="n">n_elg_rec</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;g&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="n">lab</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s1">&#39;n_lost=&#39;</span><span class="p">,</span><span class="n">n_lost</span><span class="p">)</span>

<span class="n">lab</span><span class="p">,</span><span class="n">keep</span><span class="o">=</span> <span class="s1">&#39;contaminated Targets&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">isRec</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="o">~</span><span class="n">is_elg_input</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">is_elg_trac</span><span class="p">)</span>
<span class="n">n_contam</span><span class="p">,</span><span class="n">_</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">histogram</span><span class="p">(</span><span class="n">dat</span><span class="o">.</span><span class="n">psql_redshift</span><span class="p">[</span><span class="n">keep</span><span class="p">],</span><span class="n">bins</span><span class="o">=</span><span class="n">bins</span><span class="p">,</span><span class="o">**</span><span class="n">kw</span><span class="p">)</span>
<span class="n">my_step</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span><span class="n">bins</span><span class="p">,</span><span class="n">n_contam</span><span class="o">/</span><span class="n">n_elg_rec</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;m&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="n">lab</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s1">&#39;n_contam=&#39;</span><span class="p">,</span><span class="n">n_contam</span><span class="p">)</span>

<span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="n">axes</span><span class="p">:</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">-</span><span class="mf">0.1</span><span class="p">,</span><span class="mf">1.1</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Fraction&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;redshift&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper left&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="p">(</span><span class="mf">1.01</span><span class="p">,</span><span class="mi">0</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
n_corr= [0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0]
n_lost= [   2    6    5   18    8    5   11    1    3   26   84  559 1091  724  395
  256   73   81   31   13   13    4    0    0    0    0    0    0    0    0]
n_contam= [0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="stderr output_area docutils container">
<div class="highlight"><pre>
/Users/kaylan1/miniconda3/envs/mlbook/lib/python3.6/site-packages/ipykernel_launcher.py:13: RuntimeWarning: invalid value encountered in true_divide
  del sys.path[0]
/Users/kaylan1/miniconda3/envs/mlbook/lib/python3.6/site-packages/matplotlib/cbook.py:2649: UserWarning: Saw kwargs [&#39;ls&#39;, &#39;linestyle&#39;] which are all aliases for &#39;linestyle&#39;.  Kept value from &#39;linestyle&#39;
  seen=seen, canon=canonical, used=seen[-1]))
/Users/kaylan1/miniconda3/envs/mlbook/lib/python3.6/site-packages/ipykernel_launcher.py:17: RuntimeWarning: invalid value encountered in true_divide
/Users/kaylan1/miniconda3/envs/mlbook/lib/python3.6/site-packages/ipykernel_launcher.py:23: RuntimeWarning: invalid value encountered in true_divide
/Users/kaylan1/miniconda3/envs/mlbook/lib/python3.6/site-packages/ipykernel_launcher.py:28: RuntimeWarning: invalid value encountered in true_divide
/Users/kaylan1/miniconda3/envs/mlbook/lib/python3.6/site-packages/ipykernel_launcher.py:33: RuntimeWarning: invalid value encountered in true_divide
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>Out[548]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>&lt;matplotlib.legend.Legend at 0x1430a9d30&gt;
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/nb_obiwan_methods_paper_53_3.png" src="../_images/nb_obiwan_methods_paper_53_3.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [417]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">def</span> <span class="nf">myhist2D</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">xlim</span><span class="o">=</span><span class="p">(),</span><span class="n">ylim</span><span class="o">=</span><span class="p">(),</span><span class="n">nbins</span><span class="o">=</span><span class="p">()):</span>
    <span class="c1">#http://www.astroml.org/book_figures/chapter1/fig_S82_hess.html</span>
    <span class="n">H</span><span class="p">,</span> <span class="n">xbins</span><span class="p">,</span> <span class="n">ybins</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">histogram2d</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span>
                                     <span class="n">bins</span><span class="o">=</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">xlim</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">xlim</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">nbins</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
                                           <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">ylim</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">ylim</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">nbins</span><span class="p">[</span><span class="mi">1</span><span class="p">])))</span>
    <span class="n">cmap</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">binary</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">H</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span>
              <span class="n">extent</span><span class="o">=</span><span class="p">[</span><span class="n">xbins</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">xbins</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">ybins</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ybins</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]],</span>
              <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span> <span class="n">interpolation</span><span class="o">=</span><span class="s1">&#39;nearest&#39;</span><span class="p">,</span>
              <span class="n">aspect</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">xlim</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">ylim</span><span class="p">)</span>


<span class="n">isRec</span><span class="o">=</span> <span class="n">dat</span><span class="o">.</span><span class="n">obiwan_mask</span> <span class="o">==</span> <span class="mi">1</span>
<span class="n">fig</span><span class="p">,</span><span class="n">axes</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">wspace</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>

<span class="n">kw</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">xlim</span><span class="o">=</span><span class="p">(</span><span class="mf">0.2</span><span class="p">,</span><span class="mf">1.0</span><span class="p">),</span><span class="n">ylim</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">180</span><span class="p">),</span><span class="n">nbins</span><span class="o">=</span><span class="p">(</span><span class="mi">30</span><span class="p">,</span><span class="mi">30</span><span class="p">))</span>
<span class="k">for</span> <span class="n">ax</span><span class="p">,</span><span class="n">keep</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">axes</span><span class="p">,</span>
                   <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dat</span><span class="p">),</span><span class="nb">bool</span><span class="p">),</span><span class="n">isRec</span><span class="p">]):</span>
    <span class="n">myhist2D</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span><span class="n">dat</span><span class="o">.</span><span class="n">psql_ba</span><span class="p">[</span><span class="n">keep</span><span class="p">],</span><span class="n">dat</span><span class="o">.</span><span class="n">psql_pa</span><span class="p">[</span><span class="n">keep</span><span class="p">],</span><span class="o">**</span><span class="n">kw</span><span class="p">)</span>

<span class="c1"># ax[0].set_aspect(&#39;equal&#39;)</span>
<span class="c1"># ax[1].set_aspect(abs((ax[1].get_xlim()[1]-ax[1].get_xlim()[0])/\</span>
<span class="c1">#                      (ax[1].get_ylim()[1]-ax[1].get_xlim()[0])))</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
    <span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;ba&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;pa&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>Out[417]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>&lt;matplotlib.text.Text at 0x14084df60&gt;
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/nb_obiwan_methods_paper_54_1.png" src="../_images/nb_obiwan_methods_paper_54_1.png" />
</div>
</div>
<div class="section" id="How-to-Fix-dflux-using-apflux_resid!!!!">
<h2>How to Fix dflux using apflux_resid!!!!<a class="headerlink" href="#How-to-Fix-dflux-using-apflux_resid!!!!" title="Permalink to this headline">Â¶</a></h2>
<ul class="simple">
<li>the fix makes faint end of the residual have larger scatter than
bright end which is what expect</li>
</ul>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [334]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">band</span><span class="o">=</span><span class="s1">&#39;z&#39;</span>
<span class="n">figs</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">12</span><span class="p">))</span>

<span class="n">isRec</span><span class="o">=</span> <span class="n">dat</span><span class="o">.</span><span class="n">obiwan_mask</span> <span class="o">==</span> <span class="mi">1</span>
<span class="n">dflux</span><span class="o">=</span> <span class="n">dat</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;tractor_flux_&#39;</span><span class="o">+</span><span class="n">band</span><span class="p">)[</span><span class="n">isRec</span><span class="p">]</span> <span class="o">-</span> <span class="n">dat</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">band</span><span class="o">+</span><span class="s1">&#39;flux&#39;</span><span class="p">)[</span><span class="n">isRec</span><span class="p">]</span>
<span class="n">rad_aper</span><span class="o">=</span> <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">0.75</span><span class="p">,</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">1.5</span><span class="p">,</span><span class="mf">2.0</span><span class="p">,</span><span class="mf">3.5</span><span class="p">,</span><span class="mf">5.0</span><span class="p">,</span><span class="mf">7.0</span><span class="p">]</span>
<span class="k">for</span> <span class="n">cnt</span><span class="p">,</span><span class="n">i_aper</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">([</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">]):</span>
    <span class="n">ratio_area</span><span class="o">=</span> <span class="mf">1.</span>
    <span class="c1">#ratio_area= (1.5*dat.rhalf[isRec] / rad_aper[i_aper])**2</span>
    <span class="k">if</span> <span class="n">i_aper</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
        <span class="n">fix</span><span class="o">=</span> <span class="n">ratio_area</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">average</span><span class="p">([</span><span class="n">dat</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;tractor_apflux_resid_&#39;</span><span class="o">+</span><span class="n">band</span><span class="p">)[</span><span class="n">isRec</span><span class="p">,</span><span class="mi">6</span><span class="p">],</span>
                                      <span class="n">dat</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;tractor_apflux_resid_&#39;</span><span class="o">+</span><span class="n">band</span><span class="p">)[</span><span class="n">isRec</span><span class="p">,</span><span class="mi">7</span><span class="p">]],</span>
                                    <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">assert</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">fix</span><span class="p">))</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">dat</span><span class="p">[</span><span class="n">isRec</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">fix</span><span class="o">=</span> <span class="n">dat</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;tractor_apflux_resid_&#39;</span><span class="o">+</span><span class="n">band</span><span class="p">)[</span><span class="n">isRec</span><span class="p">,</span><span class="n">i_aper</span><span class="p">]</span><span class="o">*</span> <span class="n">ratio_area</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;fix=&#39;</span><span class="p">,</span><span class="n">fix</span><span class="p">,</span><span class="s1">&#39;dflux=&#39;</span><span class="p">,</span><span class="n">dflux</span><span class="p">)</span>
    <span class="n">y</span><span class="o">=</span> <span class="n">dflux</span> <span class="o">-</span> <span class="n">fix</span>
    <span class="n">ax</span><span class="p">[</span><span class="n">cnt</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">dat</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">band</span><span class="o">+</span><span class="s1">&#39;flux&#39;</span><span class="p">)[</span><span class="n">isRec</span><span class="p">],</span><span class="n">y</span><span class="p">,</span>
                    <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="n">cnt</span><span class="p">]</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">y</span><span class="p">),</span><span class="n">c</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;median=&#39;</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">y</span><span class="p">))</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>
    <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
<span class="c1">#     ax[i].set_yscale(&#39;log&#39;)</span>
<span class="c1">#     ax[i].set_ylim(1e-2,2e1)</span>
    <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
fix= [ 0.46955267 -0.21419707  0.2856611  ...,  0.21198358  0.13909206
 -0.32362264] dflux= [-0.60327875  0.13913705 -0.08202423 ..., -0.05187323 -0.03534078
 -0.02667671]
median= -0.531838792528
fix= [ 0.83753693 -0.44062534  0.81644279 ...,  0.25070146  0.35351264
 -1.73575914] dflux= [-0.60327875  0.13913705 -0.08202423 ..., -0.05187323 -0.03534078
 -0.02667671]
median= -0.44539169405
fix= [ 1.32278228 -0.80876064  1.78851771 ..., -1.24446416 -0.04480623
 -2.68531513] dflux= [-0.60327875  0.13913705 -0.08202423 ..., -0.05187323 -0.03534078
 -0.02667671]
median= -0.179187853022
fix= [ 2.67648363 -1.0258615   0.90383226 ..., -2.88036346  1.83955121
 -4.72889614] dflux= [-0.60327875  0.13913705 -0.08202423 ..., -0.05187323 -0.03534078
 -0.02667671]
median= 0.235969813752
fix= [ 1.99963295 -0.91731107  1.34617499 ..., -2.06241381  0.89737249
 -3.70710564] dflux= [-0.60327875  0.13913705 -0.08202423 ..., -0.05187323 -0.03534078
 -0.02667671]
median= 0.0162609069016
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/nb_obiwan_methods_paper_56_1.png" src="../_images/nb_obiwan_methods_paper_56_1.png" />
</div>
</div>
<div class="system-message">
<p class="system-message-title">System Message: SEVERE/4 (<tt class="docutils">/global/cscratch1/sd/huikong/obiwan_Aug/repos_for_docker/obiwan_webpage/obiwan/doc/nb/obiwan_methods_paper.ipynb</tt>, line 2767)</p>
<p>Title level inconsistent:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">dmag</span>
<span class="o">~~~~</span>
</pre></div>
</div>
</div>
<ul class="simple">
<li>True mag: brightness of source + its noise + extinction</li>
<li>dmag: tractor measured mag - true_mag - sky_mag from sky at that
source position</li>
</ul>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [340]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">band</span><span class="o">=</span><span class="s1">&#39;z&#39;</span>
<span class="n">figs</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">12</span><span class="p">))</span>

<span class="n">isRec</span><span class="o">=</span> <span class="n">dat</span><span class="o">.</span><span class="n">obiwan_mask</span> <span class="o">==</span> <span class="mi">1</span>
<span class="n">rad_aper</span><span class="o">=</span> <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">0.75</span><span class="p">,</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">1.5</span><span class="p">,</span><span class="mf">2.0</span><span class="p">,</span><span class="mf">3.5</span><span class="p">,</span><span class="mf">5.0</span><span class="p">,</span><span class="mf">7.0</span><span class="p">]</span>
<span class="k">for</span> <span class="n">cnt</span><span class="p">,</span><span class="n">i_aper</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">([</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">]):</span>
    <span class="n">ratio_area</span><span class="o">=</span> <span class="mf">1.</span>
    <span class="c1">#ratio_area= (1.5*dat.rhalf[isRec] / rad_aper[i_aper])**2</span>
    <span class="k">if</span> <span class="n">i_aper</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
        <span class="n">fix</span><span class="o">=</span> <span class="n">ratio_area</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">average</span><span class="p">([</span><span class="n">dat</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;tractor_apflux_resid_&#39;</span><span class="o">+</span><span class="n">band</span><span class="p">)[</span><span class="n">isRec</span><span class="p">,</span><span class="mi">6</span><span class="p">],</span>
                                      <span class="n">dat</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;tractor_apflux_resid_&#39;</span><span class="o">+</span><span class="n">band</span><span class="p">)[</span><span class="n">isRec</span><span class="p">,</span><span class="mi">7</span><span class="p">]],</span>
                                    <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">assert</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">fix</span><span class="p">))</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">dat</span><span class="p">[</span><span class="n">isRec</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">fix</span><span class="o">=</span> <span class="n">dat</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;tractor_apflux_resid_&#39;</span><span class="o">+</span><span class="n">band</span><span class="p">)[</span><span class="n">isRec</span><span class="p">,</span><span class="n">i_aper</span><span class="p">]</span><span class="o">*</span> <span class="n">ratio_area</span>
    <span class="n">dmag</span><span class="o">=</span> <span class="n">plots</span><span class="o">.</span><span class="n">flux2mag</span><span class="p">(</span><span class="n">dat</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;tractor_flux_&#39;</span><span class="o">+</span><span class="n">band</span><span class="p">)[</span><span class="n">isRec</span><span class="p">])</span> <span class="o">-</span>\
            <span class="n">plots</span><span class="o">.</span><span class="n">flux2mag</span><span class="p">(</span><span class="n">dat</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">band</span><span class="o">+</span><span class="s1">&#39;flux&#39;</span><span class="p">)[</span><span class="n">isRec</span><span class="p">]</span><span class="o">+</span>  <span class="n">fix</span><span class="p">)</span>
    <span class="n">true_mag</span><span class="o">=</span> <span class="n">plots</span><span class="o">.</span><span class="n">flux2mag</span><span class="p">(</span><span class="n">dat</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">band</span><span class="o">+</span><span class="s1">&#39;flux&#39;</span><span class="p">)[</span><span class="n">isRec</span><span class="p">]</span><span class="o">/</span>\
                             <span class="n">dat</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;mw_transmission_&#39;</span><span class="o">+</span><span class="n">band</span><span class="p">)[</span><span class="n">isRec</span><span class="p">])</span>
    <span class="n">isPostiveFlux</span><span class="o">=</span> <span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">dmag</span><span class="p">))</span> <span class="o">&amp;</span>
                    <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">true_mag</span><span class="p">)))</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;true_mag=&#39;</span><span class="p">,</span><span class="n">true_mag</span><span class="p">[</span><span class="n">isPostiveFlux</span><span class="p">],</span><span class="s1">&#39;trac_mag=&#39;</span><span class="p">,</span><span class="n">dmag</span><span class="p">[</span><span class="n">isPostiveFlux</span><span class="p">])</span>
    <span class="n">ax</span><span class="p">[</span><span class="n">cnt</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">true_mag</span><span class="p">[</span><span class="n">isPostiveFlux</span><span class="p">],</span><span class="n">dmag</span><span class="p">[</span><span class="n">isPostiveFlux</span><span class="p">],</span>
                    <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="n">cnt</span><span class="p">]</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">dmag</span><span class="p">[</span><span class="n">isPostiveFlux</span><span class="p">]),</span><span class="n">c</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;median=&#39;</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">dmag</span><span class="p">[</span><span class="n">isPostiveFlux</span><span class="p">]))</span>

    <span class="n">binned</span><span class="o">=</span> <span class="n">plots</span><span class="o">.</span><span class="n">bin_up</span><span class="p">(</span><span class="n">true_mag</span><span class="p">[</span><span class="n">isPostiveFlux</span><span class="p">],</span><span class="n">dmag</span><span class="p">[</span><span class="n">isPostiveFlux</span><span class="p">],</span>
                         <span class="n">bin_minmax</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span><span class="mi">25</span><span class="p">),</span><span class="n">nbins</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">perc</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;q25&#39;</span><span class="p">,</span><span class="s1">&#39;q75&#39;</span><span class="p">]:</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">cnt</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">binned</span><span class="p">[</span><span class="s1">&#39;binc&#39;</span><span class="p">],</span><span class="n">binned</span><span class="p">[</span><span class="n">perc</span><span class="p">],</span><span class="n">c</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>
    <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="stderr output_area docutils container">
<div class="highlight"><pre>
/Users/kaylan1/PhdStudent/Research/desi/obiwan/py/obiwan/qa/plots.py:39: RuntimeWarning: divide by zero encountered in log10
  np.linspace(ylim[0],ylim[1],nbins[1])))
/Users/kaylan1/PhdStudent/Research/desi/obiwan/py/obiwan/qa/plots.py:39: RuntimeWarning: invalid value encountered in log10
  np.linspace(ylim[0],ylim[1],nbins[1])))
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
true_mag= [ 20.93833542  21.20184135  20.8072052  ...,  21.31015587  21.77809906
  21.01568413] trac_mag= [ 0.29185285 -0.1210452   0.08480629 ...,  0.09607506  0.09786368
 -0.08881957]
median= 0.133546854082
true_mag= [ 20.93833542  21.20184135  20.8072052  ...,  21.31015587  21.77809906
  21.01568413] trac_mag= [ 0.3762652  -0.20637092  0.19661195 ...,  0.10948405  0.20720452
 -0.65323161]
median= 0.10447186237
true_mag= [ 20.93833542  21.20184135  20.8072052  ...,  21.31015587  21.77809906
  21.01568413] trac_mag= [ 0.47840095 -0.3612303   0.37558672 ..., -0.58803373 -0.00557145
 -1.31910432]
median= 0.0395384160801
true_mag= [ 20.93833542  21.20184135  20.8072052  ...,  20.82847595  21.31015587
  21.77809906] trac_mag= [ 0.72108025 -0.4641138   0.21396448 ..., -1.81171733 -5.21707271
  0.76005683]
median= -0.0505317558301
true_mag= [ 20.93833542  21.20184135  20.8072052  ...,  21.31015587  21.77809906
  21.01568413] trac_mag= [ 0.60650687 -0.41145386  0.2977802  ..., -1.32543575  0.4433763
 -3.94433459]
median= -0.0074523196963
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/nb_obiwan_methods_paper_58_2.png" src="../_images/nb_obiwan_methods_paper_58_2.png" />
</div>
</div>
<div class="system-message">
<p class="system-message-title">System Message: SEVERE/4 (<tt class="docutils">/global/cscratch1/sd/huikong/obiwan_Aug/repos_for_docker/obiwan_webpage/obiwan/doc/nb/obiwan_methods_paper.ipynb</tt>, line 2919)</p>
<p>Title level inconsistent:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">num</span> <span class="n">std</span> <span class="n">deviations</span>
<span class="o">~~~~~~~~~~~~~~~~~~</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [338]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">band</span><span class="o">=</span><span class="s1">&#39;z&#39;</span>
<span class="n">figs</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">12</span><span class="p">))</span>

<span class="n">isRec</span><span class="o">=</span> <span class="n">dat</span><span class="o">.</span><span class="n">obiwan_mask</span> <span class="o">==</span> <span class="mi">1</span>
<span class="n">rad_aper</span><span class="o">=</span> <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">0.75</span><span class="p">,</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">1.5</span><span class="p">,</span><span class="mf">2.0</span><span class="p">,</span><span class="mf">3.5</span><span class="p">,</span><span class="mf">5.0</span><span class="p">,</span><span class="mf">7.0</span><span class="p">]</span>
<span class="k">for</span> <span class="n">cnt</span><span class="p">,</span><span class="n">i_aper</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">([</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">]):</span>
    <span class="n">ratio_area</span><span class="o">=</span> <span class="mf">1.</span>
    <span class="c1">#ratio_area= (1.5*dat.rhalf[isRec] / rad_aper[i_aper])**2</span>
    <span class="k">if</span> <span class="n">i_aper</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
        <span class="n">fix</span><span class="o">=</span> <span class="n">ratio_area</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">average</span><span class="p">([</span><span class="n">dat</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;tractor_apflux_resid_&#39;</span><span class="o">+</span><span class="n">band</span><span class="p">)[</span><span class="n">isRec</span><span class="p">,</span><span class="mi">6</span><span class="p">],</span>
                                      <span class="n">dat</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;tractor_apflux_resid_&#39;</span><span class="o">+</span><span class="n">band</span><span class="p">)[</span><span class="n">isRec</span><span class="p">,</span><span class="mi">7</span><span class="p">]],</span>
                                    <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">assert</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">fix</span><span class="p">))</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">dat</span><span class="p">[</span><span class="n">isRec</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">fix</span><span class="o">=</span> <span class="n">dat</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;tractor_apflux_resid_&#39;</span><span class="o">+</span><span class="n">band</span><span class="p">)[</span><span class="n">isRec</span><span class="p">,</span><span class="n">i_aper</span><span class="p">]</span><span class="o">*</span> <span class="n">ratio_area</span>
    <span class="n">num_std_dev</span><span class="o">=</span> <span class="p">(</span><span class="n">dat</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;tractor_flux_&#39;</span><span class="o">+</span><span class="n">band</span><span class="p">)[</span><span class="n">isRec</span><span class="p">]</span> <span class="o">-</span>\
                  <span class="p">(</span><span class="n">dat</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">band</span><span class="o">+</span><span class="s1">&#39;flux&#39;</span><span class="p">)[</span><span class="n">isRec</span><span class="p">]</span><span class="o">+</span>  <span class="n">fix</span><span class="p">))</span><span class="o">*</span>\
            <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">dat</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;tractor_flux_ivar_&#39;</span><span class="o">+</span><span class="n">band</span><span class="p">)[</span><span class="n">isRec</span><span class="p">])</span>
    <span class="n">true_mag</span><span class="o">=</span> <span class="n">plots</span><span class="o">.</span><span class="n">flux2mag</span><span class="p">(</span><span class="n">dat</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">band</span><span class="o">+</span><span class="s1">&#39;flux&#39;</span><span class="p">)[</span><span class="n">isRec</span><span class="p">]</span><span class="o">/</span>\
                             <span class="n">dat</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;mw_transmission_&#39;</span><span class="o">+</span><span class="n">band</span><span class="p">)[</span><span class="n">isRec</span><span class="p">])</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;true_mag=&#39;</span><span class="p">,</span><span class="n">true_mag</span><span class="p">,</span><span class="s1">&#39;num_std_dev=&#39;</span><span class="p">,</span><span class="n">num_std_dev</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="n">cnt</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">true_mag</span><span class="p">,</span><span class="n">num_std_dev</span><span class="p">,</span>
                    <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="n">cnt</span><span class="p">]</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">num_std_dev</span><span class="p">),</span><span class="n">c</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;median=&#39;</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">num_std_dev</span><span class="p">))</span>

    <span class="n">binned</span><span class="o">=</span> <span class="n">plots</span><span class="o">.</span><span class="n">bin_up</span><span class="p">(</span><span class="n">true_mag</span><span class="p">,</span><span class="n">num_std_dev</span><span class="p">,</span> <span class="n">bin_minmax</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span><span class="mi">25</span><span class="p">),</span><span class="n">nbins</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">perc</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;q25&#39;</span><span class="p">,</span><span class="s1">&#39;q75&#39;</span><span class="p">]:</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">cnt</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">binned</span><span class="p">[</span><span class="s1">&#39;binc&#39;</span><span class="p">],</span><span class="n">binned</span><span class="p">[</span><span class="n">perc</span><span class="p">],</span><span class="n">c</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>
    <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
true_mag= [ 20.93833542  21.20184135  20.8072052  ...,  21.31015587  21.77809906
  21.01568413] num_std_dev= [-4.34730214  1.21810205 -1.3827519  ..., -0.75389706 -0.73209095
  1.21890048]
median= -1.60525274255
true_mag= [ 20.93833542  21.20184135  20.8072052  ...,  21.31015587  21.77809906
  21.01568413] num_std_dev= [-5.8384393   1.99870241 -3.3788592  ..., -0.86452258 -1.63200962
  7.01542316]
median= -1.15402747036
true_mag= [ 20.93833542  21.20184135  20.8072052  ...,  21.31015587  21.77809906
  21.01568413] num_std_dev= [ -7.80473904   3.26783082  -7.03453518 ...,   3.40749519   0.0397263
  10.91315038]
median= -0.151277299666
true_mag= [ 20.93833542  21.20184135  20.8072052  ...,  21.31015587  21.77809906
  21.01568413] num_std_dev= [-13.29017572   4.01627538  -3.70750422 ...,   8.08162013  -7.86888209
  19.30161971]
median= 0.781358373371
true_mag= [ 20.93833542  21.20184135  20.8072052  ...,  21.31015587  21.77809906
  21.01568413] num_std_dev= [-10.54745738   3.6420531   -5.3710197  ...,   5.74455766  -3.91457789
  15.10738504]
median= 0.0549080444017
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/nb_obiwan_methods_paper_60_1.png" src="../_images/nb_obiwan_methods_paper_60_1.png" />
</div>
</div>
<div class="system-message">
<p class="system-message-title">System Message: SEVERE/4 (<tt class="docutils">/global/cscratch1/sd/huikong/obiwan_Aug/repos_for_docker/obiwan_webpage/obiwan/doc/nb/obiwan_methods_paper.ipynb</tt>, line 3034)</p>
<p>Title level inconsistent:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">delta</span> <span class="n">RA</span><span class="p">,</span> <span class="n">Dec</span>
<span class="o">~~~~~~~~~~~~~</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [281]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">i</span><span class="o">=</span> <span class="n">dat</span><span class="o">.</span><span class="n">obiwan_mask</span> <span class="o">==</span> <span class="mi">1</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">dat</span><span class="o">.</span><span class="n">mw_transmission_g</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
            <span class="n">dat</span><span class="o">.</span><span class="n">mw_transmission_g</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">dat</span><span class="o">.</span><span class="n">tractor_mw_transmission_g</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="o">-</span><span class="mf">1e-4</span><span class="p">,</span><span class="mf">1e-4</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>Out[281]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>(-0.0001, 0.0001)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/nb_obiwan_methods_paper_62_1.png" src="../_images/nb_obiwan_methods_paper_62_1.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [282]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">i</span><span class="o">=</span> <span class="n">dat</span><span class="o">.</span><span class="n">obiwan_mask</span> <span class="o">==</span> <span class="mi">1</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">dat</span><span class="o">.</span><span class="n">ra</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
            <span class="p">(</span><span class="n">dat</span><span class="o">.</span><span class="n">ra</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">dat</span><span class="o">.</span><span class="n">tractor_ra</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">*</span><span class="mi">3600</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="o">-</span><span class="mf">1.2</span><span class="p">,</span><span class="mf">1.2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>Out[282]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>(-1.2, 1.2)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/nb_obiwan_methods_paper_63_1.png" src="../_images/nb_obiwan_methods_paper_63_1.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [283]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">i</span><span class="o">=</span> <span class="n">dat</span><span class="o">.</span><span class="n">obiwan_mask</span> <span class="o">==</span> <span class="mi">1</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">((</span><span class="n">dat</span><span class="o">.</span><span class="n">ra</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">dat</span><span class="o">.</span><span class="n">tractor_ra</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">*</span><span class="mi">3600</span><span class="p">,</span>
            <span class="p">(</span><span class="n">dat</span><span class="o">.</span><span class="n">dec</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">dat</span><span class="o">.</span><span class="n">tractor_dec</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">*</span><span class="mi">3600</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="o">-</span><span class="mf">1.2</span><span class="p">,</span><span class="mf">1.2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="o">-</span><span class="mf">1.2</span><span class="p">,</span><span class="mf">1.2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\Delta \, RA$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\Delta \, Dec$&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>Out[283]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>&lt;matplotlib.text.Text at 0x13ba78a90&gt;
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/nb_obiwan_methods_paper_64_1.png" src="../_images/nb_obiwan_methods_paper_64_1.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [285]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">i</span><span class="o">=</span> <span class="n">dat</span><span class="o">.</span><span class="n">obiwan_mask</span> <span class="o">==</span> <span class="mi">1</span>
<span class="n">sns</span><span class="o">.</span><span class="n">distplot</span><span class="p">((</span><span class="n">dat</span><span class="o">.</span><span class="n">tractor_nora</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">dat</span><span class="o">.</span><span class="n">tractor_ra</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">*</span><span class="mi">3600</span><span class="p">,</span>
             <span class="p">(</span><span class="n">dat</span><span class="o">.</span><span class="n">dec</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">dat</span><span class="o">.</span><span class="n">tractor_dec</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">*</span><span class="mi">3600</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="o">-</span><span class="mf">1.2</span><span class="p">,</span><span class="mf">1.2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="o">-</span><span class="mf">1.2</span><span class="p">,</span><span class="mf">1.2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\Delta \, RA$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\Delta \, Dec$&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">AttributeError</span>                            Traceback (most recent call last)
<span class="ansi-green-fg">&lt;ipython-input-285-3335e05cd327&gt;</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span><span class="ansi-blue-fg">()</span>
<span class="ansi-green-intense-fg ansi-bold">      1</span> i<span class="ansi-blue-fg">=</span> dat<span class="ansi-blue-fg">.</span>obiwan_mask <span class="ansi-blue-fg">==</span> <span class="ansi-cyan-fg">1</span>
<span class="ansi-green-fg">----&gt; 2</span><span class="ansi-red-fg"> sns.distplot((dat.tractor_nora[i] - dat.tractor_ra[i])*3600,
</span><span class="ansi-green-intense-fg ansi-bold">      3</span>              (dat.dec[i] - dat.tractor_dec[i])*3600)
<span class="ansi-green-intense-fg ansi-bold">      4</span> plt<span class="ansi-blue-fg">.</span>axhline<span class="ansi-blue-fg">(</span><span class="ansi-cyan-fg">0</span><span class="ansi-blue-fg">,</span>c<span class="ansi-blue-fg">=</span><span class="ansi-blue-fg">&#39;k&#39;</span><span class="ansi-blue-fg">,</span>ls<span class="ansi-blue-fg">=</span><span class="ansi-blue-fg">&#39;--&#39;</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">      5</span> plt<span class="ansi-blue-fg">.</span>axvline<span class="ansi-blue-fg">(</span><span class="ansi-cyan-fg">0</span><span class="ansi-blue-fg">,</span>c<span class="ansi-blue-fg">=</span><span class="ansi-blue-fg">&#39;k&#39;</span><span class="ansi-blue-fg">,</span>ls<span class="ansi-blue-fg">=</span><span class="ansi-blue-fg">&#39;--&#39;</span><span class="ansi-blue-fg">)</span>

<span class="ansi-red-fg">AttributeError</span>: &#39;tabledata&#39; object has no attribute &#39;tractor_nora&#39;
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [298]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">band</span><span class="o">=</span><span class="s1">&#39;g&#39;</span>
<span class="n">figs</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>

<span class="n">isRec</span><span class="o">=</span> <span class="n">dat</span><span class="o">.</span><span class="n">obiwan_mask</span> <span class="o">==</span> <span class="mi">1</span>
<span class="n">dflux</span><span class="o">=</span> <span class="n">dat</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;tractor_flux_&#39;</span><span class="o">+</span><span class="n">band</span><span class="p">)[</span><span class="n">isRec</span><span class="p">]</span> <span class="o">-</span> <span class="n">dat</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">band</span><span class="o">+</span><span class="s1">&#39;flux&#39;</span><span class="p">)[</span><span class="n">isRec</span><span class="p">]</span>
<span class="n">rad_aper</span><span class="o">=</span> <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">0.75</span><span class="p">,</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">1.5</span><span class="p">,</span><span class="mf">2.0</span><span class="p">,</span><span class="mf">3.5</span><span class="p">,</span><span class="mf">5.0</span><span class="p">,</span><span class="mf">7.0</span><span class="p">]</span>
<span class="k">for</span> <span class="n">cnt</span><span class="p">,</span><span class="n">i_aper</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">([</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">]):</span>
    <span class="n">ratio_area</span><span class="o">=</span> <span class="p">(</span><span class="mf">1.5</span><span class="o">*</span><span class="n">dat</span><span class="o">.</span><span class="n">rhalf</span><span class="p">[</span><span class="n">isRec</span><span class="p">]</span> <span class="o">/</span> <span class="n">rad_aper</span><span class="p">[</span><span class="n">i_aper</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span>
    <span class="n">fix</span><span class="o">=</span> <span class="n">dat</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;tractor_apflux_resid_&#39;</span><span class="o">+</span><span class="n">band</span><span class="p">)[</span><span class="n">isRec</span><span class="p">,</span><span class="n">i_aper</span><span class="p">]</span><span class="o">*</span> <span class="n">ratio_area</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;fix=&#39;</span><span class="p">,</span><span class="n">fix</span><span class="p">,</span><span class="s1">&#39;dflux=&#39;</span><span class="p">,</span><span class="n">dflux</span><span class="p">)</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">distplot</span><span class="p">(</span><span class="n">fix</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="n">cnt</span><span class="p">])</span>
    <span class="n">ax</span><span class="p">[</span><span class="n">cnt</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="o">-</span><span class="mf">0.2</span><span class="p">,</span><span class="mf">0.2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
fix= [ 0.01410908  0.00205612  0.0094271  ...,  0.05565902  0.00697286
  0.00865769] dflux= [-0.17664099  0.04343205 -0.02215747 ..., -0.12600998 -0.06912357
  0.01782683]
fix= [ 0.00511783 -0.00519097  0.01246918 ...,  0.01146335  0.00121295
  0.00036051] dflux= [-0.17664099  0.04343205 -0.02215747 ..., -0.12600998 -0.06912357
  0.01782683]
fix= [ 0.00151087 -0.00555547  0.00538299 ..., -0.02107371  0.00137389
 -0.00986581] dflux= [-0.17664099  0.04343205 -0.02215747 ..., -0.12600998 -0.06912357
  0.01782683]
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/nb_obiwan_methods_paper_66_1.png" src="../_images/nb_obiwan_methods_paper_66_1.png" />
</div>
</div>
<div class="system-message">
<p class="system-message-title">System Message: SEVERE/4 (<tt class="docutils">/global/cscratch1/sd/huikong/obiwan_Aug/repos_for_docker/obiwan_webpage/obiwan/doc/nb/obiwan_methods_paper.ipynb</tt>, line 3238)</p>
<p>Title level inconsistent:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">psfsize</span> <span class="o">--&gt;</span> <span class="n">rhalf</span>
<span class="o">~~~~~~~~~~~~~~~~~</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">dat</span><span class="o">.</span><span class="n">tractor_allmask_g</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [243]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># recovered</span>
<span class="n">isRec</span><span class="o">=</span> <span class="p">((</span><span class="n">dat</span><span class="o">.</span><span class="n">obiwan_mask</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span>
        <span class="p">(</span><span class="n">dat</span><span class="o">.</span><span class="n">tractor_brick_primary</span><span class="p">)</span> <span class="o">&amp;</span>
        <span class="p">(</span><span class="n">dat</span><span class="o">.</span><span class="n">tractor_allmask_g</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span>
        <span class="p">(</span><span class="n">dat</span><span class="o">.</span><span class="n">tractor_allmask_r</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span>
        <span class="p">(</span><span class="n">dat</span><span class="o">.</span><span class="n">tractor_allmask_z</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span>
        <span class="p">((</span><span class="n">dat</span><span class="o">.</span><span class="n">tractor_flux_g</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">|</span>
         <span class="p">(</span><span class="n">dat</span><span class="o">.</span><span class="n">tractor_flux_r</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">|</span>
         <span class="p">(</span><span class="n">dat</span><span class="o">.</span><span class="n">tractor_flux_z</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">))</span>
       <span class="p">)</span>

<span class="c1"># Types</span>
<span class="n">tractor_type</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">char</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="n">dat</span><span class="o">.</span><span class="n">tractor_type</span><span class="p">)</span>
<span class="n">TYPES</span><span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">tractor_type</span><span class="p">))</span>
<span class="n">isType</span><span class="o">=</span><span class="p">{}</span>
<span class="k">for</span> <span class="n">typ</span> <span class="ow">in</span> <span class="n">TYPES</span><span class="p">:</span>
    <span class="n">isType</span><span class="p">[</span><span class="n">typ</span><span class="p">]</span><span class="o">=</span> <span class="n">tractor_type</span> <span class="o">==</span> <span class="n">typ</span>
<span class="k">print</span><span class="p">(</span><span class="n">isType</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
<span class="c1"># rhalf ~ fwhm/2</span>
<span class="n">fwhm_or_rhalf</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dat</span><span class="p">))</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span>
<span class="k">for</span> <span class="n">typ</span> <span class="ow">in</span> <span class="n">TYPES</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">typ</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="s1">&#39;COMP&#39;</span><span class="p">]:</span>
        <span class="k">continue</span>
    <span class="n">i</span><span class="o">=</span> <span class="p">(</span><span class="n">isType</span><span class="p">[</span><span class="n">typ</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">isRec</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">typ</span> <span class="o">==</span> <span class="s1">&#39;PSF&#39;</span><span class="p">:</span>
        <span class="n">fwhm_or_rhalf</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">([</span><span class="n">dat</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;tractor_psfsize_&#39;</span><span class="o">+</span><span class="n">band</span><span class="p">)[</span><span class="n">i</span><span class="p">]</span>
                                   <span class="k">for</span> <span class="n">band</span> <span class="ow">in</span> <span class="s1">&#39;grz&#39;</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
    <span class="k">elif</span> <span class="n">typ</span> <span class="o">==</span> <span class="s1">&#39;SIMP&#39;</span><span class="p">:</span>
        <span class="n">fwhm_or_rhalf</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span> <span class="mf">0.5</span>
    <span class="k">elif</span> <span class="n">typ</span> <span class="o">==</span> <span class="s1">&#39;EXP&#39;</span><span class="p">:</span>
        <span class="n">fwhm_or_rhalf</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span> <span class="n">dat</span><span class="o">.</span><span class="n">tractor_shapeexp_r</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="k">elif</span> <span class="n">typ</span> <span class="o">==</span> <span class="s1">&#39;DEV&#39;</span><span class="p">:</span>
        <span class="n">fwhm_or_rhalf</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span> <span class="n">dat</span><span class="o">.</span><span class="n">tractor_shapedev_r</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
dict_keys([&#39;&#39;, &#39;DEV&#39;, &#39;PSF&#39;, &#39;COMP&#39;, &#39;EXP&#39;, &#39;SIMP&#39;])
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="stderr output_area docutils container">
<div class="highlight"><pre>
/Users/kaylan1/miniconda3/envs/mlbook/lib/python3.6/site-packages/ipykernel_launcher.py:8: RuntimeWarning: invalid value encountered in greater

/Users/kaylan1/miniconda3/envs/mlbook/lib/python3.6/site-packages/ipykernel_launcher.py:9: RuntimeWarning: invalid value encountered in greater
  if __name__ == &#39;__main__&#39;:
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [244]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">e1</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dat</span><span class="p">))</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span>
<span class="n">e2</span><span class="o">=</span><span class="n">e1</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="k">for</span> <span class="n">typ</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;SIMP&#39;</span><span class="p">,</span><span class="s1">&#39;EXP&#39;</span><span class="p">,</span><span class="s1">&#39;DEV&#39;</span><span class="p">]:</span>
    <span class="n">i</span><span class="o">=</span> <span class="p">(</span><span class="n">isType</span><span class="p">[</span><span class="n">typ</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">isRec</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">typ</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;SIMP&#39;</span><span class="p">,</span><span class="s1">&#39;EXP&#39;</span><span class="p">,</span><span class="s1">&#39;REX&#39;</span><span class="p">]:</span>
        <span class="n">e1</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span> <span class="n">dat</span><span class="o">.</span><span class="n">tractor_shapeexp_e1</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">e2</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span> <span class="n">dat</span><span class="o">.</span><span class="n">tractor_shapeexp_e2</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="k">elif</span> <span class="n">typ</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;DEV&#39;</span><span class="p">]:</span>
        <span class="n">e1</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span> <span class="n">dat</span><span class="o">.</span><span class="n">tractor_shapedev_e1</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">e2</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span> <span class="n">dat</span><span class="o">.</span><span class="n">tractor_shapedev_e2</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="Delta-plots">
<h1>Delta plots<a class="headerlink" href="#Delta-plots" title="Permalink to this headline">Â¶</a></h1>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [255]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">diff</span><span class="o">=</span><span class="p">{}</span>

<span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;ra&#39;</span><span class="p">,</span><span class="s1">&#39;dec&#39;</span><span class="p">]:</span>
    <span class="n">diff</span><span class="p">[</span><span class="s1">&#39;delta_&#39;</span><span class="o">+</span><span class="n">key</span><span class="p">]</span><span class="o">=</span> <span class="n">dat</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;tractor_&#39;</span><span class="o">+</span><span class="n">key</span><span class="p">)[</span><span class="n">isRec</span><span class="p">]</span> <span class="o">-</span> <span class="n">dat</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">)[</span><span class="n">isRec</span><span class="p">]</span>
<span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="s1">&#39;xy&#39;</span><span class="p">:</span>
    <span class="n">diff</span><span class="p">[</span><span class="s1">&#39;delta_&#39;</span><span class="o">+</span><span class="n">key</span><span class="p">]</span><span class="o">=</span> <span class="n">dat</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;tractor_b&#39;</span><span class="o">+</span><span class="n">key</span><span class="p">)[</span><span class="n">isRec</span><span class="p">]</span> <span class="o">-</span> <span class="n">dat</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">)[</span><span class="n">isRec</span><span class="p">]</span>
<span class="c1"># More complicated quantities</span>
<span class="n">diff</span><span class="p">[</span><span class="s1">&#39;avg_num_std&#39;</span><span class="p">]</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">([(</span><span class="n">dat</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;tractor_flux_&#39;</span><span class="o">+</span><span class="n">band</span><span class="p">)[</span><span class="n">isRec</span><span class="p">]</span> <span class="o">-</span> <span class="n">dat</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">band</span><span class="o">+</span><span class="s1">&#39;flux&#39;</span><span class="p">)[</span><span class="n">isRec</span><span class="p">])</span><span class="o">*</span>\
                                <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">dat</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;tractor_flux_ivar_&#39;</span><span class="o">+</span><span class="n">band</span><span class="p">)[</span><span class="n">isRec</span><span class="p">])</span>
                              <span class="k">for</span> <span class="n">band</span> <span class="ow">in</span> <span class="s1">&#39;grz&#39;</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">diff</span><span class="p">[</span><span class="s1">&#39;fracflux_sum&#39;</span><span class="p">]</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">([</span><span class="n">dat</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;tractor_fracflux_&#39;</span><span class="o">+</span><span class="n">band</span><span class="p">)[</span><span class="n">isRec</span><span class="p">]</span>
                              <span class="k">for</span> <span class="n">band</span> <span class="ow">in</span> <span class="s1">&#39;grz&#39;</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">diff</span><span class="p">[</span><span class="s1">&#39;anymask_sum&#39;</span><span class="p">]</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">([</span><span class="n">dat</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;tractor_anymask_&#39;</span><span class="o">+</span><span class="n">band</span><span class="p">)[</span><span class="n">isRec</span><span class="p">]</span>
                             <span class="k">for</span> <span class="n">band</span> <span class="ow">in</span> <span class="s1">&#39;grz&#39;</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">diff</span><span class="p">[</span><span class="s1">&#39;allmask_sum&#39;</span><span class="p">]</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">([</span><span class="n">dat</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;tractor_allmask_&#39;</span><span class="o">+</span><span class="n">band</span><span class="p">)[</span><span class="n">isRec</span><span class="p">]</span>
                             <span class="k">for</span> <span class="n">band</span> <span class="ow">in</span> <span class="s1">&#39;grz&#39;</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="k">assert</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">diff</span><span class="p">[</span><span class="s1">&#39;avg_num_std&#39;</span><span class="p">])</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">dat</span><span class="p">[</span><span class="n">isRec</span><span class="p">]))</span>
<span class="k">for</span> <span class="n">band</span> <span class="ow">in</span> <span class="s1">&#39;grz&#39;</span><span class="p">:</span>
    <span class="n">diff</span><span class="p">[</span><span class="n">band</span><span class="o">+</span><span class="s1">&#39;_mag&#39;</span><span class="p">]</span><span class="o">=</span> <span class="n">plots</span><span class="o">.</span><span class="n">flux2mag</span><span class="p">(</span><span class="n">dat</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">band</span><span class="o">+</span><span class="s1">&#39;flux&#39;</span><span class="p">)[</span><span class="n">isRec</span><span class="p">]</span><span class="o">/</span>\
                                      <span class="n">dat</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;mw_transmission_&#39;</span><span class="o">+</span><span class="n">band</span><span class="p">)[</span><span class="n">isRec</span><span class="p">])</span>


<span class="n">diff</span><span class="p">[</span><span class="s1">&#39;delta_rhalf&#39;</span><span class="p">]</span><span class="o">=</span> <span class="n">fwhm_or_rhalf</span><span class="p">[</span><span class="n">isRec</span><span class="p">]</span> <span class="o">-</span> <span class="n">dat</span><span class="o">.</span><span class="n">rhalf</span><span class="p">[</span><span class="n">isRec</span><span class="p">]</span>
<span class="n">diff</span><span class="p">[</span><span class="s1">&#39;delta_e1&#39;</span><span class="p">]</span><span class="o">=</span> <span class="n">e1</span><span class="p">[</span><span class="n">isRec</span><span class="p">]</span> <span class="o">-</span> <span class="n">dat</span><span class="o">.</span><span class="n">e1</span><span class="p">[</span><span class="n">isRec</span><span class="p">]</span>
<span class="n">diff</span><span class="p">[</span><span class="s1">&#39;delta_e2&#39;</span><span class="p">]</span><span class="o">=</span> <span class="n">e2</span><span class="p">[</span><span class="n">isRec</span><span class="p">]</span> <span class="o">-</span> <span class="n">dat</span><span class="o">.</span><span class="n">e1</span><span class="p">[</span><span class="n">isRec</span><span class="p">]</span>
<span class="c1"># Scale</span>
<span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;ra&#39;</span><span class="p">,</span><span class="s1">&#39;dec&#39;</span><span class="p">]:</span>
    <span class="n">diff</span><span class="p">[</span><span class="s1">&#39;delta_&#39;</span><span class="o">+</span><span class="n">key</span><span class="p">]</span><span class="o">*=</span> <span class="mi">3600</span> <span class="c1"># arcsec</span>
<span class="c1"># Add Hue</span>
<span class="n">diff</span><span class="p">[</span><span class="s1">&#39;typ&#39;</span><span class="p">]</span><span class="o">=</span> <span class="n">tractor_type</span><span class="p">[</span><span class="n">isRec</span><span class="p">]</span>

<span class="n">diff_df</span><span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">diff</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [260]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">diff_df</span><span class="o">.</span><span class="n">columns</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>Out[260]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>Index([&#39;allmask_sum&#39;, &#39;anymask_sum&#39;, &#39;avg_num_std&#39;, &#39;delta_dec&#39;, &#39;delta_e1&#39;,
       &#39;delta_e2&#39;, &#39;delta_ra&#39;, &#39;delta_rhalf&#39;, &#39;delta_x&#39;, &#39;delta_y&#39;,
       &#39;fracflux_sum&#39;, &#39;g_mag&#39;, &#39;r_mag&#39;, &#39;typ&#39;, &#39;z_mag&#39;],
      dtype=&#39;object&#39;)
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [189]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">cols</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;avg_num_std&#39;</span><span class="p">,</span><span class="s1">&#39;delta_rhalf&#39;</span><span class="p">,</span><span class="s1">&#39;typ&#39;</span><span class="p">,</span><span class="s1">&#39;delta_e1&#39;</span><span class="p">,</span><span class="s1">&#39;delta_e2&#39;</span><span class="p">]</span>
<span class="n">sns</span><span class="o">.</span><span class="n">pairplot</span><span class="p">(</span><span class="n">diff_df</span><span class="p">[</span><span class="n">cols</span><span class="p">],</span> <span class="n">hue</span><span class="o">=</span><span class="s2">&quot;typ&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>Out[189]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>&lt;seaborn.axisgrid.PairGrid at 0x13172a9b0&gt;
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/nb_obiwan_methods_paper_74_1.png" src="../_images/nb_obiwan_methods_paper_74_1.png" />
</div>
</div>
<div class="system-message">
<p class="system-message-title">System Message: SEVERE/4 (<tt class="docutils">/global/cscratch1/sd/huikong/obiwan_Aug/repos_for_docker/obiwan_webpage/obiwan/doc/nb/obiwan_methods_paper.ipynb</tt>, line 3449)</p>
<p>Title level inconsistent:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Color</span> <span class="n">by</span> <span class="n">exp</span> <span class="ow">or</span> <span class="n">dev</span><span class="p">:</span> <span class="n">dflux</span><span class="o">/</span><span class="n">sigma</span> <span class="n">vs</span><span class="o">.</span> <span class="n">mag</span><span class="p">,</span> <span class="n">delta</span>\<span class="n">_rhalf</span><span class="p">,</span> <span class="n">e1</span><span class="p">,</span> <span class="n">e2</span>
<span class="o">~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [252]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="nb">set</span><span class="p">(</span><span class="n">dat</span><span class="o">.</span><span class="n">tractor_fracflux_g</span><span class="p">[</span><span class="n">dat</span><span class="o">.</span><span class="n">obiwan_mask</span> <span class="o">==</span> <span class="mi">1</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>Out[252]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>{0.0,
 0.0047294269315898418,
 0.0023323663044720888,
 0.0081588653847575188,
 0.0011112581705674529,
 0.00022863196500111371,
 0.0028280213009566069,
 0.030261635780334473,
 0.0059115500189363956,
 0.0083711715415120125,
 0.025556182488799095,
 0.0027173240669071674,
 0.0037926218938082457,
 0.00010892535647144541,
 0.0012100641615688801,
 0.012101290747523308,
 14.269735336303711,
 2.6745290756225586,
 2.8670837879180908,
 3.1662344932556152,
 3.4293971061706543,
 4.0342559814453125,
 4.6869664192199707,
 4.2039799690246582,
 4.6072125434875488,
 5.1494345664978027,
 0.00043466495117172599,
 0.003186654532328248,
 0.00039661111077293754,
 0.016525644809007645,
 0.0072397477924823761,
 0.046174246817827225,
 0.035119015723466873,
 0.00099933159071952105,
 0.04029545933008194,
 0.0039268843829631805,
 0.05319729819893837,
 0.035980585962533951,
 0.015883620828390121,
 7.1345424652099609,
 7.6121649742126465,
 7.8426203727722168,
 7.5551371574401855,
 7.2274575233459473,
 53.890106201171875,
 2.1058113574981689,
 0.0021151273977011442,
 0.48074543476104736,
 0.30374348163604736,
 0.01520820427685976,
 78.014678955078125,
 0.0043114498257637024,
 0.021147154271602631,
 0.0080924537032842636,
 0.0042782332748174667,
 0.014719894155859947,
 -0.016780922189354897,
 0.05286865308880806,
 0.02588401734828949,
 0.032105665653944016,
 0.016524665057659149,
 0.15338337421417236,
 0.031374458223581314,
 0.031712781637907028,
 0.040225639939308167,
 0.24791301786899567,
 0.02515222504734993,
 35.384681701660156,
 0.88722628355026245,
 0.029777966439723969,
 242.52635192871094,
 0.0019409952219575644,
 262.66131591796875,
 0.024800173938274384,
 0.016671650111675262,
 0.11056958884000778,
 0.014150612056255341,
 0.0019752904772758484,
 0.011684291064739227,
 0.023002736270427704,
 0.078789584338665009,
 0.00076079560676589608,
 0.00071176706114783883,
 0.00053090794244781137,
 0.0050068278796970844,
 0.0022040982730686665,
 305.32778930664062,
 0.00079166959039866924,
 0.086347818374633789,
 0.0019182795658707619,
 0.013557636179029942,
 0.0026297206059098244,
 0.006730162538588047,
 0.0058425301685929298,
 0.014439904130995274,
 0.0047968262806534767,
 0.005891451146453619,
 0.27767303586006165,
 0.27765396237373352,
 0.006315404549241066,
 0.017492348328232765,
 0.016349012032151222,
 0.021700674667954445,
 0.017674857750535011,
 0.019980007782578468,
 -0.001210983726195991,
 0.00094040122348815203,
 0.00070836779195815325,
 0.0013671108754351735,
 0.0013050996931269765,
 0.0030812646728008986,
 0.0022382165770977736,
 0.008688594214618206,
 0.0024312986060976982,
 0.008744741789996624,
 0.009035731665790081,
 0.0096628917381167412,
 0.0051619065925478935,
 0.0065440190955996513,
 0.0087470067664980888,
 0.0014299220638349652,
 0.00031275968649424613,
 -0.00023636672995053232,
 0.0034496295265853405,
 0.018878903239965439,
 0.0038034056778997183,
 0.004217144101858139,
 0.057325955480337143,
 0.01572548970580101,
 0.0092544518411159515,
 0.049897190183401108,
 0.016388889402151108,
 0.0014315806329250336,
 0.033767934888601303,
 0.010960932821035385,
 0.060251589864492416,
 0.00030056218383833766,
 1.7589198250789195e-05,
 -7.692537474213168e-05,
 -0.0001087374912458472,
 0.0015342835104092956,
 0.0077529367990791798,
 0.0020579514093697071,
 0.30950009822845459,
 1.197462797164917,
 0.0033193500712513924,
 0.0062030227854847908,
 0.0073475511744618416,
 0.00029207879560999572,
 0.0036139613948762417,
 0.0042140609584748745,
 0.016031883656978607,
 0.3094877302646637,
 0.16868343949317932,
 0.001471834140829742,
 0.015761552378535271,
 0.01629704050719738,
 0.030194340273737907,
 0.0033712964504957199,
 0.011107264086604118,
 0.0031989198178052902,
 0.021881280466914177,
 0.029040036723017693,
 0.00010615983046591282,
 0.0033833535853773355,
 0.0037341269198805094,
 0.0018255526665598154,
 0.0034144560340791941,
 0.00095064961351454258,
 0.0010783302132040262,
 0.0026173295918852091,
 0.0020925367716699839,
 0.00085371383465826511,
 0.0018671773141250014,
 0.0076300934888422489,
 0.0046875313855707645,
 -0.004469127394258976,
 0.0042519858106970787,
 0.014928012154996395,
 0.0015788181917741895,
 0.0032517828512936831,
 0.0011628784704953432,
 0.00068210740573704243,
 0.0077416445128619671,
 0.0073294187895953655,
 0.013896435499191284,
 0.29160904884338379,
 0.45901989936828613,
 0.036918878555297852,
 0.0089933872222900391,
 0.039824843406677246,
 0.12461221218109131,
 0.66359269618988037,
 0.046008467674255371,
 1.3118312358856201,
 0.28300464153289795,
 0.00073404080467298627,
 0.0003850518842227757,
 -0.00016969972057268023,
 -5.7023356930585578e-05,
 0.00065057026222348213,
 0.0050882552750408649,
 0.27581644058227539,
 0.13229990005493164,
 0.0090340087190270424,
 0.0017859647050499916,
 0.0087938020005822182,
 0.0038163824938237667,
 0.003563897218555212,
 0.0054650469683110714,
 0.053335927426815033,
 0.0036839039530605078,
 0.043916255235671997,
 0.016479911282658577,
 0.020323814824223518,
 0.024330439046025276,
 0.0079422611743211746,
 0.004613460972905159,
 0.017116250470280647,
 0.00060978194233030081,
 0.00077674200292676687,
 0.0013749900972470641,
 0.0016377608990296721,
 0.0012549612438306212,
 0.0015874285018071532,
 0.0015750344609841704,
 0.0010878596222028136,
 0.0011326823150739074,
 0.0015051609370857477,
 0.00099216634407639503,
 0.0017347210086882114,
 0.0035908096469938755,
 0.0064539783634245396,
 0.0023453931789845228,
 0.080257952213287354,
 0.0011035714996978641,
 0.015087041072547436,
 0.012988838367164135,
 0.0064075319096446037,
 0.0089156953617930412,
 0.0052636447362601757,
 0.0058414521627128124,
 0.002910226583480835,
 0.017020825296640396,
 0.0005986727774143219,
 0.044127229601144791,
 0.035281065851449966,
 0.017896536737680435,
 0.04097164049744606,
 0.03484821692109108,
 0.0044860877096652985,
 0.032718662172555923,
 0.02830231562256813,
 0.00036116171395406127,
 -0.00060164328897371888,
 0.00012451563088688999,
 0.00022760198044124991,
 -0.0001875789457699284,
 0.00018074888794217259,
 0.00022678148525301367,
 0.0017120135016739368,
 0.0053748381324112415,
 0.091292023658752441,
 1.9477224349975586,
 0.007445906288921833,
 0.0010996805503964424,
 0.015501474030315876,
 0.00036963584716431797,
 0.00056045991368591785,
 0.022613659501075745,
 0.006904741283506155,
 0.005098243709653616,
 0.0026794872246682644,
 0.0052360496483743191,
 0.0015857419930398464,
 0.080714128911495209,
 0.2869049608707428,
 0.027644818648695946,
 0.0018188413232564926,
 0.016170090064406395,
 0.029798692092299461,
 0.015973752364516258,
 0.0020297225564718246,
 0.0021868404000997543,
 0.0060475808568298817,
 0.0019083363004028797,
 0.0058848005719482899,
 0.0045462888665497303,
 0.0040046018548309803,
 0.0060977977700531483,
 0.0034865480847656727,
 0.0039303344674408436,
 0.0068969805724918842,
 0.0059498031623661518,
 0.0019778294954448938,
 0.3974425196647644,
 0.0059730177745223045,
 0.0010543232783675194,
 0.011248267255723476,
 0.016093974933028221,
 0.11903676390647888,
 0.0010947167174890637,
 -4.63393225800246e-05,
 0.11015911400318146,
 0.0038274149410426617,
 0.093342743813991547,
 0.050667725503444672,
 0.00080005801282823086,
 0.099043019115924835,
 0.097706921398639679,
 0.10922742635011673,
 0.061075456440448761,
 0.056689627468585968,
 0.042253859341144562,
 0.074288733303546906,
 0.10062826424837112,
 0.11307228356599808,
 0.018109805881977081,
 0.00046209112042561173,
 -0.00019222631817683578,
 0.00025590375298634171,
 5.6827342632459477e-05,
 0.00085352972382679582,
 0.005917601753026247,
 0.053260203450918198,
 0.038466807454824448,
 0.0025258220266550779,
 0.25306200981140137,
 0.015242338180541992,
 0.0062207961454987526,
 0.014363029040396214,
 0.0099111581221222878,
 0.013448932208120823,
 0.010090448893606663,
 -0.0033141262829303741,
 0.052761923521757126,
 0.19202448427677155,
 0.0058570145629346371,
 1390.4716796875,
 0.0046850680373609066,
 0.01990797370672226,
 0.0012087689246982336,
 0.024300405755639076,
 -0.028416922315955162,
 0.021201202645897865,
 -0.0034608151763677597,
 0.00063397421035915613,
 0.0011263234773650765,
 0.0010269327322021127,
 0.0015313035110011697,
 0.00035687221679836512,
 0.0017186036566272378,
 0.0019791445229202509,
 0.0011617509881034493,
 0.0012025578180328012,
 0.00060522614512592554,
 0.0003415294922888279,
 0.011762420646846294,
 0.0051923650316894054,
 0.0074044126085937023,
 0.0054102796129882336,
 0.011822782456874847,
 0.0023913865443319082,
 0.0038999801035970449,
 0.0017523055430501699,
 0.0042414981871843338,
 0.029894363135099411,
 0.015101205557584763,
 0.017084848135709763,
 0.0043400637805461884,
 0.016909610480070114,
 0.016911160200834274,
 0.046718250960111618,
 0.044167649000883102,
 0.033085953444242477,
 0.05440903827548027,
 0.00067855295492336154,
 0.00062759470893070102,
 0.00085214030696079135,
 0.00066171091748401523,
 0.0007811921532265842,
 0.0001110314842662774,
 0.003018710995092988,
 0.0091750510036945343,
 0.0024213162250816822,
 0.005536374170333147,
 0.0014804794918745756,
 0.0025874569546431303,
 1.1736938953399658,
 0.0082884849980473518,
 0.019760504364967346,
 0.0095151197165250778,
 0.021912289783358574,
 0.018592191860079765,
 0.053238548338413239,
 0.0028793185483664274,
 0.0010713345836848021,
 0.00036361883394420147,
 0.0023425004910677671,
 0.0029079101514071226,
 0.0014166317414492369,
 0.0037662468384951353,
 0.0010903596412390471,
 0.002096664858981967,
 0.0034299909602850676,
 0.0068633542396128178,
 0.0012675139587372541,
 0.0015859219711273909,
 0.052868783473968506,
 0.22200864553451538,
 0.74896711111068726,
 0.013644023798406124,
 0.011906309984624386,
 0.0060466965660452843,
 0.013443036936223507,
 0.0089222630485892296,
 0.00047172213089652359,
 0.091200307011604309,
 0.00073857605457305908,
 0.0057681496255099773,
 0.0076400930993258953,
 0.007065861951559782,
 0.0018466038163751364,
 0.0010328812059015036,
 0.32025143504142761,
 0.072704285383224487,
 0.015745893120765686,
 0.003908887505531311,
 0.070791140198707581,
 0.24327565729618073,
 0.0049486309289932251,
 0.020164504647254944,
 0.057404652237892151,
 0.055869355797767639,
 0.07571817934513092,
 0.14257587492465973,
 0.00077110790880396962,
 0.00059494265588000417,
 0.00081370287807658315,
 -0.0029539091046899557,
 0.031025756150484085,
 0.0025441055186092854,
 0.0023123626597225666,
 0.0039365892298519611,
 0.053199406713247299,
 0.039587382227182388,
 0.01509998831897974,
 0.013834104873239994,
 0.011567340232431889,
 0.011207566596567631,
 0.0086693624034523964,
 0.052469022572040558,
 0.00025778435519896448,
 0.048450961709022522,
 0.0052376105450093746,
 0.0025761439464986324,
 0.0018156708683818579,
 0.017277078703045845,
 0.00058775965590029955,
 0.00060923106502741575,
 0.00078179023694247007,
 0.00076847232412546873,
 -0.00019735388923436403,
 0.0001445085508748889,
 0.00052717409562319517,
 0.0013461419148370624,
 0.00028741813730448484,
 0.0014504686696454883,
 0.00090775347780436277,
 0.099856898188591003,
 0.080813929438591003,
 -0.00052096077706664801,
 0.001601899741217494,
 0.29473596811294556,
 0.39328485727310181,
 0.24674707651138306,
 0.40735346078872681,
 0.015359806828200817,
 0.0037440536543726921,
 0.012263226322829723,
 0.0024165390059351921,
 0.0052093742415308952,
 0.00035794443101622164,
 0.00092948530800640583,
 0.0033822804689407349,
 0.031893327832221985,
 0.0022004577331244946,
 0.0043959352187812328,
 0.0026090701576322317,
 0.00071817240677773952,
 0.37379464507102966,
 0.0019053592113777995,
 0.0053674168884754181,
 0.045046944171190262,
 0.032755155116319656,
 0.031827230006456375,
 0.0050758309662342072,
 0.034843344241380692,
 0.0025995785836130381,
 0.00030044469167478383,
 0.00044642112334258854,
 0.00030270140268839896,
 0.00012977435835637152,
 -0.00037535917363129556,
 0.00034537751344032586,
 0.00047194052604027092,
 0.00044360049651004374,
 -0.00022781229927204549,
 0.00018947248463518918,
 0.15075837075710297,
 0.00039788370486348867,
 0.0046047610230743885,
 0.0053296727128326893,
 0.0016044831136241555,
 0.0025676756631582975,
 0.001302030635997653,
 0.001748093287460506,
 0.017541181296110153,
 0.096169129014015198,
 0.0027568689547479153,
 0.0048528066836297512,
 0.027920564636588097,
 0.017704924568533897,
 0.022664865478873253,
 0.0037981951609253883,
 0.0124600725248456,
 0.013591338880360126,
 0.012363632209599018,
 0.0084264772012829781,
 0.010953743942081928,
 0.0025558667257428169,
 0.0034427950158715248,
 0.0019744271412491798,
 0.011244864203035831,
 0.14291876554489136,
 0.043807931244373322,
 0.085140176117420197,
 0.00038648772169835865,
 0.0022678517270833254,
 0.0061729811131954193,
 0.0034927723463624716,
 0.11030139774084091,
 0.0096649155020713806,
 0.027981184422969818,
 0.089087866246700287,
 0.031308434903621674,
 0.019012473523616791,
 0.012302182614803314,
 0.10105755180120468,
 0.052641414105892181,
 0.0064826235175132751,
 0.009226776659488678,
 0.00094772787997499108,
 0.00080281781265512109,
 -0.012530094943940639,
 0.0011757547035813332,
 0.0024871760979294777,
 0.0051734833978116512,
 0.0027848498430103064,
 0.37327030301094055,
 0.019159520044922829,
 0.020402396097779274,
 0.02310713566839695,
 0.0098933819681406021,
 0.02794262208044529,
 0.00015064515173435211,
 0.024648511782288551,
 0.0021494273096323013,
 0.0018092404352501035,
 0.00035045400727540255,
 -0.00051612674724310637,
 0.00082027644384652376,
 0.0010901737259700894,
 0.00072271109092980623,
 0.0010830584215000272,
 0.0010416927980259061,
 0.0011897060321643949,
 0.0007676354143768549,
 0.0037270246539264917,
 0.0019375183619558811,
 0.0014737572055310011,
 0.0090421987697482109,
 0.0026920391246676445,
 0.0017348707187920809,
 0.0029300260357558727,
 0.0024101543240249157,
 0.0045161056332290173,
 0.063209861516952515,
 0.0016453712014481425,
 0.057715322822332382,
 0.026324298232793808,
 0.0047627948224544525,
 0.019932057708501816,
 0.032249834388494492,
 0.046102907508611679,
 0.041956331580877304,
 0.0083899758756160736,
 0.043861057609319687,
 0.05926981195807457,
 0.00052051170496270061,
 0.00046081020263954997,
 0.00092486216453835368,
 0.16210733354091644,
 0.0059051034040749073,
 0.0046383854933083057,
 -0.0016431466210633516,
 0.0054979296401143074,
 0.0005807848647236824,
 0.0028855402488261461,
 0.007301372941583395,
 0.0012003236915916204,
 0.029028326272964478,
 0.030134588479995728,
 0.0017576086102053523,
 0.0015977304428815842,
 0.021286575123667717,
 0.016234962269663811,
 0.0051231067627668381,
 0.028233615681529045,
 0.012549726292490959,
 0.012518731877207756,
 0.02436467818915844,
 0.0011567596811801195,
 0.0038765196222811937,
 0.0012296561617404222,
 0.001322941156104207,
 0.0034950573462992907,
 0.0036511619109660387,
 0.0014841307420283556,
 0.0012179214973002672,
 0.0011964079458266497,
 -0.0029092791955918074,
 0.0010335580445826054,
 0.0020029679872095585,
 0.01625698059797287,
 0.61544555425643921,
 0.028455197811126709,
 0.01191860344260931,
 0.0083059659227728844,
 0.00093012955039739609,
 0.011532016098499298,
 -0.00024232242139987648,
 0.001630447106435895,
 0.0024394013453274965,
 -0.00050725089386105537,
 0.0065225209109485149,
 0.0047176922671496868,
 0.016423311084508896,
 0.017685975879430771,
 0.0013666821178048849,
 0.26643481850624084,
 0.15599361062049866,
 0.22988715767860413,
 0.28501239418983459,
 0.032191544771194458,
 0.099493294954299927,
 0.046296387910842896,
 0.22548893094062805,
 0.15685299038887024,
 0.15211036801338196,
 0.00063211406813934445,
 0.00091038580285385251,
 0.00036177347647026181,
 -4.1509239963488653e-05,
 0.00028150092111900449,
 0.00070887740002945065,
 0.00048838864313438535,
 -1.8205220840172842e-05,
 0.0051369224674999714,
 0.0050996099598705769,
 0.35522794723510742,
 0.15250349044799805,
 1.9106520414352417,
 1.0761984586715698,
 0.013176680542528629,
 -0.0097925653681159019,
 0.067968614399433136,
 0.0002252406848128885,
 0.0003750122559722513,
 0.0003001264703925699,
 0.029868097975850105,
 0.0013663489371538162,
 0.013994308188557625,
 0.028792830184102058,
 0.001042985706590116,
 0.0016049420228227973,
 0.00044068822171539068,
 0.00093061232473701239,
 0.00020609551575034857,
 0.0014496309449896216,
 -0.00054074323270469904,
 -0.0010003173956647515,
 -0.0007101396331563592,
 0.0017901858082041144,
 0.0011427944991737604,
 0.61169582605361938,
 0.27197414636611938,
 0.084909021854400635,
 0.055787622928619385,
 0.0020646480843424797,
 0.014262857846915722,
 0.0079689649865031242,
 0.066269226372241974,
 0.0004497472255025059,
 0.0027221695054322481,
 0.0011247650254517794,
 0.0028885486535727978,
 0.0071203592233359814,
 0.0054974439553916454,
 0.015909038484096527,
 0.011857237666845322,
 0.11925944685935974,
 0.001609358936548233,
 0.0079528428614139557,
 0.0010258294641971588,
 0.053145322948694229,
 0.052313957363367081,
 0.021258387714624405,
 0.010473284870386124,
 0.035617861896753311,
 0.014233861118555069,
 0.034742031246423721,
 0.00081915355985984206,
 0.00078714959090575576,
 0.00070761091774329543,
 7.3208750109188259e-05,
 -0.00011820341751445085,
 0.0001907237310661003,
 0.0002206470089731738,
 -9.7589872893877327e-05,
 0.000109977598185651,
 0.00067505933111533523,
 0.051858413964509964,
 0.0019867015071213245,
 -0.00011972663924098015,
 0.00057522649876773357,
 0.28498423099517822,
 0.081962227821350098,
 0.14870798587799072,
 0.18240320682525635,
 0.16882288455963135,
 0.013181333430111408,
 0.012166504748165607,
 0.0074415253475308418,
 0.014761094935238361,
 0.0044525908306241035,
 0.032736189663410187,
 -0.0048138597048819065,
 0.00310350744985044,
 0.0030974277760833502,
 0.0016407724469900131,
 0.018796658143401146,
 0.010886048898100853,
 0.0029108873568475246,
 0.0027159205637872219,
 0.0016892640851438046,
 0.0029927878640592098,
 0.0074916272424161434,
 0.0049378960393369198,
 0.0011170892976224422,
 0.0028855926357209682,
 0.0014603263698518276,
 0.0069419867359101772,
 0.0055310935713350773,
 0.010214738547801971,
 0.0018409515032544732,
 0.0014934150967746973,
 0.31871956586837769,
 0.99842613935470581,
 0.0014980685664340854,
 0.0067020123824477196,
 0.0025292104110121727,
 0.01196629460901022,
 0.012815422378480434,
 0.012310094200074673,
 0.02658504992723465,
 0.0079396432265639305,
 0.0003289275337010622,
 0.20118637382984161,
 0.0048866192810237408,
 0.002443424891680479,
 0.0037708203308284283,
 0.0063891331665217876,
 0.1239909753203392,
 0.35305473208427429,
 0.25400230288505554,
 0.20532295107841492,
 0.11995765566825867,
 0.011458314955234528,
 0.04194728285074234,
 0.028075255453586578,
 0.015924490988254547,
 0.015355147421360016,
 0.039179958403110504,
 0.048784412443637848,
 0.031465806066989899,
 0.017843522131443024,
 0.074148572981357574,
 0.051753498613834381,
 0.0004754583933390677,
 0.00050884817028418183,
 0.0008058692910708487,
 0.00088672671699896455,
 0.00069694290868937969,
 0.0034854866098612547,
 0.17501425743103027,
 0.065131902694702148,
 0.1432645320892334,
 0.037188652902841568,
 0.0066090906038880348,
 0.0037728631868958473,
 0.014795192517340183,
 0.00099087599664926529,
 0.0038455808535218239,
 0.023657329380512238,
 0.0037186229601502419,
 0.00028171259327791631,
 0.00024959561415016651,
 0.00039557236596010625,
 0.074181810021400452,
 0.18770338594913483,
 0.10540773719549179,
 0.001326953643001616,
 0.030121544376015663,
 0.01941094733774662,
 0.018657663837075233,
 0.031210998073220253,
 0.0047542843967676163,
 0.015812018886208534,
 -0.016797801479697227,
 0.013601759448647499,
 0.0064567122608423233,
 0.018159607425332069,
 0.0018595695728436112,
 0.0019334793323650956,
 0.0015618555480614305,
 0.00038147869054228067,
 0.0035002848599106073,
 0.0013070531422272325,
 0.0013102419907227159,
 0.0019118316704407334,
 0.00078898819629102945,
 0.00098423066083341837,
 0.0073899277485907078,
 0.055090956389904022,
 0.047507338225841522,
 0.076922468841075897,
 0.010505507700145245,
 0.0021646721288561821,
 0.010454605333507061,
 0.078064508736133575,
 0.11617333441972733,
 0.00011865110718645155,
 0.037719085812568665,
 0.0086663514375686646,
 0.0016222780104726553,
 0.0022456233855336905,
 0.017168562859296799,
 0.027675312012434006,
 0.049289505928754807,
 0.040313523262739182,
 0.034223597496747971,
 0.015525858849287033,
 0.050586860626935959,
 0.052837532013654709,
 0.0068254880607128143,
 0.053075354546308517,
 0.00043041975004598498,
 0.00073085696203634143,
 0.0025506059173494577,
 6.1192367866169661e-05,
 8.2954931713175029e-05,
 -7.6862001151312143e-05,
 0.0032849351409822702,
 0.00074277044041082263,
 0.00036728777922689915,
 0.00011865171109093353,
 0.0073869116604328156,
 0.0036432864144444466,
 0.013848555274307728,
 0.0026235701516270638,
 0.0061208130791783333,
 0.074659951031208038,
 0.00023010998847894371,
 0.0010885572992265224,
 0.0019785368349403143,
 0.01424625888466835,
 0.0059181284159421921,
 0.028597814962267876,
 0.026400191709399223,
 0.017249686643481255,
 0.0014537405222654343,
 0.009897453710436821,
 0.028339488431811333,
 0.012139542028307915,
 0.029326183721423149,
 0.0035466828849166632,
 0.0016987600829452276,
 0.0012922005262225866,
 0.0018069201614707708,
 0.0010061913635581732,
 0.0028131993021816015,
 0.0034155675675719976,
 0.0027186700608581305,
 0.0012218186166137457,
 0.001976711442694068,
 0.061668798327445984,
 0.034943029284477234,
 0.0051121995784342289,
 0.0033064172603189945,
 0.00152360531501472,
 0.010900437831878662,
 0.0074116727337241173,
 0.0056010028347373009,
 0.0037734874058514833,
 0.00026480038650333881,
 0.0020501979161053896,
 0.00050929863937199116,
 0.00092792464420199394,
 0.0039188857190310955,
 0.006652116309851408,
 0.0018542630132287741,
 0.093283340334892273,
 0.10585097968578339,
 0.072786256670951843,
 -0.05875881016254425,
 0.11531548202037811,
 0.043680235743522644,
 0.19103269279003143,
 0.011735245585441589,
 0.17753557860851288,
 0.0022277086973190308,
 0.00089564156951382756,
 -0.00088545697508379817,
 0.00051531550707295537,
 -0.00046582537470385432,
 0.00078057852806523442,
 0.043550360947847366,
 0.0057346527464687824,
 0.14040374755859375,
 1.0130332708358765,
 1.3634963035583496,
 1.4262427091598511,
 6.8024158477783203,
 1.0329034328460693,
 1.8375755548477173,
 1.2911521196365356,
 1.5159057378768921,
 1.069514274597168,
 0.0086323181167244911,
 0.0044170776382088661,
 0.011881486512720585,
 0.013349429704248905,
 -0.010608657263219357,
 0.038454778492450714,
 0.00041957836947403848,
 0.0025827672798186541,
 0.0046467198990285397,
 0.14402297139167786,
 0.005705343559384346,
 0.0085844863206148148,
 0.016995416954159737,
 0.013749824836850166,
 0.0083989966660737991,
 0.020901905372738838,
 0.0010043474612757564,
 0.0015479157445952296,
 0.00099288101773709059,
 0.0012612211285158992,
 0.00069241772871464491,
 0.00056411873083561659,
 0.0014742257772013545,
 0.00098801206331700087,
 0.0014022606192156672,
 0.00087468873243778944,
 0.0025119280908256769,
 0.0074019753374159336,
 0.12028818577528,
 0.001312966225668788,
 0.003213721327483654,
 0.0043179569765925407,
 0.0021978197619318962,
 0.00043893689871765673,
 0.00039761225343681872,
 0.0042526754550635815,
 0.0062162908725440502,
 -1.9167431673849933e-05,
 1.9776414774241857e-05,
 2.5632538381614722e-05,
 2.3725833671051078e-05,
 0.019988346844911575,
 0.035915780812501907,
 0.049676347523927689,
 0.052563238888978958,
 0.024176169186830521,
 0.013807941228151321,
 0.057191777974367142,
 0.018295098096132278,
 0.00084485107799991965,
 0.00051167694618925452,
 ...}
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [263]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">xaxis_band</span><span class="o">=</span><span class="s1">&#39;g&#39;</span>

<span class="n">isEXP</span><span class="o">=</span> <span class="p">(</span><span class="n">diff</span><span class="p">[</span><span class="s1">&#39;typ&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;EXP&#39;</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">diff</span><span class="p">[</span><span class="s1">&#39;typ&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;SIMP&#39;</span><span class="p">)</span>
<span class="n">isDEV</span><span class="o">=</span> <span class="p">(</span><span class="n">diff</span><span class="p">[</span><span class="s1">&#39;typ&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;DEV&#39;</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span><span class="n">axes</span><span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">12</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">hspace</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">bin_minmax</span><span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">g_mag</span><span class="o">=</span><span class="p">(</span><span class="mf">21.5</span><span class="p">,</span><span class="mf">23.5</span><span class="p">),</span>
                 <span class="n">delta_rhalf</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">),</span>
                 <span class="n">delta_e1</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span>
                 <span class="n">delta_e2</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span>
                 <span class="n">fracflux_sum</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">0.2</span><span class="p">,</span><span class="mf">1.5</span><span class="p">)</span>
                <span class="p">)</span>
<span class="k">for</span> <span class="n">ax</span><span class="p">,</span><span class="n">xkey</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">axes</span><span class="p">,</span>
                   <span class="p">[</span><span class="s1">&#39;g_mag&#39;</span><span class="p">,</span><span class="s1">&#39;delta_rhalf&#39;</span><span class="p">,</span><span class="s1">&#39;fracflux_sum&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;anymask_sum&#39;</span><span class="p">,</span><span class="s1">&#39;allmask_sum&#39;</span><span class="p">]):</span>
    <span class="k">for</span> <span class="n">keep</span><span class="p">,</span><span class="n">label</span><span class="p">,</span><span class="n">color</span><span class="p">,</span><span class="n">ls</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">([</span><span class="n">isEXP</span><span class="p">,</span><span class="n">isDEV</span><span class="p">],</span>
                                <span class="p">[</span><span class="s1">&#39;EXP&#39;</span><span class="p">,</span><span class="s1">&#39;DEV&#39;</span><span class="p">],</span>
                                <span class="s1">&#39;bg&#39;</span><span class="p">,</span>
                                <span class="p">[</span><span class="s1">&#39;-&#39;</span><span class="p">,</span><span class="s1">&#39;--&#39;</span><span class="p">]):</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">diff</span><span class="p">[</span><span class="n">xkey</span><span class="p">][</span><span class="n">keep</span><span class="p">],</span><span class="n">diff</span><span class="p">[</span><span class="s1">&#39;avg_num_std&#39;</span><span class="p">][</span><span class="n">keep</span><span class="p">],</span>
                   <span class="n">edgecolor</span><span class="o">=</span><span class="n">color</span><span class="p">,</span><span class="n">s</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mf">2.</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                   <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">bin_minmax</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">xkey</span><span class="p">,</span><span class="bp">None</span><span class="p">):</span>
            <span class="n">binned</span><span class="o">=</span> <span class="n">plots</span><span class="o">.</span><span class="n">bin_up</span><span class="p">(</span><span class="n">diff</span><span class="p">[</span><span class="n">xkey</span><span class="p">][</span><span class="n">keep</span><span class="p">],</span><span class="n">diff</span><span class="p">[</span><span class="s1">&#39;avg_num_std&#39;</span><span class="p">][</span><span class="n">keep</span><span class="p">],</span>
                                 <span class="n">bin_minmax</span><span class="o">=</span><span class="n">bin_minmax</span><span class="p">[</span><span class="n">xkey</span><span class="p">],</span><span class="n">nbins</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">perc</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;q50&#39;</span><span class="p">]:</span> <span class="c1">#,&#39;q25&#39;,&#39;q75&#39;]:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">binned</span><span class="p">[</span><span class="s1">&#39;binc&#39;</span><span class="p">],</span><span class="n">binned</span><span class="p">[</span><span class="n">perc</span><span class="p">],</span><span class="n">c</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="n">ls</span><span class="o">=</span><span class="n">ls</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">bin_minmax</span><span class="p">[</span><span class="n">xkey</span><span class="p">])</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">xkey</span><span class="p">)</span>

<span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>
    <span class="n">axes</span><span class="p">[</span><span class="n">row</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">-</span><span class="mi">30</span><span class="p">,</span><span class="mi">30</span><span class="p">)</span>
<span class="n">leg</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper left&#39;</span><span class="p">,</span><span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;Average[ $\Delta\, Flux\,/\,\sigma$ ] (Tractor - Truth)&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>Out[263]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>&lt;matplotlib.text.Text at 0x139cf7198&gt;
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/nb_obiwan_methods_paper_77_1.png" src="../_images/nb_obiwan_methods_paper_77_1.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [269]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">for</span> <span class="n">keep</span><span class="p">,</span><span class="n">label</span><span class="p">,</span><span class="n">color</span><span class="p">,</span><span class="n">ls</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">([</span><span class="n">isEXP</span><span class="p">,</span><span class="n">isDEV</span><span class="p">],</span>
                            <span class="p">[</span><span class="s1">&#39;EXP&#39;</span><span class="p">,</span><span class="s1">&#39;DEV&#39;</span><span class="p">],</span>
                            <span class="s1">&#39;bg&#39;</span><span class="p">,</span>
                            <span class="p">[</span><span class="s1">&#39;-&#39;</span><span class="p">,</span><span class="s1">&#39;--&#39;</span><span class="p">]):</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">diff</span><span class="p">[</span><span class="s1">&#39;delta_rhalf&#39;</span><span class="p">][</span><span class="n">keep</span><span class="p">],</span><span class="n">diff</span><span class="p">[</span><span class="s1">&#39;avg_num_std&#39;</span><span class="p">][</span><span class="n">keep</span><span class="p">],</span>
               <span class="n">edgecolor</span><span class="o">=</span><span class="n">color</span><span class="p">,</span><span class="n">s</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mf">2.</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span>
               <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>Out[269]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>(-10, 10)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/nb_obiwan_methods_paper_78_1.png" src="../_images/nb_obiwan_methods_paper_78_1.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [271]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">sns</span><span class="o">.</span><span class="n">distplot</span><span class="p">(</span><span class="n">fwhm_or_rhalf</span><span class="p">[</span><span class="n">isRec</span><span class="p">][</span><span class="n">isEXP</span><span class="p">])</span> <span class="c1"># - dat.rhalf[isRec]</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>Out[271]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>&lt;matplotlib.axes._subplots.AxesSubplot at 0x13a4f47b8&gt;
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/nb_obiwan_methods_paper_79_1.png" src="../_images/nb_obiwan_methods_paper_79_1.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [247]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">sns</span><span class="o">.</span><span class="n">distplot</span><span class="p">(</span><span class="n">diff</span><span class="p">[</span><span class="s1">&#39;delta_rhalf&#39;</span><span class="p">][</span><span class="n">isEXP</span><span class="p">])</span>
<span class="n">sns</span><span class="o">.</span><span class="n">distplot</span><span class="p">(</span><span class="n">diff</span><span class="p">[</span><span class="s1">&#39;delta_rhalf&#39;</span><span class="p">][</span><span class="n">isDEV</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>Out[247]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>(-10, 10)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/nb_obiwan_methods_paper_80_1.png" src="../_images/nb_obiwan_methods_paper_80_1.png" />
</div>
</div>
</div>
<div class="section" id="Compare-to-straigth-truth-and-measured-quanities">
<h1>Compare to straigth truth and measured quanities<a class="headerlink" href="#Compare-to-straigth-truth-and-measured-quanities" title="Permalink to this headline">Â¶</a></h1>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [181]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">d</span><span class="o">=</span><span class="p">{}</span>

<span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;ra&#39;</span><span class="p">,</span><span class="s1">&#39;dec&#39;</span><span class="p">]:</span>
    <span class="n">d</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">=</span> <span class="n">dat</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">)[</span><span class="n">isRec</span><span class="p">]</span>
<span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="s1">&#39;xy&#39;</span><span class="p">:</span>
    <span class="n">d</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">=</span> <span class="n">dat</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">)[</span><span class="n">isRec</span><span class="p">]</span>
<span class="c1"># More complicated quantities</span>
<span class="n">d</span><span class="p">[</span><span class="s1">&#39;avg_num_std&#39;</span><span class="p">]</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">([(</span><span class="n">dat</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;tractor_flux_&#39;</span><span class="o">+</span><span class="n">band</span><span class="p">)[</span><span class="n">isRec</span><span class="p">]</span> <span class="o">-</span> <span class="n">dat</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">band</span><span class="o">+</span><span class="s1">&#39;flux&#39;</span><span class="p">)[</span><span class="n">isRec</span><span class="p">])</span><span class="o">*</span>\
                             <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">dat</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;tractor_flux_ivar_&#39;</span><span class="o">+</span><span class="n">band</span><span class="p">)[</span><span class="n">isRec</span><span class="p">])</span>
                            <span class="k">for</span> <span class="n">band</span> <span class="ow">in</span> <span class="s1">&#39;grz&#39;</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="k">assert</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;avg_num_std&#39;</span><span class="p">])</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">dat</span><span class="p">[</span><span class="n">isRec</span><span class="p">]))</span>
<span class="c1">#for band in &#39;grz&#39;:</span>
<span class="c1">#    diff[&#39;num_stddev_&#39;+band]= (dat.get(&#39;tractor_flux_&#39;+band)[isRec] - dat.get(band+&#39;flux&#39;)[isRec])*\</span>
<span class="c1">#                               np.sqrt(dat.get(&#39;tractor_flux_ivar_&#39;+band)[isRec])</span>

<span class="n">d</span><span class="p">[</span><span class="s1">&#39;rhalf&#39;</span><span class="p">]</span><span class="o">=</span> <span class="n">dat</span><span class="o">.</span><span class="n">rhalf</span><span class="p">[</span><span class="n">isRec</span><span class="p">]</span>
<span class="n">d</span><span class="p">[</span><span class="s1">&#39;e1&#39;</span><span class="p">]</span><span class="o">=</span> <span class="n">dat</span><span class="o">.</span><span class="n">e1</span><span class="p">[</span><span class="n">isRec</span><span class="p">]</span>
<span class="n">d</span><span class="p">[</span><span class="s1">&#39;e2&#39;</span><span class="p">]</span><span class="o">=</span> <span class="n">dat</span><span class="o">.</span><span class="n">e1</span><span class="p">[</span><span class="n">isRec</span><span class="p">]</span>
<span class="c1"># Scale</span>
<span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;ra&#39;</span><span class="p">,</span><span class="s1">&#39;dec&#39;</span><span class="p">]:</span>
    <span class="n">d</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">*=</span> <span class="mi">3600</span> <span class="c1"># arcsec</span>
<span class="c1"># Add Hue</span>
<span class="n">d</span><span class="p">[</span><span class="s1">&#39;typ&#39;</span><span class="p">]</span><span class="o">=</span> <span class="n">tractor_type</span><span class="p">[</span><span class="n">isRec</span><span class="p">]</span>

<span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">d</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;avg_num_std&#39;</span><span class="p">]:</span>
        <span class="n">d</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="n">key</span><span class="p">])</span><span class="o">.</span><span class="n">byteswap</span><span class="p">()</span><span class="o">.</span><span class="n">newbyteorder</span><span class="p">()</span>

<span class="n">d</span><span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [179]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">d</span><span class="o">.</span><span class="n">columns</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>Out[179]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>Index([&#39;avg_num_std&#39;, &#39;dec&#39;, &#39;e1&#39;, &#39;e2&#39;, &#39;ra&#39;, &#39;rhalf&#39;, &#39;typ&#39;, &#39;x&#39;, &#39;y&#39;], dtype=&#39;object&#39;)
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [182]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">cols</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;avg_num_std&#39;</span><span class="p">,</span><span class="s1">&#39;rhalf&#39;</span><span class="p">,</span><span class="s1">&#39;typ&#39;</span><span class="p">,</span><span class="s1">&#39;e1&#39;</span><span class="p">,</span><span class="s1">&#39;e2&#39;</span><span class="p">]</span>
<span class="n">sns</span><span class="o">.</span><span class="n">pairplot</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="n">cols</span><span class="p">],</span> <span class="n">hue</span><span class="o">=</span><span class="s2">&quot;typ&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>Out[182]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>&lt;seaborn.axisgrid.PairGrid at 0x13092c630&gt;
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/nb_obiwan_methods_paper_84_1.png" src="../_images/nb_obiwan_methods_paper_84_1.png" />
</div>
</div>
<div class="system-message">
<p class="system-message-title">System Message: SEVERE/4 (<tt class="docutils">/global/cscratch1/sd/huikong/obiwan_Aug/repos_for_docker/obiwan_webpage/obiwan/doc/nb/obiwan_methods_paper.ipynb</tt>, line 4675)</p>
<p>Title level inconsistent:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">delta</span> <span class="n">Flux</span><span class="o">/</span><span class="n">err</span>\<span class="n">_estim</span> <span class="n">vs</span><span class="o">.</span> <span class="n">mag</span><span class="p">,</span> <span class="k">with</span> <span class="n">q25</span><span class="p">,</span><span class="mi">50</span><span class="p">,</span><span class="mi">75</span> <span class="n">lines</span>
<span class="o">~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [70]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">i</span><span class="o">=</span> <span class="n">dat</span><span class="o">.</span><span class="n">obiwan_mask</span> <span class="o">==</span> <span class="mi">1</span>
<span class="c1">#truth= plots.flux2mag(dat.gflux[i]/dat.mw_transmission_g[i])</span>
<span class="c1">#meas= plots.flux2mag(dat.tractor_flux_g[i]/dat.tractor_mw_transmission_g[i])</span>

<span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">hspace</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
<span class="k">for</span> <span class="n">iax</span><span class="p">,</span><span class="n">band</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="s1">&#39;grz&#39;</span><span class="p">):</span>
    <span class="n">x</span><span class="o">=</span> <span class="n">plots</span><span class="o">.</span><span class="n">flux2mag</span><span class="p">(</span><span class="n">dat</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">band</span><span class="o">+</span><span class="s1">&#39;flux&#39;</span><span class="p">)[</span><span class="n">i</span><span class="p">]</span><span class="o">/</span>\
                      <span class="n">dat</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;mw_transmission_&#39;</span><span class="o">+</span><span class="n">band</span><span class="p">)[</span><span class="n">i</span><span class="p">])</span>
    <span class="n">y</span><span class="o">=</span> <span class="p">(</span><span class="n">dat</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;tractor_flux_&#39;</span><span class="o">+</span><span class="n">band</span><span class="p">)[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">dat</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">band</span><span class="o">+</span><span class="s1">&#39;flux&#39;</span><span class="p">)[</span><span class="n">i</span><span class="p">])</span><span class="o">*</span>\
        <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">dat</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;tractor_flux_ivar_&#39;</span><span class="o">+</span><span class="n">band</span><span class="p">)[</span><span class="n">i</span><span class="p">])</span>
    <span class="n">ax</span><span class="p">[</span><span class="n">iax</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span>
                    <span class="n">s</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mf">1.</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
                    <span class="n">label</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">band</span><span class="p">)</span>
    <span class="n">binned</span><span class="o">=</span> <span class="n">plots</span><span class="o">.</span><span class="n">bin_up</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span> <span class="n">bin_minmax</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span><span class="mi">25</span><span class="p">),</span><span class="n">nbins</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">perc</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;q25&#39;</span><span class="p">,</span><span class="s1">&#39;q50&#39;</span><span class="p">,</span><span class="s1">&#39;q75&#39;</span><span class="p">]:</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">iax</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">binned</span><span class="p">[</span><span class="s1">&#39;binc&#39;</span><span class="p">],</span><span class="n">binned</span><span class="p">[</span><span class="n">perc</span><span class="p">],</span><span class="n">c</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>

<span class="k">for</span> <span class="n">iax</span><span class="p">,</span><span class="n">band</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="s1">&#39;grz&#39;</span><span class="p">):</span>
    <span class="n">ax</span><span class="p">[</span><span class="n">iax</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper right&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="n">iax</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span><span class="mi">5</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\Delta\, Flux\,/\,\sigma$ (Tractor - Truth)&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Sky causing offset?&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;mag (AB)&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>Out[70]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>&lt;matplotlib.text.Text at 0x120ae4d68&gt;
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/nb_obiwan_methods_paper_86_1.png" src="../_images/nb_obiwan_methods_paper_86_1.png" />
</div>
</div>
<div class="system-message">
<p class="system-message-title">System Message: SEVERE/4 (<tt class="docutils">/global/cscratch1/sd/huikong/obiwan_Aug/repos_for_docker/obiwan_webpage/obiwan/doc/nb/obiwan_methods_paper.ipynb</tt>, line 4726)</p>
<p>Title level inconsistent:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">delta</span> <span class="n">Flux</span><span class="o">/</span><span class="n">err</span>\<span class="n">_estim</span> <span class="n">vs</span><span class="o">.</span> <span class="n">mag</span> <span class="k">for</span> <span class="n">a</span> <span class="n">Single</span> <span class="n">band</span> <span class="mi">4</span> <span class="n">panels</span> <span class="k">for</span> <span class="n">PSF</span><span class="p">,</span> <span class="n">SIMP</span> <span class="ow">or</span> <span class="n">REX</span><span class="p">,</span> <span class="n">EXP</span><span class="p">,</span> <span class="n">COMP</span>
<span class="o">~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [110]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">band</span><span class="o">=</span><span class="s1">&#39;g&#39;</span>

<span class="n">isRec</span><span class="o">=</span> <span class="n">dat</span><span class="o">.</span><span class="n">obiwan_mask</span> <span class="o">==</span> <span class="mi">1</span>
<span class="c1"># TYPES= &#39;psf simp exp dev comp rex&#39;.split(&#39; &#39;)</span>
<span class="n">tractor_type</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">char</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="n">dat</span><span class="o">.</span><span class="n">tractor_type</span><span class="p">)</span>
<span class="c1"># TYPES= set(tractor_type)</span>
<span class="c1"># print(TYPES)</span>
<span class="n">TYPES</span><span class="o">=</span> <span class="s1">&#39;psf simp exp dev&#39;</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
<span class="c1"># print(types)</span>
<span class="n">isType</span><span class="o">=</span><span class="p">{}</span>
<span class="k">for</span> <span class="n">typ</span> <span class="ow">in</span> <span class="n">TYPES</span><span class="p">:</span>
    <span class="n">isType</span><span class="p">[</span><span class="n">typ</span><span class="p">]</span><span class="o">=</span> <span class="n">tractor_type</span> <span class="o">==</span> <span class="n">typ</span>
<span class="c1">#isType=dict(typ= tractor_type == typ</span>
<span class="c1">#            for typ in set(tractor_type))</span>
<span class="c1">#truth= plots.flux2mag(dat.gflux[i]/dat.mw_transmission_g[i])</span>
<span class="c1">#meas= plots.flux2mag(dat.tractor_flux_g[i]/dat.tractor_mw_transmission_g[i])</span>

<span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">hspace</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span><span class="n">wspace</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">cnt</span><span class="o">=-</span><span class="mi">1</span>
<span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
        <span class="n">cnt</span><span class="o">+=</span><span class="mi">1</span>
        <span class="n">typ</span><span class="o">=</span> <span class="n">TYPES</span><span class="p">[</span><span class="n">cnt</span><span class="p">]</span>
        <span class="n">i</span><span class="o">=</span> <span class="p">(</span><span class="n">isRec</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">isType</span><span class="p">[</span><span class="n">typ</span><span class="p">])</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">dat</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">x</span><span class="o">=</span> <span class="n">plots</span><span class="o">.</span><span class="n">flux2mag</span><span class="p">(</span><span class="n">dat</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">band</span><span class="o">+</span><span class="s1">&#39;flux&#39;</span><span class="p">)[</span><span class="n">i</span><span class="p">]</span><span class="o">/</span>\
                              <span class="n">dat</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;mw_transmission_&#39;</span><span class="o">+</span><span class="n">band</span><span class="p">)[</span><span class="n">i</span><span class="p">])</span>
            <span class="n">y</span><span class="o">=</span> <span class="p">(</span><span class="n">dat</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;tractor_flux_&#39;</span><span class="o">+</span><span class="n">band</span><span class="p">)[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">dat</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">band</span><span class="o">+</span><span class="s1">&#39;flux&#39;</span><span class="p">)[</span><span class="n">i</span><span class="p">])</span><span class="o">*</span>\
                <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">dat</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;tractor_flux_ivar_&#39;</span><span class="o">+</span><span class="n">band</span><span class="p">)[</span><span class="n">i</span><span class="p">])</span>
            <span class="n">ax</span><span class="p">[</span><span class="n">row</span><span class="p">,</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span>
                                <span class="n">s</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mf">2.</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">binned</span><span class="o">=</span> <span class="n">plots</span><span class="o">.</span><span class="n">bin_up</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span> <span class="n">bin_minmax</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span><span class="mi">25</span><span class="p">),</span><span class="n">nbins</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">perc</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;q25&#39;</span><span class="p">,</span><span class="s1">&#39;q50&#39;</span><span class="p">,</span><span class="s1">&#39;q75&#39;</span><span class="p">]:</span>
                <span class="n">ax</span><span class="p">[</span><span class="n">row</span><span class="p">,</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">binned</span><span class="p">[</span><span class="s1">&#39;binc&#39;</span><span class="p">],</span><span class="n">binned</span><span class="p">[</span><span class="n">perc</span><span class="p">],</span><span class="n">c</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>

            <span class="n">plots</span><span class="o">.</span><span class="n">mytext</span><span class="p">(</span><span class="n">ax</span><span class="p">[</span><span class="n">row</span><span class="p">,</span><span class="n">col</span><span class="p">],</span><span class="mf">0.01</span><span class="p">,</span><span class="mf">0.9</span><span class="p">,</span><span class="n">typ</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
            <span class="n">ax</span><span class="p">[</span><span class="n">row</span><span class="p">,</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">)</span>

<span class="c1">#leg=ax[0].legend(loc=(0,1.01),ncol=3,markerscale=3)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\Delta\, Flux\,/\,\sigma$ (Tractor - Truth)&#39;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> (AB)&#39;</span> <span class="o">%</span> <span class="n">band</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/nb_obiwan_methods_paper_88_0.png" src="../_images/nb_obiwan_methods_paper_88_0.png" />
</div>
</div>
<div class="system-message">
<p class="system-message-title">System Message: SEVERE/4 (<tt class="docutils">/global/cscratch1/sd/huikong/obiwan_Aug/repos_for_docker/obiwan_webpage/obiwan/doc/nb/obiwan_methods_paper.ipynb</tt>, line 4789)</p>
<p>Title level inconsistent:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">q50</span> <span class="n">filled</span> <span class="n">q25</span><span class="o">-</span><span class="mi">75</span> <span class="n">of</span> <span class="n">delta</span> <span class="n">Flux</span><span class="o">/</span><span class="n">err</span>\<span class="n">_estim</span> <span class="n">vs</span><span class="o">.</span> <span class="n">mag</span> <span class="k">for</span> <span class="n">each</span> <span class="n">band</span><span class="p">,</span> <span class="mi">1</span> <span class="n">panel</span> <span class="n">per</span> <span class="n">PSF</span><span class="p">,</span> <span class="n">SIMP</span> <span class="ow">or</span> <span class="n">REX</span><span class="p">,</span> <span class="n">EXP</span><span class="p">,</span> <span class="n">DEV</span>
<span class="o">~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [112]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>plt.fill_between<span class="o">?</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [119]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">isRec</span><span class="o">=</span> <span class="n">dat</span><span class="o">.</span><span class="n">obiwan_mask</span> <span class="o">==</span> <span class="mi">1</span>
<span class="c1"># TYPES= &#39;psf simp exp dev comp rex&#39;.split(&#39; &#39;)</span>
<span class="n">tractor_type</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">char</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="n">dat</span><span class="o">.</span><span class="n">tractor_type</span><span class="p">)</span>
<span class="c1"># TYPES= set(tractor_type)</span>
<span class="c1"># print(TYPES)</span>
<span class="n">TYPES</span><span class="o">=</span> <span class="s1">&#39;psf simp exp dev&#39;</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
<span class="c1"># print(types)</span>
<span class="n">isType</span><span class="o">=</span><span class="p">{}</span>
<span class="k">for</span> <span class="n">typ</span> <span class="ow">in</span> <span class="n">TYPES</span><span class="p">:</span>
    <span class="n">isType</span><span class="p">[</span><span class="n">typ</span><span class="p">]</span><span class="o">=</span> <span class="n">tractor_type</span> <span class="o">==</span> <span class="n">typ</span>
<span class="c1">#isType=dict(typ= tractor_type == typ</span>
<span class="c1">#            for typ in set(tractor_type))</span>
<span class="c1">#truth= plots.flux2mag(dat.gflux[i]/dat.mw_transmission_g[i])</span>
<span class="c1">#meas= plots.flux2mag(dat.tractor_flux_g[i]/dat.tractor_mw_transmission_g[i])</span>

<span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">hspace</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span><span class="n">wspace</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">cnt</span><span class="o">=-</span><span class="mi">1</span>
<span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
        <span class="n">cnt</span><span class="o">+=</span><span class="mi">1</span>
        <span class="n">typ</span><span class="o">=</span> <span class="n">TYPES</span><span class="p">[</span><span class="n">cnt</span><span class="p">]</span>
        <span class="n">i</span><span class="o">=</span> <span class="p">(</span><span class="n">isRec</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">isType</span><span class="p">[</span><span class="n">typ</span><span class="p">])</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">dat</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">band</span><span class="p">,</span><span class="n">color</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="s1">&#39;grz&#39;</span><span class="p">,</span><span class="s1">&#39;bgr&#39;</span><span class="p">):</span>
                <span class="n">x</span><span class="o">=</span> <span class="n">plots</span><span class="o">.</span><span class="n">flux2mag</span><span class="p">(</span><span class="n">dat</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">band</span><span class="o">+</span><span class="s1">&#39;flux&#39;</span><span class="p">)[</span><span class="n">i</span><span class="p">]</span><span class="o">/</span>\
                                  <span class="n">dat</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;mw_transmission_&#39;</span><span class="o">+</span><span class="n">band</span><span class="p">)[</span><span class="n">i</span><span class="p">])</span>
                <span class="n">y</span><span class="o">=</span> <span class="p">(</span><span class="n">dat</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;tractor_flux_&#39;</span><span class="o">+</span><span class="n">band</span><span class="p">)[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">dat</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">band</span><span class="o">+</span><span class="s1">&#39;flux&#39;</span><span class="p">)[</span><span class="n">i</span><span class="p">])</span><span class="o">*</span>\
                    <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">dat</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;tractor_flux_ivar_&#39;</span><span class="o">+</span><span class="n">band</span><span class="p">)[</span><span class="n">i</span><span class="p">])</span>
    <span class="c1">#             ax[row,col].scatter(x,y,edgecolor=&#39;k&#39;,</span>
    <span class="c1">#                                 s=10,c=&#39;none&#39;,lw=2.,alpha=1)</span>
                <span class="n">binned</span><span class="o">=</span> <span class="n">plots</span><span class="o">.</span><span class="n">bin_up</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span> <span class="n">bin_minmax</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span><span class="mi">25</span><span class="p">),</span><span class="n">nbins</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
                <span class="n">ax</span><span class="p">[</span><span class="n">row</span><span class="p">,</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">binned</span><span class="p">[</span><span class="s1">&#39;binc&#39;</span><span class="p">],</span><span class="n">binned</span><span class="p">[</span><span class="s1">&#39;q50&#39;</span><span class="p">],</span><span class="n">c</span><span class="o">=</span><span class="n">color</span><span class="p">,</span>
                                 <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="n">band</span><span class="p">)</span>
                <span class="n">ax</span><span class="p">[</span><span class="n">row</span><span class="p">,</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">binned</span><span class="p">[</span><span class="s1">&#39;binc&#39;</span><span class="p">],</span>
                                         <span class="n">binned</span><span class="p">[</span><span class="s1">&#39;q25&#39;</span><span class="p">],</span><span class="n">binned</span><span class="p">[</span><span class="s1">&#39;q75&#39;</span><span class="p">],</span>
                                         <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>

            <span class="n">plots</span><span class="o">.</span><span class="n">mytext</span><span class="p">(</span><span class="n">ax</span><span class="p">[</span><span class="n">row</span><span class="p">,</span><span class="n">col</span><span class="p">],</span><span class="mf">0.01</span><span class="p">,</span><span class="mf">0.9</span><span class="p">,</span><span class="n">typ</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
            <span class="n">ax</span><span class="p">[</span><span class="n">row</span><span class="p">,</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">)</span>

<span class="n">leg</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="p">(</span><span class="mf">0.3</span><span class="p">,</span><span class="mf">0.8</span><span class="p">),</span><span class="n">ncol</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">13</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\Delta\, Flux\,/\,\sigma$ (Tractor - Truth)&#39;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> (AB)&#39;</span> <span class="o">%</span> <span class="n">band</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/nb_obiwan_methods_paper_91_0.png" src="../_images/nb_obiwan_methods_paper_91_0.png" />
</div>
</div>
<div class="system-message">
<p class="system-message-title">System Message: SEVERE/4 (<tt class="docutils">/global/cscratch1/sd/huikong/obiwan_Aug/repos_for_docker/obiwan_webpage/obiwan/doc/nb/obiwan_methods_paper.ipynb</tt>, line 4862)</p>
<p>Title level inconsistent:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">delta</span> <span class="n">Flux</span><span class="o">/</span><span class="n">err</span>\<span class="n">_estim</span> <span class="n">vs</span><span class="o">.</span> <span class="n">mag</span> <span class="n">but</span> <span class="n">ADD</span> <span class="k">for</span> <span class="nb">all</span> <span class="n">three</span> <span class="n">bands</span><span class="p">,</span> <span class="n">so</span> <span class="k">if</span> <span class="n">tractor</span> <span class="n">wrong</span> <span class="n">by</span> <span class="mi">2</span> <span class="n">std</span> <span class="n">dev</span> <span class="ow">in</span> <span class="nb">all</span> <span class="n">bands</span> <span class="n">would</span> <span class="n">have</span> <span class="n">a</span> <span class="o">+</span><span class="mi">6</span> <span class="n">on</span> <span class="n">the</span> <span class="n">plot</span><span class="p">,</span> <span class="n">one</span> <span class="n">panel</span> <span class="k">for</span> <span class="n">each</span> <span class="n">PSF</span><span class="p">,</span> <span class="n">SIMP</span> <span class="ow">or</span> <span class="n">REX</span><span class="p">,</span> <span class="n">EXP</span><span class="p">,</span> <span class="n">COMP</span>
<span class="o">~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>
</pre></div>
</div>
</div>
<div class="system-message">
<p class="system-message-title">System Message: SEVERE/4 (<tt class="docutils">/global/cscratch1/sd/huikong/obiwan_Aug/repos_for_docker/obiwan_webpage/obiwan/doc/nb/obiwan_methods_paper.ipynb</tt>, line 4865)</p>
<p>Title level inconsistent:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">have</span> <span class="n">to</span> <span class="n">choose</span> <span class="n">band</span> <span class="n">to</span> <span class="n">plot</span> <span class="n">mag</span> <span class="n">of</span> <span class="n">on</span> <span class="n">the</span> <span class="n">xaxis</span>
<span class="o">~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [126]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">xaxis_band</span><span class="o">=</span><span class="s1">&#39;g&#39;</span>

<span class="n">isRec</span><span class="o">=</span> <span class="n">dat</span><span class="o">.</span><span class="n">obiwan_mask</span> <span class="o">==</span> <span class="mi">1</span>
<span class="c1"># TYPES= &#39;psf simp exp dev comp rex&#39;.split(&#39; &#39;)</span>
<span class="n">tractor_type</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">char</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="n">dat</span><span class="o">.</span><span class="n">tractor_type</span><span class="p">)</span>
<span class="c1"># TYPES= set(tractor_type)</span>
<span class="c1"># print(TYPES)</span>
<span class="n">TYPES</span><span class="o">=</span> <span class="s1">&#39;psf simp exp dev&#39;</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
<span class="c1"># print(types)</span>
<span class="n">isType</span><span class="o">=</span><span class="p">{}</span>
<span class="k">for</span> <span class="n">typ</span> <span class="ow">in</span> <span class="n">TYPES</span><span class="p">:</span>
    <span class="n">isType</span><span class="p">[</span><span class="n">typ</span><span class="p">]</span><span class="o">=</span> <span class="n">tractor_type</span> <span class="o">==</span> <span class="n">typ</span>
<span class="c1">#isType=dict(typ= tractor_type == typ</span>
<span class="c1">#            for typ in set(tractor_type))</span>
<span class="c1">#truth= plots.flux2mag(dat.gflux[i]/dat.mw_transmission_g[i])</span>
<span class="c1">#meas= plots.flux2mag(dat.tractor_flux_g[i]/dat.tractor_mw_transmission_g[i])</span>

<span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">hspace</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span><span class="n">wspace</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">cnt</span><span class="o">=-</span><span class="mi">1</span>
<span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
        <span class="n">cnt</span><span class="o">+=</span><span class="mi">1</span>
        <span class="n">typ</span><span class="o">=</span> <span class="n">TYPES</span><span class="p">[</span><span class="n">cnt</span><span class="p">]</span>
        <span class="n">i</span><span class="o">=</span> <span class="p">(</span><span class="n">isRec</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">isType</span><span class="p">[</span><span class="n">typ</span><span class="p">])</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">dat</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">x</span><span class="o">=</span> <span class="n">plots</span><span class="o">.</span><span class="n">flux2mag</span><span class="p">(</span><span class="n">dat</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">xaxis_band</span><span class="o">+</span><span class="s1">&#39;flux&#39;</span><span class="p">)[</span><span class="n">i</span><span class="p">]</span><span class="o">/</span>\
                                      <span class="n">dat</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;mw_transmission_&#39;</span><span class="o">+</span><span class="n">xaxis_band</span><span class="p">)[</span><span class="n">i</span><span class="p">])</span>
            <span class="n">y</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">([(</span><span class="n">dat</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;tractor_flux_&#39;</span><span class="o">+</span><span class="n">band</span><span class="p">)[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">dat</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">band</span><span class="o">+</span><span class="s1">&#39;flux&#39;</span><span class="p">)[</span><span class="n">i</span><span class="p">])</span><span class="o">*</span>\
                         <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">dat</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;tractor_flux_ivar_&#39;</span><span class="o">+</span><span class="n">band</span><span class="p">)[</span><span class="n">i</span><span class="p">])</span>
                        <span class="k">for</span> <span class="n">band</span> <span class="ow">in</span> <span class="s1">&#39;grz&#39;</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="k">assert</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">dat</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
            <span class="n">ax</span><span class="p">[</span><span class="n">row</span><span class="p">,</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span>
                                <span class="n">s</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mf">2.</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">binned</span><span class="o">=</span> <span class="n">plots</span><span class="o">.</span><span class="n">bin_up</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span> <span class="n">bin_minmax</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span><span class="mi">25</span><span class="p">),</span><span class="n">nbins</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">perc</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;q25&#39;</span><span class="p">,</span><span class="s1">&#39;q50&#39;</span><span class="p">,</span><span class="s1">&#39;q75&#39;</span><span class="p">]:</span>
                <span class="n">ax</span><span class="p">[</span><span class="n">row</span><span class="p">,</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">binned</span><span class="p">[</span><span class="s1">&#39;binc&#39;</span><span class="p">],</span><span class="n">binned</span><span class="p">[</span><span class="n">perc</span><span class="p">],</span><span class="n">c</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>

            <span class="n">plots</span><span class="o">.</span><span class="n">mytext</span><span class="p">(</span><span class="n">ax</span><span class="p">[</span><span class="n">row</span><span class="p">,</span><span class="n">col</span><span class="p">],</span><span class="mf">0.01</span><span class="p">,</span><span class="mf">0.9</span><span class="p">,</span><span class="n">typ</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
            <span class="n">ax</span><span class="p">[</span><span class="n">row</span><span class="p">,</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">)</span>

<span class="c1">#leg=ax[0].legend(loc=(0,1.01),ncol=3,markerscale=3)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;Average[ $\Delta\, Flux\,/\,\sigma$ ] (Tractor - Truth)&#39;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> (AB)&#39;</span> <span class="o">%</span> <span class="n">xaxis_band</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/nb_obiwan_methods_paper_93_0.png" src="../_images/nb_obiwan_methods_paper_93_0.png" />
</div>
</div>
<div class="system-message">
<p class="system-message-title">System Message: SEVERE/4 (<tt class="docutils">/global/cscratch1/sd/huikong/obiwan_Aug/repos_for_docker/obiwan_webpage/obiwan/doc/nb/obiwan_methods_paper.ipynb</tt>, line 4930)</p>
<p>Title level inconsistent:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Ditto</span> <span class="n">above</span> <span class="k">except</span> <span class="n">draw</span> <span class="n">median</span> <span class="n">lines</span> <span class="k">for</span> <span class="nb">all</span> <span class="n">TYPES</span> <span class="n">on</span> <span class="n">same</span> <span class="n">panel</span><span class="p">,</span> <span class="ow">and</span> <span class="n">different</span> <span class="n">panel</span> <span class="k">for</span> <span class="n">xaxis</span>\<span class="n">_band</span> <span class="ow">in</span> <span class="n">grz</span>
<span class="o">~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [132]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">isRec</span><span class="o">=</span> <span class="n">dat</span><span class="o">.</span><span class="n">obiwan_mask</span> <span class="o">==</span> <span class="mi">1</span>
<span class="c1"># TYPES= &#39;psf simp exp dev comp rex&#39;.split(&#39; &#39;)</span>
<span class="n">tractor_type</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">char</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="n">dat</span><span class="o">.</span><span class="n">tractor_type</span><span class="p">)</span>
<span class="c1"># TYPES= set(tractor_type)</span>
<span class="c1"># print(TYPES)</span>
<span class="n">TYPES</span><span class="o">=</span> <span class="s1">&#39;psf simp exp dev&#39;</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
<span class="c1"># print(types)</span>
<span class="n">isType</span><span class="o">=</span><span class="p">{}</span>
<span class="k">for</span> <span class="n">typ</span> <span class="ow">in</span> <span class="n">TYPES</span><span class="p">:</span>
    <span class="n">isType</span><span class="p">[</span><span class="n">typ</span><span class="p">]</span><span class="o">=</span> <span class="n">tractor_type</span> <span class="o">==</span> <span class="n">typ</span>
<span class="c1">#isType=dict(typ= tractor_type == typ</span>
<span class="c1">#            for typ in set(tractor_type))</span>
<span class="c1">#truth= plots.flux2mag(dat.gflux[i]/dat.mw_transmission_g[i])</span>
<span class="c1">#meas= plots.flux2mag(dat.tractor_flux_g[i]/dat.tractor_mw_transmission_g[i])</span>

<span class="n">fig</span><span class="p">,</span><span class="n">axes</span><span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">wspace</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">cnt</span><span class="o">=-</span><span class="mi">1</span>
<span class="k">for</span> <span class="n">ax</span><span class="p">,</span><span class="n">xaxis_band</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">axes</span><span class="p">,</span><span class="s1">&#39;grz&#39;</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">typ</span><span class="p">,</span><span class="n">color</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">TYPES</span><span class="p">,</span><span class="s1">&#39;brgy&#39;</span><span class="p">):</span>
        <span class="n">i</span><span class="o">=</span> <span class="p">(</span><span class="n">isRec</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">isType</span><span class="p">[</span><span class="n">typ</span><span class="p">])</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">dat</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">x</span><span class="o">=</span> <span class="n">plots</span><span class="o">.</span><span class="n">flux2mag</span><span class="p">(</span><span class="n">dat</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">xaxis_band</span><span class="o">+</span><span class="s1">&#39;flux&#39;</span><span class="p">)[</span><span class="n">i</span><span class="p">]</span><span class="o">/</span>\
                                      <span class="n">dat</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;mw_transmission_&#39;</span><span class="o">+</span><span class="n">xaxis_band</span><span class="p">)[</span><span class="n">i</span><span class="p">])</span>
            <span class="n">y</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">([(</span><span class="n">dat</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;tractor_flux_&#39;</span><span class="o">+</span><span class="n">band</span><span class="p">)[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">dat</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">band</span><span class="o">+</span><span class="s1">&#39;flux&#39;</span><span class="p">)[</span><span class="n">i</span><span class="p">])</span><span class="o">*</span>\
                         <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">dat</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;tractor_flux_ivar_&#39;</span><span class="o">+</span><span class="n">band</span><span class="p">)[</span><span class="n">i</span><span class="p">])</span>
                        <span class="k">for</span> <span class="n">band</span> <span class="ow">in</span> <span class="s1">&#39;grz&#39;</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="k">assert</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">dat</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>

            <span class="n">binned</span><span class="o">=</span> <span class="n">plots</span><span class="o">.</span><span class="n">bin_up</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span> <span class="n">bin_minmax</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span><span class="mi">25</span><span class="p">),</span><span class="n">nbins</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">binned</span><span class="p">[</span><span class="s1">&#39;binc&#39;</span><span class="p">],</span><span class="n">binned</span><span class="p">[</span><span class="s1">&#39;q50&#39;</span><span class="p">],</span><span class="n">c</span><span class="o">=</span><span class="n">color</span><span class="p">,</span>
                    <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="n">typ</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">binned</span><span class="p">[</span><span class="s1">&#39;binc&#39;</span><span class="p">],</span>
                            <span class="n">binned</span><span class="p">[</span><span class="s1">&#39;q25&#39;</span><span class="p">],</span><span class="n">binned</span><span class="p">[</span><span class="s1">&#39;q75&#39;</span><span class="p">],</span>
                            <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>

    <span class="c1">#plots.mytext(ax,0.01,0.9,typ,fontsize=15)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> (AB)&#39;</span> <span class="o">%</span> <span class="n">xaxis_band</span><span class="p">)</span>

<span class="n">leg</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper left&#39;</span><span class="p">,</span><span class="n">ncol</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;Average[ $\Delta\, Flux\,/\,\sigma$ ] (Tractor - Truth)&#39;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">]:</span>
    <span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">([])</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/nb_obiwan_methods_paper_95_0.png" src="../_images/nb_obiwan_methods_paper_95_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [121]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">)],</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>Out[121]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>array([ 0.,  1.,  2.,  3.,  4.,  5.,  6.,  7.,  8.,  9.])
</pre></div>
</div>
</div>
</div>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
    </p>
    <p>
        &copy; Copyright 2014-2018, Kaylan Burleigh, John Moustakas.<br/>
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.7.6.<br/>
    </p>
  </div>
</footer>
  </body>
</html>